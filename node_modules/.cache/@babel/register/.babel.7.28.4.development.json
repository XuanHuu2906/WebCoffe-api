<<<<<<< HEAD
{"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst cors = require('cors');\nconst mongoose = require('mongoose');\nconst path = require('path');\nrequire('dotenv').config();\n// Restart trigger\n\nconst app = express();\nconst PORT = process.env.PORT || 5002;\n\n// Middleware\napp.use(cors());\napp.use(express.json());\napp.use(express.urlencoded({\n  extended: true\n}));\n\n// Serve static files from uploads directory\napp.use('/uploads', express.static(path.join(__dirname, '../uploads')));\n\n// Database connection\nconst connectDB = async () => {\n  try {\n    console.log('Connecting to MongoDB...');\n    await mongoose.connect(process.env.MONGODB_URI);\n    console.log('MongoDB connected successfully - nodemon restart triggered');\n  } catch (error) {\n    console.error('MongoDB connection failed:', error.message);\n    console.log('\\n=== DATABASE SETUP REQUIRED ===');\n    console.log('MongoDB is not running or not installed.');\n    console.log('To set up MongoDB:');\n    console.log('1. Install MongoDB Community Server from: https://www.mongodb.com/try/download/community');\n    console.log('2. Start MongoDB service');\n    console.log('3. Restart this server');\n    console.log('\\nFor now, the server will continue without database connectivity.');\n    console.log('Some features may not work properly until MongoDB is set up.');\n    console.log('================================\\n');\n  }\n};\n\n// Routes\napp.get('/', (req, res) => {\n  res.json({\n    message: 'DREAM COFFEE API is running!'\n  });\n});\n\n// Import routes\napp.use('/api/products', require('./routes/products'));\napp.use('/api/auth', require('./routes/auth'));\napp.use('/api/orders', require('./routes/orders'));\napp.use('/api/payments', require('./routes/payments'));\napp.use('/api/upload', require('./routes/upload'));\napp.use('/api/admin', require('./routes/admin'));\napp.use('/api/shop', require('./routes/shop'));\napp.use('/api/contact', require('./routes/contact'));\n// app.use('/api/users', require('./routes/users'));\n\n// Error handling middleware\napp.use((err, req, res, next) => {\n  console.error(err.stack);\n  res.status(500).json({\n    message: 'Something went wrong!'\n  });\n});\n\n// 404 handler\napp.use('*', (req, res) => {\n  res.status(404).json({\n    message: 'Route not found'\n  });\n});\n\n// Start server\nconst startServer = async () => {\n  await connectDB();\n  app.listen(PORT, () => {\n    console.log(`Server is running on port ${PORT}`);\n    console.log(`API available at http://localhost:${PORT}`);\n  });\n};\nstartServer(); // restart with port 5002\n// trigger restart\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImNvcnMiLCJtb25nb29zZSIsInBhdGgiLCJjb25maWciLCJhcHAiLCJQT1JUIiwicHJvY2VzcyIsImVudiIsInVzZSIsImpzb24iLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJzdGF0aWMiLCJqb2luIiwiX19kaXJuYW1lIiwiY29ubmVjdERCIiwiY29uc29sZSIsImxvZyIsImNvbm5lY3QiLCJNT05HT0RCX1VSSSIsImVycm9yIiwibWVzc2FnZSIsImdldCIsInJlcSIsInJlcyIsImVyciIsIm5leHQiLCJzdGFjayIsInN0YXR1cyIsInN0YXJ0U2VydmVyIiwibGlzdGVuIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xcIiwic291cmNlcyI6WyJpbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3QgY29ycyA9IHJlcXVpcmUoJ2NvcnMnKTtcbmNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5yZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKTtcbi8vIFJlc3RhcnQgdHJpZ2dlclxuXG5jb25zdCBhcHAgPSBleHByZXNzKCk7XG5jb25zdCBQT1JUID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCA1MDAyO1xuXG4vLyBNaWRkbGV3YXJlXG5hcHAudXNlKGNvcnMoKSk7XG5hcHAudXNlKGV4cHJlc3MuanNvbigpKTtcbmFwcC51c2UoZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUgfSkpO1xuXG4vLyBTZXJ2ZSBzdGF0aWMgZmlsZXMgZnJvbSB1cGxvYWRzIGRpcmVjdG9yeVxuYXBwLnVzZSgnL3VwbG9hZHMnLCBleHByZXNzLnN0YXRpYyhwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vdXBsb2FkcycpKSk7XG5cbi8vIERhdGFiYXNlIGNvbm5lY3Rpb25cbmNvbnN0IGNvbm5lY3REQiA9IGFzeW5jICgpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnQ29ubmVjdGluZyB0byBNb25nb0RCLi4uJyk7XG4gICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdChwcm9jZXNzLmVudi5NT05HT0RCX1VSSSk7XG4gICAgY29uc29sZS5sb2coJ01vbmdvREIgY29ubmVjdGVkIHN1Y2Nlc3NmdWxseSAtIG5vZGVtb24gcmVzdGFydCB0cmlnZ2VyZWQnKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdNb25nb0RCIGNvbm5lY3Rpb24gZmFpbGVkOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIGNvbnNvbGUubG9nKCdcXG49PT0gREFUQUJBU0UgU0VUVVAgUkVRVUlSRUQgPT09Jyk7XG4gICAgY29uc29sZS5sb2coJ01vbmdvREIgaXMgbm90IHJ1bm5pbmcgb3Igbm90IGluc3RhbGxlZC4nKTtcbiAgICBjb25zb2xlLmxvZygnVG8gc2V0IHVwIE1vbmdvREI6Jyk7XG4gICAgY29uc29sZS5sb2coJzEuIEluc3RhbGwgTW9uZ29EQiBDb21tdW5pdHkgU2VydmVyIGZyb206IGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL3RyeS9kb3dubG9hZC9jb21tdW5pdHknKTtcbiAgICBjb25zb2xlLmxvZygnMi4gU3RhcnQgTW9uZ29EQiBzZXJ2aWNlJyk7XG4gICAgY29uc29sZS5sb2coJzMuIFJlc3RhcnQgdGhpcyBzZXJ2ZXInKTtcbiAgICBjb25zb2xlLmxvZygnXFxuRm9yIG5vdywgdGhlIHNlcnZlciB3aWxsIGNvbnRpbnVlIHdpdGhvdXQgZGF0YWJhc2UgY29ubmVjdGl2aXR5LicpO1xuICAgIGNvbnNvbGUubG9nKCdTb21lIGZlYXR1cmVzIG1heSBub3Qgd29yayBwcm9wZXJseSB1bnRpbCBNb25nb0RCIGlzIHNldCB1cC4nKTtcbiAgICBjb25zb2xlLmxvZygnPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cXG4nKTtcbiAgfVxufTtcblxuLy8gUm91dGVzXG5hcHAuZ2V0KCcvJywgKHJlcSwgcmVzKSA9PiB7XG4gIHJlcy5qc29uKHsgbWVzc2FnZTogJ0RSRUFNIENPRkZFRSBBUEkgaXMgcnVubmluZyEnIH0pO1xufSk7XG5cbi8vIEltcG9ydCByb3V0ZXNcbmFwcC51c2UoJy9hcGkvcHJvZHVjdHMnLCByZXF1aXJlKCcuL3JvdXRlcy9wcm9kdWN0cycpKTtcbmFwcC51c2UoJy9hcGkvYXV0aCcsIHJlcXVpcmUoJy4vcm91dGVzL2F1dGgnKSk7XG5hcHAudXNlKCcvYXBpL29yZGVycycsIHJlcXVpcmUoJy4vcm91dGVzL29yZGVycycpKTtcbmFwcC51c2UoJy9hcGkvcGF5bWVudHMnLCByZXF1aXJlKCcuL3JvdXRlcy9wYXltZW50cycpKTtcbmFwcC51c2UoJy9hcGkvdXBsb2FkJywgcmVxdWlyZSgnLi9yb3V0ZXMvdXBsb2FkJykpO1xuYXBwLnVzZSgnL2FwaS9hZG1pbicsIHJlcXVpcmUoJy4vcm91dGVzL2FkbWluJykpO1xuYXBwLnVzZSgnL2FwaS9zaG9wJywgcmVxdWlyZSgnLi9yb3V0ZXMvc2hvcCcpKTtcbmFwcC51c2UoJy9hcGkvY29udGFjdCcsIHJlcXVpcmUoJy4vcm91dGVzL2NvbnRhY3QnKSk7XG4vLyBhcHAudXNlKCcvYXBpL3VzZXJzJywgcmVxdWlyZSgnLi9yb3V0ZXMvdXNlcnMnKSk7XG5cbi8vIEVycm9yIGhhbmRsaW5nIG1pZGRsZXdhcmVcbmFwcC51c2UoKGVyciwgcmVxLCByZXMsIG5leHQpID0+IHtcbiAgY29uc29sZS5lcnJvcihlcnIuc3RhY2spO1xuICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdTb21ldGhpbmcgd2VudCB3cm9uZyEnIH0pO1xufSk7XG5cbi8vIDQwNCBoYW5kbGVyXG5hcHAudXNlKCcqJywgKHJlcSwgcmVzKSA9PiB7XG4gIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ1JvdXRlIG5vdCBmb3VuZCcgfSk7XG59KTtcblxuLy8gU3RhcnQgc2VydmVyXG5jb25zdCBzdGFydFNlcnZlciA9IGFzeW5jICgpID0+IHtcbiAgYXdhaXQgY29ubmVjdERCKCk7XG4gIGFwcC5saXN0ZW4oUE9SVCwgKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBTZXJ2ZXIgaXMgcnVubmluZyBvbiBwb3J0ICR7UE9SVH1gKTtcbiAgICBjb25zb2xlLmxvZyhgQVBJIGF2YWlsYWJsZSBhdCBodHRwOi8vbG9jYWxob3N0OiR7UE9SVH1gKTtcbiAgfSk7XG59O1xuXG5zdGFydFNlcnZlcigpOy8vIHJlc3RhcnQgd2l0aCBwb3J0IDUwMDJcbi8vIHRyaWdnZXIgcmVzdGFydFxuIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsTUFBTSxDQUFDO0FBQzVCLE1BQU1FLFFBQVEsR0FBR0YsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUNwQyxNQUFNRyxJQUFJLEdBQUdILE9BQU8sQ0FBQyxNQUFNLENBQUM7QUFDNUJBLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQ0ksTUFBTSxDQUFDLENBQUM7QUFDMUI7O0FBRUEsTUFBTUMsR0FBRyxHQUFHTixPQUFPLENBQUMsQ0FBQztBQUNyQixNQUFNTyxJQUFJLEdBQUdDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDRixJQUFJLElBQUksSUFBSTs7QUFFckM7QUFDQUQsR0FBRyxDQUFDSSxHQUFHLENBQUNSLElBQUksQ0FBQyxDQUFDLENBQUM7QUFDZkksR0FBRyxDQUFDSSxHQUFHLENBQUNWLE9BQU8sQ0FBQ1csSUFBSSxDQUFDLENBQUMsQ0FBQztBQUN2QkwsR0FBRyxDQUFDSSxHQUFHLENBQUNWLE9BQU8sQ0FBQ1ksVUFBVSxDQUFDO0VBQUVDLFFBQVEsRUFBRTtBQUFLLENBQUMsQ0FBQyxDQUFDOztBQUUvQztBQUNBUCxHQUFHLENBQUNJLEdBQUcsQ0FBQyxVQUFVLEVBQUVWLE9BQU8sQ0FBQ2MsTUFBTSxDQUFDVixJ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","map":{"version":3,"names":["express","require","cors","mongoose","path","config","app","PORT","process","env","use","json","urlencoded","extended","static","join","__dirname","connectDB","console","log","connect","MONGODB_URI","error","message","get","req","res","err","next","stack","status","startServer","listen"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\","sources":["index.js"],"sourcesContent":["const express = require('express');\nconst cors = require('cors');\nconst mongoose = require('mongoose');\nconst path = require('path');\nrequire('dotenv').config();\n// Restart trigger\n\nconst app = express();\nconst PORT = process.env.PORT || 5002;\n\n// Middleware\napp.use(cors());\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\n// Serve static files from uploads directory\napp.use('/uploads', express.static(path.join(__dirname, '../uploads')));\n\n// Database connection\nconst connectDB = async () => {\n  try {\n    console.log('Connecting to MongoDB...');\n    await mongoose.connect(process.env.MONGODB_URI);\n    console.log('MongoDB connected successfully - nodemon restart triggered');\n  } catch (error) {\n    console.error('MongoDB connection failed:', error.message);\n    console.log('\\n=== DATABASE SETUP REQUIRED ===');\n    console.log('MongoDB is not running or not installed.');\n    console.log('To set up MongoDB:');\n    console.log('1. Install MongoDB Community Server from: https://www.mongodb.com/try/download/community');\n    console.log('2. Start MongoDB service');\n    console.log('3. Restart this server');\n    console.log('\\nFor now, the server will continue without database connectivity.');\n    console.log('Some features may not work properly until MongoDB is set up.');\n    console.log('================================\\n');\n  }\n};\n\n// Routes\napp.get('/', (req, res) => {\n  res.json({ message: 'DREAM COFFEE API is running!' });\n});\n\n// Import routes\napp.use('/api/products', require('./routes/products'));\napp.use('/api/auth', require('./routes/auth'));\napp.use('/api/orders', require('./routes/orders'));\napp.use('/api/payments', require('./routes/payments'));\napp.use('/api/upload', require('./routes/upload'));\napp.use('/api/admin', require('./routes/admin'));\napp.use('/api/shop', require('./routes/shop'));\napp.use('/api/contact', require('./routes/contact'));\n// app.use('/api/users', require('./routes/users'));\n\n// Error handling middleware\napp.use((err, req, res, next) => {\n  console.error(err.stack);\n  res.status(500).json({ message: 'Something went wrong!' });\n});\n\n// 404 handler\napp.use('*', (req, res) => {\n  res.status(404).json({ message: 'Route not found' });\n});\n\n// Start server\nconst startServer = async () => {\n  await connectDB();\n  app.listen(PORT, () => {\n    console.log(`Server is running on port ${PORT}`);\n    console.log(`API available at http://localhost:${PORT}`);\n  });\n};\n\nstartServer();// restart with port 5002\n// trigger restart\n"],"mappings":"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","ignoreList":[]}},"mtime":1757589081061},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\products.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst Product = require('../models/Product');\nconst router = express.Router();\n\n// Sample products data for seeding (will be moved to database)\n// Products are now stored in MongoDB\n// Use the seedProducts.js script to populate the database with sample data\n\n// @route   GET /api/products\n// @desc    Get all products with optional filtering\n// @access  Public\nrouter.get('/', async (req, res) => {\n  try {\n    const {\n      category,\n      featured,\n      search,\n      page = 1,\n      limit = 10,\n      includeOutOfStock\n    } = req.query;\n\n    // Build query object\n    let query = {};\n\n    // Only filter by inStock if includeOutOfStock is not set to 'true'\n    if (includeOutOfStock !== 'true') {\n      query.inStock = true;\n    }\n    if (category) {\n      query.category = new RegExp(category, 'i');\n    }\n    if (featured === 'true') {\n      query.featured = true;\n    }\n    if (search) {\n      query.$or = [{\n        name: new RegExp(search, 'i')\n      }, {\n        description: new RegExp(search, 'i')\n      }];\n    }\n\n    // Calculate pagination\n    const pageNum = parseInt(page);\n    const limitNum = parseInt(limit);\n    const skip = (pageNum - 1) * limitNum;\n\n    // Execute queries\n    const [products, total] = await Promise.all([Product.find(query).skip(skip).limit(limitNum).sort({\n      createdAt: -1\n    }), Product.countDocuments(query)]);\n    res.json({\n      success: true,\n      data: products,\n      pagination: {\n        current: pageNum,\n        pages: Math.ceil(total / limitNum),\n        total: total\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching products:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching products'\n    });\n  }\n});\n\n// @route   GET /api/products/categories\n// @desc    Get all product categories\n// @access  Public\nrouter.get('/categories', async (req, res) => {\n  try {\n    // Return the enum categories from the schema instead of existing data\n    const categories = ['Cà phê', 'Thức uống đậm vị', 'Đồ uống tươi mát', 'Bánh ngọt'];\n    res.json({\n      success: true,\n      data: categories\n    });\n  } catch (error) {\n    console.error('Error fetching categories:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching categories'\n    });\n  }\n});\n\n// @route   GET /api/products/featured\n// @desc    Get featured products\n// @access  Public\nrouter.get('/featured', async (req, res) => {\n  try {\n    const featuredProducts = await Product.find({\n      featured: true,\n      inStock: true\n    });\n    res.json({\n      success: true,\n      data: featuredProducts\n    });\n  } catch (error) {\n    console.error('Error fetching featured products:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching featured products'\n    });\n  }\n});\n\n// @route   GET /api/products/bestsellers\n// @desc    Get best selling products\n// @access  Public\nrouter.get('/bestsellers', async (req, res) => {\n  try {\n    const Order = require('../models/Order');\n\n    // Get top selling products from order data\n    const bestSellers = await Order.aggregate([{\n      $unwind: '$items'\n    }, {\n      $group: {\n        _id: '$items.product',\n        name: {\n          $first: '$items.name'\n        },\n        totalSold: {\n          $sum: '$items.quantity'\n        },\n        totalRevenue: {\n          $sum: {\n            $multiply: ['$items.price', '$items.quantity']\n          }\n        }\n      }\n    }, {\n      $sort: {\n        totalSold: -1\n      }\n    }, {\n      $limit: 6\n    }]);\n\n    // Get full product details for best sellers\n    const productIds = bestSellers.map(item => item._id).filter(id => id);\n    const products = await Product.find({\n      _id: {\n        $in: productIds\n      },\n      inStock: true\n    });\n\n    // Merge sales data with product details\n    const bestSellerProducts = products.map(product => {\n      const salesData = bestSellers.find(item => item._id && item._id.toString() === product._id.toString());\n      return {\n        ...product.toObject(),\n        totalSold: salesData ? salesData.totalSold : 0\n      };\n    });\n\n    // Sort by total sold and limit to 6\n    bestSellerProducts.sort((a, b) => b.totalSold - a.totalSold);\n    res.json({\n      success: true,\n      data: bestSellerProducts.slice(0, 6)\n    });\n  } catch (error) {\n    console.error('Error fetching best sellers:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching best sellers'\n    });\n  }\n});\n\n// @route   GET /api/products/:id\n// @desc    Get single product\n// @access  Public\nrouter.get('/:id', async (req, res) => {\n  try {\n    const product = await Product.findById(req.params.id);\n    if (!product) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: product\n    });\n  } catch (error) {\n    console.error('Error fetching product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching product'\n    });\n  }\n});\n\n// @route   POST /api/products\n// @desc    Create new product\n// @access  Private/Admin\nrouter.post('/', async (req, res) => {\n  try {\n    const {\n      name,\n      category,\n      description,\n      price,\n      image,\n      imageUrl,\n      imagePublicId,\n      featured,\n      sizes\n    } = req.body;\n    const productData = {\n      name,\n      category,\n      description,\n      price: parseFloat(price),\n      image,\n      imageUrl,\n      imagePublicId,\n      featured: featured || false,\n      inStock: true,\n      sizes: sizes || [{\n        name: 'Regular',\n        price: parseFloat(price)\n      }]\n    };\n    const newProduct = await Product.create(productData);\n    res.status(201).json({\n      success: true,\n      data: newProduct\n    });\n  } catch (error) {\n    console.error('Error creating product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating product'\n    });\n  }\n});\n\n// @route   PUT /api/products/:id\n// @desc    Update product\n// @access  Private/Admin\nrouter.put('/:id', async (req, res) => {\n  try {\n    const {\n      name,\n      category,\n      description,\n      price,\n      image,\n      imageUrl,\n      imagePublicId,\n      featured,\n      inStock,\n      sizes\n    } = req.body;\n\n    // Get the existing product to check for old image\n    const existingProduct = await Product.findById(req.params.id);\n    if (!existingProduct) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n\n    // If updating with a new Cloudinary image, delete the old one\n    if (imagePublicId && existingProduct.imagePublicId && existingProduct.imagePublicId !== imagePublicId) {\n      try {\n        const {\n          deleteFromCloudinary\n        } = require('../config/cloudinary');\n        await deleteFromCloudinary(existingProduct.imagePublicId);\n      } catch (cloudinaryError) {\n        console.error('Error deleting old image from Cloudinary:', cloudinaryError);\n        // Continue with update even if Cloudinary deletion fails\n      }\n    }\n    const updateData = {};\n    if (name !== undefined) updateData.name = name;\n    if (category !== undefined) updateData.category = category;\n    if (description !== undefined) updateData.description = description;\n    if (price !== undefined) updateData.price = parseFloat(price);\n    if (image !== undefined) updateData.image = image;\n    if (imageUrl !== undefined) updateData.imageUrl = imageUrl;\n    if (imagePublicId !== undefined) updateData.imagePublicId = imagePublicId;\n    if (featured !== undefined) updateData.featured = featured;\n    if (inStock !== undefined) updateData.inStock = inStock;\n    if (sizes !== undefined) updateData.sizes = sizes;\n    const updatedProduct = await Product.findByIdAndUpdate(req.params.id, updateData, {\n      new: true,\n      runValidators: true\n    });\n    res.json({\n      success: true,\n      data: updatedProduct\n    });\n  } catch (error) {\n    console.error('Error updating product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating product'\n    });\n  }\n});\n\n// @route   DELETE /api/products/:id\n// @desc    Delete product\n// @access  Private/Admin\nrouter.delete('/:id', async (req, res) => {\n  try {\n    const product = await Product.findById(req.params.id);\n    if (!product) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n\n    // Delete image from Cloudinary if it exists\n    if (product.imagePublicId) {\n      try {\n        const {\n          deleteFromCloudinary\n        } = require('../config/cloudinary');\n        await deleteFromCloudinary(product.imagePublicId);\n      } catch (cloudinaryError) {\n        console.error('Error deleting image from Cloudinary:', cloudinaryError);\n        // Continue with product deletion even if Cloudinary deletion fails\n      }\n    }\n    const deletedProduct = await Product.findByIdAndDelete(req.params.id);\n    res.json({\n      success: true,\n      data: deletedProduct,\n      message: 'Product deleted successfully'\n    });\n  } catch (error) {\n    console.error('Error deleting product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while deleting product'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsIlByb2R1Y3QiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJnZXQiLCJyZXEiLCJyZXMiLCJjYXRlZ29yeSIsImZlYXR1cmVkIiwic2VhcmNoIiwicGFnZSIsImxpbWl0IiwiaW5jbHVkZU91dE9mU3RvY2siLCJxdWVyeSIsImluU3RvY2siLCJSZWdFeHAiLCIkb3IiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJwYWdlTnVtIiwicGFyc2VJbnQiLCJsaW1pdE51bSIsInNraXAiLCJwcm9kdWN0cyIsInRvdGFsIiwiUHJvbWlzZSIsImFsbCIsImZpbmQiLCJzb3J0IiwiY3JlYXRlZEF0IiwiY291bnREb2N1bWVudHMiLCJqc29uIiwic3VjY2VzcyIsImRhdGEiLCJwYWdpbmF0aW9uIiwiY3VycmVudCIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJlcnJvciIsImNvbnNvbGUiLCJzdGF0dXMiLCJtZXNzYWdlIiwiY2F0ZWdvcmllcyIsImZlYXR1cmVkUHJvZHVjdHMiLCJPcmRlciIsImJlc3RTZWxsZXJzIiwiYWdncmVnYXRlIiwiJHVud2luZCIsIiRncm91cCIsIl9pZCIsIiRmaXJzdCIsInRvdGFsU29sZCIsIiRzdW0iLCJ0b3RhbFJldmVudWUiLCIkbXVsdGlwbHkiLCIkc29ydCIsIiRsaW1pdCIsInByb2R1Y3RJZHMiLCJtYXAiLCJpdGVtIiwiZmlsdGVyIiwiaWQiLCIkaW4iLCJiZXN0U2VsbGVyUHJvZHVjdHMiLCJwcm9kdWN0Iiwic2FsZXNEYXRhIiwidG9TdHJpbmciLCJ0b09iamVjdCIsImEiLCJiIiwic2xpY2UiLCJmaW5kQnlJZCIsInBhcmFtcyIsInBvc3QiLCJwcmljZSIsImltYWdlIiwiaW1hZ2VVcmwiLCJpbWFnZVB1YmxpY0lkIiwic2l6ZXMiLCJib2R5IiwicHJvZHVjdERhdGEiLCJwYXJzZUZsb2F0IiwibmV3UHJvZHVjdCIsImNyZWF0ZSIsInB1dCIsImV4aXN0aW5nUHJvZHVjdCIsImRlbGV0ZUZyb21DbG91ZGluYXJ5IiwiY2xvdWRpbmFyeUVycm9yIiwidXBkYXRlRGF0YSIsInVuZGVmaW5lZCIsInVwZGF0ZWRQcm9kdWN0IiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJuZXciLCJydW5WYWxpZGF0b3JzIiwiZGVsZXRlIiwiZGVsZXRlZFByb2R1Y3QiLCJmaW5kQnlJZEFuZERlbGV0ZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkQ6XFxjb2RlXFxXZWJDYWZmZVxcYmFja2VuZFxcc3JjXFxyb3V0ZXNcXCIsInNvdXJjZXMiOlsicHJvZHVjdHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IFByb2R1Y3QgPSByZXF1aXJlKCcuLi9tb2RlbHMvUHJvZHVjdCcpO1xuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcblxuLy8gU2FtcGxlIHByb2R1Y3RzIGRhdGEgZm9yIHNlZWRpbmcgKHdpbGwgYmUgbW92ZWQgdG8gZGF0YWJhc2UpXG4vLyBQcm9kdWN0cyBhcmUgbm93IHN0b3JlZCBpbiBNb25nb0RCXG4vLyBVc2UgdGhlIHNlZWRQcm9kdWN0cy5qcyBzY3JpcHQgdG8gcG9wdWxhdGUgdGhlIGRhdGFiYXNlIHdpdGggc2FtcGxlIGRhdGFcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvcHJvZHVjdHNcbi8vIEBkZXNjICAgIEdldCBhbGwgcHJvZHVjdHMgd2l0aCBvcHRpb25hbCBmaWx0ZXJpbmdcbi8vIEBhY2Nlc3MgIFB1YmxpY1xucm91dGVyLmdldCgnLycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgY2F0ZWdvcnksIGZlYXR1cmVkLCBzZWFyY2gsIHBhZ2UgPSAxLCBsaW1pdCA9IDEwLCBpbmNsdWRlT3V0T2ZTdG9jayB9ID0gcmVxLnF1ZXJ5O1xuICAgIFxuICAgIC8vIEJ1aWxkIHF1ZXJ5IG9iamVjdFxuICAgIGxldCBxdWVyeSA9IHt9O1xuICAgIFxuICAgIC8vIE9ubHkgZmlsdGVyIGJ5IGluU3RvY2sgaWYgaW5jbHVkZU91dE9mU3RvY2sgaXMgbm90IHNldCB0byAndHJ1ZSdcbiAgICBpZiAoaW5jbHVkZU91dE9mU3RvY2sgIT09ICd0cnVlJykge1xuICAgICAgcXVlcnkuaW5TdG9jayA9IHRydWU7XG4gICAgfVxuICAgIFxuICAgIGlmIChjYXRlZ29yeSkge1xuICAgICAgcXVlcnkuY2F0ZWdvcnkgPSBuZXcgUmVnRXhwKGNhdGVnb3J5LCAnaScpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoZmVhdHVyZWQgPT09ICd0cnVlJykge1xuICAgICAgcXVlcnkuZmVhdHVyZWQgPSB0cnVlO1xuICAgIH1cbiAgICBcbiAgICBpZiAoc2VhcmNoKSB7XG4gICAgICBxdWVyeS4kb3IgPSBbXG4gICAgICAgIHsgbmFtZTogbmV3IFJlZ0V4cChzZWFyY2gsICdpJykgfSxcbiAgICAgICAgeyBkZXNjcmlwdGlvbjogbmV3IFJlZ0V4cChzZWFyY2gsICdpJykgfVxuICAgICAgXTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIHBhZ2luYXRpb25cbiAgICBjb25zdCBwYWdlTnVtID0gcGFyc2VJbnQocGFnZSk7XG4gICAgY29uc3QgbGltaXROdW0gPSBwYXJzZUludChsaW1pdCk7XG4gICAgY29uc3Qgc2tpcCA9IChwYWdlTnVtIC0gMSkgKiBsaW1pdE51bTtcbiAgICBcbiAgICAvLyBFeGVjdXRlIHF1ZXJpZXNcbiAgICBjb25zdCBbcHJvZHVjdHMsIHRvdGFsXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgIFByb2R1Y3QuZmluZChxdWVyeSlcbiAgICAgICAgLnNraXAoc2tpcClcbiAgICAgICAgLmxpbWl0KGxpbWl0TnVtKVxuICAgICAgICAuc29ydCh7IGNyZWF0ZWRBdDogLTEgfSksXG4gICAgICBQcm9kdWN0LmNvdW50RG9jdW1lbnRzKHF1ZXJ5KVxuICAgIF0pO1xuICAgIFxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBwcm9kdWN0cyxcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgY3VycmVudDogcGFnZU51bSxcbiAgICAgICAgcGFnZXM6IE1hdGguY2VpbCh0b3RhbCAvIGxpbWl0TnVtKSxcbiAgICAgICAgdG90YWw6IHRvdGFsXG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvZHVjdHM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBwcm9kdWN0cydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3Byb2R1Y3RzL2NhdGVnb3JpZXNcbi8vIEBkZXNjICAgIEdldCBhbGwgcHJvZHVjdCBjYXRlZ29yaWVzXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5nZXQoJy9jYXRlZ29yaWVzJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgLy8gUmV0dXJuIHRoZSBlbnVtIGNhdGVnb3JpZXMgZnJvbSB0aGUgc2NoZW1hIGluc3RlYWQgb2YgZXhpc3RpbmcgZGF0YVxuICAgIGNvbnN0IGNhdGVnb3JpZXMgPSBbJ0PDoCBwaMOqJywgJ1Ro4bupYyB14buRbmcgxJHhuq1tIHbhu4snLCAnxJDhu5MgdeG7kW5nIHTGsMahaSBtw6F0JywgJ0LDoW5oIG5n4buNdCddO1xuICAgIFxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBjYXRlZ29yaWVzXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgY2F0ZWdvcmllczonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIGNhdGVnb3JpZXMnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9wcm9kdWN0cy9mZWF0dXJlZFxuLy8gQGRlc2MgICAgR2V0IGZlYXR1cmVkIHByb2R1Y3RzXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5nZXQoJy9mZWF0dXJlZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGZlYXR1cmVkUHJvZHVjdHMgPSBhd2FpdCBQcm9kdWN0LmZpbmQoeyBmZWF0dXJlZDogdHJ1ZSwgaW5TdG9jazogdHJ1ZSB9KTtcbiAgICBcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogZmVhdHVyZWRQcm9kdWN0c1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGZlYXR1cmVkIHByb2R1Y3RzOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgZmVhdHVyZWQgcHJvZHVjdHMnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9wcm9kdWN0cy9iZXN0c2VsbGVyc1xuLy8gQGRlc2MgICAgR2V0IGJlc3Qgc2VsbGluZyBwcm9kdWN0c1xuLy8gQGFjY2VzcyAgUHVibGljXG5yb3V0ZXIuZ2V0KCcvYmVzdHNlbGxlcnMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBPcmRlciA9IHJlcXVpcmUoJy4uL21vZGVscy9PcmRlcicpO1xuICAgIFxuICAgIC8vIEdldCB0b3Agc2VsbGluZyBwcm9kdWN0cyBmcm9tIG9yZGVyIGRhdGFcbiAgICBjb25zdCBiZXN0U2VsbGVycyA9IGF3YWl0IE9yZGVyLmFnZ3JlZ2F0ZShbXG4gICAgICB7ICR1bndpbmQ6ICckaXRlbXMnIH0sXG4gICAgICB7XG4gICAgICAgICRncm91cDoge1xuICAgICAgICAgIF9pZDogJyRpdGVtcy5wcm9kdWN0JyxcbiAgICAgICAgICBuYW1lOiB7ICRmaXJzdDogJyRpdGVtcy5uYW1lJyB9LFxuICAgICAgICAgIHRvdGFsU29sZDogeyAkc3VtOiAnJGl0ZW1zLnF1YW50aXR5JyB9LFxuICAgICAgICAgIHRvdGFsUmV2ZW51ZTogeyAkc3VtOiB7ICRtdWx0aXBseTogWyckaXRlbXMucHJpY2UnLCAnJGl0ZW1zLnF1YW50aXR5J10gfSB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7ICRzb3J0OiB7IHRvdGFsU29sZDogLTEgfSB9LFxuICAgICAgeyAkbGltaXQ6IDYgfVxuICAgIF0pO1xuICAgIFxuICAgIC8vIEdldCBmdWxsIHByb2R1Y3QgZGV0YWlscyBmb3IgYmVzdCBzZWxsZXJzXG4gICAgY29uc3QgcHJvZHVjdElkcyA9IGJlc3RTZWxsZXJzLm1hcChpdGVtID0+IGl0ZW0uX2lkKS5maWx0ZXIoaWQgPT4gaWQpO1xuICAgIGNvbnN0IHByb2R1Y3RzID0gYXdhaXQgUHJvZHVjdC5maW5kKHsgXG4gICAgICBfaWQ6IHsgJGluOiBwcm9kdWN0SWRzIH0sIFxuICAgICAgaW5TdG9jazogdHJ1ZSBcbiAgICB9KTtcbiAgICBcbiAgICAvLyBNZXJnZSBzYWxlcyBkYXRhIHdpdGggcHJvZHVjdCBkZXRhaWxzXG4gICAgY29uc3QgYmVzdFNlbGxlclByb2R1Y3RzID0gcHJvZHVjdHMubWFwKHByb2R1Y3QgPT4ge1xuICAgICAgY29uc3Qgc2FsZXNEYXRhID0gYmVzdFNlbGxlcnMuZmluZChpdGVtID0+IFxuICAgICAgICBpdGVtLl9pZCAmJiBpdGVtLl9pZC50b1N0cmluZygpID09PSBwcm9kdWN0Ll9pZC50b1N0cmluZygpXG4gICAgICApO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucHJvZHVjdC50b09iamVjdCgpLFxuICAgICAgICB0b3RhbFNvbGQ6IHNhbGVzRGF0YSA/IHNhbGVzRGF0YS50b3RhbFNvbGQgOiAwXG4gICAgICB9O1xuICAgIH0pO1xuICAgIFxuICAgIC8vIFNvcnQgYnkgdG90YWwgc29sZCBhbmQgbGltaXQgdG8gNlxuICAgIGJlc3RTZWxsZXJQcm9kdWN0cy5zb3J0KChhLCBiKSA9PiBiLnRvdGFsU29sZCAtIGEudG90YWxTb2xkKTtcbiAgICBcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogYmVzdFNlbGxlclByb2R1Y3RzLnNsaWNlKDAsIDYpXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgYmVzdCBzZWxsZXJzOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgYmVzdCBzZWxsZXJzJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvcHJvZHVjdHMvOmlkXG4vLyBAZGVzYyAgICBHZXQgc2luZ2xlIHByb2R1Y3Rcbi8vIEBhY2Nlc3MgIFB1YmxpY1xucm91dGVyLmdldCgnLzppZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpO1xuICAgIFxuICAgIGlmICghcHJvZHVjdCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdQcm9kdWN0IG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogcHJvZHVjdFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHByb2R1Y3Q6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBwcm9kdWN0J1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3Byb2R1Y3RzXG4vLyBAZGVzYyAgICBDcmVhdGUgbmV3IHByb2R1Y3Rcbi8vIEBhY2Nlc3MgIFByaXZhdGUvQWRtaW5cbnJvdXRlci5wb3N0KCcvJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBuYW1lLCBjYXRlZ29yeSwgZGVzY3JpcHRpb24sIHByaWNlLCBpbWFnZSwgaW1hZ2VVcmwsIGltYWdlUHVibGljSWQsIGZlYXR1cmVkLCBzaXplcyB9ID0gcmVxLmJvZHk7XG4gICAgXG4gICAgY29uc3QgcHJvZHVjdERhdGEgPSB7XG4gICAgICBuYW1lLFxuICAgICAgY2F0ZWdvcnksXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHByaWNlOiBwYXJzZUZsb2F0KHByaWNlKSxcbiAgICAgIGltYWdlLFxuICAgICAgaW1hZ2VVcmwsXG4gICAgICBpbWFnZVB1YmxpY0lkLFxuICAgICAgZmVhdHVyZWQ6IGZlYXR1cmVkIHx8IGZhbHNlLFxuICAgICAgaW5TdG9jazogdHJ1ZSxcbiAgICAgIHNpemVzOiBzaXplcyB8fCBbeyBuYW1lOiAnUmVndWxhcicsIHByaWNlOiBwYXJzZUZsb2F0KHByaWNlKSB9XVxuICAgIH07XG4gICAgXG4gICAgY29uc3QgbmV3UHJvZHVjdCA9IGF3YWl0IFByb2R1Y3QuY3JlYXRlKHByb2R1Y3REYXRhKTtcbiAgICBcbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogbmV3UHJvZHVjdFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHByb2R1Y3Q6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBjcmVhdGluZyBwcm9kdWN0J1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUFVUIC9hcGkvcHJvZHVjdHMvOmlkXG4vLyBAZGVzYyAgICBVcGRhdGUgcHJvZHVjdFxuLy8gQGFjY2VzcyAgUHJpdmF0ZS9BZG1pblxucm91dGVyLnB1dCgnLzppZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgbmFtZSwgY2F0ZWdvcnksIGRlc2NyaXB0aW9uLCBwcmljZSwgaW1hZ2UsIGltYWdlVXJsLCBpbWFnZVB1YmxpY0lkLCBmZWF0dXJlZCwgaW5TdG9jaywgc2l6ZXMgfSA9IHJlcS5ib2R5O1xuICAgIFxuICAgIC8vIEdldCB0aGUgZXhpc3RpbmcgcHJvZHVjdCB0byBjaGVjayBmb3Igb2xkIGltYWdlXG4gICAgY29uc3QgZXhpc3RpbmdQcm9kdWN0ID0gYXdhaXQgUHJvZHVjdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcbiAgICBpZiAoIWV4aXN0aW5nUHJvZHVjdCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdQcm9kdWN0IG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBJZiB1cGRhdGluZyB3aXRoIGEgbmV3IENsb3VkaW5hcnkgaW1hZ2UsIGRlbGV0ZSB0aGUgb2xkIG9uZVxuICAgIGlmIChpbWFnZVB1YmxpY0lkICYmIGV4aXN0aW5nUHJvZHVjdC5pbWFnZVB1YmxpY0lkICYmIGV4aXN0aW5nUHJvZHVjdC5pbWFnZVB1YmxpY0lkICE9PSBpbWFnZVB1YmxpY0lkKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGRlbGV0ZUZyb21DbG91ZGluYXJ5IH0gPSByZXF1aXJlKCcuLi9jb25maWcvY2xvdWRpbmFyeScpO1xuICAgICAgICBhd2FpdCBkZWxldGVGcm9tQ2xvdWRpbmFyeShleGlzdGluZ1Byb2R1Y3QuaW1hZ2VQdWJsaWNJZCk7XG4gICAgICB9IGNhdGNoIChjbG91ZGluYXJ5RXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgb2xkIGltYWdlIGZyb20gQ2xvdWRpbmFyeTonLCBjbG91ZGluYXJ5RXJyb3IpO1xuICAgICAgICAvLyBDb250aW51ZSB3aXRoIHVwZGF0ZSBldmVuIGlmIENsb3VkaW5hcnkgZGVsZXRpb24gZmFpbHNcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgY29uc3QgdXBkYXRlRGF0YSA9IHt9O1xuICAgIGlmIChuYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IG5hbWU7XG4gICAgaWYgKGNhdGVnb3J5ICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuY2F0ZWdvcnkgPSBjYXRlZ29yeTtcbiAgICBpZiAoZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgIGlmIChwcmljZSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnByaWNlID0gcGFyc2VGbG9hdChwcmljZSk7XG4gICAgaWYgKGltYWdlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuaW1hZ2UgPSBpbWFnZTtcbiAgICBpZiAoaW1hZ2VVcmwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5pbWFnZVVybCA9IGltYWdlVXJsO1xuICAgIGlmIChpbWFnZVB1YmxpY0lkICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuaW1hZ2VQdWJsaWNJZCA9IGltYWdlUHVibGljSWQ7XG4gICAgaWYgKGZlYXR1cmVkICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuZmVhdHVyZWQgPSBmZWF0dXJlZDtcbiAgICBpZiAoaW5TdG9jayAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmluU3RvY2sgPSBpblN0b2NrO1xuICAgIGlmIChzaXplcyAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNpemVzID0gc2l6ZXM7XG4gICAgXG4gICAgY29uc3QgdXBkYXRlZFByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkQW5kVXBkYXRlKFxuICAgICAgcmVxLnBhcmFtcy5pZCxcbiAgICAgIHVwZGF0ZURhdGEsXG4gICAgICB7IG5ldzogdHJ1ZSwgcnVuVmFsaWRhdG9yczogdHJ1ZSB9XG4gICAgKTtcbiAgICBcblxuICAgIFxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB1cGRhdGVkUHJvZHVjdFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHByb2R1Y3Q6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSB1cGRhdGluZyBwcm9kdWN0J1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgREVMRVRFIC9hcGkvcHJvZHVjdHMvOmlkXG4vLyBAZGVzYyAgICBEZWxldGUgcHJvZHVjdFxuLy8gQGFjY2VzcyAgUHJpdmF0ZS9BZG1pblxucm91dGVyLmRlbGV0ZSgnLzppZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpO1xuICAgIFxuICAgIGlmICghcHJvZHVjdCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdQcm9kdWN0IG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBEZWxldGUgaW1hZ2UgZnJvbSBDbG91ZGluYXJ5IGlmIGl0IGV4aXN0c1xuICAgIGlmIChwcm9kdWN0LmltYWdlUHVibGljSWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgZGVsZXRlRnJvbUNsb3VkaW5hcnkgfSA9IHJlcXVpcmUoJy4uL2NvbmZpZy9jbG91ZGluYXJ5Jyk7XG4gICAgICAgIGF3YWl0IGRlbGV0ZUZyb21DbG91ZGluYXJ5KHByb2R1Y3QuaW1hZ2VQdWJsaWNJZCk7XG4gICAgICB9IGNhdGNoIChjbG91ZGluYXJ5RXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgaW1hZ2UgZnJvbSBDbG91ZGluYXJ5OicsIGNsb3VkaW5hcnlFcnJvcik7XG4gICAgICAgIC8vIENvbnRpbnVlIHdpdGggcHJvZHVjdCBkZWxldGlvbiBldmVuIGlmIENsb3VkaW5hcnkgZGVsZXRpb24gZmFpbHNcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgY29uc3QgZGVsZXRlZFByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkQW5kRGVsZXRlKHJlcS5wYXJhbXMuaWQpO1xuICAgIFxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBkZWxldGVkUHJvZHVjdCxcbiAgICAgIG1lc3NhZ2U6ICdQcm9kdWN0IGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5J1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRlbGV0aW5nIHByb2R1Y3Q6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBkZWxldGluZyBwcm9kdWN0J1xuICAgIH0pO1xuICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDNUMsTUFBTUUsTUFBTSxHQUFHSCxPQUFPLENBQUNJLE1BQU0sQ0FBQyxDQUFDOztBQUUvQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0FELE1BQU0sQ0FBQ0UsR0FBRyxDQUFDLEdBQUcsRUFBRSxPQUFPQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUNsQyxJQUFJO0lBQ0YsTUFBTTtNQUFFQyxRQUFRO01BQUVDLFFBQVE7TUFBRUMsTUFBTTtNQUFFQyxJQUFJLEdBQUcsQ0FBQztNQUFFQyxLQUFLLEdBQUcsRUFBRTtNQUFFQztJQUFrQixDQUFDLEdBQUdQLEdBQUcsQ0FBQ1EsS0FBSzs7SUFFekY7SUFDQSxJQUFJQSxLQUFLLEdBQUcsQ0FBQyxDQUFDOztJQUVkO0lBQ0EsSUFBSUQsaUJBQWlCLEtBQUssTUFBTSxFQUFFO01BQ2hDQyxLQUFLLENBQUNDLE9BQU8sR0FBRyxJQUFJO0lBQ3RCO0lBRUEsSUFBSVAsUUFBUSxFQUFFO01BQ1pNLEtBQUssQ0FBQ04sUUFBUSxHQUFHLElBQUlRLE1BQU0sQ0FBQ1IsUUFBUSxFQUFFLEdBQUcsQ0FBQztJQUM1QztJQUVBLElBQUlDLFFBQVEsS0FBSyxNQUFNLEVBQUU7TUFDdkJLLEtBQUssQ0FBQ0wsUUFBUSxHQUFHLElBQUk7SUFDdkI7SUFFQSxJQUFJQyxNQUFNLEVBQUU7TUFDVkksS0FBSyxDQUFDRyxHQUFHLEdBQUcsQ0FDVjtRQUFFQyxJQUFJLEVBQUUsSUFBSUYsTUFBTSxDQUFDTixNQUFNLEVBQUUsR0FBRztNQUFFLENBQUMsRUFDakM7UUFBRVMsV0FBVyxFQUFFLElBQUlILE1BQU0sQ0FBQ04s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","map":{"version":3,"names":["express","require","Product","router","Router","get","req","res","category","featured","search","page","limit","includeOutOfStock","query","inStock","RegExp","$or","name","description","pageNum","parseInt","limitNum","skip","products","total","Promise","all","find","sort","createdAt","countDocuments","json","success","data","pagination","current","pages","Math","ceil","error","console","status","message","categories","featuredProducts","Order","bestSellers","aggregate","$unwind","$group","_id","$first","totalSold","$sum","totalRevenue","$multiply","$sort","$limit","productIds","map","item","filter","id","$in","bestSellerProducts","product","salesData","toString","toObject","a","b","slice","findById","params","post","price","image","imageUrl","imagePublicId","sizes","body","productData","parseFloat","newProduct","create","put","existingProduct","deleteFromCloudinary","cloudinaryError","updateData","undefined","updatedProduct","findByIdAndUpdate","new","runValidators","delete","deletedProduct","findByIdAndDelete","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["products.js"],"sourcesContent":["const express = require('express');\nconst Product = require('../models/Product');\nconst router = express.Router();\n\n// Sample products data for seeding (will be moved to database)\n// Products are now stored in MongoDB\n// Use the seedProducts.js script to populate the database with sample data\n\n// @route   GET /api/products\n// @desc    Get all products with optional filtering\n// @access  Public\nrouter.get('/', async (req, res) => {\n  try {\n    const { category, featured, search, page = 1, limit = 10, includeOutOfStock } = req.query;\n    \n    // Build query object\n    let query = {};\n    \n    // Only filter by inStock if includeOutOfStock is not set to 'true'\n    if (includeOutOfStock !== 'true') {\n      query.inStock = true;\n    }\n    \n    if (category) {\n      query.category = new RegExp(category, 'i');\n    }\n    \n    if (featured === 'true') {\n      query.featured = true;\n    }\n    \n    if (search) {\n      query.$or = [\n        { name: new RegExp(search, 'i') },\n        { description: new RegExp(search, 'i') }\n      ];\n    }\n    \n    // Calculate pagination\n    const pageNum = parseInt(page);\n    const limitNum = parseInt(limit);\n    const skip = (pageNum - 1) * limitNum;\n    \n    // Execute queries\n    const [products, total] = await Promise.all([\n      Product.find(query)\n        .skip(skip)\n        .limit(limitNum)\n        .sort({ createdAt: -1 }),\n      Product.countDocuments(query)\n    ]);\n    \n    res.json({\n      success: true,\n      data: products,\n      pagination: {\n        current: pageNum,\n        pages: Math.ceil(total / limitNum),\n        total: total\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching products:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching products'\n    });\n  }\n});\n\n// @route   GET /api/products/categories\n// @desc    Get all product categories\n// @access  Public\nrouter.get('/categories', async (req, res) => {\n  try {\n    // Return the enum categories from the schema instead of existing data\n    const categories = ['Cà phê', 'Thức uống đậm vị', 'Đồ uống tươi mát', 'Bánh ngọt'];\n    \n    res.json({\n      success: true,\n      data: categories\n    });\n  } catch (error) {\n    console.error('Error fetching categories:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching categories'\n    });\n  }\n});\n\n// @route   GET /api/products/featured\n// @desc    Get featured products\n// @access  Public\nrouter.get('/featured', async (req, res) => {\n  try {\n    const featuredProducts = await Product.find({ featured: true, inStock: true });\n    \n    res.json({\n      success: true,\n      data: featuredProducts\n    });\n  } catch (error) {\n    console.error('Error fetching featured products:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching featured products'\n    });\n  }\n});\n\n// @route   GET /api/products/bestsellers\n// @desc    Get best selling products\n// @access  Public\nrouter.get('/bestsellers', async (req, res) => {\n  try {\n    const Order = require('../models/Order');\n    \n    // Get top selling products from order data\n    const bestSellers = await Order.aggregate([\n      { $unwind: '$items' },\n      {\n        $group: {\n          _id: '$items.product',\n          name: { $first: '$items.name' },\n          totalSold: { $sum: '$items.quantity' },\n          totalRevenue: { $sum: { $multiply: ['$items.price', '$items.quantity'] } }\n        }\n      },\n      { $sort: { totalSold: -1 } },\n      { $limit: 6 }\n    ]);\n    \n    // Get full product details for best sellers\n    const productIds = bestSellers.map(item => item._id).filter(id => id);\n    const products = await Product.find({ \n      _id: { $in: productIds }, \n      inStock: true \n    });\n    \n    // Merge sales data with product details\n    const bestSellerProducts = products.map(product => {\n      const salesData = bestSellers.find(item => \n        item._id && item._id.toString() === product._id.toString()\n      );\n      return {\n        ...product.toObject(),\n        totalSold: salesData ? salesData.totalSold : 0\n      };\n    });\n    \n    // Sort by total sold and limit to 6\n    bestSellerProducts.sort((a, b) => b.totalSold - a.totalSold);\n    \n    res.json({\n      success: true,\n      data: bestSellerProducts.slice(0, 6)\n    });\n  } catch (error) {\n    console.error('Error fetching best sellers:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching best sellers'\n    });\n  }\n});\n\n// @route   GET /api/products/:id\n// @desc    Get single product\n// @access  Public\nrouter.get('/:id', async (req, res) => {\n  try {\n    const product = await Product.findById(req.params.id);\n    \n    if (!product) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n    \n    res.json({\n      success: true,\n      data: product\n    });\n  } catch (error) {\n    console.error('Error fetching product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching product'\n    });\n  }\n});\n\n// @route   POST /api/products\n// @desc    Create new product\n// @access  Private/Admin\nrouter.post('/', async (req, res) => {\n  try {\n    const { name, category, description, price, image, imageUrl, imagePublicId, featured, sizes } = req.body;\n    \n    const productData = {\n      name,\n      category,\n      description,\n      price: parseFloat(price),\n      image,\n      imageUrl,\n      imagePublicId,\n      featured: featured || false,\n      inStock: true,\n      sizes: sizes || [{ name: 'Regular', price: parseFloat(price) }]\n    };\n    \n    const newProduct = await Product.create(productData);\n    \n    res.status(201).json({\n      success: true,\n      data: newProduct\n    });\n  } catch (error) {\n    console.error('Error creating product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating product'\n    });\n  }\n});\n\n// @route   PUT /api/products/:id\n// @desc    Update product\n// @access  Private/Admin\nrouter.put('/:id', async (req, res) => {\n  try {\n    const { name, category, description, price, image, imageUrl, imagePublicId, featured, inStock, sizes } = req.body;\n    \n    // Get the existing product to check for old image\n    const existingProduct = await Product.findById(req.params.id);\n    if (!existingProduct) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n    \n    // If updating with a new Cloudinary image, delete the old one\n    if (imagePublicId && existingProduct.imagePublicId && existingProduct.imagePublicId !== imagePublicId) {\n      try {\n        const { deleteFromCloudinary } = require('../config/cloudinary');\n        await deleteFromCloudinary(existingProduct.imagePublicId);\n      } catch (cloudinaryError) {\n        console.error('Error deleting old image from Cloudinary:', cloudinaryError);\n        // Continue with update even if Cloudinary deletion fails\n      }\n    }\n    \n    const updateData = {};\n    if (name !== undefined) updateData.name = name;\n    if (category !== undefined) updateData.category = category;\n    if (description !== undefined) updateData.description = description;\n    if (price !== undefined) updateData.price = parseFloat(price);\n    if (image !== undefined) updateData.image = image;\n    if (imageUrl !== undefined) updateData.imageUrl = imageUrl;\n    if (imagePublicId !== undefined) updateData.imagePublicId = imagePublicId;\n    if (featured !== undefined) updateData.featured = featured;\n    if (inStock !== undefined) updateData.inStock = inStock;\n    if (sizes !== undefined) updateData.sizes = sizes;\n    \n    const updatedProduct = await Product.findByIdAndUpdate(\n      req.params.id,\n      updateData,\n      { new: true, runValidators: true }\n    );\n    \n\n    \n    res.json({\n      success: true,\n      data: updatedProduct\n    });\n  } catch (error) {\n    console.error('Error updating product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating product'\n    });\n  }\n});\n\n// @route   DELETE /api/products/:id\n// @desc    Delete product\n// @access  Private/Admin\nrouter.delete('/:id', async (req, res) => {\n  try {\n    const product = await Product.findById(req.params.id);\n    \n    if (!product) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n    \n    // Delete image from Cloudinary if it exists\n    if (product.imagePublicId) {\n      try {\n        const { deleteFromCloudinary } = require('../config/cloudinary');\n        await deleteFromCloudinary(product.imagePublicId);\n      } catch (cloudinaryError) {\n        console.error('Error deleting image from Cloudinary:', cloudinaryError);\n        // Continue with product deletion even if Cloudinary deletion fails\n      }\n    }\n    \n    const deletedProduct = await Product.findByIdAndDelete(req.params.id);\n    \n    res.json({\n      success: true,\n      data: deletedProduct,\n      message: 'Product deleted successfully'\n    });\n  } catch (error) {\n    console.error('Error deleting product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while deleting product'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1757524331863},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\Product.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const mongoose = require('mongoose');\nconst productSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: [true, 'Product name is required'],\n    trim: true,\n    maxlength: [100, 'Product name cannot exceed 100 characters']\n  },\n  description: {\n    type: String,\n    required: [true, 'Product description is required'],\n    maxlength: [500, 'Description cannot exceed 500 characters']\n  },\n  price: {\n    type: Number,\n    required: [true, 'Product price is required'],\n    min: [0, 'Price cannot be negative']\n  },\n  category: {\n    type: String,\n    required: [true, 'Product category is required'],\n    enum: ['Cà phê', 'Thức uống đậm vị', 'Đồ uống tươi mát', 'Bánh ngọt'],\n    trim: true\n  },\n  image: {\n    type: String,\n    default: '/images/default-product.jpg'\n  },\n  imageUrl: {\n    type: String,\n    default: null\n  },\n  imagePublicId: {\n    type: String,\n    default: null\n  },\n  inStock: {\n    type: Boolean,\n    default: true\n  },\n  featured: {\n    type: Boolean,\n    default: false\n  },\n  ingredients: [{\n    type: String,\n    trim: true\n  }],\n  nutritionalInfo: {\n    calories: {\n      type: Number,\n      min: 0\n    },\n    protein: {\n      type: Number,\n      min: 0\n    },\n    carbs: {\n      type: Number,\n      min: 0\n    },\n    fat: {\n      type: Number,\n      min: 0\n    }\n  },\n  sizes: [{\n    name: {\n      type: String,\n      required: true\n    },\n    // Small, Medium, Large\n    price: {\n      type: Number,\n      required: true,\n      min: 0\n    },\n    available: {\n      type: Boolean,\n      default: true\n    }\n  }]\n}, {\n  timestamps: true\n});\n\n// Index for better search performance\nproductSchema.index({\n  name: 'text',\n  description: 'text'\n});\nproductSchema.index({\n  category: 1\n});\nproductSchema.index({\n  featured: 1\n});\nproductSchema.index({\n  inStock: 1\n});\nmodule.exports = mongoose.model('Product', productSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJwcm9kdWN0U2NoZW1hIiwiU2NoZW1hIiwibmFtZSIsInR5cGUiLCJTdHJpbmciLCJyZXF1aXJlZCIsInRyaW0iLCJtYXhsZW5ndGgiLCJkZXNjcmlwdGlvbiIsInByaWNlIiwiTnVtYmVyIiwibWluIiwiY2F0ZWdvcnkiLCJlbnVtIiwiaW1hZ2UiLCJkZWZhdWx0IiwiaW1hZ2VVcmwiLCJpbWFnZVB1YmxpY0lkIiwiaW5TdG9jayIsIkJvb2xlYW4iLCJmZWF0dXJlZCIsImluZ3JlZGllbnRzIiwibnV0cml0aW9uYWxJbmZvIiwiY2Fsb3JpZXMiLCJwcm90ZWluIiwiY2FyYnMiLCJmYXQiLCJzaXplcyIsImF2YWlsYWJsZSIsInRpbWVzdGFtcHMiLCJpbmRleCIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2RlbCJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXG1vZGVsc1xcIiwic291cmNlcyI6WyJQcm9kdWN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcblxuY29uc3QgcHJvZHVjdFNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICBuYW1lOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ1Byb2R1Y3QgbmFtZSBpcyByZXF1aXJlZCddLFxuICAgIHRyaW06IHRydWUsXG4gICAgbWF4bGVuZ3RoOiBbMTAwLCAnUHJvZHVjdCBuYW1lIGNhbm5vdCBleGNlZWQgMTAwIGNoYXJhY3RlcnMnXVxuICB9LFxuICBkZXNjcmlwdGlvbjoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICByZXF1aXJlZDogW3RydWUsICdQcm9kdWN0IGRlc2NyaXB0aW9uIGlzIHJlcXVpcmVkJ10sXG4gICAgbWF4bGVuZ3RoOiBbNTAwLCAnRGVzY3JpcHRpb24gY2Fubm90IGV4Y2VlZCA1MDAgY2hhcmFjdGVycyddXG4gIH0sXG4gIHByaWNlOiB7XG4gICAgdHlwZTogTnVtYmVyLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ1Byb2R1Y3QgcHJpY2UgaXMgcmVxdWlyZWQnXSxcbiAgICBtaW46IFswLCAnUHJpY2UgY2Fubm90IGJlIG5lZ2F0aXZlJ11cbiAgfSxcbiAgY2F0ZWdvcnk6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgcmVxdWlyZWQ6IFt0cnVlLCAnUHJvZHVjdCBjYXRlZ29yeSBpcyByZXF1aXJlZCddLFxuICAgIGVudW06IFsnQ8OgIHBow6onLCAnVGjhu6ljIHXhu5FuZyDEkeG6rW0gduG7iycsICfEkOG7kyB14buRbmcgdMawxqFpIG3DoXQnLCAnQsOhbmggbmfhu410J10sXG4gICAgdHJpbTogdHJ1ZVxuICB9LFxuICBpbWFnZToge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICBkZWZhdWx0OiAnL2ltYWdlcy9kZWZhdWx0LXByb2R1Y3QuanBnJ1xuICB9LFxuICBpbWFnZVVybDoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICBkZWZhdWx0OiBudWxsXG4gIH0sXG4gIGltYWdlUHVibGljSWQ6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgZGVmYXVsdDogbnVsbFxuICB9LFxuICBpblN0b2NrOiB7XG4gICAgdHlwZTogQm9vbGVhbixcbiAgICBkZWZhdWx0OiB0cnVlXG4gIH0sXG4gIGZlYXR1cmVkOiB7XG4gICAgdHlwZTogQm9vbGVhbixcbiAgICBkZWZhdWx0OiBmYWxzZVxuICB9LFxuICBpbmdyZWRpZW50czogW3tcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgdHJpbTogdHJ1ZVxuICB9XSxcbiAgbnV0cml0aW9uYWxJbmZvOiB7XG4gICAgY2Fsb3JpZXM6IHsgdHlwZTogTnVtYmVyLCBtaW46IDAgfSxcbiAgICBwcm90ZWluOiB7IHR5cGU6IE51bWJlciwgbWluOiAwIH0sXG4gICAgY2FyYnM6IHsgdHlwZTogTnVtYmVyLCBtaW46IDAgfSxcbiAgICBmYXQ6IHsgdHlwZTogTnVtYmVyLCBtaW46IDAgfVxuICB9LFxuICBzaXplczogW3tcbiAgICBuYW1lOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUgfSwgLy8gU21hbGwsIE1lZGl1bSwgTGFyZ2VcbiAgICBwcmljZTogeyB0eXBlOiBOdW1iZXIsIHJlcXVpcmVkOiB0cnVlLCBtaW46IDAgfSxcbiAgICBhdmFpbGFibGU6IHsgdHlwZTogQm9vbGVhbiwgZGVmYXVsdDogdHJ1ZSB9XG4gIH1dXG59LCB7XG4gIHRpbWVzdGFtcHM6IHRydWVcbn0pO1xuXG4vLyBJbmRleCBmb3IgYmV0dGVyIHNlYXJjaCBwZXJmb3JtYW5jZVxucHJvZHVjdFNjaGVtYS5pbmRleCh7IG5hbWU6ICd0ZXh0JywgZGVzY3JpcHRpb246ICd0ZXh0JyB9KTtcbnByb2R1Y3RTY2hlbWEuaW5kZXgoeyBjYXRlZ29yeTogMSB9KTtcbnByb2R1Y3RTY2hlbWEuaW5kZXgoeyBmZWF0dXJlZDogMSB9KTtcbnByb2R1Y3RTY2hlbWEuaW5kZXgoeyBpblN0b2NrOiAxIH0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IG1vbmdvb3NlLm1vZGVsKCdQcm9kdWN0JywgcHJvZHVjdFNjaGVtYSk7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFFcEMsTUFBTUMsYUFBYSxHQUFHLElBQUlGLFFBQVEsQ0FBQ0csTUFBTSxDQUFDO0VBQ3hDQyxJQUFJLEVBQUU7SUFDSkMsSUFBSSxFQUFFQyxNQUFNO0lBQ1pDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSwwQkFBMEIsQ0FBQztJQUM1Q0MsSUFBSSxFQUFFLElBQUk7SUFDVkMsU0FBUyxFQUFFLENBQUMsR0FBRyxFQUFFLDJDQUEyQztFQUM5RCxDQUFDO0VBQ0RDLFdBQVcsRUFBRTtJQUNYTCxJQUFJLEVBQUVDLE1BQU07SUFDWkMsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLGlDQUFpQyxDQUFDO0lBQ25ERSxTQUFTLEVBQUUsQ0FBQyxHQUFHLEVBQUUsMENBQTBD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","map":{"version":3,"names":["mongoose","require","productSchema","Schema","name","type","String","required","trim","maxlength","description","price","Number","min","category","enum","image","default","imageUrl","imagePublicId","inStock","Boolean","featured","ingredients","nutritionalInfo","calories","protein","carbs","fat","sizes","available","timestamps","index","module","exports","model"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\models\\","sources":["Product.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst productSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: [true, 'Product name is required'],\n    trim: true,\n    maxlength: [100, 'Product name cannot exceed 100 characters']\n  },\n  description: {\n    type: String,\n    required: [true, 'Product description is required'],\n    maxlength: [500, 'Description cannot exceed 500 characters']\n  },\n  price: {\n    type: Number,\n    required: [true, 'Product price is required'],\n    min: [0, 'Price cannot be negative']\n  },\n  category: {\n    type: String,\n    required: [true, 'Product category is required'],\n    enum: ['Cà phê', 'Thức uống đậm vị', 'Đồ uống tươi mát', 'Bánh ngọt'],\n    trim: true\n  },\n  image: {\n    type: String,\n    default: '/images/default-product.jpg'\n  },\n  imageUrl: {\n    type: String,\n    default: null\n  },\n  imagePublicId: {\n    type: String,\n    default: null\n  },\n  inStock: {\n    type: Boolean,\n    default: true\n  },\n  featured: {\n    type: Boolean,\n    default: false\n  },\n  ingredients: [{\n    type: String,\n    trim: true\n  }],\n  nutritionalInfo: {\n    calories: { type: Number, min: 0 },\n    protein: { type: Number, min: 0 },\n    carbs: { type: Number, min: 0 },\n    fat: { type: Number, min: 0 }\n  },\n  sizes: [{\n    name: { type: String, required: true }, // Small, Medium, Large\n    price: { type: Number, required: true, min: 0 },\n    available: { type: Boolean, default: true }\n  }]\n}, {\n  timestamps: true\n});\n\n// Index for better search performance\nproductSchema.index({ name: 'text', description: 'text' });\nproductSchema.index({ category: 1 });\nproductSchema.index({ featured: 1 });\nproductSchema.index({ inStock: 1 });\n\nmodule.exports = mongoose.model('Product', productSchema);"],"mappings":"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","ignoreList":[]}},"mtime":1757433503379},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\auth.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst jwt = require('jsonwebtoken');\nconst User = require('../models/User');\nconst {\n  protect\n} = require('../middleware/auth');\n\n// Generate JWT Token\nconst generateToken = userId => {\n  return jwt.sign({\n    userId\n  }, process.env.JWT_SECRET || 'fallback_secret', {\n    expiresIn: process.env.JWT_EXPIRE || '30d'\n  });\n};\n\n// @route   POST /api/auth/register\n// @desc    Register a new user\n// @access  Public\nrouter.post('/register', async (req, res) => {\n  try {\n    const {\n      firstName,\n      lastName,\n      email,\n      password,\n      phone,\n      role\n    } = req.body;\n\n    // Check if user already exists\n    const existingUser = await User.findOne({\n      email: email.toLowerCase().trim()\n    });\n    if (existingUser) {\n      return res.status(400).json({\n        success: false,\n        message: 'User already exists with this email'\n      });\n    }\n\n    // Create new user (password will be hashed automatically by the User model)\n    const newUser = new User({\n      firstName,\n      lastName,\n      email: email.toLowerCase().trim(),\n      password,\n      phone,\n      role: role || 'customer'\n    });\n    await newUser.save();\n\n    // Generate token\n    const token = generateToken(newUser._id);\n\n    // Remove password from response\n    const userResponse = {\n      _id: newUser._id,\n      firstName: newUser.firstName,\n      lastName: newUser.lastName,\n      email: newUser.email,\n      phone: newUser.phone,\n      role: newUser.role,\n      createdAt: newUser.createdAt\n    };\n    res.status(201).json({\n      success: true,\n      token,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Registration error:', error);\n\n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n\n    // Handle duplicate key error\n    if (error.code === 11000) {\n      return res.status(400).json({\n        success: false,\n        message: 'User already exists with this email'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error during registration'\n    });\n  }\n});\n\n// @route   POST /api/auth/login\n// @desc    Login user\n// @access  Public\nrouter.post('/login', async (req, res) => {\n  try {\n    const {\n      email,\n      password\n    } = req.body;\n\n    // Find user by email (include password for comparison)\n    const user = await User.findOne({\n      email: email.toLowerCase().trim()\n    }).select('+password');\n    if (!user) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid credentials'\n      });\n    }\n\n    // Check if user is active\n    if (!user.isActive) {\n      return res.status(401).json({\n        success: false,\n        message: 'Account is deactivated'\n      });\n    }\n\n    // Check password using the model method\n    const isMatch = await user.comparePassword(password);\n    if (!isMatch) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid credentials'\n      });\n    }\n\n    // Generate token\n    const token = generateToken(user._id);\n\n    // Remove password from response\n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      createdAt: user.createdAt\n    };\n    res.json({\n      success: true,\n      token,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Login error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error during login'\n    });\n  }\n});\n\n// @route   GET /api/auth/me\n// @desc    Get current user\n// @access  Private\nrouter.get('/me', protect, async (req, res) => {\n  try {\n    // req.user is set by the auth middleware\n    const user = await User.findById(req.user._id);\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n\n    // Check if user is active\n    if (!user.isActive) {\n      return res.status(401).json({\n        success: false,\n        message: 'Account is deactivated'\n      });\n    }\n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      createdAt: user.createdAt\n    };\n    res.json({\n      success: true,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Get user error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   PUT /api/auth/profile\n// @desc    Update user profile\n// @access  Private\nrouter.put('/profile', protect, async (req, res) => {\n  try {\n    const {\n      firstName,\n      lastName,\n      email,\n      phone,\n      address,\n      preferences\n    } = req.body;\n\n    // Find the current user\n    const user = await User.findById(req.user._id);\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n\n    // Check if email is being changed and if it already exists\n    if (email && email.toLowerCase().trim() !== user.email) {\n      const existingUser = await User.findOne({\n        email: email.toLowerCase().trim(),\n        _id: {\n          $ne: user._id\n        }\n      });\n      if (existingUser) {\n        return res.status(400).json({\n          success: false,\n          message: 'Email already exists'\n        });\n      }\n    }\n\n    // Update user fields\n    if (firstName) user.firstName = firstName;\n    if (lastName) user.lastName = lastName;\n    if (email) user.email = email.toLowerCase().trim();\n    if (phone) user.phone = phone;\n    if (address) {\n      user.address = {\n        ...user.address,\n        ...address\n      };\n    }\n    if (preferences) {\n      user.preferences = {\n        ...user.preferences,\n        ...preferences\n      };\n    }\n    await user.save();\n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      address: user.address,\n      preferences: user.preferences,\n      createdAt: user.createdAt,\n      updatedAt: user.updatedAt\n    };\n    res.json({\n      success: true,\n      message: 'Profile updated successfully',\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Profile update error:', error);\n\n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n\n    // Handle duplicate key error\n    if (error.code === 11000) {\n      return res.status(400).json({\n        success: false,\n        message: 'Email already exists'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error during profile update'\n    });\n  }\n});\n\n// @route   PUT /api/auth/password\n// @desc    Change user password\n// @access  Private\nrouter.put('/password', protect, async (req, res) => {\n  try {\n    const {\n      currentPassword,\n      newPassword\n    } = req.body;\n    if (!currentPassword || !newPassword) {\n      return res.status(400).json({\n        success: false,\n        message: 'Current password and new password are required'\n      });\n    }\n    if (newPassword.length < 6) {\n      return res.status(400).json({\n        success: false,\n        message: 'New password must be at least 6 characters long'\n      });\n    }\n\n    // Find the current user with password\n    const user = await User.findById(req.user._id).select('+password');\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n\n    // Check current password\n    const isMatch = await user.comparePassword(currentPassword);\n    if (!isMatch) {\n      return res.status(400).json({\n        success: false,\n        message: 'Current password is incorrect'\n      });\n    }\n\n    // Update password (will be hashed automatically by the User model)\n    user.password = newPassword;\n    await user.save();\n    res.json({\n      success: true,\n      message: 'Password updated successfully'\n    });\n  } catch (error) {\n    console.error('Password update error:', error);\n\n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error during password update'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsImp3dCIsIlVzZXIiLCJwcm90ZWN0IiwiZ2VuZXJhdGVUb2tlbiIsInVzZXJJZCIsInNpZ24iLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImV4cGlyZXNJbiIsIkpXVF9FWFBJUkUiLCJwb3N0IiwicmVxIiwicmVzIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJlbWFpbCIsInBhc3N3b3JkIiwicGhvbmUiLCJyb2xlIiwiYm9keSIsImV4aXN0aW5nVXNlciIsImZpbmRPbmUiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJuZXdVc2VyIiwic2F2ZSIsInRva2VuIiwiX2lkIiwidXNlclJlc3BvbnNlIiwiY3JlYXRlZEF0IiwidXNlciIsImVycm9yIiwiY29uc29sZSIsIm5hbWUiLCJtZXNzYWdlcyIsIk9iamVjdCIsInZhbHVlcyIsImVycm9ycyIsIm1hcCIsImVyciIsImpvaW4iLCJjb2RlIiwic2VsZWN0IiwiaXNBY3RpdmUiLCJpc01hdGNoIiwiY29tcGFyZVBhc3N3b3JkIiwibG95YWx0eVBvaW50cyIsImdldCIsImZpbmRCeUlkIiwicHV0IiwiYWRkcmVzcyIsInByZWZlcmVuY2VzIiwiJG5lIiwidXBkYXRlZEF0IiwiY3VycmVudFBhc3N3b3JkIiwibmV3UGFzc3dvcmQiLCJsZW5ndGgiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xccm91dGVzXFwiLCJzb3VyY2VzIjpbImF1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5jb25zdCBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKTtcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xuY29uc3QgeyBwcm90ZWN0IH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcblxuLy8gR2VuZXJhdGUgSldUIFRva2VuXG5jb25zdCBnZW5lcmF0ZVRva2VuID0gKHVzZXJJZCkgPT4ge1xuICByZXR1cm4gand0LnNpZ24oeyB1c2VySWQgfSwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCB8fCAnZmFsbGJhY2tfc2VjcmV0Jywge1xuICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSRSB8fCAnMzBkJ1xuICB9KTtcbn07XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9hdXRoL3JlZ2lzdGVyXG4vLyBAZGVzYyAgICBSZWdpc3RlciBhIG5ldyB1c2VyXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5wb3N0KCcvcmVnaXN0ZXInLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGZpcnN0TmFtZSwgbGFzdE5hbWUsIGVtYWlsLCBwYXNzd29yZCwgcGhvbmUsIHJvbGUgfSA9IHJlcS5ib2R5O1xuICAgIFxuICAgIC8vIENoZWNrIGlmIHVzZXIgYWxyZWFkeSBleGlzdHNcbiAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKS50cmltKCkgfSk7XG4gICAgaWYgKGV4aXN0aW5nVXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdVc2VyIGFscmVhZHkgZXhpc3RzIHdpdGggdGhpcyBlbWFpbCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBDcmVhdGUgbmV3IHVzZXIgKHBhc3N3b3JkIHdpbGwgYmUgaGFzaGVkIGF1dG9tYXRpY2FsbHkgYnkgdGhlIFVzZXIgbW9kZWwpXG4gICAgY29uc3QgbmV3VXNlciA9IG5ldyBVc2VyKHtcbiAgICAgIGZpcnN0TmFtZSxcbiAgICAgIGxhc3ROYW1lLFxuICAgICAgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkudHJpbSgpLFxuICAgICAgcGFzc3dvcmQsXG4gICAgICBwaG9uZSxcbiAgICAgIHJvbGU6IHJvbGUgfHwgJ2N1c3RvbWVyJ1xuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IG5ld1VzZXIuc2F2ZSgpO1xuICAgIFxuICAgIC8vIEdlbmVyYXRlIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSBnZW5lcmF0ZVRva2VuKG5ld1VzZXIuX2lkKTtcbiAgICBcbiAgICAvLyBSZW1vdmUgcGFzc3dvcmQgZnJvbSByZXNwb25zZVxuICAgIGNvbnN0IHVzZXJSZXNwb25zZSA9IHtcbiAgICAgIF9pZDogbmV3VXNlci5faWQsXG4gICAgICBmaXJzdE5hbWU6IG5ld1VzZXIuZmlyc3ROYW1lLFxuICAgICAgbGFzdE5hbWU6IG5ld1VzZXIubGFzdE5hbWUsXG4gICAgICBlbWFpbDogbmV3VXNlci5lbWFpbCxcbiAgICAgIHBob25lOiBuZXdVc2VyLnBob25lLFxuICAgICAgcm9sZTogbmV3VXNlci5yb2xlLFxuICAgICAgY3JlYXRlZEF0OiBuZXdVc2VyLmNyZWF0ZWRBdFxuICAgIH07XG4gICAgXG4gICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHRva2VuLFxuICAgICAgdXNlcjogdXNlclJlc3BvbnNlXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignUmVnaXN0cmF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICBcbiAgICAvLyBIYW5kbGUgdmFsaWRhdGlvbiBlcnJvcnNcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1ZhbGlkYXRpb25FcnJvcicpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gT2JqZWN0LnZhbHVlcyhlcnJvci5lcnJvcnMpLm1hcChlcnIgPT4gZXJyLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VzLmpvaW4oJywgJylcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgZHVwbGljYXRlIGtleSBlcnJvclxuICAgIGlmIChlcnJvci5jb2RlID09PSAxMTAwMCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdVc2VyIGFscmVhZHkgZXhpc3RzIHdpdGggdGhpcyBlbWFpbCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3IgZHVyaW5nIHJlZ2lzdHJhdGlvbidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9hdXRoL2xvZ2luXG4vLyBAZGVzYyAgICBMb2dpbiB1c2VyXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5wb3N0KCcvbG9naW4nLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XG4gICAgXG4gICAgLy8gRmluZCB1c2VyIGJ5IGVtYWlsIChpbmNsdWRlIHBhc3N3b3JkIGZvciBjb21wYXJpc29uKVxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKS50cmltKCkgfSkuc2VsZWN0KCcrcGFzc3dvcmQnKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBjcmVkZW50aWFscydcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGFjdGl2ZVxuICAgIGlmICghdXNlci5pc0FjdGl2ZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdBY2NvdW50IGlzIGRlYWN0aXZhdGVkJ1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIHBhc3N3b3JkIHVzaW5nIHRoZSBtb2RlbCBtZXRob2RcbiAgICBjb25zdCBpc01hdGNoID0gYXdhaXQgdXNlci5jb21wYXJlUGFzc3dvcmQocGFzc3dvcmQpO1xuICAgIGlmICghaXNNYXRjaCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGNyZWRlbnRpYWxzJ1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIEdlbmVyYXRlIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSBnZW5lcmF0ZVRva2VuKHVzZXIuX2lkKTtcbiAgICBcbiAgICAvLyBSZW1vdmUgcGFzc3dvcmQgZnJvbSByZXNwb25zZVxuICAgIGNvbnN0IHVzZXJSZXNwb25zZSA9IHtcbiAgICAgIF9pZDogdXNlci5faWQsXG4gICAgICBmaXJzdE5hbWU6IHVzZXIuZmlyc3ROYW1lLFxuICAgICAgbGFzdE5hbWU6IHVzZXIubGFzdE5hbWUsXG4gICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgIHBob25lOiB1c2VyLnBob25lLFxuICAgICAgcm9sZTogdXNlci5yb2xlLFxuICAgICAgaXNBY3RpdmU6IHVzZXIuaXNBY3RpdmUsXG4gICAgICBsb3lhbHR5UG9pbnRzOiB1c2VyLmxveWFsdHlQb2ludHMsXG4gICAgICBjcmVhdGVkQXQ6IHVzZXIuY3JlYXRlZEF0XG4gICAgfTtcbiAgICBcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgdG9rZW4sXG4gICAgICB1c2VyOiB1c2VyUmVzcG9uc2VcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdMb2dpbiBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIGR1cmluZyBsb2dpbidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2F1dGgvbWVcbi8vIEBkZXNjICAgIEdldCBjdXJyZW50IHVzZXJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcbnJvdXRlci5nZXQoJy9tZScsIHByb3RlY3QsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIC8vIHJlcS51c2VyIGlzIHNldCBieSB0aGUgYXV0aCBtaWRkbGV3YXJlXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQocmVxLnVzZXIuX2lkKTtcbiAgICBcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhY3RpdmVcbiAgICBpZiAoIXVzZXIuaXNBY3RpdmUpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQWNjb3VudCBpcyBkZWFjdGl2YXRlZCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCB1c2VyUmVzcG9uc2UgPSB7XG4gICAgICBfaWQ6IHVzZXIuX2lkLFxuICAgICAgZmlyc3ROYW1lOiB1c2VyLmZpcnN0TmFtZSxcbiAgICAgIGxhc3ROYW1lOiB1c2VyLmxhc3ROYW1lLFxuICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICBwaG9uZTogdXNlci5waG9uZSxcbiAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICAgIGlzQWN0aXZlOiB1c2VyLmlzQWN0aXZlLFxuICAgICAgbG95YWx0eVBvaW50czogdXNlci5sb3lhbHR5UG9pbnRzLFxuICAgICAgY3JlYXRlZEF0OiB1c2VyLmNyZWF0ZWRBdFxuICAgIH07XG4gICAgXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHVzZXI6IHVzZXJSZXNwb25zZVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0dldCB1c2VyIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBQVVQgL2FwaS9hdXRoL3Byb2ZpbGVcbi8vIEBkZXNjICAgIFVwZGF0ZSB1c2VyIHByb2ZpbGVcbi8vIEBhY2Nlc3MgIFByaXZhdGVcbnJvdXRlci5wdXQoJy9wcm9maWxlJywgcHJvdGVjdCwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBmaXJzdE5hbWUsIGxhc3ROYW1lLCBlbWFpbCwgcGhvbmUsIGFkZHJlc3MsIHByZWZlcmVuY2VzIH0gPSByZXEuYm9keTtcbiAgICBcbiAgICAvLyBGaW5kIHRoZSBjdXJyZW50IHVzZXJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEudXNlci5faWQpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiBlbWFpbCBpcyBiZWluZyBjaGFuZ2VkIGFuZCBpZiBpdCBhbHJlYWR5IGV4aXN0c1xuICAgIGlmIChlbWFpbCAmJiBlbWFpbC50b0xvd2VyQ2FzZSgpLnRyaW0oKSAhPT0gdXNlci5lbWFpbCkge1xuICAgICAgY29uc3QgZXhpc3RpbmdVc2VyID0gYXdhaXQgVXNlci5maW5kT25lKHsgXG4gICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLnRyaW0oKSxcbiAgICAgICAgX2lkOiB7ICRuZTogdXNlci5faWQgfVxuICAgICAgfSk7XG4gICAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ0VtYWlsIGFscmVhZHkgZXhpc3RzJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gVXBkYXRlIHVzZXIgZmllbGRzXG4gICAgaWYgKGZpcnN0TmFtZSkgdXNlci5maXJzdE5hbWUgPSBmaXJzdE5hbWU7XG4gICAgaWYgKGxhc3ROYW1lKSB1c2VyLmxhc3ROYW1lID0gbGFzdE5hbWU7XG4gICAgaWYgKGVtYWlsKSB1c2VyLmVtYWlsID0gZW1haWwudG9Mb3dlckNhc2UoKS50cmltKCk7XG4gICAgaWYgKHBob25lKSB1c2VyLnBob25lID0gcGhvbmU7XG4gICAgaWYgKGFkZHJlc3MpIHtcbiAgICAgIHVzZXIuYWRkcmVzcyA9IHtcbiAgICAgICAgLi4udXNlci5hZGRyZXNzLFxuICAgICAgICAuLi5hZGRyZXNzXG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAocHJlZmVyZW5jZXMpIHtcbiAgICAgIHVzZXIucHJlZmVyZW5jZXMgPSB7XG4gICAgICAgIC4uLnVzZXIucHJlZmVyZW5jZXMsXG4gICAgICAgIC4uLnByZWZlcmVuY2VzXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBhd2FpdCB1c2VyLnNhdmUoKTtcbiAgICBcbiAgICBjb25zdCB1c2VyUmVzcG9uc2UgPSB7XG4gICAgICBfaWQ6IHVzZXIuX2lkLFxuICAgICAgZmlyc3ROYW1lOiB1c2VyLmZpcnN0TmFtZSxcbiAgICAgIGxhc3ROYW1lOiB1c2VyLmxhc3ROYW1lLFxuICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICBwaG9uZTogdXNlci5waG9uZSxcbiAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICAgIGlzQWN0aXZlOiB1c2VyLmlzQWN0aXZlLFxuICAgICAgbG95YWx0eVBvaW50czogdXNlci5sb3lhbHR5UG9pbnRzLFxuICAgICAgYWRkcmVzczogdXNlci5hZGRyZXNzLFxuICAgICAgcHJlZmVyZW5jZXM6IHVzZXIucHJlZmVyZW5jZXMsXG4gICAgICBjcmVhdGVkQXQ6IHVzZXIuY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZEF0OiB1c2VyLnVwZGF0ZWRBdFxuICAgIH07XG4gICAgXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdQcm9maWxlIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIHVzZXI6IHVzZXJSZXNwb25zZVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1Byb2ZpbGUgdXBkYXRlIGVycm9yOicsIGVycm9yKTtcbiAgICBcbiAgICAvLyBIYW5kbGUgdmFsaWRhdGlvbiBlcnJvcnNcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1ZhbGlkYXRpb25FcnJvcicpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gT2JqZWN0LnZhbHVlcyhlcnJvci5lcnJvcnMpLm1hcChlcnIgPT4gZXJyLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VzLmpvaW4oJywgJylcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgZHVwbGljYXRlIGtleSBlcnJvclxuICAgIGlmIChlcnJvci5jb2RlID09PSAxMTAwMCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cydcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3IgZHVyaW5nIHByb2ZpbGUgdXBkYXRlJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUFVUIC9hcGkvYXV0aC9wYXNzd29yZFxuLy8gQGRlc2MgICAgQ2hhbmdlIHVzZXIgcGFzc3dvcmRcbi8vIEBhY2Nlc3MgIFByaXZhdGVcbnJvdXRlci5wdXQoJy9wYXNzd29yZCcsIHByb3RlY3QsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgY3VycmVudFBhc3N3b3JkLCBuZXdQYXNzd29yZCB9ID0gcmVxLmJvZHk7XG4gICAgXG4gICAgaWYgKCFjdXJyZW50UGFzc3dvcmQgfHwgIW5ld1Bhc3N3b3JkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0N1cnJlbnQgcGFzc3dvcmQgYW5kIG5ldyBwYXNzd29yZCBhcmUgcmVxdWlyZWQnXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgaWYgKG5ld1Bhc3N3b3JkLmxlbmd0aCA8IDYpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnTmV3IHBhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgNiBjaGFyYWN0ZXJzIGxvbmcnXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gRmluZCB0aGUgY3VycmVudCB1c2VyIHdpdGggcGFzc3dvcmRcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEudXNlci5faWQpLnNlbGVjdCgnK3Bhc3N3b3JkJyk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGN1cnJlbnQgcGFzc3dvcmRcbiAgICBjb25zdCBpc01hdGNoID0gYXdhaXQgdXNlci5jb21wYXJlUGFzc3dvcmQoY3VycmVudFBhc3N3b3JkKTtcbiAgICBpZiAoIWlzTWF0Y2gpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQ3VycmVudCBwYXNzd29yZCBpcyBpbmNvcnJlY3QnXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gVXBkYXRlIHBhc3N3b3JkICh3aWxsIGJlIGhhc2hlZCBhdXRvbWF0aWNhbGx5IGJ5IHRoZSBVc2VyIG1vZGVsKVxuICAgIHVzZXIucGFzc3dvcmQgPSBuZXdQYXNzd29yZDtcbiAgICBhd2FpdCB1c2VyLnNhdmUoKTtcbiAgICBcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ1Bhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5J1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1Bhc3N3b3JkIHVwZGF0ZSBlcnJvcjonLCBlcnJvcik7XG4gICAgXG4gICAgLy8gSGFuZGxlIHZhbGlkYXRpb24gZXJyb3JzXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdWYWxpZGF0aW9uRXJyb3InKSB7XG4gICAgICBjb25zdCBtZXNzYWdlcyA9IE9iamVjdC52YWx1ZXMoZXJyb3IuZXJyb3JzKS5tYXAoZXJyID0+IGVyci5tZXNzYWdlKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBtZXNzYWdlcy5qb2luKCcsICcpXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIGR1cmluZyBwYXNzd29yZCB1cGRhdGUnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTUMsR0FBRyxHQUFHSCxPQUFPLENBQUMsY0FBYyxDQUFDO0FBQ25DLE1BQU1JLElBQUksR0FBR0osT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ3RDLE1BQU07RUFBRUs7QUFBUSxDQUFDLEdBQUdMLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQzs7QUFFakQ7QUFDQSxNQUFNTSxhQUFhLEdBQUlDLE1BQU0sSUFBSztFQUNoQyxPQUFPSixHQUFHLENBQUNLLElBQUksQ0FBQztJQUFFRDtFQUFPLENBQUMsRUFBRUUsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFVBQVUsSUFBSSxpQkFBaUIsRUFBRTtJQUN2RUMsU0FBUyxFQUFFSCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0csVUFBVSxJQUFJO0VBQ3ZDLENB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","map":{"version":3,"names":["express","require","router","Router","jwt","User","protect","generateToken","userId","sign","process","env","JWT_SECRET","expiresIn","JWT_EXPIRE","post","req","res","firstName","lastName","email","password","phone","role","body","existingUser","findOne","toLowerCase","trim","status","json","success","message","newUser","save","token","_id","userResponse","createdAt","user","error","console","name","messages","Object","values","errors","map","err","join","code","select","isActive","isMatch","comparePassword","loyaltyPoints","get","findById","put","address","preferences","$ne","updatedAt","currentPassword","newPassword","length","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["auth.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst jwt = require('jsonwebtoken');\nconst User = require('../models/User');\nconst { protect } = require('../middleware/auth');\n\n// Generate JWT Token\nconst generateToken = (userId) => {\n  return jwt.sign({ userId }, process.env.JWT_SECRET || 'fallback_secret', {\n    expiresIn: process.env.JWT_EXPIRE || '30d'\n  });\n};\n\n// @route   POST /api/auth/register\n// @desc    Register a new user\n// @access  Public\nrouter.post('/register', async (req, res) => {\n  try {\n    const { firstName, lastName, email, password, phone, role } = req.body;\n    \n    // Check if user already exists\n    const existingUser = await User.findOne({ email: email.toLowerCase().trim() });\n    if (existingUser) {\n      return res.status(400).json({\n        success: false,\n        message: 'User already exists with this email'\n      });\n    }\n    \n    // Create new user (password will be hashed automatically by the User model)\n    const newUser = new User({\n      firstName,\n      lastName,\n      email: email.toLowerCase().trim(),\n      password,\n      phone,\n      role: role || 'customer'\n    });\n    \n    await newUser.save();\n    \n    // Generate token\n    const token = generateToken(newUser._id);\n    \n    // Remove password from response\n    const userResponse = {\n      _id: newUser._id,\n      firstName: newUser.firstName,\n      lastName: newUser.lastName,\n      email: newUser.email,\n      phone: newUser.phone,\n      role: newUser.role,\n      createdAt: newUser.createdAt\n    };\n    \n    res.status(201).json({\n      success: true,\n      token,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Registration error:', error);\n    \n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n    \n    // Handle duplicate key error\n    if (error.code === 11000) {\n      return res.status(400).json({\n        success: false,\n        message: 'User already exists with this email'\n      });\n    }\n    \n    res.status(500).json({\n      success: false,\n      message: 'Server error during registration'\n    });\n  }\n});\n\n// @route   POST /api/auth/login\n// @desc    Login user\n// @access  Public\nrouter.post('/login', async (req, res) => {\n  try {\n    const { email, password } = req.body;\n    \n    // Find user by email (include password for comparison)\n    const user = await User.findOne({ email: email.toLowerCase().trim() }).select('+password');\n    if (!user) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid credentials'\n      });\n    }\n    \n    // Check if user is active\n    if (!user.isActive) {\n      return res.status(401).json({\n        success: false,\n        message: 'Account is deactivated'\n      });\n    }\n    \n    // Check password using the model method\n    const isMatch = await user.comparePassword(password);\n    if (!isMatch) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid credentials'\n      });\n    }\n    \n    // Generate token\n    const token = generateToken(user._id);\n    \n    // Remove password from response\n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      createdAt: user.createdAt\n    };\n    \n    res.json({\n      success: true,\n      token,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Login error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error during login'\n    });\n  }\n});\n\n// @route   GET /api/auth/me\n// @desc    Get current user\n// @access  Private\nrouter.get('/me', protect, async (req, res) => {\n  try {\n    // req.user is set by the auth middleware\n    const user = await User.findById(req.user._id);\n    \n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n    \n    // Check if user is active\n    if (!user.isActive) {\n      return res.status(401).json({\n        success: false,\n        message: 'Account is deactivated'\n      });\n    }\n    \n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      createdAt: user.createdAt\n    };\n    \n    res.json({\n      success: true,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Get user error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   PUT /api/auth/profile\n// @desc    Update user profile\n// @access  Private\nrouter.put('/profile', protect, async (req, res) => {\n  try {\n    const { firstName, lastName, email, phone, address, preferences } = req.body;\n    \n    // Find the current user\n    const user = await User.findById(req.user._id);\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n    \n    // Check if email is being changed and if it already exists\n    if (email && email.toLowerCase().trim() !== user.email) {\n      const existingUser = await User.findOne({ \n        email: email.toLowerCase().trim(),\n        _id: { $ne: user._id }\n      });\n      if (existingUser) {\n        return res.status(400).json({\n          success: false,\n          message: 'Email already exists'\n        });\n      }\n    }\n    \n    // Update user fields\n    if (firstName) user.firstName = firstName;\n    if (lastName) user.lastName = lastName;\n    if (email) user.email = email.toLowerCase().trim();\n    if (phone) user.phone = phone;\n    if (address) {\n      user.address = {\n        ...user.address,\n        ...address\n      };\n    }\n    if (preferences) {\n      user.preferences = {\n        ...user.preferences,\n        ...preferences\n      };\n    }\n    \n    await user.save();\n    \n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      address: user.address,\n      preferences: user.preferences,\n      createdAt: user.createdAt,\n      updatedAt: user.updatedAt\n    };\n    \n    res.json({\n      success: true,\n      message: 'Profile updated successfully',\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Profile update error:', error);\n    \n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n    \n    // Handle duplicate key error\n    if (error.code === 11000) {\n      return res.status(400).json({\n        success: false,\n        message: 'Email already exists'\n      });\n    }\n    \n    res.status(500).json({\n      success: false,\n      message: 'Server error during profile update'\n    });\n  }\n});\n\n// @route   PUT /api/auth/password\n// @desc    Change user password\n// @access  Private\nrouter.put('/password', protect, async (req, res) => {\n  try {\n    const { currentPassword, newPassword } = req.body;\n    \n    if (!currentPassword || !newPassword) {\n      return res.status(400).json({\n        success: false,\n        message: 'Current password and new password are required'\n      });\n    }\n    \n    if (newPassword.length < 6) {\n      return res.status(400).json({\n        success: false,\n        message: 'New password must be at least 6 characters long'\n      });\n    }\n    \n    // Find the current user with password\n    const user = await User.findById(req.user._id).select('+password');\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n    \n    // Check current password\n    const isMatch = await user.comparePassword(currentPassword);\n    if (!isMatch) {\n      return res.status(400).json({\n        success: false,\n        message: 'Current password is incorrect'\n      });\n    }\n    \n    // Update password (will be hashed automatically by the User model)\n    user.password = newPassword;\n    await user.save();\n    \n    res.json({\n      success: true,\n      message: 'Password updated successfully'\n    });\n  } catch (error) {\n    console.error('Password update error:', error);\n    \n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n    \n    res.status(500).json({\n      success: false,\n      message: 'Server error during password update'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1756225536247},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\User.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const mongoose = require('mongoose');\nconst bcrypt = require('bcryptjs');\nconst userSchema = new mongoose.Schema({\n  firstName: {\n    type: String,\n    required: [true, 'First name is required'],\n    trim: true,\n    maxlength: [50, 'First name cannot exceed 50 characters']\n  },\n  lastName: {\n    type: String,\n    required: [true, 'Last name is required'],\n    trim: true,\n    maxlength: [50, 'Last name cannot exceed 50 characters']\n  },\n  email: {\n    type: String,\n    required: [true, 'Email is required'],\n    unique: true,\n    lowercase: true,\n    trim: true,\n    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email']\n  },\n  password: {\n    type: String,\n    required: [true, 'Password is required'],\n    minlength: [6, 'Password must be at least 6 characters'],\n    select: false // Don't include password in queries by default\n  },\n  phone: {\n    type: String,\n    trim: true,\n    match: [/^\\d{10}$/, 'Please enter a valid phone number']\n  },\n  address: {\n    street: {\n      type: String,\n      trim: true\n    },\n    city: {\n      type: String,\n      trim: true\n    },\n    state: {\n      type: String,\n      trim: true\n    },\n    zipCode: {\n      type: String,\n      trim: true\n    },\n    country: {\n      type: String,\n      trim: true,\n      default: 'USA'\n    }\n  },\n  role: {\n    type: String,\n    enum: ['customer', 'admin'],\n    default: 'customer'\n  },\n  isActive: {\n    type: Boolean,\n    default: true\n  },\n  preferences: {\n    newsletter: {\n      type: Boolean,\n      default: false\n    },\n    notifications: {\n      type: Boolean,\n      default: true\n    }\n  },\n  loyaltyPoints: {\n    type: Number,\n    default: 0,\n    min: 0\n  }\n}, {\n  timestamps: true,\n  toJSON: {\n    virtuals: true\n  },\n  toObject: {\n    virtuals: true\n  }\n});\n\n// Virtual for full name\nuserSchema.virtual('name').get(function () {\n  return `${this.firstName} ${this.lastName}`;\n});\n\n// Index for better performance\nuserSchema.index({\n  email: 1\n});\nuserSchema.index({\n  role: 1\n});\n\n// Hash password before saving\nuserSchema.pre('save', async function (next) {\n  // Only hash the password if it has been modified (or is new)\n  if (!this.isModified('password')) return next();\n  try {\n    // Hash password with cost of 12\n    const hashedPassword = await bcrypt.hash(this.password, 12);\n    this.password = hashedPassword;\n    next();\n  } catch (error) {\n    next(error);\n  }\n});\n\n// Instance method to check password\nuserSchema.methods.comparePassword = async function (candidatePassword) {\n  return await bcrypt.compare(candidatePassword, this.password);\n};\n\n// Instance method to get full name\nuserSchema.methods.getFullName = function () {\n  return `${this.firstName} ${this.lastName}`;\n};\nmodule.exports = mongoose.model('User', userSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJiY3J5cHQiLCJ1c2VyU2NoZW1hIiwiU2NoZW1hIiwiZmlyc3ROYW1lIiwidHlwZSIsIlN0cmluZyIsInJlcXVpcmVkIiwidHJpbSIsIm1heGxlbmd0aCIsImxhc3ROYW1lIiwiZW1haWwiLCJ1bmlxdWUiLCJsb3dlcmNhc2UiLCJtYXRjaCIsInBhc3N3b3JkIiwibWlubGVuZ3RoIiwic2VsZWN0IiwicGhvbmUiLCJhZGRyZXNzIiwic3RyZWV0IiwiY2l0eSIsInN0YXRlIiwiemlwQ29kZSIsImNvdW50cnkiLCJkZWZhdWx0Iiwicm9sZSIsImVudW0iLCJpc0FjdGl2ZSIsIkJvb2xlYW4iLCJwcmVmZXJlbmNlcyIsIm5ld3NsZXR0ZXIiLCJub3RpZmljYXRpb25zIiwibG95YWx0eVBvaW50cyIsIk51bWJlciIsIm1pbiIsInRpbWVzdGFtcHMiLCJ0b0pTT04iLCJ2aXJ0dWFscyIsInRvT2JqZWN0IiwidmlydHVhbCIsImdldCIsImluZGV4IiwicHJlIiwibmV4dCIsImlzTW9kaWZpZWQiLCJoYXNoZWRQYXNzd29yZCIsImhhc2giLCJlcnJvciIsIm1ldGhvZHMiLCJjb21wYXJlUGFzc3dvcmQiLCJjYW5kaWRhdGVQYXNzd29yZCIsImNvbXBhcmUiLCJnZXRGdWxsTmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2RlbCJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXG1vZGVsc1xcIiwic291cmNlcyI6WyJVc2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJyk7XG5cbmNvbnN0IHVzZXJTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcbiAgZmlyc3ROYW1lOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnXSxcbiAgICB0cmltOiB0cnVlLFxuICAgIG1heGxlbmd0aDogWzUwLCAnRmlyc3QgbmFtZSBjYW5ub3QgZXhjZWVkIDUwIGNoYXJhY3RlcnMnXVxuICB9LFxuICBsYXN0TmFtZToge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICByZXF1aXJlZDogW3RydWUsICdMYXN0IG5hbWUgaXMgcmVxdWlyZWQnXSxcbiAgICB0cmltOiB0cnVlLFxuICAgIG1heGxlbmd0aDogWzUwLCAnTGFzdCBuYW1lIGNhbm5vdCBleGNlZWQgNTAgY2hhcmFjdGVycyddXG4gIH0sXG4gIGVtYWlsOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ0VtYWlsIGlzIHJlcXVpcmVkJ10sXG4gICAgdW5pcXVlOiB0cnVlLFxuICAgIGxvd2VyY2FzZTogdHJ1ZSxcbiAgICB0cmltOiB0cnVlLFxuICAgIG1hdGNoOiBbL15cXHcrKFtcXC4tXT9cXHcrKSpAXFx3KyhbXFwuLV0/XFx3KykqKFxcLlxcd3syLDN9KSskLywgJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsJ11cbiAgfSxcbiAgcGFzc3dvcmQ6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgcmVxdWlyZWQ6IFt0cnVlLCAnUGFzc3dvcmQgaXMgcmVxdWlyZWQnXSxcbiAgICBtaW5sZW5ndGg6IFs2LCAnUGFzc3dvcmQgbXVzdCBiZSBhdCBsZWFzdCA2IGNoYXJhY3RlcnMnXSxcbiAgICBzZWxlY3Q6IGZhbHNlIC8vIERvbid0IGluY2x1ZGUgcGFzc3dvcmQgaW4gcXVlcmllcyBieSBkZWZhdWx0XG4gIH0sXG4gIHBob25lOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHRyaW06IHRydWUsXG4gICAgbWF0Y2g6IFsvXlxcZHsxMH0kLywgJ1BsZWFzZSBlbnRlciBhIHZhbGlkIHBob25lIG51bWJlciddXG4gIH0sXG4gIGFkZHJlc3M6IHtcbiAgICBzdHJlZXQ6IHsgdHlwZTogU3RyaW5nLCB0cmltOiB0cnVlIH0sXG4gICAgY2l0eTogeyB0eXBlOiBTdHJpbmcsIHRyaW06IHRydWUgfSxcbiAgICBzdGF0ZTogeyB0eXBlOiBTdHJpbmcsIHRyaW06IHRydWUgfSxcbiAgICB6aXBDb2RlOiB7IHR5cGU6IFN0cmluZywgdHJpbTogdHJ1ZSB9LFxuICAgIGNvdW50cnk6IHsgdHlwZTogU3RyaW5nLCB0cmltOiB0cnVlLCBkZWZhdWx0OiAnVVNBJyB9XG4gIH0sXG4gIHJvbGU6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgZW51bTogWydjdXN0b21lcicsICdhZG1pbiddLFxuICAgIGRlZmF1bHQ6ICdjdXN0b21lcidcbiAgfSxcbiAgaXNBY3RpdmU6IHtcbiAgICB0eXBlOiBCb29sZWFuLFxuICAgIGRlZmF1bHQ6IHRydWVcbiAgfSxcbiAgcHJlZmVyZW5jZXM6IHtcbiAgICBuZXdzbGV0dGVyOiB7IHR5cGU6IEJvb2xlYW4sIGRlZmF1bHQ6IGZhbHNlIH0sXG4gICAgbm90aWZpY2F0aW9uczogeyB0eXBlOiBCb29sZWFuLCBkZWZhdWx0OiB0cnVlIH1cbiAgfSxcbiAgbG95YWx0eVBvaW50czoge1xuICAgIHR5cGU6IE51bWJlcixcbiAgICBkZWZhdWx0OiAwLFxuICAgIG1pbjogMFxuICB9XG59LCB7XG4gIHRpbWVzdGFtcHM6IHRydWUsXG4gIHRvSlNPTjogeyB2aXJ0dWFsczogdHJ1ZSB9LFxuICB0b09iamVjdDogeyB2aXJ0dWFsczogdHJ1ZSB9XG59KTtcblxuLy8gVmlydHVhbCBmb3IgZnVsbCBuYW1lXG51c2VyU2NoZW1hLnZpcnR1YWwoJ25hbWUnKS5nZXQoZnVuY3Rpb24oKSB7XG4gIHJldHVybiBgJHt0aGlzLmZpcnN0TmFtZX0gJHt0aGlzLmxhc3ROYW1lfWA7XG59KTtcblxuLy8gSW5kZXggZm9yIGJldHRlciBwZXJmb3JtYW5jZVxudXNlclNjaGVtYS5pbmRleCh7IGVtYWlsOiAxIH0pO1xudXNlclNjaGVtYS5pbmRleCh7IHJvbGU6IDEgfSk7XG5cbi8vIEhhc2ggcGFzc3dvcmQgYmVmb3JlIHNhdmluZ1xudXNlclNjaGVtYS5wcmUoJ3NhdmUnLCBhc3luYyBmdW5jdGlvbihuZXh0KSB7XG4gIC8vIE9ubHkgaGFzaCB0aGUgcGFzc3dvcmQgaWYgaXQgaGFzIGJlZW4gbW9kaWZpZWQgKG9yIGlzIG5ldylcbiAgaWYgKCF0aGlzLmlzTW9kaWZpZWQoJ3Bhc3N3b3JkJykpIHJldHVybiBuZXh0KCk7XG4gIFxuICB0cnkge1xuICAgIC8vIEhhc2ggcGFzc3dvcmQgd2l0aCBjb3N0IG9mIDEyXG4gICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaCh0aGlzLnBhc3N3b3JkLCAxMik7XG4gICAgdGhpcy5wYXNzd29yZCA9IGhhc2hlZFBhc3N3b3JkO1xuICAgIG5leHQoKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBuZXh0KGVycm9yKTtcbiAgfVxufSk7XG5cbi8vIEluc3RhbmNlIG1ldGhvZCB0byBjaGVjayBwYXNzd29yZFxudXNlclNjaGVtYS5tZXRob2RzLmNvbXBhcmVQYXNzd29yZCA9IGFzeW5jIGZ1bmN0aW9uKGNhbmRpZGF0ZVBhc3N3b3JkKSB7XG4gIHJldHVybiBhd2FpdCBiY3J5cHQuY29tcGFyZShjYW5kaWRhdGVQYXNzd29yZCwgdGhpcy5wYXNzd29yZCk7XG59O1xuXG4vLyBJbnN0YW5jZSBtZXRob2QgdG8gZ2V0IGZ1bGwgbmFtZVxudXNlclNjaGVtYS5tZXRob2RzLmdldEZ1bGxOYW1lID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiBgJHt0aGlzLmZpcnN0TmFtZX0gJHt0aGlzLmxhc3ROYW1lfWA7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IG1vbmdvb3NlLm1vZGVsKCdVc2VyJywgdXNlclNjaGVtYSk7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFDcEMsTUFBTUMsTUFBTSxHQUFHRCxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRWxDLE1BQU1FLFVBQVUsR0FBRyxJQUFJSCxRQUFRLENB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","map":{"version":3,"names":["mongoose","require","bcrypt","userSchema","Schema","firstName","type","String","required","trim","maxlength","lastName","email","unique","lowercase","match","password","minlength","select","phone","address","street","city","state","zipCode","country","default","role","enum","isActive","Boolean","preferences","newsletter","notifications","loyaltyPoints","Number","min","timestamps","toJSON","virtuals","toObject","virtual","get","index","pre","next","isModified","hashedPassword","hash","error","methods","comparePassword","candidatePassword","compare","getFullName","module","exports","model"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\models\\","sources":["User.js"],"sourcesContent":["const mongoose = require('mongoose');\nconst bcrypt = require('bcryptjs');\n\nconst userSchema = new mongoose.Schema({\n  firstName: {\n    type: String,\n    required: [true, 'First name is required'],\n    trim: true,\n    maxlength: [50, 'First name cannot exceed 50 characters']\n  },\n  lastName: {\n    type: String,\n    required: [true, 'Last name is required'],\n    trim: true,\n    maxlength: [50, 'Last name cannot exceed 50 characters']\n  },\n  email: {\n    type: String,\n    required: [true, 'Email is required'],\n    unique: true,\n    lowercase: true,\n    trim: true,\n    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email']\n  },\n  password: {\n    type: String,\n    required: [true, 'Password is required'],\n    minlength: [6, 'Password must be at least 6 characters'],\n    select: false // Don't include password in queries by default\n  },\n  phone: {\n    type: String,\n    trim: true,\n    match: [/^\\d{10}$/, 'Please enter a valid phone number']\n  },\n  address: {\n    street: { type: String, trim: true },\n    city: { type: String, trim: true },\n    state: { type: String, trim: true },\n    zipCode: { type: String, trim: true },\n    country: { type: String, trim: true, default: 'USA' }\n  },\n  role: {\n    type: String,\n    enum: ['customer', 'admin'],\n    default: 'customer'\n  },\n  isActive: {\n    type: Boolean,\n    default: true\n  },\n  preferences: {\n    newsletter: { type: Boolean, default: false },\n    notifications: { type: Boolean, default: true }\n  },\n  loyaltyPoints: {\n    type: Number,\n    default: 0,\n    min: 0\n  }\n}, {\n  timestamps: true,\n  toJSON: { virtuals: true },\n  toObject: { virtuals: true }\n});\n\n// Virtual for full name\nuserSchema.virtual('name').get(function() {\n  return `${this.firstName} ${this.lastName}`;\n});\n\n// Index for better performance\nuserSchema.index({ email: 1 });\nuserSchema.index({ role: 1 });\n\n// Hash password before saving\nuserSchema.pre('save', async function(next) {\n  // Only hash the password if it has been modified (or is new)\n  if (!this.isModified('password')) return next();\n  \n  try {\n    // Hash password with cost of 12\n    const hashedPassword = await bcrypt.hash(this.password, 12);\n    this.password = hashedPassword;\n    next();\n  } catch (error) {\n    next(error);\n  }\n});\n\n// Instance method to check password\nuserSchema.methods.comparePassword = async function(candidatePassword) {\n  return await bcrypt.compare(candidatePassword, this.password);\n};\n\n// Instance method to get full name\nuserSchema.methods.getFullName = function() {\n  return `${this.firstName} ${this.lastName}`;\n};\n\nmodule.exports = mongoose.model('User', userSchema);"],"mappings":"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","ignoreList":[]}},"mtime":1757523841233},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\middleware\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\middleware\\\\auth.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const jwt = require('jsonwebtoken');\nconst User = require('../models/User');\n\n// Middleware to protect routes\nconst protect = async (req, res, next) => {\n  try {\n    let token;\n\n    // Check for token in Authorization header\n    if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {\n      token = req.headers.authorization.split(' ')[1];\n    }\n\n    // Make sure token exists\n    if (!token) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n    try {\n      // Verify token\n      const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n      // Get user from token\n      const user = await User.findById(decoded.userId);\n      if (!user) {\n        return res.status(401).json({\n          success: false,\n          message: 'User not found'\n        });\n      }\n      if (!user.isActive) {\n        return res.status(401).json({\n          success: false,\n          message: 'User account is deactivated'\n        });\n      }\n      req.user = user;\n      next();\n    } catch (error) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n  } catch (error) {\n    console.error('Auth middleware error:', error);\n    return res.status(500).json({\n      success: false,\n      message: 'Server error in authentication'\n    });\n  }\n};\n\n// Middleware to check if user is admin\nconst authorize = (...roles) => {\n  return (req, res, next) => {\n    if (!req.user) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n    if (!roles.includes(req.user.role)) {\n      return res.status(403).json({\n        success: false,\n        message: `User role ${req.user.role} is not authorized to access this route`\n      });\n    }\n    next();\n  };\n};\n\n// Middleware to check if user owns the resource or is admin\nconst authorizeOwnerOrAdmin = (req, res, next) => {\n  if (!req.user) {\n    return res.status(401).json({\n      success: false,\n      message: 'Not authorized to access this route'\n    });\n  }\n\n  // Allow if user is admin or owns the resource\n  if (req.user.role === 'admin' || req.user._id.toString() === req.params.userId) {\n    next();\n  } else {\n    return res.status(403).json({\n      success: false,\n      message: 'Not authorized to access this resource'\n    });\n  }\n};\nmodule.exports = {\n  protect,\n  authorize,\n  authorizeOwnerOrAdmin\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwiVXNlciIsInByb3RlY3QiLCJyZXEiLCJyZXMiLCJuZXh0IiwidG9rZW4iLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInN0YXJ0c1dpdGgiLCJzcGxpdCIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwibWVzc2FnZSIsImRlY29kZWQiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsInVzZXIiLCJmaW5kQnlJZCIsInVzZXJJZCIsImlzQWN0aXZlIiwiZXJyb3IiLCJjb25zb2xlIiwiYXV0aG9yaXplIiwicm9sZXMiLCJpbmNsdWRlcyIsInJvbGUiLCJhdXRob3JpemVPd25lck9yQWRtaW4iLCJfaWQiLCJ0b1N0cmluZyIsInBhcmFtcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkQ6XFxjb2RlXFxXZWJDYWZmZVxcYmFja2VuZFxcc3JjXFxtaWRkbGV3YXJlXFwiLCJzb3VyY2VzIjpbImF1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XG5jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1VzZXInKTtcblxuLy8gTWlkZGxld2FyZSB0byBwcm90ZWN0IHJvdXRlc1xuY29uc3QgcHJvdGVjdCA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGxldCB0b2tlbjtcblxuICAgIC8vIENoZWNrIGZvciB0b2tlbiBpbiBBdXRob3JpemF0aW9uIGhlYWRlclxuICAgIGlmIChyZXEuaGVhZGVycy5hdXRob3JpemF0aW9uICYmIHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24uc3RhcnRzV2l0aCgnQmVhcmVyJykpIHtcbiAgICAgIHRva2VuID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbi5zcGxpdCgnICcpWzFdO1xuICAgIH1cblxuICAgIC8vIE1ha2Ugc3VyZSB0b2tlbiBleGlzdHNcbiAgICBpZiAoIXRva2VuKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ05vdCBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGlzIHJvdXRlJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFZlcmlmeSB0b2tlblxuICAgICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xuICAgICAgXG4gICAgICAvLyBHZXQgdXNlciBmcm9tIHRva2VuXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChkZWNvZGVkLnVzZXJJZCk7XG4gICAgICBcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCdcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdXNlci5pc0FjdGl2ZSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIGFjY291bnQgaXMgZGVhY3RpdmF0ZWQnXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXEudXNlciA9IHVzZXI7XG4gICAgICBuZXh0KCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnTm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgcm91dGUnXG4gICAgICB9KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQXV0aCBtaWRkbGV3YXJlIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIGluIGF1dGhlbnRpY2F0aW9uJ1xuICAgIH0pO1xuICB9XG59O1xuXG4vLyBNaWRkbGV3YXJlIHRvIGNoZWNrIGlmIHVzZXIgaXMgYWRtaW5cbmNvbnN0IGF1dGhvcml6ZSA9ICguLi5yb2xlcykgPT4ge1xuICByZXR1cm4gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgaWYgKCFyZXEudXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byBhY2Nlc3MgdGhpcyByb3V0ZSdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICghcm9sZXMuaW5jbHVkZXMocmVxLnVzZXIucm9sZSkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBgVXNlciByb2xlICR7cmVxLnVzZXIucm9sZX0gaXMgbm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgcm91dGVgXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBuZXh0KCk7XG4gIH07XG59O1xuXG4vLyBNaWRkbGV3YXJlIHRvIGNoZWNrIGlmIHVzZXIgb3ducyB0aGUgcmVzb3VyY2Ugb3IgaXMgYWRtaW5cbmNvbnN0IGF1dGhvcml6ZU93bmVyT3JBZG1pbiA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICBpZiAoIXJlcS51c2VyKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ05vdCBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGlzIHJvdXRlJ1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQWxsb3cgaWYgdXNlciBpcyBhZG1pbiBvciBvd25zIHRoZSByZXNvdXJjZVxuICBpZiAocmVxLnVzZXIucm9sZSA9PT0gJ2FkbWluJyB8fCByZXEudXNlci5faWQudG9TdHJpbmcoKSA9PT0gcmVxLnBhcmFtcy51c2VySWQpIHtcbiAgICBuZXh0KCk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ05vdCBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGlzIHJlc291cmNlJ1xuICAgIH0pO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgcHJvdGVjdCxcbiAgYXV0aG9yaXplLFxuICBhdXRob3JpemVPd25lck9yQWRtaW5cbn07Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxHQUFHLEdBQUdDLE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDbkMsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsZ0JBQWdCLENBQUM7O0FBRXRDO0FBQ0EsTUFBTUUsT0FBTyxHQUFHLE1BQUFBLENBQU9DLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDeEMsSUFBSTtJQUNGLElBQUlDLEtBQUs7O0lBRVQ7SUFDQSxJQUFJSCxHQUFHLENBQUNJLE9BQU8sQ0FBQ0MsYUFBYSxJQUFJTCxHQUFHLENBQUNJLE9BQU8sQ0FBQ0MsYUFBYSxDQUFDQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUU7TUFDL0VILEtBQUssR0FBR0gsR0FBRyxDQUFDSSxPQUFPLENBQUNDLGFBQWEsQ0FBQ0UsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNqRDs7SUFFQTtJQUNBLElBQUksQ0FBQ0osS0FBSyxFQUFFO01BQ1YsT0FBT0YsR0FBRyxDQUFDTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztR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","map":{"version":3,"names":["jwt","require","User","protect","req","res","next","token","headers","authorization","startsWith","split","status","json","success","message","decoded","verify","process","env","JWT_SECRET","user","findById","userId","isActive","error","console","authorize","roles","includes","role","authorizeOwnerOrAdmin","_id","toString","params","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\middleware\\","sources":["auth.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\nconst User = require('../models/User');\n\n// Middleware to protect routes\nconst protect = async (req, res, next) => {\n  try {\n    let token;\n\n    // Check for token in Authorization header\n    if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {\n      token = req.headers.authorization.split(' ')[1];\n    }\n\n    // Make sure token exists\n    if (!token) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n\n    try {\n      // Verify token\n      const decoded = jwt.verify(token, process.env.JWT_SECRET);\n      \n      // Get user from token\n      const user = await User.findById(decoded.userId);\n      \n      if (!user) {\n        return res.status(401).json({\n          success: false,\n          message: 'User not found'\n        });\n      }\n\n      if (!user.isActive) {\n        return res.status(401).json({\n          success: false,\n          message: 'User account is deactivated'\n        });\n      }\n\n      req.user = user;\n      next();\n    } catch (error) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n  } catch (error) {\n    console.error('Auth middleware error:', error);\n    return res.status(500).json({\n      success: false,\n      message: 'Server error in authentication'\n    });\n  }\n};\n\n// Middleware to check if user is admin\nconst authorize = (...roles) => {\n  return (req, res, next) => {\n    if (!req.user) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n\n    if (!roles.includes(req.user.role)) {\n      return res.status(403).json({\n        success: false,\n        message: `User role ${req.user.role} is not authorized to access this route`\n      });\n    }\n\n    next();\n  };\n};\n\n// Middleware to check if user owns the resource or is admin\nconst authorizeOwnerOrAdmin = (req, res, next) => {\n  if (!req.user) {\n    return res.status(401).json({\n      success: false,\n      message: 'Not authorized to access this route'\n    });\n  }\n\n  // Allow if user is admin or owns the resource\n  if (req.user.role === 'admin' || req.user._id.toString() === req.params.userId) {\n    next();\n  } else {\n    return res.status(403).json({\n      success: false,\n      message: 'Not authorized to access this resource'\n    });\n  }\n};\n\nmodule.exports = {\n  protect,\n  authorize,\n  authorizeOwnerOrAdmin\n};"],"mappings":"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","ignoreList":[]}},"mtime":1756225535435},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\orders.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst Order = require('../models/Order');\nconst Product = require('../models/Product');\nconst {\n  protect: auth\n} = require('../middleware/auth');\n\n// @route   GET /api/orders\n// @desc    Get all orders for authenticated user\n// @access  Private\nrouter.get('/', auth, async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const skip = (page - 1) * limit;\n    const status = req.query.status;\n\n    // Build query\n    const query = {\n      customer: req.user.id\n    };\n    if (status && status !== 'all') {\n      query.status = status;\n    }\n\n    // Get orders with pagination\n    const orders = await Order.find(query).populate('items.product', 'name category image').sort({\n      createdAt: -1\n    }).skip(skip).limit(limit);\n\n    // Get total count for pagination\n    const total = await Order.countDocuments(query);\n    res.json({\n      success: true,\n      data: orders,\n      pagination: {\n        current: page,\n        pages: Math.ceil(total / limit),\n        total\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching orders'\n    });\n  }\n});\n\n// @route   GET /api/orders/:id\n// @desc    Get single order by ID\n// @access  Private\nrouter.get('/:id', auth, async (req, res) => {\n  try {\n    const order = await Order.findOne({\n      _id: req.params.id,\n      customer: req.user.id\n    }).populate('items.product', 'name category image description');\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: order\n    });\n  } catch (error) {\n    console.error('Error fetching order:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order'\n    });\n  }\n});\n\n// @route   POST /api/orders\n// @desc    Create new order\n// @access  Private\nrouter.post('/', auth, async (req, res) => {\n  try {\n    const {\n      items,\n      orderType,\n      paymentMethod,\n      deliveryAddress,\n      notes\n    } = req.body;\n\n    // Validate required fields\n    if (!items || !Array.isArray(items) || items.length === 0) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order must contain at least one item'\n      });\n    }\n    if (!orderType || !['pickup', 'delivery', 'dine-in'].includes(orderType)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid order type is required'\n      });\n    }\n    if (!paymentMethod || !['cash', 'card', 'digital_wallet', 'momo', 'vnpay'].includes(paymentMethod)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid payment method is required'\n      });\n    }\n\n    // Validate delivery address for delivery orders\n    if (orderType === 'delivery') {\n      if (!deliveryAddress || !deliveryAddress.street || !deliveryAddress.city) {\n        return res.status(400).json({\n          success: false,\n          message: 'Delivery address is required for delivery orders'\n        });\n      }\n    }\n\n    // Validate and calculate order totals\n    let subtotal = 0;\n    const validatedItems = [];\n    for (const item of items) {\n      // Validate product exists\n      const product = await Product.findById(item.product);\n      if (!product) {\n        return res.status(400).json({\n          success: false,\n          message: `Product with ID ${item.product} not found`\n        });\n      }\n\n      // Validate quantity\n      if (!item.quantity || item.quantity < 1) {\n        return res.status(400).json({\n          success: false,\n          message: 'Item quantity must be at least 1'\n        });\n      }\n\n      // Calculate item price (base price or size-specific price)\n      let itemPrice = product.price;\n      if (item.size && product.sizes && product.sizes.length > 0) {\n        const sizeOption = product.sizes.find(s => s.name === item.size);\n        if (sizeOption) {\n          itemPrice = sizeOption.price;\n        }\n      }\n      const itemTotal = itemPrice * item.quantity;\n      subtotal += itemTotal;\n      validatedItems.push({\n        product: product._id,\n        name: product.name,\n        price: itemPrice,\n        quantity: item.quantity,\n        size: item.size || 'Regular',\n        customizations: item.customizations || []\n      });\n    }\n\n    // Calculate tax (8% for example)\n    const tax = subtotal * 0.08;\n    const total = subtotal + tax;\n\n    // Generate unique order number\n    const orderNumber = `ORD-${Date.now()}-${Math.random().toString(36).substr(2, 4).toUpperCase()}`;\n\n    // Create order\n    const order = new Order({\n      orderNumber,\n      customer: req.user.id,\n      items: validatedItems,\n      subtotal,\n      tax,\n      total,\n      orderType,\n      paymentMethod,\n      deliveryAddress: orderType === 'delivery' ? deliveryAddress : undefined,\n      notes: notes || '',\n      loyaltyPointsEarned: Math.floor(total * 0.1) // 10% of total as points\n    });\n    await order.save();\n\n    // Populate the order before sending response\n    await order.populate('items.product', 'name category image');\n    res.status(201).json({\n      success: true,\n      data: order,\n      message: 'Order created successfully'\n    });\n  } catch (error) {\n    console.error('Error creating order:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating order'\n    });\n  }\n});\n\n// @route   PUT /api/orders/:id/status\n// @desc    Update order status (for admin use)\n// @access  Private\nrouter.put('/:id/status', auth, async (req, res) => {\n  try {\n    const {\n      status\n    } = req.body;\n    const validStatuses = ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'];\n    if (!status || !validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid status is required'\n      });\n    }\n    const order = await Order.findById(req.params.id);\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if user owns the order or is admin (for now, allow user to cancel their own orders)\n    if (order.customer.toString() !== req.user.id && status !== 'cancelled') {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to update this order'\n      });\n    }\n\n    // Only allow cancellation if order is still pending or confirmed\n    if (status === 'cancelled' && !['pending', 'confirmed'].includes(order.status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order cannot be cancelled at this stage'\n      });\n    }\n    order.status = status;\n    if (status === 'completed') {\n      order.actualCompletionTime = new Date();\n    }\n    await order.save();\n    res.json({\n      success: true,\n      data: order,\n      message: 'Order status updated successfully'\n    });\n  } catch (error) {\n    console.error('Error updating order status:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating order status'\n    });\n  }\n});\n\n// @route   DELETE /api/orders/:id\n// @desc    Cancel/Delete order (only if pending)\n// @access  Private\nrouter.delete('/:id', auth, async (req, res) => {\n  try {\n    const order = await Order.findOne({\n      _id: req.params.id,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Only allow deletion if order is pending\n    if (order.status !== 'pending') {\n      return res.status(400).json({\n        success: false,\n        message: 'Only pending orders can be cancelled'\n      });\n    }\n    order.status = 'cancelled';\n    await order.save();\n    res.json({\n      success: true,\n      message: 'Order cancelled successfully'\n    });\n  } catch (error) {\n    console.error('Error cancelling order:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while cancelling order'\n    });\n  }\n});\n\n// @route   GET /api/orders/stats/summary\n// @desc    Get order statistics for user\n// @access  Private\nrouter.get('/stats/summary', auth, async (req, res) => {\n  try {\n    const userId = req.user.id;\n\n    // Get order counts by status\n    const statusCounts = await Order.aggregate([{\n      $match: {\n        customer: mongoose.Types.ObjectId(userId)\n      }\n    }, {\n      $group: {\n        _id: '$status',\n        count: {\n          $sum: 1\n        }\n      }\n    }]);\n\n    // Get total spent\n    const totalSpent = await Order.aggregate([{\n      $match: {\n        customer: mongoose.Types.ObjectId(userId),\n        status: {\n          $in: ['completed', 'ready']\n        }\n      }\n    }, {\n      $group: {\n        _id: null,\n        total: {\n          $sum: '$total'\n        }\n      }\n    }]);\n\n    // Get recent orders count (last 30 days)\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n    const recentOrdersCount = await Order.countDocuments({\n      customer: userId,\n      createdAt: {\n        $gte: thirtyDaysAgo\n      }\n    });\n\n    // Get loyalty points\n    const loyaltyPoints = await Order.aggregate([{\n      $match: {\n        customer: mongoose.Types.ObjectId(userId)\n      }\n    }, {\n      $group: {\n        _id: null,\n        earned: {\n          $sum: '$loyaltyPointsEarned'\n        },\n        used: {\n          $sum: '$loyaltyPointsUsed'\n        }\n      }\n    }]);\n    res.json({\n      success: true,\n      data: {\n        statusCounts: statusCounts.reduce((acc, item) => {\n          acc[item._id] = item.count;\n          return acc;\n        }, {}),\n        totalSpent: totalSpent[0]?.total || 0,\n        recentOrdersCount,\n        loyaltyPoints: {\n          earned: loyaltyPoints[0]?.earned || 0,\n          used: loyaltyPoints[0]?.used || 0,\n          available: (loyaltyPoints[0]?.earned || 0) - (loyaltyPoints[0]?.used || 0)\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching order statistics:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order statistics'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIk9yZGVyIiwiUHJvZHVjdCIsInByb3RlY3QiLCJhdXRoIiwiZ2V0IiwicmVxIiwicmVzIiwicGFnZSIsInBhcnNlSW50IiwicXVlcnkiLCJsaW1pdCIsInNraXAiLCJzdGF0dXMiLCJjdXN0b21lciIsInVzZXIiLCJpZCIsIm9yZGVycyIsImZpbmQiLCJwb3B1bGF0ZSIsInNvcnQiLCJjcmVhdGVkQXQiLCJ0b3RhbCIsImNvdW50RG9jdW1lbnRzIiwianNvbiIsInN1Y2Nlc3MiLCJkYXRhIiwicGFnaW5hdGlvbiIsImN1cnJlbnQiLCJwYWdlcyIsIk1hdGgiLCJjZWlsIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsIm9yZGVyIiwiZmluZE9uZSIsIl9pZCIsInBhcmFtcyIsIm5hbWUiLCJwb3N0IiwiaXRlbXMiLCJvcmRlclR5cGUiLCJwYXltZW50TWV0aG9kIiwiZGVsaXZlcnlBZGRyZXNzIiwibm90ZXMiLCJib2R5IiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiaW5jbHVkZXMiLCJzdHJlZXQiLCJjaXR5Iiwic3VidG90YWwiLCJ2YWxpZGF0ZWRJdGVtcyIsIml0ZW0iLCJwcm9kdWN0IiwiZmluZEJ5SWQiLCJxdWFudGl0eSIsIml0ZW1QcmljZSIsInByaWNlIiwic2l6ZSIsInNpemVzIiwic2l6ZU9wdGlvbiIsInMiLCJpdGVtVG90YWwiLCJwdXNoIiwiY3VzdG9taXphdGlvbnMiLCJ0YXgiLCJvcmRlck51bWJlciIsIkRhdGUiLCJub3ciLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsInRvVXBwZXJDYXNlIiwidW5kZWZpbmVkIiwibG95YWx0eVBvaW50c0Vhcm5lZCIsImZsb29yIiwic2F2ZSIsInB1dCIsInZhbGlkU3RhdHVzZXMiLCJhY3R1YWxDb21wbGV0aW9uVGltZSIsImRlbGV0ZSIsInVzZXJJZCIsInN0YXR1c0NvdW50cyIsImFnZ3JlZ2F0ZSIsIiRtYXRjaCIsIm1vbmdvb3NlIiwiVHlwZXMiLCJPYmplY3RJZCIsIiRncm91cCIsImNvdW50IiwiJHN1bSIsInRvdGFsU3BlbnQiLCIkaW4iLCJ0aGlydHlEYXlzQWdvIiwic2V0RGF0ZSIsImdldERhdGUiLCJyZWNlbnRPcmRlcnNDb3VudCIsIiRndGUiLCJsb3lhbHR5UG9pbnRzIiwiZWFybmVkIiwidXNlZCIsInJlZHVjZSIsImFjYyIsImF2YWlsYWJsZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkQ6XFxjb2RlXFxXZWJDYWZmZVxcYmFja2VuZFxcc3JjXFxyb3V0ZXNcXCIsInNvdXJjZXMiOlsib3JkZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuY29uc3QgT3JkZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvT3JkZXInKTtcbmNvbnN0IFByb2R1Y3QgPSByZXF1aXJlKCcuLi9tb2RlbHMvUHJvZHVjdCcpO1xuY29uc3QgeyBwcm90ZWN0OiBhdXRoIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvb3JkZXJzXG4vLyBAZGVzYyAgICBHZXQgYWxsIG9yZGVycyBmb3IgYXV0aGVudGljYXRlZCB1c2VyXG4vLyBAYWNjZXNzICBQcml2YXRlXG5yb3V0ZXIuZ2V0KCcvJywgYXV0aCwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFnZSA9IHBhcnNlSW50KHJlcS5xdWVyeS5wYWdlKSB8fCAxO1xuICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLnF1ZXJ5LmxpbWl0KSB8fCAxMDtcbiAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuICAgIGNvbnN0IHN0YXR1cyA9IHJlcS5xdWVyeS5zdGF0dXM7XG5cbiAgICAvLyBCdWlsZCBxdWVyeVxuICAgIGNvbnN0IHF1ZXJ5ID0geyBjdXN0b21lcjogcmVxLnVzZXIuaWQgfTtcbiAgICBpZiAoc3RhdHVzICYmIHN0YXR1cyAhPT0gJ2FsbCcpIHtcbiAgICAgIHF1ZXJ5LnN0YXR1cyA9IHN0YXR1cztcbiAgICB9XG5cbiAgICAvLyBHZXQgb3JkZXJzIHdpdGggcGFnaW5hdGlvblxuICAgIGNvbnN0IG9yZGVycyA9IGF3YWl0IE9yZGVyLmZpbmQocXVlcnkpXG4gICAgICAucG9wdWxhdGUoJ2l0ZW1zLnByb2R1Y3QnLCAnbmFtZSBjYXRlZ29yeSBpbWFnZScpXG4gICAgICAuc29ydCh7IGNyZWF0ZWRBdDogLTEgfSlcbiAgICAgIC5za2lwKHNraXApXG4gICAgICAubGltaXQobGltaXQpO1xuXG4gICAgLy8gR2V0IHRvdGFsIGNvdW50IGZvciBwYWdpbmF0aW9uXG4gICAgY29uc3QgdG90YWwgPSBhd2FpdCBPcmRlci5jb3VudERvY3VtZW50cyhxdWVyeSk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogb3JkZXJzLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBjdXJyZW50OiBwYWdlLFxuICAgICAgICBwYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gbGltaXQpLFxuICAgICAgICB0b3RhbFxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIG9yZGVyczonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIG9yZGVycydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL29yZGVycy86aWRcbi8vIEBkZXNjICAgIEdldCBzaW5nbGUgb3JkZXIgYnkgSURcbi8vIEBhY2Nlc3MgIFByaXZhdGVcbnJvdXRlci5nZXQoJy86aWQnLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoe1xuICAgICAgX2lkOiByZXEucGFyYW1zLmlkLFxuICAgICAgY3VzdG9tZXI6IHJlcS51c2VyLmlkXG4gICAgfSkucG9wdWxhdGUoJ2l0ZW1zLnByb2R1Y3QnLCAnbmFtZSBjYXRlZ29yeSBpbWFnZSBkZXNjcmlwdGlvbicpO1xuXG4gICAgaWYgKCFvcmRlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogb3JkZXJcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBvcmRlcjonLCBlcnJvcik7XG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdDYXN0RXJyb3InKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgb3JkZXIgSUQnXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIG9yZGVyJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL29yZGVyc1xuLy8gQGRlc2MgICAgQ3JlYXRlIG5ldyBvcmRlclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxucm91dGVyLnBvc3QoJy8nLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7XG4gICAgICBpdGVtcyxcbiAgICAgIG9yZGVyVHlwZSxcbiAgICAgIHBheW1lbnRNZXRob2QsXG4gICAgICBkZWxpdmVyeUFkZHJlc3MsXG4gICAgICBub3Rlc1xuICAgIH0gPSByZXEuYm9keTtcblxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgIGlmICghaXRlbXMgfHwgIUFycmF5LmlzQXJyYXkoaXRlbXMpIHx8IGl0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBtdXN0IGNvbnRhaW4gYXQgbGVhc3Qgb25lIGl0ZW0nXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoIW9yZGVyVHlwZSB8fCAhWydwaWNrdXAnLCAnZGVsaXZlcnknLCAnZGluZS1pbiddLmluY2x1ZGVzKG9yZGVyVHlwZSkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnVmFsaWQgb3JkZXIgdHlwZSBpcyByZXF1aXJlZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICghcGF5bWVudE1ldGhvZCB8fCAhWydjYXNoJywgJ2NhcmQnLCAnZGlnaXRhbF93YWxsZXQnLCAnbW9tbycsICd2bnBheSddLmluY2x1ZGVzKHBheW1lbnRNZXRob2QpKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ1ZhbGlkIHBheW1lbnQgbWV0aG9kIGlzIHJlcXVpcmVkJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgZGVsaXZlcnkgYWRkcmVzcyBmb3IgZGVsaXZlcnkgb3JkZXJzXG4gICAgaWYgKG9yZGVyVHlwZSA9PT0gJ2RlbGl2ZXJ5Jykge1xuICAgICAgaWYgKCFkZWxpdmVyeUFkZHJlc3MgfHwgIWRlbGl2ZXJ5QWRkcmVzcy5zdHJlZXQgfHwgIWRlbGl2ZXJ5QWRkcmVzcy5jaXR5KSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ0RlbGl2ZXJ5IGFkZHJlc3MgaXMgcmVxdWlyZWQgZm9yIGRlbGl2ZXJ5IG9yZGVycydcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgYW5kIGNhbGN1bGF0ZSBvcmRlciB0b3RhbHNcbiAgICBsZXQgc3VidG90YWwgPSAwO1xuICAgIGNvbnN0IHZhbGlkYXRlZEl0ZW1zID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgIC8vIFZhbGlkYXRlIHByb2R1Y3QgZXhpc3RzXG4gICAgICBjb25zdCBwcm9kdWN0ID0gYXdhaXQgUHJvZHVjdC5maW5kQnlJZChpdGVtLnByb2R1Y3QpO1xuICAgICAgaWYgKCFwcm9kdWN0KSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogYFByb2R1Y3Qgd2l0aCBJRCAke2l0ZW0ucHJvZHVjdH0gbm90IGZvdW5kYFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgcXVhbnRpdHlcbiAgICAgIGlmICghaXRlbS5xdWFudGl0eSB8fCBpdGVtLnF1YW50aXR5IDwgMSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdJdGVtIHF1YW50aXR5IG11c3QgYmUgYXQgbGVhc3QgMSdcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBpdGVtIHByaWNlIChiYXNlIHByaWNlIG9yIHNpemUtc3BlY2lmaWMgcHJpY2UpXG4gICAgICBsZXQgaXRlbVByaWNlID0gcHJvZHVjdC5wcmljZTtcbiAgICAgIGlmIChpdGVtLnNpemUgJiYgcHJvZHVjdC5zaXplcyAmJiBwcm9kdWN0LnNpemVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3Qgc2l6ZU9wdGlvbiA9IHByb2R1Y3Quc2l6ZXMuZmluZChzID0+IHMubmFtZSA9PT0gaXRlbS5zaXplKTtcbiAgICAgICAgaWYgKHNpemVPcHRpb24pIHtcbiAgICAgICAgICBpdGVtUHJpY2UgPSBzaXplT3B0aW9uLnByaWNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGl0ZW1Ub3RhbCA9IGl0ZW1QcmljZSAqIGl0ZW0ucXVhbnRpdHk7XG4gICAgICBzdWJ0b3RhbCArPSBpdGVtVG90YWw7XG5cbiAgICAgIHZhbGlkYXRlZEl0ZW1zLnB1c2goe1xuICAgICAgICBwcm9kdWN0OiBwcm9kdWN0Ll9pZCxcbiAgICAgICAgbmFtZTogcHJvZHVjdC5uYW1lLFxuICAgICAgICBwcmljZTogaXRlbVByaWNlLFxuICAgICAgICBxdWFudGl0eTogaXRlbS5xdWFudGl0eSxcbiAgICAgICAgc2l6ZTogaXRlbS5zaXplIHx8ICdSZWd1bGFyJyxcbiAgICAgICAgY3VzdG9taXphdGlvbnM6IGl0ZW0uY3VzdG9taXphdGlvbnMgfHwgW11cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSB0YXggKDglIGZvciBleGFtcGxlKVxuICAgIGNvbnN0IHRheCA9IHN1YnRvdGFsICogMC4wODtcbiAgICBjb25zdCB0b3RhbCA9IHN1YnRvdGFsICsgdGF4O1xuXG4gICAgLy8gR2VuZXJhdGUgdW5pcXVlIG9yZGVyIG51bWJlclxuICAgIGNvbnN0IG9yZGVyTnVtYmVyID0gYE9SRC0ke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDQpLnRvVXBwZXJDYXNlKCl9YDtcblxuICAgIC8vIENyZWF0ZSBvcmRlclxuICAgIGNvbnN0IG9yZGVyID0gbmV3IE9yZGVyKHtcbiAgICAgIG9yZGVyTnVtYmVyLFxuICAgICAgY3VzdG9tZXI6IHJlcS51c2VyLmlkLFxuICAgICAgaXRlbXM6IHZhbGlkYXRlZEl0ZW1zLFxuICAgICAgc3VidG90YWwsXG4gICAgICB0YXgsXG4gICAgICB0b3RhbCxcbiAgICAgIG9yZGVyVHlwZSxcbiAgICAgIHBheW1lbnRNZXRob2QsXG4gICAgICBkZWxpdmVyeUFkZHJlc3M6IG9yZGVyVHlwZSA9PT0gJ2RlbGl2ZXJ5JyA/IGRlbGl2ZXJ5QWRkcmVzcyA6IHVuZGVmaW5lZCxcbiAgICAgIG5vdGVzOiBub3RlcyB8fCAnJyxcbiAgICAgIGxveWFsdHlQb2ludHNFYXJuZWQ6IE1hdGguZmxvb3IodG90YWwgKiAwLjEpIC8vIDEwJSBvZiB0b3RhbCBhcyBwb2ludHNcbiAgICB9KTtcblxuICAgIGF3YWl0IG9yZGVyLnNhdmUoKTtcblxuICAgIC8vIFBvcHVsYXRlIHRoZSBvcmRlciBiZWZvcmUgc2VuZGluZyByZXNwb25zZVxuICAgIGF3YWl0IG9yZGVyLnBvcHVsYXRlKCdpdGVtcy5wcm9kdWN0JywgJ25hbWUgY2F0ZWdvcnkgaW1hZ2UnKTtcblxuICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBvcmRlcixcbiAgICAgIG1lc3NhZ2U6ICdPcmRlciBjcmVhdGVkIHN1Y2Nlc3NmdWxseSdcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBvcmRlcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGNyZWF0aW5nIG9yZGVyJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUFVUIC9hcGkvb3JkZXJzLzppZC9zdGF0dXNcbi8vIEBkZXNjICAgIFVwZGF0ZSBvcmRlciBzdGF0dXMgKGZvciBhZG1pbiB1c2UpXG4vLyBAYWNjZXNzICBQcml2YXRlXG5yb3V0ZXIucHV0KCcvOmlkL3N0YXR1cycsIGF1dGgsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgc3RhdHVzIH0gPSByZXEuYm9keTtcbiAgICBjb25zdCB2YWxpZFN0YXR1c2VzID0gWydwZW5kaW5nJywgJ2NvbmZpcm1lZCcsICdwcmVwYXJpbmcnLCAncmVhZHknLCAnY29tcGxldGVkJywgJ2NhbmNlbGxlZCddO1xuXG4gICAgaWYgKCFzdGF0dXMgfHwgIXZhbGlkU3RhdHVzZXMuaW5jbHVkZXMoc3RhdHVzKSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdWYWxpZCBzdGF0dXMgaXMgcmVxdWlyZWQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpO1xuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBvd25zIHRoZSBvcmRlciBvciBpcyBhZG1pbiAoZm9yIG5vdywgYWxsb3cgdXNlciB0byBjYW5jZWwgdGhlaXIgb3duIG9yZGVycylcbiAgICBpZiAob3JkZXIuY3VzdG9tZXIudG9TdHJpbmcoKSAhPT0gcmVxLnVzZXIuaWQgJiYgc3RhdHVzICE9PSAnY2FuY2VsbGVkJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byB1cGRhdGUgdGhpcyBvcmRlcidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE9ubHkgYWxsb3cgY2FuY2VsbGF0aW9uIGlmIG9yZGVyIGlzIHN0aWxsIHBlbmRpbmcgb3IgY29uZmlybWVkXG4gICAgaWYgKHN0YXR1cyA9PT0gJ2NhbmNlbGxlZCcgJiYgIVsncGVuZGluZycsICdjb25maXJtZWQnXS5pbmNsdWRlcyhvcmRlci5zdGF0dXMpKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIGNhbm5vdCBiZSBjYW5jZWxsZWQgYXQgdGhpcyBzdGFnZSdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIG9yZGVyLnN0YXR1cyA9IHN0YXR1cztcbiAgICBpZiAoc3RhdHVzID09PSAnY29tcGxldGVkJykge1xuICAgICAgb3JkZXIuYWN0dWFsQ29tcGxldGlvblRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgIH1cblxuICAgIGF3YWl0IG9yZGVyLnNhdmUoKTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBvcmRlcixcbiAgICAgIG1lc3NhZ2U6ICdPcmRlciBzdGF0dXMgdXBkYXRlZCBzdWNjZXNzZnVsbHknXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgb3JkZXIgc3RhdHVzOicsIGVycm9yKTtcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0Nhc3RFcnJvcicpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBvcmRlciBJRCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgdXBkYXRpbmcgb3JkZXIgc3RhdHVzJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgREVMRVRFIC9hcGkvb3JkZXJzLzppZFxuLy8gQGRlc2MgICAgQ2FuY2VsL0RlbGV0ZSBvcmRlciAob25seSBpZiBwZW5kaW5nKVxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxucm91dGVyLmRlbGV0ZSgnLzppZCcsIGF1dGgsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXIuZmluZE9uZSh7XG4gICAgICBfaWQ6IHJlcS5wYXJhbXMuaWQsXG4gICAgICBjdXN0b21lcjogcmVxLnVzZXIuaWRcbiAgICB9KTtcblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gT25seSBhbGxvdyBkZWxldGlvbiBpZiBvcmRlciBpcyBwZW5kaW5nXG4gICAgaWYgKG9yZGVyLnN0YXR1cyAhPT0gJ3BlbmRpbmcnKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09ubHkgcGVuZGluZyBvcmRlcnMgY2FuIGJlIGNhbmNlbGxlZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIG9yZGVyLnN0YXR1cyA9ICdjYW5jZWxsZWQnO1xuICAgIGF3YWl0IG9yZGVyLnNhdmUoKTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnT3JkZXIgY2FuY2VsbGVkIHN1Y2Nlc3NmdWxseSdcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjYW5jZWxsaW5nIG9yZGVyOicsIGVycm9yKTtcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0Nhc3RFcnJvcicpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBvcmRlciBJRCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgY2FuY2VsbGluZyBvcmRlcidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL29yZGVycy9zdGF0cy9zdW1tYXJ5XG4vLyBAZGVzYyAgICBHZXQgb3JkZXIgc3RhdGlzdGljcyBmb3IgdXNlclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxucm91dGVyLmdldCgnL3N0YXRzL3N1bW1hcnknLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlci5pZDtcblxuICAgIC8vIEdldCBvcmRlciBjb3VudHMgYnkgc3RhdHVzXG4gICAgY29uc3Qgc3RhdHVzQ291bnRzID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHsgJG1hdGNoOiB7IGN1c3RvbWVyOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCh1c2VySWQpIH0gfSxcbiAgICAgIHsgJGdyb3VwOiB7IF9pZDogJyRzdGF0dXMnLCBjb3VudDogeyAkc3VtOiAxIH0gfSB9XG4gICAgXSk7XG5cbiAgICAvLyBHZXQgdG90YWwgc3BlbnRcbiAgICBjb25zdCB0b3RhbFNwZW50ID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHsgXG4gICAgICAgICRtYXRjaDogeyBcbiAgICAgICAgICBjdXN0b21lcjogbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQodXNlcklkKSxcbiAgICAgICAgICBzdGF0dXM6IHsgJGluOiBbJ2NvbXBsZXRlZCcsICdyZWFkeSddIH1cbiAgICAgICAgfSBcbiAgICAgIH0sXG4gICAgICB7ICRncm91cDogeyBfaWQ6IG51bGwsIHRvdGFsOiB7ICRzdW06ICckdG90YWwnIH0gfSB9XG4gICAgXSk7XG5cbiAgICAvLyBHZXQgcmVjZW50IG9yZGVycyBjb3VudCAobGFzdCAzMCBkYXlzKVxuICAgIGNvbnN0IHRoaXJ0eURheXNBZ28gPSBuZXcgRGF0ZSgpO1xuICAgIHRoaXJ0eURheXNBZ28uc2V0RGF0ZSh0aGlydHlEYXlzQWdvLmdldERhdGUoKSAtIDMwKTtcbiAgICBcbiAgICBjb25zdCByZWNlbnRPcmRlcnNDb3VudCA9IGF3YWl0IE9yZGVyLmNvdW50RG9jdW1lbnRzKHtcbiAgICAgIGN1c3RvbWVyOiB1c2VySWQsXG4gICAgICBjcmVhdGVkQXQ6IHsgJGd0ZTogdGhpcnR5RGF5c0FnbyB9XG4gICAgfSk7XG5cbiAgICAvLyBHZXQgbG95YWx0eSBwb2ludHNcbiAgICBjb25zdCBsb3lhbHR5UG9pbnRzID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHsgJG1hdGNoOiB7IGN1c3RvbWVyOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCh1c2VySWQpIH0gfSxcbiAgICAgIHsgXG4gICAgICAgICRncm91cDogeyBcbiAgICAgICAgICBfaWQ6IG51bGwsIFxuICAgICAgICAgIGVhcm5lZDogeyAkc3VtOiAnJGxveWFsdHlQb2ludHNFYXJuZWQnIH0sXG4gICAgICAgICAgdXNlZDogeyAkc3VtOiAnJGxveWFsdHlQb2ludHNVc2VkJyB9XG4gICAgICAgIH0gXG4gICAgICB9XG4gICAgXSk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBzdGF0dXNDb3VudHM6IHN0YXR1c0NvdW50cy5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xuICAgICAgICAgIGFjY1tpdGVtLl9pZF0gPSBpdGVtLmNvdW50O1xuICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIHt9KSxcbiAgICAgICAgdG90YWxTcGVudDogdG90YWxTcGVudFswXT8udG90YWwgfHwgMCxcbiAgICAgICAgcmVjZW50T3JkZXJzQ291bnQsXG4gICAgICAgIGxveWFsdHlQb2ludHM6IHtcbiAgICAgICAgICBlYXJuZWQ6IGxveWFsdHlQb2ludHNbMF0/LmVhcm5lZCB8fCAwLFxuICAgICAgICAgIHVzZWQ6IGxveWFsdHlQb2ludHNbMF0/LnVzZWQgfHwgMCxcbiAgICAgICAgICBhdmFpbGFibGU6IChsb3lhbHR5UG9pbnRzWzBdPy5lYXJuZWQgfHwgMCkgLSAobG95YWx0eVBvaW50c1swXT8udXNlZCB8fCAwKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgb3JkZXIgc3RhdGlzdGljczonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIG9yZGVyIHN0YXRpc3RpY3MnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTUMsS0FBSyxHQUFHSCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDeEMsTUFBTUksT0FBTyxHQUFHSixPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDNUMsTUFBTTtF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","map":{"version":3,"names":["express","require","router","Router","Order","Product","protect","auth","get","req","res","page","parseInt","query","limit","skip","status","customer","user","id","orders","find","populate","sort","createdAt","total","countDocuments","json","success","data","pagination","current","pages","Math","ceil","error","console","message","order","findOne","_id","params","name","post","items","orderType","paymentMethod","deliveryAddress","notes","body","Array","isArray","length","includes","street","city","subtotal","validatedItems","item","product","findById","quantity","itemPrice","price","size","sizes","sizeOption","s","itemTotal","push","customizations","tax","orderNumber","Date","now","random","toString","substr","toUpperCase","undefined","loyaltyPointsEarned","floor","save","put","validStatuses","actualCompletionTime","delete","userId","statusCounts","aggregate","$match","mongoose","Types","ObjectId","$group","count","$sum","totalSpent","$in","thirtyDaysAgo","setDate","getDate","recentOrdersCount","$gte","loyaltyPoints","earned","used","reduce","acc","available","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["orders.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst Order = require('../models/Order');\nconst Product = require('../models/Product');\nconst { protect: auth } = require('../middleware/auth');\n\n// @route   GET /api/orders\n// @desc    Get all orders for authenticated user\n// @access  Private\nrouter.get('/', auth, async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const skip = (page - 1) * limit;\n    const status = req.query.status;\n\n    // Build query\n    const query = { customer: req.user.id };\n    if (status && status !== 'all') {\n      query.status = status;\n    }\n\n    // Get orders with pagination\n    const orders = await Order.find(query)\n      .populate('items.product', 'name category image')\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(limit);\n\n    // Get total count for pagination\n    const total = await Order.countDocuments(query);\n\n    res.json({\n      success: true,\n      data: orders,\n      pagination: {\n        current: page,\n        pages: Math.ceil(total / limit),\n        total\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching orders'\n    });\n  }\n});\n\n// @route   GET /api/orders/:id\n// @desc    Get single order by ID\n// @access  Private\nrouter.get('/:id', auth, async (req, res) => {\n  try {\n    const order = await Order.findOne({\n      _id: req.params.id,\n      customer: req.user.id\n    }).populate('items.product', 'name category image description');\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    res.json({\n      success: true,\n      data: order\n    });\n  } catch (error) {\n    console.error('Error fetching order:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order'\n    });\n  }\n});\n\n// @route   POST /api/orders\n// @desc    Create new order\n// @access  Private\nrouter.post('/', auth, async (req, res) => {\n  try {\n    const {\n      items,\n      orderType,\n      paymentMethod,\n      deliveryAddress,\n      notes\n    } = req.body;\n\n    // Validate required fields\n    if (!items || !Array.isArray(items) || items.length === 0) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order must contain at least one item'\n      });\n    }\n\n    if (!orderType || !['pickup', 'delivery', 'dine-in'].includes(orderType)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid order type is required'\n      });\n    }\n\n    if (!paymentMethod || !['cash', 'card', 'digital_wallet', 'momo', 'vnpay'].includes(paymentMethod)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid payment method is required'\n      });\n    }\n\n    // Validate delivery address for delivery orders\n    if (orderType === 'delivery') {\n      if (!deliveryAddress || !deliveryAddress.street || !deliveryAddress.city) {\n        return res.status(400).json({\n          success: false,\n          message: 'Delivery address is required for delivery orders'\n        });\n      }\n    }\n\n    // Validate and calculate order totals\n    let subtotal = 0;\n    const validatedItems = [];\n\n    for (const item of items) {\n      // Validate product exists\n      const product = await Product.findById(item.product);\n      if (!product) {\n        return res.status(400).json({\n          success: false,\n          message: `Product with ID ${item.product} not found`\n        });\n      }\n\n      // Validate quantity\n      if (!item.quantity || item.quantity < 1) {\n        return res.status(400).json({\n          success: false,\n          message: 'Item quantity must be at least 1'\n        });\n      }\n\n      // Calculate item price (base price or size-specific price)\n      let itemPrice = product.price;\n      if (item.size && product.sizes && product.sizes.length > 0) {\n        const sizeOption = product.sizes.find(s => s.name === item.size);\n        if (sizeOption) {\n          itemPrice = sizeOption.price;\n        }\n      }\n\n      const itemTotal = itemPrice * item.quantity;\n      subtotal += itemTotal;\n\n      validatedItems.push({\n        product: product._id,\n        name: product.name,\n        price: itemPrice,\n        quantity: item.quantity,\n        size: item.size || 'Regular',\n        customizations: item.customizations || []\n      });\n    }\n\n    // Calculate tax (8% for example)\n    const tax = subtotal * 0.08;\n    const total = subtotal + tax;\n\n    // Generate unique order number\n    const orderNumber = `ORD-${Date.now()}-${Math.random().toString(36).substr(2, 4).toUpperCase()}`;\n\n    // Create order\n    const order = new Order({\n      orderNumber,\n      customer: req.user.id,\n      items: validatedItems,\n      subtotal,\n      tax,\n      total,\n      orderType,\n      paymentMethod,\n      deliveryAddress: orderType === 'delivery' ? deliveryAddress : undefined,\n      notes: notes || '',\n      loyaltyPointsEarned: Math.floor(total * 0.1) // 10% of total as points\n    });\n\n    await order.save();\n\n    // Populate the order before sending response\n    await order.populate('items.product', 'name category image');\n\n    res.status(201).json({\n      success: true,\n      data: order,\n      message: 'Order created successfully'\n    });\n  } catch (error) {\n    console.error('Error creating order:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating order'\n    });\n  }\n});\n\n// @route   PUT /api/orders/:id/status\n// @desc    Update order status (for admin use)\n// @access  Private\nrouter.put('/:id/status', auth, async (req, res) => {\n  try {\n    const { status } = req.body;\n    const validStatuses = ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'];\n\n    if (!status || !validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid status is required'\n      });\n    }\n\n    const order = await Order.findById(req.params.id);\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if user owns the order or is admin (for now, allow user to cancel their own orders)\n    if (order.customer.toString() !== req.user.id && status !== 'cancelled') {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to update this order'\n      });\n    }\n\n    // Only allow cancellation if order is still pending or confirmed\n    if (status === 'cancelled' && !['pending', 'confirmed'].includes(order.status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order cannot be cancelled at this stage'\n      });\n    }\n\n    order.status = status;\n    if (status === 'completed') {\n      order.actualCompletionTime = new Date();\n    }\n\n    await order.save();\n\n    res.json({\n      success: true,\n      data: order,\n      message: 'Order status updated successfully'\n    });\n  } catch (error) {\n    console.error('Error updating order status:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating order status'\n    });\n  }\n});\n\n// @route   DELETE /api/orders/:id\n// @desc    Cancel/Delete order (only if pending)\n// @access  Private\nrouter.delete('/:id', auth, async (req, res) => {\n  try {\n    const order = await Order.findOne({\n      _id: req.params.id,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Only allow deletion if order is pending\n    if (order.status !== 'pending') {\n      return res.status(400).json({\n        success: false,\n        message: 'Only pending orders can be cancelled'\n      });\n    }\n\n    order.status = 'cancelled';\n    await order.save();\n\n    res.json({\n      success: true,\n      message: 'Order cancelled successfully'\n    });\n  } catch (error) {\n    console.error('Error cancelling order:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while cancelling order'\n    });\n  }\n});\n\n// @route   GET /api/orders/stats/summary\n// @desc    Get order statistics for user\n// @access  Private\nrouter.get('/stats/summary', auth, async (req, res) => {\n  try {\n    const userId = req.user.id;\n\n    // Get order counts by status\n    const statusCounts = await Order.aggregate([\n      { $match: { customer: mongoose.Types.ObjectId(userId) } },\n      { $group: { _id: '$status', count: { $sum: 1 } } }\n    ]);\n\n    // Get total spent\n    const totalSpent = await Order.aggregate([\n      { \n        $match: { \n          customer: mongoose.Types.ObjectId(userId),\n          status: { $in: ['completed', 'ready'] }\n        } \n      },\n      { $group: { _id: null, total: { $sum: '$total' } } }\n    ]);\n\n    // Get recent orders count (last 30 days)\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n    \n    const recentOrdersCount = await Order.countDocuments({\n      customer: userId,\n      createdAt: { $gte: thirtyDaysAgo }\n    });\n\n    // Get loyalty points\n    const loyaltyPoints = await Order.aggregate([\n      { $match: { customer: mongoose.Types.ObjectId(userId) } },\n      { \n        $group: { \n          _id: null, \n          earned: { $sum: '$loyaltyPointsEarned' },\n          used: { $sum: '$loyaltyPointsUsed' }\n        } \n      }\n    ]);\n\n    res.json({\n      success: true,\n      data: {\n        statusCounts: statusCounts.reduce((acc, item) => {\n          acc[item._id] = item.count;\n          return acc;\n        }, {}),\n        totalSpent: totalSpent[0]?.total || 0,\n        recentOrdersCount,\n        loyaltyPoints: {\n          earned: loyaltyPoints[0]?.earned || 0,\n          used: loyaltyPoints[0]?.used || 0,\n          available: (loyaltyPoints[0]?.earned || 0) - (loyaltyPoints[0]?.used || 0)\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching order statistics:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order statistics'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1756971338295},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\Order.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const mongoose = require('mongoose');\nconst orderItemSchema = new mongoose.Schema({\n  product: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Product',\n    required: true\n  },\n  name: {\n    type: String,\n    required: true\n  },\n  price: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  quantity: {\n    type: Number,\n    required: true,\n    min: 1\n  },\n  size: {\n    type: String,\n    default: 'Regular'\n  },\n  customizations: [{\n    type: String,\n    trim: true\n  }]\n});\nconst orderSchema = new mongoose.Schema({\n  orderNumber: {\n    type: String,\n    unique: true,\n    required: true\n  },\n  customer: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'User',\n    required: true\n  },\n  items: [orderItemSchema],\n  subtotal: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  tax: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  total: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  status: {\n    type: String,\n    enum: ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'],\n    default: 'pending'\n  },\n  orderType: {\n    type: String,\n    enum: ['pickup', 'delivery', 'dine-in'],\n    required: true\n  },\n  paymentMethod: {\n    type: String,\n    enum: ['cash', 'card', 'digital_wallet', 'momo', 'vnpay'],\n    required: true\n  },\n  paymentStatus: {\n    type: String,\n    enum: ['pending', 'paid', 'failed', 'refunded'],\n    default: 'pending'\n  },\n  // MoMo payment transaction details\n  momoTransaction: {\n    requestId: String,\n    transId: String,\n    payUrl: String,\n    deeplink: String,\n    qrCodeUrl: String,\n    resultCode: Number,\n    message: String,\n    responseTime: String,\n    payType: String\n  },\n  deliveryAddress: {\n    street: String,\n    city: String,\n    state: String,\n    zipCode: String,\n    instructions: String\n  },\n  estimatedTime: {\n    type: Date\n  },\n  actualCompletionTime: {\n    type: Date\n  },\n  notes: {\n    type: String,\n    maxlength: 500\n  },\n  loyaltyPointsEarned: {\n    type: Number,\n    default: 0,\n    min: 0\n  },\n  loyaltyPointsUsed: {\n    type: Number,\n    default: 0,\n    min: 0\n  },\n  // Promotional code information\n  promoCode: {\n    code: String,\n    type: String,\n    value: Number,\n    description: String\n  },\n  discount: {\n    type: Number,\n    default: 0,\n    min: 0\n  }\n}, {\n  timestamps: true\n});\n\n// Index for better performance\norderSchema.index({\n  customer: 1\n});\norderSchema.index({\n  orderNumber: 1\n});\norderSchema.index({\n  status: 1\n});\norderSchema.index({\n  createdAt: -1\n});\n\n// Generate order number before saving\norderSchema.pre('save', async function (next) {\n  if (this.isNew) {\n    const date = new Date();\n    const dateStr = date.toISOString().slice(0, 10).replace(/-/g, '');\n    const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');\n    this.orderNumber = `WC${dateStr}${randomNum}`;\n  }\n  next();\n});\n\n// Calculate estimated completion time\norderSchema.methods.calculateEstimatedTime = function () {\n  const baseTime = 15; // 15 minutes base time\n  const itemTime = this.items.reduce((total, item) => total + item.quantity * 2, 0);\n  const estimatedMinutes = baseTime + itemTime;\n  const moment = require('moment-timezone');\n  const nowVN = moment.tz('Asia/Ho_Chi_Minh');\n  this.estimatedTime = nowVN.add(estimatedMinutes, 'minutes').toDate();\n  return this.estimatedTime;\n};\nmodule.exports = mongoose.model('Order', orderSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJvcmRlckl0ZW1TY2hlbWEiLCJTY2hlbWEiLCJwcm9kdWN0IiwidHlwZSIsIlR5cGVzIiwiT2JqZWN0SWQiLCJyZWYiLCJyZXF1aXJlZCIsIm5hbWUiLCJTdHJpbmciLCJwcmljZSIsIk51bWJlciIsIm1pbiIsInF1YW50aXR5Iiwic2l6ZSIsImRlZmF1bHQiLCJjdXN0b21pemF0aW9ucyIsInRyaW0iLCJvcmRlclNjaGVtYSIsIm9yZGVyTnVtYmVyIiwidW5pcXVlIiwiY3VzdG9tZXIiLCJpdGVtcyIsInN1YnRvdGFsIiwidGF4IiwidG90YWwiLCJzdGF0dXMiLCJlbnVtIiwib3JkZXJUeXBlIiwicGF5bWVudE1ldGhvZCIsInBheW1lbnRTdGF0dXMiLCJtb21vVHJhbnNhY3Rpb24iLCJyZXF1ZXN0SWQiLCJ0cmFuc0lkIiwicGF5VXJsIiwiZGVlcGxpbmsiLCJxckNvZGVVcmwiLCJyZXN1bHRDb2RlIiwibWVzc2FnZSIsInJlc3BvbnNlVGltZSIsInBheVR5cGUiLCJkZWxpdmVyeUFkZHJlc3MiLCJzdHJlZXQiLCJjaXR5Iiwic3RhdGUiLCJ6aXBDb2RlIiwiaW5zdHJ1Y3Rpb25zIiwiZXN0aW1hdGVkVGltZSIsIkRhdGUiLCJhY3R1YWxDb21wbGV0aW9uVGltZSIsIm5vdGVzIiwibWF4bGVuZ3RoIiwibG95YWx0eVBvaW50c0Vhcm5lZCIsImxveWFsdHlQb2ludHNVc2VkIiwicHJvbW9Db2RlIiwiY29kZSIsInZhbHVlIiwiZGVzY3JpcHRpb24iLCJkaXNjb3VudCIsInRpbWVzdGFtcHMiLCJpbmRleCIsImNyZWF0ZWRBdCIsInByZSIsIm5leHQiLCJpc05ldyIsImRhdGUiLCJkYXRlU3RyIiwidG9JU09TdHJpbmciLCJzbGljZSIsInJlcGxhY2UiLCJyYW5kb21OdW0iLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJ0b1N0cmluZyIsInBhZFN0YXJ0IiwibWV0aG9kcyIsImNhbGN1bGF0ZUVzdGltYXRlZFRpbWUiLCJiYXNlVGltZSIsIml0ZW1UaW1lIiwicmVkdWNlIiwiaXRlbSIsImVzdGltYXRlZE1pbnV0ZXMiLCJtb21lbnQiLCJub3dWTiIsInR6IiwiYWRkIiwidG9EYXRlIiwibW9kdWxlIiwiZXhwb3J0cyIsIm1vZGVsIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xcbW9kZWxzXFwiLCJzb3VyY2VzIjpbIk9yZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcblxuY29uc3Qgb3JkZXJJdGVtU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gIHByb2R1Y3Q6IHtcbiAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXG4gICAgcmVmOiAnUHJvZHVjdCcsXG4gICAgcmVxdWlyZWQ6IHRydWVcbiAgfSxcbiAgbmFtZToge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICByZXF1aXJlZDogdHJ1ZVxuICB9LFxuICBwcmljZToge1xuICAgIHR5cGU6IE51bWJlcixcbiAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICBtaW46IDBcbiAgfSxcbiAgcXVhbnRpdHk6IHtcbiAgICB0eXBlOiBOdW1iZXIsXG4gICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgbWluOiAxXG4gIH0sXG4gIHNpemU6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgZGVmYXVsdDogJ1JlZ3VsYXInXG4gIH0sXG4gIGN1c3RvbWl6YXRpb25zOiBbe1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICB0cmltOiB0cnVlXG4gIH1dXG59KTtcblxuY29uc3Qgb3JkZXJTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcbiAgb3JkZXJOdW1iZXI6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgdW5pcXVlOiB0cnVlLFxuICAgIHJlcXVpcmVkOiB0cnVlXG4gIH0sXG4gIGN1c3RvbWVyOiB7XG4gICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxuICAgIHJlZjogJ1VzZXInLFxuICAgIHJlcXVpcmVkOiB0cnVlXG4gIH0sXG4gIGl0ZW1zOiBbb3JkZXJJdGVtU2NoZW1hXSxcbiAgc3VidG90YWw6IHtcbiAgICB0eXBlOiBOdW1iZXIsXG4gICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgbWluOiAwXG4gIH0sXG4gIHRheDoge1xuICAgIHR5cGU6IE51bWJlcixcbiAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICBtaW46IDBcbiAgfSxcbiAgdG90YWw6IHtcbiAgICB0eXBlOiBOdW1iZXIsXG4gICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgbWluOiAwXG4gIH0sXG4gIHN0YXR1czoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICBlbnVtOiBbJ3BlbmRpbmcnLCAnY29uZmlybWVkJywgJ3ByZXBhcmluZycsICdyZWFkeScsICdjb21wbGV0ZWQnLCAnY2FuY2VsbGVkJ10sXG4gICAgZGVmYXVsdDogJ3BlbmRpbmcnXG4gIH0sXG4gIG9yZGVyVHlwZToge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICBlbnVtOiBbJ3BpY2t1cCcsICdkZWxpdmVyeScsICdkaW5lLWluJ10sXG4gICAgcmVxdWlyZWQ6IHRydWVcbiAgfSxcbiAgcGF5bWVudE1ldGhvZDoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICBlbnVtOiBbJ2Nhc2gnLCAnY2FyZCcsICdkaWdpdGFsX3dhbGxldCcsICdtb21vJywgJ3ZucGF5J10sXG4gICAgcmVxdWlyZWQ6IHRydWVcbiAgfSxcbiAgcGF5bWVudFN0YXR1czoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICBlbnVtOiBbJ3BlbmRpbmcnLCAncGFpZCcsICdmYWlsZWQnLCAncmVmdW5kZWQnXSxcbiAgICBkZWZhdWx0OiAncGVuZGluZydcbiAgfSxcbiAgLy8gTW9NbyBwYXltZW50IHRyYW5zYWN0aW9uIGRldGFpbHNcbiAgbW9tb1RyYW5zYWN0aW9uOiB7XG4gICAgcmVxdWVzdElkOiBTdHJpbmcsXG4gICAgdHJhbnNJZDogU3RyaW5nLFxuICAgIHBheVVybDogU3RyaW5nLFxuICAgIGRlZXBsaW5rOiBTdHJpbmcsXG4gICAgcXJDb2RlVXJsOiBTdHJpbmcsXG4gICAgcmVzdWx0Q29kZTogTnVtYmVyLFxuICAgIG1lc3NhZ2U6IFN0cmluZyxcbiAgICByZXNwb25zZVRpbWU6IFN0cmluZyxcbiAgICBwYXlUeXBlOiBTdHJpbmdcbiAgfSxcbiAgZGVsaXZlcnlBZGRyZXNzOiB7XG4gICAgc3RyZWV0OiBTdHJpbmcsXG4gICAgY2l0eTogU3RyaW5nLFxuICAgIHN0YXRlOiBTdHJpbmcsXG4gICAgemlwQ29kZTogU3RyaW5nLFxuICAgIGluc3RydWN0aW9uczogU3RyaW5nXG4gIH0sXG4gIGVzdGltYXRlZFRpbWU6IHtcbiAgICB0eXBlOiBEYXRlXG4gIH0sXG4gIGFjdHVhbENvbXBsZXRpb25UaW1lOiB7XG4gICAgdHlwZTogRGF0ZVxuICB9LFxuICBub3Rlczoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICBtYXhsZW5ndGg6IDUwMFxuICB9LFxuICBsb3lhbHR5UG9pbnRzRWFybmVkOiB7XG4gICAgdHlwZTogTnVtYmVyLFxuICAgIGRlZmF1bHQ6IDAsXG4gICAgbWluOiAwXG4gIH0sXG4gIGxveWFsdHlQb2ludHNVc2VkOiB7XG4gICAgdHlwZTogTnVtYmVyLFxuICAgIGRlZmF1bHQ6IDAsXG4gICAgbWluOiAwXG4gIH0sXG4gIC8vIFByb21vdGlvbmFsIGNvZGUgaW5mb3JtYXRpb25cbiAgcHJvbW9Db2RlOiB7XG4gICAgY29kZTogU3RyaW5nLFxuICAgIHR5cGU6IFN0cmluZyxcbiAgICB2YWx1ZTogTnVtYmVyLFxuICAgIGRlc2NyaXB0aW9uOiBTdHJpbmdcbiAgfSxcbiAgZGlzY291bnQ6IHtcbiAgICB0eXBlOiBOdW1iZXIsXG4gICAgZGVmYXVsdDogMCxcbiAgICBtaW46IDBcbiAgfVxufSwge1xuICB0aW1lc3RhbXBzOiB0cnVlXG59KTtcblxuLy8gSW5kZXggZm9yIGJldHRlciBwZXJmb3JtYW5jZVxub3JkZXJTY2hlbWEuaW5kZXgoeyBjdXN0b21lcjogMSB9KTtcbm9yZGVyU2NoZW1hLmluZGV4KHsgb3JkZXJOdW1iZXI6IDEgfSk7XG5vcmRlclNjaGVtYS5pbmRleCh7IHN0YXR1czogMSB9KTtcbm9yZGVyU2NoZW1hLmluZGV4KHsgY3JlYXRlZEF0OiAtMSB9KTtcblxuLy8gR2VuZXJhdGUgb3JkZXIgbnVtYmVyIGJlZm9yZSBzYXZpbmdcbm9yZGVyU2NoZW1hLnByZSgnc2F2ZScsIGFzeW5jIGZ1bmN0aW9uKG5leHQpIHtcbiAgaWYgKHRoaXMuaXNOZXcpIHtcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBkYXRlU3RyID0gZGF0ZS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDEwKS5yZXBsYWNlKC8tL2csICcnKTtcbiAgICBjb25zdCByYW5kb21OdW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwKS50b1N0cmluZygpLnBhZFN0YXJ0KDMsICcwJyk7XG4gICAgdGhpcy5vcmRlck51bWJlciA9IGBXQyR7ZGF0ZVN0cn0ke3JhbmRvbU51bX1gO1xuICB9XG4gIG5leHQoKTtcbn0pO1xuXG4vLyBDYWxjdWxhdGUgZXN0aW1hdGVkIGNvbXBsZXRpb24gdGltZVxub3JkZXJTY2hlbWEubWV0aG9kcy5jYWxjdWxhdGVFc3RpbWF0ZWRUaW1lID0gZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGJhc2VUaW1lID0gMTU7IC8vIDE1IG1pbnV0ZXMgYmFzZSB0aW1lXG4gIGNvbnN0IGl0ZW1UaW1lID0gdGhpcy5pdGVtcy5yZWR1Y2UoKHRvdGFsLCBpdGVtKSA9PiB0b3RhbCArIChpdGVtLnF1YW50aXR5ICogMiksIDApO1xuICBjb25zdCBlc3RpbWF0ZWRNaW51dGVzID0gYmFzZVRpbWUgKyBpdGVtVGltZTtcbiAgXG4gIGNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudC10aW1lem9uZScpO1xuICBjb25zdCBub3dWTiA9IG1vbWVudC50eignQXNpYS9Ib19DaGlfTWluaCcpO1xuICB0aGlzLmVzdGltYXRlZFRpbWUgPSBub3dWTi5hZGQoZXN0aW1hdGVkTWludXRlcywgJ21pbnV0ZXMnKS50b0RhdGUoKTtcbiAgcmV0dXJuIHRoaXMuZXN0aW1hdGVkVGltZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ09yZGVyJywgb3JkZXJTY2hlbWEpOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRXBDLE1BQU1DLGVBQWUsR0FBRyxJQUFJRixRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUMxQ0MsT0FBTyxFQUFFO0lBQ1BDLElBQUksRUFBRUwsUUFBUSxDQUFDRyxNQUFNLENBQUNHLEtBQUssQ0FBQ0MsUUFBUTtJQUNwQ0MsR0FBRyxFQUFFLFNBQVM7SUFDZEMsUUFBUSxFQUFFO0VBQ1osQ0FBQztFQUNEQyxJQUFJLEVBQUU7SUFDSkwsSUFBSSxFQUFFTSxNQUFNO0lBQ1pGLFFBQVEsRUFBRTtFQUNaLENBQUM7RUFDREcsS0FBSyxFQUFFO0lBQ0xQLElBQUksRUFBRVEsTUFBTTtJQUNaSixRQUFRLEVBQUUsSUFBSTtJQUNkSyxHQUFHLEVBQUU7RUFDUCxDQUFDO0VBQ0RDLFFBQVEsRUFBRTtJQUNSVixJQUFJLEVBQUVRLE1BQU07SUFDWkosUUFBUSxFQUFFLElBQUk7SUFDZEssR0FBRyxFQUFFO0VBQ1AsQ0FBQztFQUNERSxJQUFJLEVBQUU7SUFDSlgsSUFBSSxFQUFFTSxNQUFNO0lBQ1pNLE9BQU8sRUFBRTtFQUNYLENBQUM7RUFDREMsY0FBYyxFQUFFLENBQUM7SUFDZmIsSUFBSSxFQUFFTSxNQUFNO0lBQ1pRLElBQUksRUFBRTtFQUNSLENBQUM7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNQyxXQUFXLEdBQUcsSUFBSXBCLFFBQVEsQ0FBQ0csTUFBTSxDQUFDO0VBQ3RDa0IsV0FBVyxFQUFFO0lBQ1hoQixJQUFJLEVBQUVNLE1BQU07SUFDWlcsTUFBTSxFQUFFLElBQUk7SUFDWmIs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","map":{"version":3,"names":["mongoose","require","orderItemSchema","Schema","product","type","Types","ObjectId","ref","required","name","String","price","Number","min","quantity","size","default","customizations","trim","orderSchema","orderNumber","unique","customer","items","subtotal","tax","total","status","enum","orderType","paymentMethod","paymentStatus","momoTransaction","requestId","transId","payUrl","deeplink","qrCodeUrl","resultCode","message","responseTime","payType","deliveryAddress","street","city","state","zipCode","instructions","estimatedTime","Date","actualCompletionTime","notes","maxlength","loyaltyPointsEarned","loyaltyPointsUsed","promoCode","code","value","description","discount","timestamps","index","createdAt","pre","next","isNew","date","dateStr","toISOString","slice","replace","randomNum","Math","floor","random","toString","padStart","methods","calculateEstimatedTime","baseTime","itemTime","reduce","item","estimatedMinutes","moment","nowVN","tz","add","toDate","module","exports","model"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\models\\","sources":["Order.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst orderItemSchema = new mongoose.Schema({\n  product: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Product',\n    required: true\n  },\n  name: {\n    type: String,\n    required: true\n  },\n  price: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  quantity: {\n    type: Number,\n    required: true,\n    min: 1\n  },\n  size: {\n    type: String,\n    default: 'Regular'\n  },\n  customizations: [{\n    type: String,\n    trim: true\n  }]\n});\n\nconst orderSchema = new mongoose.Schema({\n  orderNumber: {\n    type: String,\n    unique: true,\n    required: true\n  },\n  customer: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'User',\n    required: true\n  },\n  items: [orderItemSchema],\n  subtotal: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  tax: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  total: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  status: {\n    type: String,\n    enum: ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'],\n    default: 'pending'\n  },\n  orderType: {\n    type: String,\n    enum: ['pickup', 'delivery', 'dine-in'],\n    required: true\n  },\n  paymentMethod: {\n    type: String,\n    enum: ['cash', 'card', 'digital_wallet', 'momo', 'vnpay'],\n    required: true\n  },\n  paymentStatus: {\n    type: String,\n    enum: ['pending', 'paid', 'failed', 'refunded'],\n    default: 'pending'\n  },\n  // MoMo payment transaction details\n  momoTransaction: {\n    requestId: String,\n    transId: String,\n    payUrl: String,\n    deeplink: String,\n    qrCodeUrl: String,\n    resultCode: Number,\n    message: String,\n    responseTime: String,\n    payType: String\n  },\n  deliveryAddress: {\n    street: String,\n    city: String,\n    state: String,\n    zipCode: String,\n    instructions: String\n  },\n  estimatedTime: {\n    type: Date\n  },\n  actualCompletionTime: {\n    type: Date\n  },\n  notes: {\n    type: String,\n    maxlength: 500\n  },\n  loyaltyPointsEarned: {\n    type: Number,\n    default: 0,\n    min: 0\n  },\n  loyaltyPointsUsed: {\n    type: Number,\n    default: 0,\n    min: 0\n  },\n  // Promotional code information\n  promoCode: {\n    code: String,\n    type: String,\n    value: Number,\n    description: String\n  },\n  discount: {\n    type: Number,\n    default: 0,\n    min: 0\n  }\n}, {\n  timestamps: true\n});\n\n// Index for better performance\norderSchema.index({ customer: 1 });\norderSchema.index({ orderNumber: 1 });\norderSchema.index({ status: 1 });\norderSchema.index({ createdAt: -1 });\n\n// Generate order number before saving\norderSchema.pre('save', async function(next) {\n  if (this.isNew) {\n    const date = new Date();\n    const dateStr = date.toISOString().slice(0, 10).replace(/-/g, '');\n    const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');\n    this.orderNumber = `WC${dateStr}${randomNum}`;\n  }\n  next();\n});\n\n// Calculate estimated completion time\norderSchema.methods.calculateEstimatedTime = function() {\n  const baseTime = 15; // 15 minutes base time\n  const itemTime = this.items.reduce((total, item) => total + (item.quantity * 2), 0);\n  const estimatedMinutes = baseTime + itemTime;\n  \n  const moment = require('moment-timezone');\n  const nowVN = moment.tz('Asia/Ho_Chi_Minh');\n  this.estimatedTime = nowVN.add(estimatedMinutes, 'minutes').toDate();\n  return this.estimatedTime;\n};\n\nmodule.exports = mongoose.model('Order', orderSchema);"],"mappings":"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","ignoreList":[]}},"mtime":1757590253594},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\payments.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst Order = require('../models/Order');\nconst momoService = require('../services/momoService');\nconst vnpayConfig = require('../config/vnpay');\nconst {\n  protect: auth\n} = require('../middleware/auth');\nconst moment = require('moment-timezone');\n\n// @route   POST /api/payments/momo/create\n// @desc    Create MoMo payment request\n// @access  Private\nrouter.post('/momo/create', auth, async (req, res) => {\n  try {\n    const {\n      orderId,\n      amount,\n      orderInfo\n    } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Validate amount\n    if (amount <= 0 || amount > 50000000) {\n      // MoMo limit is 50M VND\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid payment amount'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // Create MoMo payment request\n    const paymentResult = await momoService.createPayment({\n      orderId,\n      amount: Math.round(amount),\n      // Ensure amount is integer\n      orderInfo: orderInfo || `Payment for DREAM COFFEE order ${orderId}`,\n      extraData: JSON.stringify({\n        userId: req.user.id,\n        orderNumber: orderId\n      })\n    });\n    if (!paymentResult.success) {\n      return res.status(500).json({\n        success: false,\n        message: 'Failed to create MoMo payment',\n        error: paymentResult.error\n      });\n    }\n\n    // Update order with MoMo transaction details\n    order.momoTransaction = {\n      requestId: paymentResult.requestId,\n      payUrl: paymentResult.data.payUrl,\n      deeplink: paymentResult.data.deeplink,\n      qrCodeUrl: paymentResult.data.qrCodeUrl,\n      resultCode: paymentResult.data.resultCode,\n      message: paymentResult.data.message\n    };\n    await order.save();\n    res.json({\n      success: true,\n      data: {\n        payUrl: paymentResult.data.payUrl,\n        deeplink: paymentResult.data.deeplink,\n        qrCodeUrl: paymentResult.data.qrCodeUrl,\n        requestId: paymentResult.requestId,\n        orderId: orderId,\n        amount: amount\n      },\n      message: 'MoMo payment created successfully'\n    });\n  } catch (error) {\n    console.error('MoMo payment creation error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating MoMo payment'\n    });\n  }\n});\n\n// @route   POST /api/payments/momo/callback\n// @desc    Handle MoMo payment callback (IPN)\n// @access  Public\nrouter.post('/momo/callback', async (req, res) => {\n  try {\n    console.log('MoMo callback received:', req.body);\n    const {\n      partnerCode,\n      orderId,\n      requestId,\n      amount,\n      orderInfo,\n      orderType,\n      transId,\n      resultCode,\n      message,\n      payType,\n      responseTime,\n      extraData,\n      signature\n    } = req.body;\n\n    // Verify callback signature\n    const isValidSignature = momoService.verifyCallback(req.body);\n    if (!isValidSignature) {\n      console.error('Invalid MoMo callback signature');\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid signature'\n      });\n    }\n\n    // Find the order\n    const order = await Order.findOne({\n      orderNumber: orderId\n    });\n    if (!order) {\n      console.error(`Order not found for MoMo callback: ${orderId}`);\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Update order with transaction details\n    order.momoTransaction = {\n      ...order.momoTransaction,\n      transId,\n      resultCode: parseInt(resultCode),\n      message,\n      responseTime,\n      payType\n    };\n\n    // Update payment status based on result code\n    if (resultCode === '0') {\n      // Payment successful\n      order.paymentStatus = 'paid';\n      order.status = 'confirmed';\n      console.log(`MoMo payment successful for order: ${orderId}`);\n    } else {\n      // Payment failed\n      order.paymentStatus = 'failed';\n      console.log(`MoMo payment failed for order: ${orderId}, code: ${resultCode}`);\n    }\n    await order.save();\n\n    // Respond to MoMo\n    res.json({\n      success: true,\n      message: 'Callback processed successfully'\n    });\n  } catch (error) {\n    console.error('MoMo callback processing error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while processing callback'\n    });\n  }\n});\n\n// @route   GET /api/payments/momo/status/:orderId\n// @desc    Check MoMo payment status\n// @access  Private\nrouter.get('/momo/status/:orderId', auth, async (req, res) => {\n  try {\n    const {\n      orderId\n    } = req.params;\n\n    // Find the order\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Return payment status\n    res.json({\n      success: true,\n      data: {\n        orderId: order.orderNumber,\n        paymentStatus: order.paymentStatus,\n        orderStatus: order.status,\n        momoTransaction: order.momoTransaction,\n        amount: order.total\n      }\n    });\n  } catch (error) {\n    console.error('Payment status check error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while checking payment status'\n    });\n  }\n});\n\n// @route   POST /api/payments/momo/return\n// @desc    Handle MoMo payment return URL\n// @access  Public\nrouter.get('/momo/return', async (req, res) => {\n  try {\n    const {\n      partnerCode,\n      orderId,\n      requestId,\n      amount,\n      orderInfo,\n      orderType,\n      transId,\n      resultCode,\n      message,\n      payType,\n      responseTime,\n      extraData,\n      signature\n    } = req.query;\n    console.log('MoMo return URL accessed:', req.query);\n\n    // Verify signature\n    const isValidSignature = momoService.verifyCallback(req.query);\n    if (!isValidSignature) {\n      return res.redirect(`${process.env.FRONTEND_URL}/payment/error?message=Invalid signature`);\n    }\n\n    // Redirect based on payment result\n    if (resultCode === '0') {\n      // Payment successful\n      res.redirect(`${process.env.FRONTEND_URL}/payment/success?orderId=${orderId}&transId=${transId}`);\n    } else {\n      // Payment failed\n      res.redirect(`${process.env.FRONTEND_URL}/payment/error?orderId=${orderId}&message=${encodeURIComponent(message)}`);\n    }\n  } catch (error) {\n    console.error('MoMo return URL error:', error);\n    res.redirect(`${process.env.FRONTEND_URL}/payment/error?message=Processing error`);\n  }\n});\n\n// @route   POST /api/payments/vnpay/create\n// @desc    Create VNPay payment request\n// @access  Private\nrouter.post('/vnpay/create', auth, async (req, res) => {\n  try {\n    const {\n      orderId,\n      amount,\n      orderInfo,\n      bankCode\n    } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Validate amount\n    if (amount <= 0 || amount > 500000000) {\n      // VNPay limit is 500M VND\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid payment amount'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // Get client IP address\n    const ipAddr = req.headers['x-forwarded-for'] || req.connection.remoteAddress || req.socket.remoteAddress || (req.connection.socket ? req.connection.socket.remoteAddress : null) || '127.0.0.1';\n\n    // Debug: Log the parameters being sent to VNPay\n    console.log('VNPay Payment Parameters:', {\n      orderId,\n      amount,\n      orderInfo: orderInfo || `Thanh toan don hang ${orderId}`,\n      ipAddr,\n      bankCode\n    });\n\n    // Create payment URL\n    try {\n      const paymentUrl = vnpayConfig.createPaymentUrl(orderId, amount, orderInfo || `Thanh toan don hang ${orderId}`, ipAddr, bankCode);\n      console.log('Generated VNPay URL:', paymentUrl);\n\n      // Update order with payment method\n      await Order.findByIdAndUpdate(order._id, {\n        paymentMethod: 'vnpay',\n        paymentStatus: 'pending'\n      });\n      res.json({\n        success: true,\n        message: 'VNPay payment URL created successfully',\n        data: {\n          paymentUrl,\n          orderId,\n          amount\n        }\n      });\n    } catch (vnpayError) {\n      console.error('VNPay URL creation error:', vnpayError.message);\n      return res.status(400).json({\n        success: false,\n        message: 'Failed to create payment URL: ' + vnpayError.message\n      });\n    }\n  } catch (error) {\n    console.error('VNPay create payment error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Internal server error',\n      error: process.env.NODE_ENV === 'development' ? error.message : undefined\n    });\n  }\n});\n\n// @route   GET /api/payments/vnpay/return\n// @desc    Handle VNPay return URL\n// @access  Public\nrouter.get('/vnpay/return', async (req, res) => {\n  try {\n    const vnp_Params = req.query;\n    const orderId = vnp_Params.vnp_TxnRef;\n    const responseCode = vnp_Params.vnp_ResponseCode;\n    const transactionNo = vnp_Params.vnp_TransactionNo;\n    const amount = vnp_Params.vnp_Amount / 100; // Convert from VND cents\n\n    // Verify the return URL\n    const isValidSignature = vnpayConfig.verifyReturnUrl(vnp_Params);\n    if (!isValidSignature) {\n      return res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Invalid signature`);\n    }\n\n    // Find the order\n    const order = await Order.findOne({\n      orderNumber: orderId\n    });\n    if (!order) {\n      return res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Order not found`);\n    }\n    let paymentStatus = 'failed';\n    let message = vnpayConfig.getPaymentStatus(responseCode);\n    if (responseCode === '00') {\n      paymentStatus = 'paid';\n      // Update order status\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'paid',\n        status: 'confirmed',\n        paymentDetails: {\n          method: 'vnpay',\n          transactionId: transactionNo,\n          amount: amount,\n          responseCode: responseCode,\n          paidAt: moment.tz('Asia/Ho_Chi_Minh').toDate()\n        }\n      });\n    } else {\n      // Update order with failed payment\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'failed',\n        paymentDetails: {\n          method: 'vnpay',\n          responseCode: responseCode,\n          failedAt: moment.tz('Asia/Ho_Chi_Minh').toDate(),\n          failureReason: message\n        }\n      });\n    }\n\n    // Redirect to frontend with result\n    const redirectUrl = `${process.env.FRONTEND_URL}/checkout/result?status=${paymentStatus}&orderId=${orderId}&message=${encodeURIComponent(message)}`;\n    res.redirect(redirectUrl);\n  } catch (error) {\n    console.error('VNPay return URL error:', error);\n    res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Payment processing error`);\n  }\n});\n\n// @route   POST /api/payments/vnpay/ipn\n// @desc    Handle VNPay IPN (Instant Payment Notification)\n// @access  Public\nrouter.post('/vnpay/ipn', async (req, res) => {\n  try {\n    const vnp_Params = req.query;\n    const orderId = vnp_Params.vnp_TxnRef;\n    const responseCode = vnp_Params.vnp_ResponseCode;\n    const transactionNo = vnp_Params.vnp_TransactionNo;\n    const amount = vnp_Params.vnp_Amount / 100;\n\n    // Verify the IPN\n    const isValidSignature = vnpayConfig.verifyReturnUrl(vnp_Params);\n    if (!isValidSignature) {\n      return res.status(400).json({\n        RspCode: '97',\n        Message: 'Invalid signature'\n      });\n    }\n\n    // Find the order\n    const order = await Order.findOne({\n      orderNumber: orderId\n    });\n    if (!order) {\n      return res.status(400).json({\n        RspCode: '01',\n        Message: 'Order not found'\n      });\n    }\n\n    // Check if order amount matches\n    if (Math.abs(order.total - amount) > 1) {\n      // Allow 1 VND difference for rounding\n      return res.status(400).json({\n        RspCode: '04',\n        Message: 'Invalid amount'\n      });\n    }\n    if (responseCode === '00') {\n      // Payment successful\n      if (order.paymentStatus !== 'paid') {\n        await Order.findByIdAndUpdate(order._id, {\n          paymentStatus: 'paid',\n          status: 'confirmed',\n          paymentDetails: {\n            method: 'vnpay',\n            transactionId: transactionNo,\n            amount: amount,\n            responseCode: responseCode,\n            paidAt: new Date()\n          }\n        });\n      }\n      return res.status(200).json({\n        RspCode: '00',\n        Message: 'Success'\n      });\n    } else {\n      // Payment failed\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'failed',\n        paymentDetails: {\n          method: 'vnpay',\n          responseCode: responseCode,\n          failedAt: new Date(),\n          failureReason: vnpayConfig.getPaymentStatus(responseCode)\n        }\n      });\n      return res.status(200).json({\n        RspCode: '00',\n        Message: 'Success'\n      });\n    }\n  } catch (error) {\n    console.error('VNPay IPN error:', error);\n    res.status(500).json({\n      RspCode: '99',\n      Message: 'Internal server error'\n    });\n  }\n});\n\n// @route   GET /api/payments/vnpay/status/:orderId\n// @desc    Get VNPay payment status\n// @access  Private\nrouter.get('/vnpay/status/:orderId', auth, async (req, res) => {\n  try {\n    const {\n      orderId\n    } = req.params;\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: {\n        orderId: order.orderNumber,\n        paymentStatus: order.paymentStatus,\n        paymentMethod: order.paymentMethod,\n        paymentDetails: order.paymentDetails,\n        totalAmount: order.total\n      }\n    });\n  } catch (error) {\n    console.error('Get VNPay status error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Internal server error'\n    });\n  }\n});\n\n// @route   POST /api/payments/card/process\n// @desc    Process card payment\n// @access  Private\nrouter.post('/card/process', auth, async (req, res) => {\n  try {\n    const {\n      orderId,\n      amount,\n      cardData\n    } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // In a real implementation, you would:\n    // 1. Validate card details with a payment processor (Stripe, Square, etc.)\n    // 2. Process the actual payment\n    // 3. Handle payment success/failure\n\n    // For demo purposes, we'll simulate a successful payment\n    // In production, NEVER store full card details in your database\n\n    // Simulate payment processing delay\n    await new Promise(resolve => setTimeout(resolve, 1000));\n\n    // Update order with payment details\n    order.paymentStatus = 'paid';\n    order.status = 'confirmed';\n    order.paymentDetails = {\n      method: 'card',\n      lastFour: cardData.lastFour,\n      cardholderName: cardData.cardholderName,\n      paidAt: moment.tz('Asia/Ho_Chi_Minh').toDate(),\n      transactionId: `card_${moment.tz('Asia/Ho_Chi_Minh').valueOf()}_${Math.random().toString(36).substr(2, 9)}`\n    };\n    await order.save();\n    res.json({\n      success: true,\n      message: 'Card payment processed successfully',\n      data: {\n        orderId: order.orderNumber,\n        transactionId: order.paymentDetails.transactionId,\n        amount: amount\n      }\n    });\n  } catch (error) {\n    console.error('Card payment processing error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while processing card payment'\n    });\n  }\n});\n\n// @route   POST /api/payments/cash/confirm\n// @desc    Confirm cash payment order\n// @access  Private\nrouter.post('/cash/confirm', auth, async (req, res) => {\n  try {\n    const {\n      orderId,\n      amount\n    } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already confirmed\n    if (order.status === 'confirmed' || order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already confirmed'\n      });\n    }\n\n    // Update order status for cash payment\n    // Cash orders are confirmed but payment status remains pending until actual payment\n    order.status = 'confirmed';\n    order.paymentDetails = {\n      method: 'cash',\n      confirmedAt: moment.tz('Asia/Ho_Chi_Minh').toDate(),\n      orderType: order.orderType // delivery or pickup\n    };\n    await order.save();\n    res.json({\n      success: true,\n      message: 'Cash payment order confirmed successfully',\n      data: {\n        orderId: order.orderNumber,\n        status: order.status,\n        paymentMethod: 'cash',\n        orderType: order.orderType\n      }\n    });\n  } catch (error) {\n    console.error('Cash payment confirmation error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while confirming cash payment'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIk9yZGVyIiwibW9tb1NlcnZpY2UiLCJ2bnBheUNvbmZpZyIsInByb3RlY3QiLCJhdXRoIiwibW9tZW50IiwicG9zdCIsInJlcSIsInJlcyIsIm9yZGVySWQiLCJhbW91bnQiLCJvcmRlckluZm8iLCJib2R5Iiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwib3JkZXIiLCJmaW5kT25lIiwib3JkZXJOdW1iZXIiLCJjdXN0b21lciIsInVzZXIiLCJpZCIsInBheW1lbnRTdGF0dXMiLCJwYXltZW50UmVzdWx0IiwiY3JlYXRlUGF5bWVudCIsIk1hdGgiLCJyb3VuZCIsImV4dHJhRGF0YSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1c2VySWQiLCJlcnJvciIsIm1vbW9UcmFuc2FjdGlvbiIsInJlcXVlc3RJZCIsInBheVVybCIsImRhdGEiLCJkZWVwbGluayIsInFyQ29kZVVybCIsInJlc3VsdENvZGUiLCJzYXZlIiwiY29uc29sZSIsImxvZyIsInBhcnRuZXJDb2RlIiwib3JkZXJUeXBlIiwidHJhbnNJZCIsInBheVR5cGUiLCJyZXNwb25zZVRpbWUiLCJzaWduYXR1cmUiLCJpc1ZhbGlkU2lnbmF0dXJlIiwidmVyaWZ5Q2FsbGJhY2siLCJwYXJzZUludCIsImdldCIsInBhcmFtcyIsIm9yZGVyU3RhdHVzIiwidG90YWwiLCJxdWVyeSIsInJlZGlyZWN0IiwicHJvY2VzcyIsImVudiIsIkZST05URU5EX1VSTCIsImVuY29kZVVSSUNvbXBvbmVudCIsImJhbmtDb2RlIiwiaXBBZGRyIiwiaGVhZGVycyIsImNvbm5lY3Rpb24iLCJyZW1vdGVBZGRyZXNzIiwic29ja2V0IiwicGF5bWVudFVybCIsImNyZWF0ZVBheW1lbnRVcmwiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIl9pZCIsInBheW1lbnRNZXRob2QiLCJ2bnBheUVycm9yIiwiTk9ERV9FTlYiLCJ1bmRlZmluZWQiLCJ2bnBfUGFyYW1zIiwidm5wX1R4blJlZiIsInJlc3BvbnNlQ29kZSIsInZucF9SZXNwb25zZUNvZGUiLCJ0cmFuc2FjdGlvbk5vIiwidm5wX1RyYW5zYWN0aW9uTm8iLCJ2bnBfQW1vdW50IiwidmVyaWZ5UmV0dXJuVXJsIiwiZ2V0UGF5bWVudFN0YXR1cyIsInBheW1lbnREZXRhaWxzIiwibWV0aG9kIiwidHJhbnNhY3Rpb25JZCIsInBhaWRBdCIsInR6IiwidG9EYXRlIiwiZmFpbGVkQXQiLCJmYWlsdXJlUmVhc29uIiwicmVkaXJlY3RVcmwiLCJSc3BDb2RlIiwiTWVzc2FnZSIsImFicyIsIkRhdGUiLCJ0b3RhbEFtb3VudCIsImNhcmREYXRhIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwibGFzdEZvdXIiLCJjYXJkaG9sZGVyTmFtZSIsInZhbHVlT2YiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsImNvbmZpcm1lZEF0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXHJvdXRlc1xcIiwic291cmNlcyI6WyJwYXltZW50cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcbmNvbnN0IE9yZGVyID0gcmVxdWlyZSgnLi4vbW9kZWxzL09yZGVyJyk7XG5jb25zdCBtb21vU2VydmljZSA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL21vbW9TZXJ2aWNlJyk7XG5jb25zdCB2bnBheUNvbmZpZyA9IHJlcXVpcmUoJy4uL2NvbmZpZy92bnBheScpO1xuY29uc3QgeyBwcm90ZWN0OiBhdXRoIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudC10aW1lem9uZScpO1xuXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvcGF5bWVudHMvbW9tby9jcmVhdGVcbi8vIEBkZXNjICAgIENyZWF0ZSBNb01vIHBheW1lbnQgcmVxdWVzdFxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxucm91dGVyLnBvc3QoJy9tb21vL2NyZWF0ZScsIGF1dGgsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgb3JkZXJJZCwgYW1vdW50LCBvcmRlckluZm8gfSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzXG4gICAgaWYgKCFvcmRlcklkIHx8ICFhbW91bnQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgSUQgYW5kIGFtb3VudCBhcmUgcmVxdWlyZWQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBhbW91bnRcbiAgICBpZiAoYW1vdW50IDw9IDAgfHwgYW1vdW50ID4gNTAwMDAwMDApIHsgLy8gTW9NbyBsaW1pdCBpcyA1ME0gVk5EXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgcGF5bWVudCBhbW91bnQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBGaW5kIHRoZSBvcmRlciB0byB2ZXJpZnkgaXQgYmVsb25ncyB0byB0aGUgdXNlclxuICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXIuZmluZE9uZSh7XG4gICAgICBvcmRlck51bWJlcjogb3JkZXJJZCxcbiAgICAgIGN1c3RvbWVyOiByZXEudXNlci5pZFxuICAgIH0pO1xuXG4gICAgaWYgKCFvcmRlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBvcmRlciBpcyBhbHJlYWR5IHBhaWRcbiAgICBpZiAob3JkZXIucGF5bWVudFN0YXR1cyA9PT0gJ3BhaWQnKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIGlzIGFscmVhZHkgcGFpZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBNb01vIHBheW1lbnQgcmVxdWVzdFxuICAgIGNvbnN0IHBheW1lbnRSZXN1bHQgPSBhd2FpdCBtb21vU2VydmljZS5jcmVhdGVQYXltZW50KHtcbiAgICAgIG9yZGVySWQsXG4gICAgICBhbW91bnQ6IE1hdGgucm91bmQoYW1vdW50KSwgLy8gRW5zdXJlIGFtb3VudCBpcyBpbnRlZ2VyXG4gICAgICBvcmRlckluZm86IG9yZGVySW5mbyB8fCBgUGF5bWVudCBmb3IgRFJFQU0gQ09GRkVFIG9yZGVyICR7b3JkZXJJZH1gLFxuICAgICAgZXh0cmFEYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHVzZXJJZDogcmVxLnVzZXIuaWQsXG4gICAgICAgIG9yZGVyTnVtYmVyOiBvcmRlcklkXG4gICAgICB9KVxuICAgIH0pO1xuXG4gICAgaWYgKCFwYXltZW50UmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBNb01vIHBheW1lbnQnLFxuICAgICAgICBlcnJvcjogcGF5bWVudFJlc3VsdC5lcnJvclxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIG9yZGVyIHdpdGggTW9NbyB0cmFuc2FjdGlvbiBkZXRhaWxzXG4gICAgb3JkZXIubW9tb1RyYW5zYWN0aW9uID0ge1xuICAgICAgcmVxdWVzdElkOiBwYXltZW50UmVzdWx0LnJlcXVlc3RJZCxcbiAgICAgIHBheVVybDogcGF5bWVudFJlc3VsdC5kYXRhLnBheVVybCxcbiAgICAgIGRlZXBsaW5rOiBwYXltZW50UmVzdWx0LmRhdGEuZGVlcGxpbmssXG4gICAgICBxckNvZGVVcmw6IHBheW1lbnRSZXN1bHQuZGF0YS5xckNvZGVVcmwsXG4gICAgICByZXN1bHRDb2RlOiBwYXltZW50UmVzdWx0LmRhdGEucmVzdWx0Q29kZSxcbiAgICAgIG1lc3NhZ2U6IHBheW1lbnRSZXN1bHQuZGF0YS5tZXNzYWdlXG4gICAgfTtcbiAgICBcbiAgICBhd2FpdCBvcmRlci5zYXZlKCk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBwYXlVcmw6IHBheW1lbnRSZXN1bHQuZGF0YS5wYXlVcmwsXG4gICAgICAgIGRlZXBsaW5rOiBwYXltZW50UmVzdWx0LmRhdGEuZGVlcGxpbmssXG4gICAgICAgIHFyQ29kZVVybDogcGF5bWVudFJlc3VsdC5kYXRhLnFyQ29kZVVybCxcbiAgICAgICAgcmVxdWVzdElkOiBwYXltZW50UmVzdWx0LnJlcXVlc3RJZCxcbiAgICAgICAgb3JkZXJJZDogb3JkZXJJZCxcbiAgICAgICAgYW1vdW50OiBhbW91bnRcbiAgICAgIH0sXG4gICAgICBtZXNzYWdlOiAnTW9NbyBwYXltZW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5J1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ01vTW8gcGF5bWVudCBjcmVhdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGNyZWF0aW5nIE1vTW8gcGF5bWVudCdcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9wYXltZW50cy9tb21vL2NhbGxiYWNrXG4vLyBAZGVzYyAgICBIYW5kbGUgTW9NbyBwYXltZW50IGNhbGxiYWNrIChJUE4pXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5wb3N0KCcvbW9tby9jYWxsYmFjaycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKCdNb01vIGNhbGxiYWNrIHJlY2VpdmVkOicsIHJlcS5ib2R5KTtcblxuICAgIGNvbnN0IHtcbiAgICAgIHBhcnRuZXJDb2RlLFxuICAgICAgb3JkZXJJZCxcbiAgICAgIHJlcXVlc3RJZCxcbiAgICAgIGFtb3VudCxcbiAgICAgIG9yZGVySW5mbyxcbiAgICAgIG9yZGVyVHlwZSxcbiAgICAgIHRyYW5zSWQsXG4gICAgICByZXN1bHRDb2RlLFxuICAgICAgbWVzc2FnZSxcbiAgICAgIHBheVR5cGUsXG4gICAgICByZXNwb25zZVRpbWUsXG4gICAgICBleHRyYURhdGEsXG4gICAgICBzaWduYXR1cmVcbiAgICB9ID0gcmVxLmJvZHk7XG5cbiAgICAvLyBWZXJpZnkgY2FsbGJhY2sgc2lnbmF0dXJlXG4gICAgY29uc3QgaXNWYWxpZFNpZ25hdHVyZSA9IG1vbW9TZXJ2aWNlLnZlcmlmeUNhbGxiYWNrKHJlcS5ib2R5KTtcbiAgICBcbiAgICBpZiAoIWlzVmFsaWRTaWduYXR1cmUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgTW9NbyBjYWxsYmFjayBzaWduYXR1cmUnKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBzaWduYXR1cmUnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBGaW5kIHRoZSBvcmRlclxuICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXIuZmluZE9uZSh7IG9yZGVyTnVtYmVyOiBvcmRlcklkIH0pO1xuICAgIFxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYE9yZGVyIG5vdCBmb3VuZCBmb3IgTW9NbyBjYWxsYmFjazogJHtvcmRlcklkfWApO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgb3JkZXIgd2l0aCB0cmFuc2FjdGlvbiBkZXRhaWxzXG4gICAgb3JkZXIubW9tb1RyYW5zYWN0aW9uID0ge1xuICAgICAgLi4ub3JkZXIubW9tb1RyYW5zYWN0aW9uLFxuICAgICAgdHJhbnNJZCxcbiAgICAgIHJlc3VsdENvZGU6IHBhcnNlSW50KHJlc3VsdENvZGUpLFxuICAgICAgbWVzc2FnZSxcbiAgICAgIHJlc3BvbnNlVGltZSxcbiAgICAgIHBheVR5cGVcbiAgICB9O1xuXG4gICAgLy8gVXBkYXRlIHBheW1lbnQgc3RhdHVzIGJhc2VkIG9uIHJlc3VsdCBjb2RlXG4gICAgaWYgKHJlc3VsdENvZGUgPT09ICcwJykge1xuICAgICAgLy8gUGF5bWVudCBzdWNjZXNzZnVsXG4gICAgICBvcmRlci5wYXltZW50U3RhdHVzID0gJ3BhaWQnO1xuICAgICAgb3JkZXIuc3RhdHVzID0gJ2NvbmZpcm1lZCc7XG4gICAgICBjb25zb2xlLmxvZyhgTW9NbyBwYXltZW50IHN1Y2Nlc3NmdWwgZm9yIG9yZGVyOiAke29yZGVySWR9YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFBheW1lbnQgZmFpbGVkXG4gICAgICBvcmRlci5wYXltZW50U3RhdHVzID0gJ2ZhaWxlZCc7XG4gICAgICBjb25zb2xlLmxvZyhgTW9NbyBwYXltZW50IGZhaWxlZCBmb3Igb3JkZXI6ICR7b3JkZXJJZH0sIGNvZGU6ICR7cmVzdWx0Q29kZX1gKTtcbiAgICB9XG5cbiAgICBhd2FpdCBvcmRlci5zYXZlKCk7XG5cbiAgICAvLyBSZXNwb25kIHRvIE1vTW9cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ0NhbGxiYWNrIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHknXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignTW9NbyBjYWxsYmFjayBwcm9jZXNzaW5nIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgcHJvY2Vzc2luZyBjYWxsYmFjaydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3BheW1lbnRzL21vbW8vc3RhdHVzLzpvcmRlcklkXG4vLyBAZGVzYyAgICBDaGVjayBNb01vIHBheW1lbnQgc3RhdHVzXG4vLyBAYWNjZXNzICBQcml2YXRlXG5yb3V0ZXIuZ2V0KCcvbW9tby9zdGF0dXMvOm9yZGVySWQnLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IG9yZGVySWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAvLyBGaW5kIHRoZSBvcmRlclxuICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXIuZmluZE9uZSh7XG4gICAgICBvcmRlck51bWJlcjogb3JkZXJJZCxcbiAgICAgIGN1c3RvbWVyOiByZXEudXNlci5pZFxuICAgIH0pO1xuXG4gICAgaWYgKCFvcmRlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gcGF5bWVudCBzdGF0dXNcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBvcmRlcklkOiBvcmRlci5vcmRlck51bWJlcixcbiAgICAgICAgcGF5bWVudFN0YXR1czogb3JkZXIucGF5bWVudFN0YXR1cyxcbiAgICAgICAgb3JkZXJTdGF0dXM6IG9yZGVyLnN0YXR1cyxcbiAgICAgICAgbW9tb1RyYW5zYWN0aW9uOiBvcmRlci5tb21vVHJhbnNhY3Rpb24sXG4gICAgICAgIGFtb3VudDogb3JkZXIudG90YWxcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdQYXltZW50IHN0YXR1cyBjaGVjayBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGNoZWNraW5nIHBheW1lbnQgc3RhdHVzJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3BheW1lbnRzL21vbW8vcmV0dXJuXG4vLyBAZGVzYyAgICBIYW5kbGUgTW9NbyBwYXltZW50IHJldHVybiBVUkxcbi8vIEBhY2Nlc3MgIFB1YmxpY1xucm91dGVyLmdldCgnL21vbW8vcmV0dXJuJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qge1xuICAgICAgcGFydG5lckNvZGUsXG4gICAgICBvcmRlcklkLFxuICAgICAgcmVxdWVzdElkLFxuICAgICAgYW1vdW50LFxuICAgICAgb3JkZXJJbmZvLFxuICAgICAgb3JkZXJUeXBlLFxuICAgICAgdHJhbnNJZCxcbiAgICAgIHJlc3VsdENvZGUsXG4gICAgICBtZXNzYWdlLFxuICAgICAgcGF5VHlwZSxcbiAgICAgIHJlc3BvbnNlVGltZSxcbiAgICAgIGV4dHJhRGF0YSxcbiAgICAgIHNpZ25hdHVyZVxuICAgIH0gPSByZXEucXVlcnk7XG5cbiAgICBjb25zb2xlLmxvZygnTW9NbyByZXR1cm4gVVJMIGFjY2Vzc2VkOicsIHJlcS5xdWVyeSk7XG5cbiAgICAvLyBWZXJpZnkgc2lnbmF0dXJlXG4gICAgY29uc3QgaXNWYWxpZFNpZ25hdHVyZSA9IG1vbW9TZXJ2aWNlLnZlcmlmeUNhbGxiYWNrKHJlcS5xdWVyeSk7XG4gICAgXG4gICAgaWYgKCFpc1ZhbGlkU2lnbmF0dXJlKSB7XG4gICAgICByZXR1cm4gcmVzLnJlZGlyZWN0KGAke3Byb2Nlc3MuZW52LkZST05URU5EX1VSTH0vcGF5bWVudC9lcnJvcj9tZXNzYWdlPUludmFsaWQgc2lnbmF0dXJlYCk7XG4gICAgfVxuXG4gICAgLy8gUmVkaXJlY3QgYmFzZWQgb24gcGF5bWVudCByZXN1bHRcbiAgICBpZiAocmVzdWx0Q29kZSA9PT0gJzAnKSB7XG4gICAgICAvLyBQYXltZW50IHN1Y2Nlc3NmdWxcbiAgICAgIHJlcy5yZWRpcmVjdChgJHtwcm9jZXNzLmVudi5GUk9OVEVORF9VUkx9L3BheW1lbnQvc3VjY2Vzcz9vcmRlcklkPSR7b3JkZXJJZH0mdHJhbnNJZD0ke3RyYW5zSWR9YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFBheW1lbnQgZmFpbGVkXG4gICAgICByZXMucmVkaXJlY3QoYCR7cHJvY2Vzcy5lbnYuRlJPTlRFTkRfVVJMfS9wYXltZW50L2Vycm9yP29yZGVySWQ9JHtvcmRlcklkfSZtZXNzYWdlPSR7ZW5jb2RlVVJJQ29tcG9uZW50KG1lc3NhZ2UpfWApO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdNb01vIHJldHVybiBVUkwgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5yZWRpcmVjdChgJHtwcm9jZXNzLmVudi5GUk9OVEVORF9VUkx9L3BheW1lbnQvZXJyb3I/bWVzc2FnZT1Qcm9jZXNzaW5nIGVycm9yYCk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvcGF5bWVudHMvdm5wYXkvY3JlYXRlXG4vLyBAZGVzYyAgICBDcmVhdGUgVk5QYXkgcGF5bWVudCByZXF1ZXN0XG4vLyBAYWNjZXNzICBQcml2YXRlXG5yb3V0ZXIucG9zdCgnL3ZucGF5L2NyZWF0ZScsIGF1dGgsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgb3JkZXJJZCwgYW1vdW50LCBvcmRlckluZm8sIGJhbmtDb2RlIH0gPSByZXEuYm9keTtcblxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgIGlmICghb3JkZXJJZCB8fCAhYW1vdW50KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIElEIGFuZCBhbW91bnQgYXJlIHJlcXVpcmVkJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgYW1vdW50XG4gICAgaWYgKGFtb3VudCA8PSAwIHx8IGFtb3VudCA+IDUwMDAwMDAwMCkgeyAvLyBWTlBheSBsaW1pdCBpcyA1MDBNIFZORFxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHBheW1lbnQgYW1vdW50J1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRmluZCB0aGUgb3JkZXIgdG8gdmVyaWZ5IGl0IGJlbG9uZ3MgdG8gdGhlIHVzZXJcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoe1xuICAgICAgb3JkZXJOdW1iZXI6IG9yZGVySWQsXG4gICAgICBjdXN0b21lcjogcmVxLnVzZXIuaWRcbiAgICB9KTtcblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgb3JkZXIgaXMgYWxyZWFkeSBwYWlkXG4gICAgaWYgKG9yZGVyLnBheW1lbnRTdGF0dXMgPT09ICdwYWlkJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBpcyBhbHJlYWR5IHBhaWQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBHZXQgY2xpZW50IElQIGFkZHJlc3NcbiAgICBjb25zdCBpcEFkZHIgPSByZXEuaGVhZGVyc1sneC1mb3J3YXJkZWQtZm9yJ10gfHxcbiAgICAgICAgICAgICAgICAgICByZXEuY29ubmVjdGlvbi5yZW1vdGVBZGRyZXNzIHx8XG4gICAgICAgICAgICAgICAgICAgcmVxLnNvY2tldC5yZW1vdGVBZGRyZXNzIHx8XG4gICAgICAgICAgICAgICAgICAgKHJlcS5jb25uZWN0aW9uLnNvY2tldCA/IHJlcS5jb25uZWN0aW9uLnNvY2tldC5yZW1vdGVBZGRyZXNzIDogbnVsbCkgfHxcbiAgICAgICAgICAgICAgICAgICAnMTI3LjAuMC4xJztcblxuICAgIC8vIERlYnVnOiBMb2cgdGhlIHBhcmFtZXRlcnMgYmVpbmcgc2VudCB0byBWTlBheVxuICAgIGNvbnNvbGUubG9nKCdWTlBheSBQYXltZW50IFBhcmFtZXRlcnM6Jywge1xuICAgICAgb3JkZXJJZCxcbiAgICAgIGFtb3VudCxcbiAgICAgIG9yZGVySW5mbzogb3JkZXJJbmZvIHx8IGBUaGFuaCB0b2FuIGRvbiBoYW5nICR7b3JkZXJJZH1gLFxuICAgICAgaXBBZGRyLFxuICAgICAgYmFua0NvZGVcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBwYXltZW50IFVSTFxuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYXltZW50VXJsID0gdm5wYXlDb25maWcuY3JlYXRlUGF5bWVudFVybChcbiAgICAgICAgb3JkZXJJZCxcbiAgICAgICAgYW1vdW50LFxuICAgICAgICBvcmRlckluZm8gfHwgYFRoYW5oIHRvYW4gZG9uIGhhbmcgJHtvcmRlcklkfWAsXG4gICAgICAgIGlwQWRkcixcbiAgICAgICAgYmFua0NvZGVcbiAgICAgICk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdHZW5lcmF0ZWQgVk5QYXkgVVJMOicsIHBheW1lbnRVcmwpO1xuXG4gICAgICAvLyBVcGRhdGUgb3JkZXIgd2l0aCBwYXltZW50IG1ldGhvZFxuICAgICAgYXdhaXQgT3JkZXIuZmluZEJ5SWRBbmRVcGRhdGUob3JkZXIuX2lkLCB7XG4gICAgICAgIHBheW1lbnRNZXRob2Q6ICd2bnBheScsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6ICdwZW5kaW5nJ1xuICAgICAgfSk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ1ZOUGF5IHBheW1lbnQgVVJMIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHBheW1lbnRVcmwsXG4gICAgICAgICAgb3JkZXJJZCxcbiAgICAgICAgICBhbW91bnRcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAodm5wYXlFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignVk5QYXkgVVJMIGNyZWF0aW9uIGVycm9yOicsIHZucGF5RXJyb3IubWVzc2FnZSk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgcGF5bWVudCBVUkw6ICcgKyB2bnBheUVycm9yLm1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH1cblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1ZOUGF5IGNyZWF0ZSBwYXltZW50IGVycm9yOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgZXJyb3I6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gZXJyb3IubWVzc2FnZSA6IHVuZGVmaW5lZFxuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvcGF5bWVudHMvdm5wYXkvcmV0dXJuXG4vLyBAZGVzYyAgICBIYW5kbGUgVk5QYXkgcmV0dXJuIFVSTFxuLy8gQGFjY2VzcyAgUHVibGljXG5yb3V0ZXIuZ2V0KCcvdm5wYXkvcmV0dXJuJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgdm5wX1BhcmFtcyA9IHJlcS5xdWVyeTtcbiAgICBjb25zdCBvcmRlcklkID0gdm5wX1BhcmFtcy52bnBfVHhuUmVmO1xuICAgIGNvbnN0IHJlc3BvbnNlQ29kZSA9IHZucF9QYXJhbXMudm5wX1Jlc3BvbnNlQ29kZTtcbiAgICBjb25zdCB0cmFuc2FjdGlvbk5vID0gdm5wX1BhcmFtcy52bnBfVHJhbnNhY3Rpb25ObztcbiAgICBjb25zdCBhbW91bnQgPSB2bnBfUGFyYW1zLnZucF9BbW91bnQgLyAxMDA7IC8vIENvbnZlcnQgZnJvbSBWTkQgY2VudHNcblxuICAgIC8vIFZlcmlmeSB0aGUgcmV0dXJuIFVSTFxuICAgIGNvbnN0IGlzVmFsaWRTaWduYXR1cmUgPSB2bnBheUNvbmZpZy52ZXJpZnlSZXR1cm5Vcmwodm5wX1BhcmFtcyk7XG5cbiAgICBpZiAoIWlzVmFsaWRTaWduYXR1cmUpIHtcbiAgICAgIHJldHVybiByZXMucmVkaXJlY3QoYCR7cHJvY2Vzcy5lbnYuRlJPTlRFTkRfVVJMfS9jaGVja291dC9yZXN1bHQ/c3RhdHVzPWVycm9yJm1lc3NhZ2U9SW52YWxpZCBzaWduYXR1cmVgKTtcbiAgICB9XG5cbiAgICAvLyBGaW5kIHRoZSBvcmRlclxuICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXIuZmluZE9uZSh7IG9yZGVyTnVtYmVyOiBvcmRlcklkIH0pO1xuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMucmVkaXJlY3QoYCR7cHJvY2Vzcy5lbnYuRlJPTlRFTkRfVVJMfS9jaGVja291dC9yZXN1bHQ/c3RhdHVzPWVycm9yJm1lc3NhZ2U9T3JkZXIgbm90IGZvdW5kYCk7XG4gICAgfVxuXG4gICAgbGV0IHBheW1lbnRTdGF0dXMgPSAnZmFpbGVkJztcbiAgICBsZXQgbWVzc2FnZSA9IHZucGF5Q29uZmlnLmdldFBheW1lbnRTdGF0dXMocmVzcG9uc2VDb2RlKTtcblxuICAgIGlmIChyZXNwb25zZUNvZGUgPT09ICcwMCcpIHtcbiAgICAgIHBheW1lbnRTdGF0dXMgPSAncGFpZCc7XG4gICAgICAvLyBVcGRhdGUgb3JkZXIgc3RhdHVzXG4gICAgICBhd2FpdCBPcmRlci5maW5kQnlJZEFuZFVwZGF0ZShvcmRlci5faWQsIHtcbiAgICAgICAgcGF5bWVudFN0YXR1czogJ3BhaWQnLFxuICAgICAgICBzdGF0dXM6ICdjb25maXJtZWQnLFxuICAgICAgICBwYXltZW50RGV0YWlsczoge1xuICAgICAgICAgIG1ldGhvZDogJ3ZucGF5JyxcbiAgICAgICAgICB0cmFuc2FjdGlvbklkOiB0cmFuc2FjdGlvbk5vLFxuICAgICAgICAgIGFtb3VudDogYW1vdW50LFxuICAgICAgICAgIHJlc3BvbnNlQ29kZTogcmVzcG9uc2VDb2RlLFxuICAgICAgICAgIHBhaWRBdDogbW9tZW50LnR6KCdBc2lhL0hvX0NoaV9NaW5oJykudG9EYXRlKClcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFVwZGF0ZSBvcmRlciB3aXRoIGZhaWxlZCBwYXltZW50XG4gICAgICBhd2FpdCBPcmRlci5maW5kQnlJZEFuZFVwZGF0ZShvcmRlci5faWQsIHtcbiAgICAgICAgcGF5bWVudFN0YXR1czogJ2ZhaWxlZCcsXG4gICAgICAgIHBheW1lbnREZXRhaWxzOiB7XG4gICAgICAgICAgbWV0aG9kOiAndm5wYXknLFxuICAgICAgICAgIHJlc3BvbnNlQ29kZTogcmVzcG9uc2VDb2RlLFxuICAgICAgICAgIGZhaWxlZEF0OiBtb21lbnQudHooJ0FzaWEvSG9fQ2hpX01pbmgnKS50b0RhdGUoKSxcbiAgICAgICAgICBmYWlsdXJlUmVhc29uOiBtZXNzYWdlXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFJlZGlyZWN0IHRvIGZyb250ZW5kIHdpdGggcmVzdWx0XG4gICAgY29uc3QgcmVkaXJlY3RVcmwgPSBgJHtwcm9jZXNzLmVudi5GUk9OVEVORF9VUkx9L2NoZWNrb3V0L3Jlc3VsdD9zdGF0dXM9JHtwYXltZW50U3RhdHVzfSZvcmRlcklkPSR7b3JkZXJJZH0mbWVzc2FnZT0ke2VuY29kZVVSSUNvbXBvbmVudChtZXNzYWdlKX1gO1xuICAgIHJlcy5yZWRpcmVjdChyZWRpcmVjdFVybCk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdWTlBheSByZXR1cm4gVVJMIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMucmVkaXJlY3QoYCR7cHJvY2Vzcy5lbnYuRlJPTlRFTkRfVVJMfS9jaGVja291dC9yZXN1bHQ/c3RhdHVzPWVycm9yJm1lc3NhZ2U9UGF5bWVudCBwcm9jZXNzaW5nIGVycm9yYCk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvcGF5bWVudHMvdm5wYXkvaXBuXG4vLyBAZGVzYyAgICBIYW5kbGUgVk5QYXkgSVBOIChJbnN0YW50IFBheW1lbnQgTm90aWZpY2F0aW9uKVxuLy8gQGFjY2VzcyAgUHVibGljXG5yb3V0ZXIucG9zdCgnL3ZucGF5L2lwbicsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHZucF9QYXJhbXMgPSByZXEucXVlcnk7XG4gICAgY29uc3Qgb3JkZXJJZCA9IHZucF9QYXJhbXMudm5wX1R4blJlZjtcbiAgICBjb25zdCByZXNwb25zZUNvZGUgPSB2bnBfUGFyYW1zLnZucF9SZXNwb25zZUNvZGU7XG4gICAgY29uc3QgdHJhbnNhY3Rpb25ObyA9IHZucF9QYXJhbXMudm5wX1RyYW5zYWN0aW9uTm87XG4gICAgY29uc3QgYW1vdW50ID0gdm5wX1BhcmFtcy52bnBfQW1vdW50IC8gMTAwO1xuXG4gICAgLy8gVmVyaWZ5IHRoZSBJUE5cbiAgICBjb25zdCBpc1ZhbGlkU2lnbmF0dXJlID0gdm5wYXlDb25maWcudmVyaWZ5UmV0dXJuVXJsKHZucF9QYXJhbXMpO1xuXG4gICAgaWYgKCFpc1ZhbGlkU2lnbmF0dXJlKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBSc3BDb2RlOiAnOTcnLCBNZXNzYWdlOiAnSW52YWxpZCBzaWduYXR1cmUnIH0pO1xuICAgIH1cblxuICAgIC8vIEZpbmQgdGhlIG9yZGVyXG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBPcmRlci5maW5kT25lKHsgb3JkZXJOdW1iZXI6IG9yZGVySWQgfSk7XG4gICAgaWYgKCFvcmRlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgUnNwQ29kZTogJzAxJywgTWVzc2FnZTogJ09yZGVyIG5vdCBmb3VuZCcgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgb3JkZXIgYW1vdW50IG1hdGNoZXNcbiAgICBpZiAoTWF0aC5hYnMob3JkZXIudG90YWwgLSBhbW91bnQpID4gMSkgeyAvLyBBbGxvdyAxIFZORCBkaWZmZXJlbmNlIGZvciByb3VuZGluZ1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgUnNwQ29kZTogJzA0JywgTWVzc2FnZTogJ0ludmFsaWQgYW1vdW50JyB9KTtcbiAgICB9XG5cbiAgICBpZiAocmVzcG9uc2VDb2RlID09PSAnMDAnKSB7XG4gICAgICAvLyBQYXltZW50IHN1Y2Nlc3NmdWxcbiAgICAgIGlmIChvcmRlci5wYXltZW50U3RhdHVzICE9PSAncGFpZCcpIHtcbiAgICAgICAgYXdhaXQgT3JkZXIuZmluZEJ5SWRBbmRVcGRhdGUob3JkZXIuX2lkLCB7XG4gICAgICAgICAgcGF5bWVudFN0YXR1czogJ3BhaWQnLFxuICAgICAgICAgIHN0YXR1czogJ2NvbmZpcm1lZCcsXG4gICAgICAgICAgcGF5bWVudERldGFpbHM6IHtcbiAgICAgICAgICAgIG1ldGhvZDogJ3ZucGF5JyxcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uSWQ6IHRyYW5zYWN0aW9uTm8sXG4gICAgICAgICAgICBhbW91bnQ6IGFtb3VudCxcbiAgICAgICAgICAgIHJlc3BvbnNlQ29kZTogcmVzcG9uc2VDb2RlLFxuICAgICAgICAgICAgcGFpZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IFJzcENvZGU6ICcwMCcsIE1lc3NhZ2U6ICdTdWNjZXNzJyB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gUGF5bWVudCBmYWlsZWRcbiAgICAgIGF3YWl0IE9yZGVyLmZpbmRCeUlkQW5kVXBkYXRlKG9yZGVyLl9pZCwge1xuICAgICAgICBwYXltZW50U3RhdHVzOiAnZmFpbGVkJyxcbiAgICAgICAgcGF5bWVudERldGFpbHM6IHtcbiAgICAgICAgICBtZXRob2Q6ICd2bnBheScsXG4gICAgICAgICAgcmVzcG9uc2VDb2RlOiByZXNwb25zZUNvZGUsXG4gICAgICAgICAgZmFpbGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgZmFpbHVyZVJlYXNvbjogdm5wYXlDb25maWcuZ2V0UGF5bWVudFN0YXR1cyhyZXNwb25zZUNvZGUpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgUnNwQ29kZTogJzAwJywgTWVzc2FnZTogJ1N1Y2Nlc3MnIH0pO1xuICAgIH1cblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1ZOUGF5IElQTiBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBSc3BDb2RlOiAnOTknLCBNZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3BheW1lbnRzL3ZucGF5L3N0YXR1cy86b3JkZXJJZFxuLy8gQGRlc2MgICAgR2V0IFZOUGF5IHBheW1lbnQgc3RhdHVzXG4vLyBAYWNjZXNzICBQcml2YXRlXG5yb3V0ZXIuZ2V0KCcvdm5wYXkvc3RhdHVzLzpvcmRlcklkJywgYXV0aCwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBvcmRlcklkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBPcmRlci5maW5kT25lKHtcbiAgICAgIG9yZGVyTnVtYmVyOiBvcmRlcklkLFxuICAgICAgY3VzdG9tZXI6IHJlcS51c2VyLmlkXG4gICAgfSk7XG5cbiAgICBpZiAoIW9yZGVyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG9yZGVySWQ6IG9yZGVyLm9yZGVyTnVtYmVyLFxuICAgICAgICBwYXltZW50U3RhdHVzOiBvcmRlci5wYXltZW50U3RhdHVzLFxuICAgICAgICBwYXltZW50TWV0aG9kOiBvcmRlci5wYXltZW50TWV0aG9kLFxuICAgICAgICBwYXltZW50RGV0YWlsczogb3JkZXIucGF5bWVudERldGFpbHMsXG4gICAgICAgIHRvdGFsQW1vdW50OiBvcmRlci50b3RhbFxuICAgICAgfVxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignR2V0IFZOUGF5IHN0YXR1cyBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3BheW1lbnRzL2NhcmQvcHJvY2Vzc1xuLy8gQGRlc2MgICAgUHJvY2VzcyBjYXJkIHBheW1lbnRcbi8vIEBhY2Nlc3MgIFByaXZhdGVcbnJvdXRlci5wb3N0KCcvY2FyZC9wcm9jZXNzJywgYXV0aCwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBvcmRlcklkLCBhbW91bnQsIGNhcmREYXRhIH0gPSByZXEuYm9keTtcblxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgIGlmICghb3JkZXJJZCB8fCAhYW1vdW50KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIElEIGFuZCBhbW91bnQgYXJlIHJlcXVpcmVkJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRmluZCB0aGUgb3JkZXIgdG8gdmVyaWZ5IGl0IGJlbG9uZ3MgdG8gdGhlIHVzZXJcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoe1xuICAgICAgb3JkZXJOdW1iZXI6IG9yZGVySWQsXG4gICAgICBjdXN0b21lcjogcmVxLnVzZXIuaWRcbiAgICB9KTtcblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgb3JkZXIgaXMgYWxyZWFkeSBwYWlkXG4gICAgaWYgKG9yZGVyLnBheW1lbnRTdGF0dXMgPT09ICdwYWlkJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBpcyBhbHJlYWR5IHBhaWQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHlvdSB3b3VsZDpcbiAgICAvLyAxLiBWYWxpZGF0ZSBjYXJkIGRldGFpbHMgd2l0aCBhIHBheW1lbnQgcHJvY2Vzc29yIChTdHJpcGUsIFNxdWFyZSwgZXRjLilcbiAgICAvLyAyLiBQcm9jZXNzIHRoZSBhY3R1YWwgcGF5bWVudFxuICAgIC8vIDMuIEhhbmRsZSBwYXltZW50IHN1Y2Nlc3MvZmFpbHVyZVxuICAgIFxuICAgIC8vIEZvciBkZW1vIHB1cnBvc2VzLCB3ZSdsbCBzaW11bGF0ZSBhIHN1Y2Nlc3NmdWwgcGF5bWVudFxuICAgIC8vIEluIHByb2R1Y3Rpb24sIE5FVkVSIHN0b3JlIGZ1bGwgY2FyZCBkZXRhaWxzIGluIHlvdXIgZGF0YWJhc2VcbiAgICBcbiAgICAvLyBTaW11bGF0ZSBwYXltZW50IHByb2Nlc3NpbmcgZGVsYXlcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCkpO1xuICAgIFxuICAgIC8vIFVwZGF0ZSBvcmRlciB3aXRoIHBheW1lbnQgZGV0YWlsc1xuICAgIG9yZGVyLnBheW1lbnRTdGF0dXMgPSAncGFpZCc7XG4gICAgb3JkZXIuc3RhdHVzID0gJ2NvbmZpcm1lZCc7XG4gICAgb3JkZXIucGF5bWVudERldGFpbHMgPSB7XG4gICAgICBtZXRob2Q6ICdjYXJkJyxcbiAgICAgIGxhc3RGb3VyOiBjYXJkRGF0YS5sYXN0Rm91cixcbiAgICAgIGNhcmRob2xkZXJOYW1lOiBjYXJkRGF0YS5jYXJkaG9sZGVyTmFtZSxcbiAgICAgIHBhaWRBdDogbW9tZW50LnR6KCdBc2lhL0hvX0NoaV9NaW5oJykudG9EYXRlKCksXG4gICAgICB0cmFuc2FjdGlvbklkOiBgY2FyZF8ke21vbWVudC50eignQXNpYS9Ib19DaGlfTWluaCcpLnZhbHVlT2YoKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YFxuICAgIH07XG4gICAgXG4gICAgYXdhaXQgb3JkZXIuc2F2ZSgpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdDYXJkIHBheW1lbnQgcHJvY2Vzc2VkIHN1Y2Nlc3NmdWxseScsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG9yZGVySWQ6IG9yZGVyLm9yZGVyTnVtYmVyLFxuICAgICAgICB0cmFuc2FjdGlvbklkOiBvcmRlci5wYXltZW50RGV0YWlscy50cmFuc2FjdGlvbklkLFxuICAgICAgICBhbW91bnQ6IGFtb3VudFxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0NhcmQgcGF5bWVudCBwcm9jZXNzaW5nIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgcHJvY2Vzc2luZyBjYXJkIHBheW1lbnQnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvcGF5bWVudHMvY2FzaC9jb25maXJtXG4vLyBAZGVzYyAgICBDb25maXJtIGNhc2ggcGF5bWVudCBvcmRlclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxucm91dGVyLnBvc3QoJy9jYXNoL2NvbmZpcm0nLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IG9yZGVySWQsIGFtb3VudCB9ID0gcmVxLmJvZHk7XG5cbiAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHNcbiAgICBpZiAoIW9yZGVySWQgfHwgIWFtb3VudCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBJRCBhbmQgYW1vdW50IGFyZSByZXF1aXJlZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEZpbmQgdGhlIG9yZGVyIHRvIHZlcmlmeSBpdCBiZWxvbmdzIHRvIHRoZSB1c2VyXG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBPcmRlci5maW5kT25lKHtcbiAgICAgIG9yZGVyTnVtYmVyOiBvcmRlcklkLFxuICAgICAgY3VzdG9tZXI6IHJlcS51c2VyLmlkXG4gICAgfSk7XG5cbiAgICBpZiAoIW9yZGVyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIG9yZGVyIGlzIGFscmVhZHkgY29uZmlybWVkXG4gICAgaWYgKG9yZGVyLnN0YXR1cyA9PT0gJ2NvbmZpcm1lZCcgfHwgb3JkZXIucGF5bWVudFN0YXR1cyA9PT0gJ3BhaWQnKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIGlzIGFscmVhZHkgY29uZmlybWVkJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIG9yZGVyIHN0YXR1cyBmb3IgY2FzaCBwYXltZW50XG4gICAgLy8gQ2FzaCBvcmRlcnMgYXJlIGNvbmZpcm1lZCBidXQgcGF5bWVudCBzdGF0dXMgcmVtYWlucyBwZW5kaW5nIHVudGlsIGFjdHVhbCBwYXltZW50XG4gICAgb3JkZXIuc3RhdHVzID0gJ2NvbmZpcm1lZCc7XG4gICAgb3JkZXIucGF5bWVudERldGFpbHMgPSB7XG4gICAgICBtZXRob2Q6ICdjYXNoJyxcbiAgICAgIGNvbmZpcm1lZEF0OiBtb21lbnQudHooJ0FzaWEvSG9fQ2hpX01pbmgnKS50b0RhdGUoKSxcbiAgICAgIG9yZGVyVHlwZTogb3JkZXIub3JkZXJUeXBlIC8vIGRlbGl2ZXJ5IG9yIHBpY2t1cFxuICAgIH07XG4gICAgXG4gICAgYXdhaXQgb3JkZXIuc2F2ZSgpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdDYXNoIHBheW1lbnQgb3JkZXIgY29uZmlybWVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG9yZGVySWQ6IG9yZGVyLm9yZGVyTnVtYmVyLFxuICAgICAgICBzdGF0dXM6IG9yZGVyLnN0YXR1cyxcbiAgICAgICAgcGF5bWVudE1ldGhvZDogJ2Nhc2gnLFxuICAgICAgICBvcmRlclR5cGU6IG9yZGVyLm9yZGVyVHlwZVxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Nhc2ggcGF5bWVudCBjb25maXJtYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBjb25maXJtaW5nIGNhc2ggcGF5bWVudCdcbiAgICB9KTtcbiAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gcm91dGVyOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNQyxLQUFLLEdBQUdILE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztBQUN4QyxNQUFNSSxXQUFXLEdBQUdKLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQztBQUN0RCxNQUFNSyxXQUFXLEdBQUdMLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztBQUM5QyxNQUFNO0VBQUVNLE9BQU8sRUFBRUM7QUFB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","map":{"version":3,"names":["express","require","router","Router","Order","momoService","vnpayConfig","protect","auth","moment","post","req","res","orderId","amount","orderInfo","body","status","json","success","message","order","findOne","orderNumber","customer","user","id","paymentStatus","paymentResult","createPayment","Math","round","extraData","JSON","stringify","userId","error","momoTransaction","requestId","payUrl","data","deeplink","qrCodeUrl","resultCode","save","console","log","partnerCode","orderType","transId","payType","responseTime","signature","isValidSignature","verifyCallback","parseInt","get","params","orderStatus","total","query","redirect","process","env","FRONTEND_URL","encodeURIComponent","bankCode","ipAddr","headers","connection","remoteAddress","socket","paymentUrl","createPaymentUrl","findByIdAndUpdate","_id","paymentMethod","vnpayError","NODE_ENV","undefined","vnp_Params","vnp_TxnRef","responseCode","vnp_ResponseCode","transactionNo","vnp_TransactionNo","vnp_Amount","verifyReturnUrl","getPaymentStatus","paymentDetails","method","transactionId","paidAt","tz","toDate","failedAt","failureReason","redirectUrl","RspCode","Message","abs","Date","totalAmount","cardData","Promise","resolve","setTimeout","lastFour","cardholderName","valueOf","random","toString","substr","confirmedAt","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["payments.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst Order = require('../models/Order');\nconst momoService = require('../services/momoService');\nconst vnpayConfig = require('../config/vnpay');\nconst { protect: auth } = require('../middleware/auth');\nconst moment = require('moment-timezone');\n\n// @route   POST /api/payments/momo/create\n// @desc    Create MoMo payment request\n// @access  Private\nrouter.post('/momo/create', auth, async (req, res) => {\n  try {\n    const { orderId, amount, orderInfo } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Validate amount\n    if (amount <= 0 || amount > 50000000) { // MoMo limit is 50M VND\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid payment amount'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // Create MoMo payment request\n    const paymentResult = await momoService.createPayment({\n      orderId,\n      amount: Math.round(amount), // Ensure amount is integer\n      orderInfo: orderInfo || `Payment for DREAM COFFEE order ${orderId}`,\n      extraData: JSON.stringify({\n        userId: req.user.id,\n        orderNumber: orderId\n      })\n    });\n\n    if (!paymentResult.success) {\n      return res.status(500).json({\n        success: false,\n        message: 'Failed to create MoMo payment',\n        error: paymentResult.error\n      });\n    }\n\n    // Update order with MoMo transaction details\n    order.momoTransaction = {\n      requestId: paymentResult.requestId,\n      payUrl: paymentResult.data.payUrl,\n      deeplink: paymentResult.data.deeplink,\n      qrCodeUrl: paymentResult.data.qrCodeUrl,\n      resultCode: paymentResult.data.resultCode,\n      message: paymentResult.data.message\n    };\n    \n    await order.save();\n\n    res.json({\n      success: true,\n      data: {\n        payUrl: paymentResult.data.payUrl,\n        deeplink: paymentResult.data.deeplink,\n        qrCodeUrl: paymentResult.data.qrCodeUrl,\n        requestId: paymentResult.requestId,\n        orderId: orderId,\n        amount: amount\n      },\n      message: 'MoMo payment created successfully'\n    });\n  } catch (error) {\n    console.error('MoMo payment creation error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating MoMo payment'\n    });\n  }\n});\n\n// @route   POST /api/payments/momo/callback\n// @desc    Handle MoMo payment callback (IPN)\n// @access  Public\nrouter.post('/momo/callback', async (req, res) => {\n  try {\n    console.log('MoMo callback received:', req.body);\n\n    const {\n      partnerCode,\n      orderId,\n      requestId,\n      amount,\n      orderInfo,\n      orderType,\n      transId,\n      resultCode,\n      message,\n      payType,\n      responseTime,\n      extraData,\n      signature\n    } = req.body;\n\n    // Verify callback signature\n    const isValidSignature = momoService.verifyCallback(req.body);\n    \n    if (!isValidSignature) {\n      console.error('Invalid MoMo callback signature');\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid signature'\n      });\n    }\n\n    // Find the order\n    const order = await Order.findOne({ orderNumber: orderId });\n    \n    if (!order) {\n      console.error(`Order not found for MoMo callback: ${orderId}`);\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Update order with transaction details\n    order.momoTransaction = {\n      ...order.momoTransaction,\n      transId,\n      resultCode: parseInt(resultCode),\n      message,\n      responseTime,\n      payType\n    };\n\n    // Update payment status based on result code\n    if (resultCode === '0') {\n      // Payment successful\n      order.paymentStatus = 'paid';\n      order.status = 'confirmed';\n      console.log(`MoMo payment successful for order: ${orderId}`);\n    } else {\n      // Payment failed\n      order.paymentStatus = 'failed';\n      console.log(`MoMo payment failed for order: ${orderId}, code: ${resultCode}`);\n    }\n\n    await order.save();\n\n    // Respond to MoMo\n    res.json({\n      success: true,\n      message: 'Callback processed successfully'\n    });\n  } catch (error) {\n    console.error('MoMo callback processing error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while processing callback'\n    });\n  }\n});\n\n// @route   GET /api/payments/momo/status/:orderId\n// @desc    Check MoMo payment status\n// @access  Private\nrouter.get('/momo/status/:orderId', auth, async (req, res) => {\n  try {\n    const { orderId } = req.params;\n\n    // Find the order\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Return payment status\n    res.json({\n      success: true,\n      data: {\n        orderId: order.orderNumber,\n        paymentStatus: order.paymentStatus,\n        orderStatus: order.status,\n        momoTransaction: order.momoTransaction,\n        amount: order.total\n      }\n    });\n  } catch (error) {\n    console.error('Payment status check error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while checking payment status'\n    });\n  }\n});\n\n// @route   POST /api/payments/momo/return\n// @desc    Handle MoMo payment return URL\n// @access  Public\nrouter.get('/momo/return', async (req, res) => {\n  try {\n    const {\n      partnerCode,\n      orderId,\n      requestId,\n      amount,\n      orderInfo,\n      orderType,\n      transId,\n      resultCode,\n      message,\n      payType,\n      responseTime,\n      extraData,\n      signature\n    } = req.query;\n\n    console.log('MoMo return URL accessed:', req.query);\n\n    // Verify signature\n    const isValidSignature = momoService.verifyCallback(req.query);\n    \n    if (!isValidSignature) {\n      return res.redirect(`${process.env.FRONTEND_URL}/payment/error?message=Invalid signature`);\n    }\n\n    // Redirect based on payment result\n    if (resultCode === '0') {\n      // Payment successful\n      res.redirect(`${process.env.FRONTEND_URL}/payment/success?orderId=${orderId}&transId=${transId}`);\n    } else {\n      // Payment failed\n      res.redirect(`${process.env.FRONTEND_URL}/payment/error?orderId=${orderId}&message=${encodeURIComponent(message)}`);\n    }\n  } catch (error) {\n    console.error('MoMo return URL error:', error);\n    res.redirect(`${process.env.FRONTEND_URL}/payment/error?message=Processing error`);\n  }\n});\n\n// @route   POST /api/payments/vnpay/create\n// @desc    Create VNPay payment request\n// @access  Private\nrouter.post('/vnpay/create', auth, async (req, res) => {\n  try {\n    const { orderId, amount, orderInfo, bankCode } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Validate amount\n    if (amount <= 0 || amount > 500000000) { // VNPay limit is 500M VND\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid payment amount'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // Get client IP address\n    const ipAddr = req.headers['x-forwarded-for'] ||\n                   req.connection.remoteAddress ||\n                   req.socket.remoteAddress ||\n                   (req.connection.socket ? req.connection.socket.remoteAddress : null) ||\n                   '127.0.0.1';\n\n    // Debug: Log the parameters being sent to VNPay\n    console.log('VNPay Payment Parameters:', {\n      orderId,\n      amount,\n      orderInfo: orderInfo || `Thanh toan don hang ${orderId}`,\n      ipAddr,\n      bankCode\n    });\n\n    // Create payment URL\n    try {\n      const paymentUrl = vnpayConfig.createPaymentUrl(\n        orderId,\n        amount,\n        orderInfo || `Thanh toan don hang ${orderId}`,\n        ipAddr,\n        bankCode\n      );\n\n      console.log('Generated VNPay URL:', paymentUrl);\n\n      // Update order with payment method\n      await Order.findByIdAndUpdate(order._id, {\n        paymentMethod: 'vnpay',\n        paymentStatus: 'pending'\n      });\n\n      res.json({\n        success: true,\n        message: 'VNPay payment URL created successfully',\n        data: {\n          paymentUrl,\n          orderId,\n          amount\n        }\n      });\n    } catch (vnpayError) {\n      console.error('VNPay URL creation error:', vnpayError.message);\n      return res.status(400).json({\n        success: false,\n        message: 'Failed to create payment URL: ' + vnpayError.message\n      });\n    }\n\n  } catch (error) {\n    console.error('VNPay create payment error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Internal server error',\n      error: process.env.NODE_ENV === 'development' ? error.message : undefined\n    });\n  }\n});\n\n// @route   GET /api/payments/vnpay/return\n// @desc    Handle VNPay return URL\n// @access  Public\nrouter.get('/vnpay/return', async (req, res) => {\n  try {\n    const vnp_Params = req.query;\n    const orderId = vnp_Params.vnp_TxnRef;\n    const responseCode = vnp_Params.vnp_ResponseCode;\n    const transactionNo = vnp_Params.vnp_TransactionNo;\n    const amount = vnp_Params.vnp_Amount / 100; // Convert from VND cents\n\n    // Verify the return URL\n    const isValidSignature = vnpayConfig.verifyReturnUrl(vnp_Params);\n\n    if (!isValidSignature) {\n      return res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Invalid signature`);\n    }\n\n    // Find the order\n    const order = await Order.findOne({ orderNumber: orderId });\n    if (!order) {\n      return res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Order not found`);\n    }\n\n    let paymentStatus = 'failed';\n    let message = vnpayConfig.getPaymentStatus(responseCode);\n\n    if (responseCode === '00') {\n      paymentStatus = 'paid';\n      // Update order status\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'paid',\n        status: 'confirmed',\n        paymentDetails: {\n          method: 'vnpay',\n          transactionId: transactionNo,\n          amount: amount,\n          responseCode: responseCode,\n          paidAt: moment.tz('Asia/Ho_Chi_Minh').toDate()\n        }\n      });\n    } else {\n      // Update order with failed payment\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'failed',\n        paymentDetails: {\n          method: 'vnpay',\n          responseCode: responseCode,\n          failedAt: moment.tz('Asia/Ho_Chi_Minh').toDate(),\n          failureReason: message\n        }\n      });\n    }\n\n    // Redirect to frontend with result\n    const redirectUrl = `${process.env.FRONTEND_URL}/checkout/result?status=${paymentStatus}&orderId=${orderId}&message=${encodeURIComponent(message)}`;\n    res.redirect(redirectUrl);\n\n  } catch (error) {\n    console.error('VNPay return URL error:', error);\n    res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Payment processing error`);\n  }\n});\n\n// @route   POST /api/payments/vnpay/ipn\n// @desc    Handle VNPay IPN (Instant Payment Notification)\n// @access  Public\nrouter.post('/vnpay/ipn', async (req, res) => {\n  try {\n    const vnp_Params = req.query;\n    const orderId = vnp_Params.vnp_TxnRef;\n    const responseCode = vnp_Params.vnp_ResponseCode;\n    const transactionNo = vnp_Params.vnp_TransactionNo;\n    const amount = vnp_Params.vnp_Amount / 100;\n\n    // Verify the IPN\n    const isValidSignature = vnpayConfig.verifyReturnUrl(vnp_Params);\n\n    if (!isValidSignature) {\n      return res.status(400).json({ RspCode: '97', Message: 'Invalid signature' });\n    }\n\n    // Find the order\n    const order = await Order.findOne({ orderNumber: orderId });\n    if (!order) {\n      return res.status(400).json({ RspCode: '01', Message: 'Order not found' });\n    }\n\n    // Check if order amount matches\n    if (Math.abs(order.total - amount) > 1) { // Allow 1 VND difference for rounding\n      return res.status(400).json({ RspCode: '04', Message: 'Invalid amount' });\n    }\n\n    if (responseCode === '00') {\n      // Payment successful\n      if (order.paymentStatus !== 'paid') {\n        await Order.findByIdAndUpdate(order._id, {\n          paymentStatus: 'paid',\n          status: 'confirmed',\n          paymentDetails: {\n            method: 'vnpay',\n            transactionId: transactionNo,\n            amount: amount,\n            responseCode: responseCode,\n            paidAt: new Date()\n          }\n        });\n      }\n      return res.status(200).json({ RspCode: '00', Message: 'Success' });\n    } else {\n      // Payment failed\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'failed',\n        paymentDetails: {\n          method: 'vnpay',\n          responseCode: responseCode,\n          failedAt: new Date(),\n          failureReason: vnpayConfig.getPaymentStatus(responseCode)\n        }\n      });\n      return res.status(200).json({ RspCode: '00', Message: 'Success' });\n    }\n\n  } catch (error) {\n    console.error('VNPay IPN error:', error);\n    res.status(500).json({ RspCode: '99', Message: 'Internal server error' });\n  }\n});\n\n// @route   GET /api/payments/vnpay/status/:orderId\n// @desc    Get VNPay payment status\n// @access  Private\nrouter.get('/vnpay/status/:orderId', auth, async (req, res) => {\n  try {\n    const { orderId } = req.params;\n\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    res.json({\n      success: true,\n      data: {\n        orderId: order.orderNumber,\n        paymentStatus: order.paymentStatus,\n        paymentMethod: order.paymentMethod,\n        paymentDetails: order.paymentDetails,\n        totalAmount: order.total\n      }\n    });\n\n  } catch (error) {\n    console.error('Get VNPay status error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Internal server error'\n    });\n  }\n});\n\n// @route   POST /api/payments/card/process\n// @desc    Process card payment\n// @access  Private\nrouter.post('/card/process', auth, async (req, res) => {\n  try {\n    const { orderId, amount, cardData } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // In a real implementation, you would:\n    // 1. Validate card details with a payment processor (Stripe, Square, etc.)\n    // 2. Process the actual payment\n    // 3. Handle payment success/failure\n    \n    // For demo purposes, we'll simulate a successful payment\n    // In production, NEVER store full card details in your database\n    \n    // Simulate payment processing delay\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    \n    // Update order with payment details\n    order.paymentStatus = 'paid';\n    order.status = 'confirmed';\n    order.paymentDetails = {\n      method: 'card',\n      lastFour: cardData.lastFour,\n      cardholderName: cardData.cardholderName,\n      paidAt: moment.tz('Asia/Ho_Chi_Minh').toDate(),\n      transactionId: `card_${moment.tz('Asia/Ho_Chi_Minh').valueOf()}_${Math.random().toString(36).substr(2, 9)}`\n    };\n    \n    await order.save();\n\n    res.json({\n      success: true,\n      message: 'Card payment processed successfully',\n      data: {\n        orderId: order.orderNumber,\n        transactionId: order.paymentDetails.transactionId,\n        amount: amount\n      }\n    });\n  } catch (error) {\n    console.error('Card payment processing error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while processing card payment'\n    });\n  }\n});\n\n// @route   POST /api/payments/cash/confirm\n// @desc    Confirm cash payment order\n// @access  Private\nrouter.post('/cash/confirm', auth, async (req, res) => {\n  try {\n    const { orderId, amount } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already confirmed\n    if (order.status === 'confirmed' || order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already confirmed'\n      });\n    }\n\n    // Update order status for cash payment\n    // Cash orders are confirmed but payment status remains pending until actual payment\n    order.status = 'confirmed';\n    order.paymentDetails = {\n      method: 'cash',\n      confirmedAt: moment.tz('Asia/Ho_Chi_Minh').toDate(),\n      orderType: order.orderType // delivery or pickup\n    };\n    \n    await order.save();\n\n    res.json({\n      success: true,\n      message: 'Cash payment order confirmed successfully',\n      data: {\n        orderId: order.orderNumber,\n        status: order.status,\n        paymentMethod: 'cash',\n        orderType: order.orderType\n      }\n    });\n  } catch (error) {\n    console.error('Cash payment confirmation error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while confirming cash payment'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1757590245641},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\services\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\services\\\\momoService.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const crypto = require('crypto');\nconst https = require('https');\nconst moment = require('moment-timezone');\nclass MoMoService {\n  constructor() {\n    // MoMo API configuration - these should be moved to environment variables in production\n    this.config = {\n      accessKey: process.env.MOMO_ACCESS_KEY || 'F8BBA842ECF85',\n      secretKey: process.env.MOMO_SECRET_KEY || 'K951B6PE1waDMi640xX08PD3vg6EkVlz',\n      partnerCode: process.env.MOMO_PARTNER_CODE || 'MOMO',\n      redirectUrl: process.env.MOMO_REDIRECT_URL || 'http://localhost:5173/momo/return',\n      ipnUrl: process.env.MOMO_IPN_URL || 'http://localhost:5003/api/payments/momo/callback',\n      requestType: 'payWithMethod',\n      autoCapture: true,\n      lang: 'vi',\n      endpoint: process.env.MOMO_ENDPOINT || 'https://test-payment.momo.vn/v2/gateway/api/create'\n    };\n  }\n\n  /**\n   * Generate HMAC SHA256 signature for MoMo API\n   * @param {string} rawSignature - Raw signature string\n   * @returns {string} - Generated signature\n   */\n  generateSignature(rawSignature) {\n    return crypto.createHmac('sha256', this.config.secretKey).update(rawSignature).digest('hex');\n  }\n\n  /**\n   * Create MoMo payment request\n   * @param {Object} paymentData - Payment information\n   * @param {string} paymentData.orderId - Order ID\n   * @param {number} paymentData.amount - Payment amount\n   * @param {string} paymentData.orderInfo - Order description\n   * @param {string} paymentData.extraData - Additional data (optional)\n   * @returns {Promise<Object>} - MoMo payment response\n   */\n  async createPayment(paymentData) {\n    try {\n      const {\n        orderId,\n        amount,\n        orderInfo = 'Payment for DREAM COFFEE order',\n        extraData = ''\n      } = paymentData;\n\n      // Generate unique request ID using Vietnam timezone\n      const nowVN = moment.tz('Asia/Ho_Chi_Minh');\n      const timestamp = nowVN.valueOf(); // Get timestamp in milliseconds\n      const requestId = `${this.config.partnerCode}${timestamp}`;\n\n      // Create raw signature string\n      const rawSignature = [`accessKey=${this.config.accessKey}`, `amount=${amount}`, `extraData=${extraData}`, `ipnUrl=${this.config.ipnUrl}`, `orderId=${orderId}`, `orderInfo=${orderInfo}`, `partnerCode=${this.config.partnerCode}`, `redirectUrl=${this.config.redirectUrl}`, `requestId=${requestId}`, `requestType=${this.config.requestType}`].join('&');\n\n      // Generate signature\n      const signature = this.generateSignature(rawSignature);\n\n      // Prepare request body\n      const requestBody = {\n        partnerCode: this.config.partnerCode,\n        partnerName: 'DREAM COFFEE',\n        storeId: 'DreamCoffeeStore',\n        requestId,\n        amount: amount.toString(),\n        orderId,\n        orderInfo,\n        redirectUrl: this.config.redirectUrl,\n        ipnUrl: this.config.ipnUrl,\n        lang: this.config.lang,\n        requestType: this.config.requestType,\n        autoCapture: this.config.autoCapture,\n        extraData,\n        signature\n      };\n      console.log('MoMo Payment Request:', {\n        orderId,\n        amount,\n        requestId,\n        rawSignature\n      });\n\n      // Make request to MoMo API\n      const response = await this.makeHttpsRequest(requestBody);\n      return {\n        success: true,\n        data: response,\n        requestId,\n        orderId\n      };\n    } catch (error) {\n      console.error('MoMo payment creation failed:', error);\n      return {\n        success: false,\n        error: error.message,\n        code: error.code || 'MOMO_ERROR'\n      };\n    }\n  }\n\n  /**\n   * Make HTTPS request to MoMo API\n   * @param {Object} requestBody - Request payload\n   * @returns {Promise<Object>} - API response\n   */\n  makeHttpsRequest(requestBody) {\n    return new Promise((resolve, reject) => {\n      const postData = JSON.stringify(requestBody);\n      const options = {\n        hostname: 'test-payment.momo.vn',\n        port: 443,\n        path: '/v2/gateway/api/create',\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Content-Length': Buffer.byteLength(postData)\n        }\n      };\n      const req = https.request(options, res => {\n        let data = '';\n        res.on('data', chunk => {\n          data += chunk;\n        });\n        res.on('end', () => {\n          try {\n            const response = JSON.parse(data);\n            console.log('MoMo API Response:', {\n              status: res.statusCode,\n              resultCode: response.resultCode,\n              message: response.message\n            });\n            if (res.statusCode === 200) {\n              resolve(response);\n            } else {\n              reject(new Error(`HTTP ${res.statusCode}: ${response.message || 'Unknown error'}`));\n            }\n          } catch (parseError) {\n            reject(new Error(`Failed to parse MoMo response: ${parseError.message}`));\n          }\n        });\n      });\n      req.on('error', error => {\n        console.error('MoMo HTTPS request error:', error);\n        reject(new Error(`Network error: ${error.message}`));\n      });\n      req.on('timeout', () => {\n        req.destroy();\n        reject(new Error('Request timeout'));\n      });\n\n      // Set timeout\n      req.setTimeout(30000); // 30 seconds\n\n      // Send request\n      req.write(postData);\n      req.end();\n    });\n  }\n\n  /**\n   * Verify MoMo callback signature\n   * @param {Object} callbackData - Callback data from MoMo\n   * @returns {boolean} - Signature verification result\n   */\n  verifyCallback(callbackData) {\n    try {\n      const {\n        partnerCode,\n        orderId,\n        requestId,\n        amount,\n        orderInfo,\n        orderType,\n        transId,\n        resultCode,\n        message,\n        payType,\n        responseTime,\n        extraData,\n        signature\n      } = callbackData;\n\n      // Create raw signature for verification\n      const rawSignature = [`accessKey=${this.config.accessKey}`, `amount=${amount}`, `extraData=${extraData}`, `message=${message}`, `orderId=${orderId}`, `orderInfo=${orderInfo}`, `orderType=${orderType}`, `partnerCode=${partnerCode}`, `payType=${payType}`, `requestId=${requestId}`, `responseTime=${responseTime}`, `resultCode=${resultCode}`, `transId=${transId}`].join('&');\n      const expectedSignature = this.generateSignature(rawSignature);\n      return signature === expectedSignature;\n    } catch (error) {\n      console.error('MoMo callback verification failed:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Check payment status\n   * @param {string} orderId - Order ID\n   * @param {string} requestId - Request ID\n   * @returns {Promise<Object>} - Payment status\n   */\n  async checkPaymentStatus(orderId, requestId) {\n    try {\n      // This would typically call MoMo's query API\n      // For now, we'll return a placeholder response\n      return {\n        success: true,\n        resultCode: 0,\n        message: 'Payment status check not implemented yet'\n      };\n    } catch (error) {\n      console.error('Payment status check failed:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n}\nmodule.exports = new MoMoService();\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcnlwdG8iLCJyZXF1aXJlIiwiaHR0cHMiLCJtb21lbnQiLCJNb01vU2VydmljZSIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiYWNjZXNzS2V5IiwicHJvY2VzcyIsImVudiIsIk1PTU9fQUNDRVNTX0tFWSIsInNlY3JldEtleSIsIk1PTU9fU0VDUkVUX0tFWSIsInBhcnRuZXJDb2RlIiwiTU9NT19QQVJUTkVSX0NPREUiLCJyZWRpcmVjdFVybCIsIk1PTU9fUkVESVJFQ1RfVVJMIiwiaXBuVXJsIiwiTU9NT19JUE5fVVJMIiwicmVxdWVzdFR5cGUiLCJhdXRvQ2FwdHVyZSIsImxhbmciLCJlbmRwb2ludCIsIk1PTU9fRU5EUE9JTlQiLCJnZW5lcmF0ZVNpZ25hdHVyZSIsInJhd1NpZ25hdHVyZSIsImNyZWF0ZUhtYWMiLCJ1cGRhdGUiLCJkaWdlc3QiLCJjcmVhdGVQYXltZW50IiwicGF5bWVudERhdGEiLCJvcmRlcklkIiwiYW1vdW50Iiwib3JkZXJJbmZvIiwiZXh0cmFEYXRhIiwibm93Vk4iLCJ0eiIsInRpbWVzdGFtcCIsInZhbHVlT2YiLCJyZXF1ZXN0SWQiLCJqb2luIiwic2lnbmF0dXJlIiwicmVxdWVzdEJvZHkiLCJwYXJ0bmVyTmFtZSIsInN0b3JlSWQiLCJ0b1N0cmluZyIsImNvbnNvbGUiLCJsb2ciLCJyZXNwb25zZSIsIm1ha2VIdHRwc1JlcXVlc3QiLCJzdWNjZXNzIiwiZGF0YSIsImVycm9yIiwibWVzc2FnZSIsImNvZGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInBvc3REYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsIm9wdGlvbnMiLCJob3N0bmFtZSIsInBvcnQiLCJwYXRoIiwibWV0aG9kIiwiaGVhZGVycyIsIkJ1ZmZlciIsImJ5dGVMZW5ndGgiLCJyZXEiLCJyZXF1ZXN0IiwicmVzIiwib24iLCJjaHVuayIsInBhcnNlIiwic3RhdHVzIiwic3RhdHVzQ29kZSIsInJlc3VsdENvZGUiLCJFcnJvciIsInBhcnNlRXJyb3IiLCJkZXN0cm95Iiwic2V0VGltZW91dCIsIndyaXRlIiwiZW5kIiwidmVyaWZ5Q2FsbGJhY2siLCJjYWxsYmFja0RhdGEiLCJvcmRlclR5cGUiLCJ0cmFuc0lkIiwicGF5VHlwZSIsInJlc3BvbnNlVGltZSIsImV4cGVjdGVkU2lnbmF0dXJlIiwiY2hlY2tQYXltZW50U3RhdHVzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXHNlcnZpY2VzXFwiLCJzb3VyY2VzIjpbIm1vbW9TZXJ2aWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNyeXB0byA9IHJlcXVpcmUoJ2NyeXB0bycpO1xuY29uc3QgaHR0cHMgPSByZXF1aXJlKCdodHRwcycpO1xuY29uc3QgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50LXRpbWV6b25lJyk7XG5cbmNsYXNzIE1vTW9TZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLy8gTW9NbyBBUEkgY29uZmlndXJhdGlvbiAtIHRoZXNlIHNob3VsZCBiZSBtb3ZlZCB0byBlbnZpcm9ubWVudCB2YXJpYWJsZXMgaW4gcHJvZHVjdGlvblxuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgYWNjZXNzS2V5OiBwcm9jZXNzLmVudi5NT01PX0FDQ0VTU19LRVkgfHwgJ0Y4QkJBODQyRUNGODUnLFxuICAgICAgc2VjcmV0S2V5OiBwcm9jZXNzLmVudi5NT01PX1NFQ1JFVF9LRVkgfHwgJ0s5NTFCNlBFMXdhRE1pNjQweFgwOFBEM3ZnNkVrVmx6JyxcbiAgICAgIHBhcnRuZXJDb2RlOiBwcm9jZXNzLmVudi5NT01PX1BBUlRORVJfQ09ERSB8fCAnTU9NTycsXG4gICAgICByZWRpcmVjdFVybDogcHJvY2Vzcy5lbnYuTU9NT19SRURJUkVDVF9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6NTE3My9tb21vL3JldHVybicsXG4gICAgICBpcG5Vcmw6IHByb2Nlc3MuZW52Lk1PTU9fSVBOX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDo1MDAzL2FwaS9wYXltZW50cy9tb21vL2NhbGxiYWNrJyxcbiAgICAgIHJlcXVlc3RUeXBlOiAncGF5V2l0aE1ldGhvZCcsXG4gICAgICBhdXRvQ2FwdHVyZTogdHJ1ZSxcbiAgICAgIGxhbmc6ICd2aScsXG4gICAgICBlbmRwb2ludDogcHJvY2Vzcy5lbnYuTU9NT19FTkRQT0lOVCB8fCAnaHR0cHM6Ly90ZXN0LXBheW1lbnQubW9tby52bi92Mi9nYXRld2F5L2FwaS9jcmVhdGUnXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBITUFDIFNIQTI1NiBzaWduYXR1cmUgZm9yIE1vTW8gQVBJXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByYXdTaWduYXR1cmUgLSBSYXcgc2lnbmF0dXJlIHN0cmluZ1xuICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIEdlbmVyYXRlZCBzaWduYXR1cmVcbiAgICovXG4gIGdlbmVyYXRlU2lnbmF0dXJlKHJhd1NpZ25hdHVyZSkge1xuICAgIHJldHVybiBjcnlwdG9cbiAgICAgIC5jcmVhdGVIbWFjKCdzaGEyNTYnLCB0aGlzLmNvbmZpZy5zZWNyZXRLZXkpXG4gICAgICAudXBkYXRlKHJhd1NpZ25hdHVyZSlcbiAgICAgIC5kaWdlc3QoJ2hleCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBNb01vIHBheW1lbnQgcmVxdWVzdFxuICAgKiBAcGFyYW0ge09iamVjdH0gcGF5bWVudERhdGEgLSBQYXltZW50IGluZm9ybWF0aW9uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXltZW50RGF0YS5vcmRlcklkIC0gT3JkZXIgSURcbiAgICogQHBhcmFtIHtudW1iZXJ9IHBheW1lbnREYXRhLmFtb3VudCAtIFBheW1lbnQgYW1vdW50XG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXltZW50RGF0YS5vcmRlckluZm8gLSBPcmRlciBkZXNjcmlwdGlvblxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF5bWVudERhdGEuZXh0cmFEYXRhIC0gQWRkaXRpb25hbCBkYXRhIChvcHRpb25hbClcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gLSBNb01vIHBheW1lbnQgcmVzcG9uc2VcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVBheW1lbnQocGF5bWVudERhdGEpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBvcmRlcklkLFxuICAgICAgICBhbW91bnQsXG4gICAgICAgIG9yZGVySW5mbyA9ICdQYXltZW50IGZvciBEUkVBTSBDT0ZGRUUgb3JkZXInLFxuICAgICAgICBleHRyYURhdGEgPSAnJ1xuICAgICAgfSA9IHBheW1lbnREYXRhO1xuXG4gICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgcmVxdWVzdCBJRCB1c2luZyBWaWV0bmFtIHRpbWV6b25lXG4gICAgICBjb25zdCBub3dWTiA9IG1vbWVudC50eignQXNpYS9Ib19DaGlfTWluaCcpO1xuICAgICAgY29uc3QgdGltZXN0YW1wID0gbm93Vk4udmFsdWVPZigpOyAvLyBHZXQgdGltZXN0YW1wIGluIG1pbGxpc2Vjb25kc1xuICAgICAgY29uc3QgcmVxdWVzdElkID0gYCR7dGhpcy5jb25maWcucGFydG5lckNvZGV9JHt0aW1lc3RhbXB9YDtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHJhdyBzaWduYXR1cmUgc3RyaW5nXG4gICAgICBjb25zdCByYXdTaWduYXR1cmUgPSBbXG4gICAgICAgIGBhY2Nlc3NLZXk9JHt0aGlzLmNvbmZpZy5hY2Nlc3NLZXl9YCxcbiAgICAgICAgYGFtb3VudD0ke2Ftb3VudH1gLFxuICAgICAgICBgZXh0cmFEYXRhPSR7ZXh0cmFEYXRhfWAsXG4gICAgICAgIGBpcG5Vcmw9JHt0aGlzLmNvbmZpZy5pcG5Vcmx9YCxcbiAgICAgICAgYG9yZGVySWQ9JHtvcmRlcklkfWAsXG4gICAgICAgIGBvcmRlckluZm89JHtvcmRlckluZm99YCxcbiAgICAgICAgYHBhcnRuZXJDb2RlPSR7dGhpcy5jb25maWcucGFydG5lckNvZGV9YCxcbiAgICAgICAgYHJlZGlyZWN0VXJsPSR7dGhpcy5jb25maWcucmVkaXJlY3RVcmx9YCxcbiAgICAgICAgYHJlcXVlc3RJZD0ke3JlcXVlc3RJZH1gLFxuICAgICAgICBgcmVxdWVzdFR5cGU9JHt0aGlzLmNvbmZpZy5yZXF1ZXN0VHlwZX1gXG4gICAgICBdLmpvaW4oJyYnKTtcblxuICAgICAgLy8gR2VuZXJhdGUgc2lnbmF0dXJlXG4gICAgICBjb25zdCBzaWduYXR1cmUgPSB0aGlzLmdlbmVyYXRlU2lnbmF0dXJlKHJhd1NpZ25hdHVyZSk7XG5cbiAgICAgIC8vIFByZXBhcmUgcmVxdWVzdCBib2R5XG4gICAgICBjb25zdCByZXF1ZXN0Qm9keSA9IHtcbiAgICAgICAgcGFydG5lckNvZGU6IHRoaXMuY29uZmlnLnBhcnRuZXJDb2RlLFxuICAgICAgICBwYXJ0bmVyTmFtZTogJ0RSRUFNIENPRkZFRScsXG4gICAgICAgIHN0b3JlSWQ6ICdEcmVhbUNvZmZlZVN0b3JlJyxcbiAgICAgICAgcmVxdWVzdElkLFxuICAgICAgICBhbW91bnQ6IGFtb3VudC50b1N0cmluZygpLFxuICAgICAgICBvcmRlcklkLFxuICAgICAgICBvcmRlckluZm8sXG4gICAgICAgIHJlZGlyZWN0VXJsOiB0aGlzLmNvbmZpZy5yZWRpcmVjdFVybCxcbiAgICAgICAgaXBuVXJsOiB0aGlzLmNvbmZpZy5pcG5VcmwsXG4gICAgICAgIGxhbmc6IHRoaXMuY29uZmlnLmxhbmcsXG4gICAgICAgIHJlcXVlc3RUeXBlOiB0aGlzLmNvbmZpZy5yZXF1ZXN0VHlwZSxcbiAgICAgICAgYXV0b0NhcHR1cmU6IHRoaXMuY29uZmlnLmF1dG9DYXB0dXJlLFxuICAgICAgICBleHRyYURhdGEsXG4gICAgICAgIHNpZ25hdHVyZVxuICAgICAgfTtcblxuICAgICAgY29uc29sZS5sb2coJ01vTW8gUGF5bWVudCBSZXF1ZXN0OicsIHtcbiAgICAgICAgb3JkZXJJZCxcbiAgICAgICAgYW1vdW50LFxuICAgICAgICByZXF1ZXN0SWQsXG4gICAgICAgIHJhd1NpZ25hdHVyZVxuICAgICAgfSk7XG5cbiAgICAgIC8vIE1ha2UgcmVxdWVzdCB0byBNb01vIEFQSVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VIdHRwc1JlcXVlc3QocmVxdWVzdEJvZHkpO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXNwb25zZSxcbiAgICAgICAgcmVxdWVzdElkLFxuICAgICAgICBvcmRlcklkXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNb01vIHBheW1lbnQgY3JlYXRpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgY29kZTogZXJyb3IuY29kZSB8fCAnTU9NT19FUlJPUidcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1ha2UgSFRUUFMgcmVxdWVzdCB0byBNb01vIEFQSVxuICAgKiBAcGFyYW0ge09iamVjdH0gcmVxdWVzdEJvZHkgLSBSZXF1ZXN0IHBheWxvYWRcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gLSBBUEkgcmVzcG9uc2VcbiAgICovXG4gIG1ha2VIdHRwc1JlcXVlc3QocmVxdWVzdEJvZHkpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgcG9zdERhdGEgPSBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSk7XG4gICAgICBcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgIGhvc3RuYW1lOiAndGVzdC1wYXltZW50Lm1vbW8udm4nLFxuICAgICAgICBwb3J0OiA0NDMsXG4gICAgICAgIHBhdGg6ICcvdjIvZ2F0ZXdheS9hcGkvY3JlYXRlJyxcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICdDb250ZW50LUxlbmd0aCc6IEJ1ZmZlci5ieXRlTGVuZ3RoKHBvc3REYXRhKVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXEgPSBodHRwcy5yZXF1ZXN0KG9wdGlvbnMsIChyZXMpID0+IHtcbiAgICAgICAgbGV0IGRhdGEgPSAnJztcbiAgICAgICAgXG4gICAgICAgIHJlcy5vbignZGF0YScsIChjaHVuaykgPT4ge1xuICAgICAgICAgIGRhdGEgKz0gY2h1bms7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgcmVzLm9uKCdlbmQnLCAoKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdNb01vIEFQSSBSZXNwb25zZTonLCB7XG4gICAgICAgICAgICAgIHN0YXR1czogcmVzLnN0YXR1c0NvZGUsXG4gICAgICAgICAgICAgIHJlc3VsdENvZGU6IHJlc3BvbnNlLnJlc3VsdENvZGUsXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLm1lc3NhZ2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAocmVzLnN0YXR1c0NvZGUgPT09IDIwMCkge1xuICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoYEhUVFAgJHtyZXMuc3RhdHVzQ29kZX06ICR7cmVzcG9uc2UubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcid9YCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoYEZhaWxlZCB0byBwYXJzZSBNb01vIHJlc3BvbnNlOiAke3BhcnNlRXJyb3IubWVzc2FnZX1gKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICByZXEub24oJ2Vycm9yJywgKGVycm9yKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ01vTW8gSFRUUFMgcmVxdWVzdCBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoYE5ldHdvcmsgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKSk7XG4gICAgICB9KTtcblxuICAgICAgcmVxLm9uKCd0aW1lb3V0JywgKCkgPT4ge1xuICAgICAgICByZXEuZGVzdHJveSgpO1xuICAgICAgICByZWplY3QobmV3IEVycm9yKCdSZXF1ZXN0IHRpbWVvdXQnKSk7XG4gICAgICB9KTtcblxuICAgICAgLy8gU2V0IHRpbWVvdXRcbiAgICAgIHJlcS5zZXRUaW1lb3V0KDMwMDAwKTsgLy8gMzAgc2Vjb25kc1xuICAgICAgXG4gICAgICAvLyBTZW5kIHJlcXVlc3RcbiAgICAgIHJlcS53cml0ZShwb3N0RGF0YSk7XG4gICAgICByZXEuZW5kKCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZ5IE1vTW8gY2FsbGJhY2sgc2lnbmF0dXJlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjYWxsYmFja0RhdGEgLSBDYWxsYmFjayBkYXRhIGZyb20gTW9Nb1xuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gLSBTaWduYXR1cmUgdmVyaWZpY2F0aW9uIHJlc3VsdFxuICAgKi9cbiAgdmVyaWZ5Q2FsbGJhY2soY2FsbGJhY2tEYXRhKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgcGFydG5lckNvZGUsXG4gICAgICAgIG9yZGVySWQsXG4gICAgICAgIHJlcXVlc3RJZCxcbiAgICAgICAgYW1vdW50LFxuICAgICAgICBvcmRlckluZm8sXG4gICAgICAgIG9yZGVyVHlwZSxcbiAgICAgICAgdHJhbnNJZCxcbiAgICAgICAgcmVzdWx0Q29kZSxcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgcGF5VHlwZSxcbiAgICAgICAgcmVzcG9uc2VUaW1lLFxuICAgICAgICBleHRyYURhdGEsXG4gICAgICAgIHNpZ25hdHVyZVxuICAgICAgfSA9IGNhbGxiYWNrRGF0YTtcblxuICAgICAgLy8gQ3JlYXRlIHJhdyBzaWduYXR1cmUgZm9yIHZlcmlmaWNhdGlvblxuICAgICAgY29uc3QgcmF3U2lnbmF0dXJlID0gW1xuICAgICAgICBgYWNjZXNzS2V5PSR7dGhpcy5jb25maWcuYWNjZXNzS2V5fWAsXG4gICAgICAgIGBhbW91bnQ9JHthbW91bnR9YCxcbiAgICAgICAgYGV4dHJhRGF0YT0ke2V4dHJhRGF0YX1gLFxuICAgICAgICBgbWVzc2FnZT0ke21lc3NhZ2V9YCxcbiAgICAgICAgYG9yZGVySWQ9JHtvcmRlcklkfWAsXG4gICAgICAgIGBvcmRlckluZm89JHtvcmRlckluZm99YCxcbiAgICAgICAgYG9yZGVyVHlwZT0ke29yZGVyVHlwZX1gLFxuICAgICAgICBgcGFydG5lckNvZGU9JHtwYXJ0bmVyQ29kZX1gLFxuICAgICAgICBgcGF5VHlwZT0ke3BheVR5cGV9YCxcbiAgICAgICAgYHJlcXVlc3RJZD0ke3JlcXVlc3RJZH1gLFxuICAgICAgICBgcmVzcG9uc2VUaW1lPSR7cmVzcG9uc2VUaW1lfWAsXG4gICAgICAgIGByZXN1bHRDb2RlPSR7cmVzdWx0Q29kZX1gLFxuICAgICAgICBgdHJhbnNJZD0ke3RyYW5zSWR9YFxuICAgICAgXS5qb2luKCcmJyk7XG5cbiAgICAgIGNvbnN0IGV4cGVjdGVkU2lnbmF0dXJlID0gdGhpcy5nZW5lcmF0ZVNpZ25hdHVyZShyYXdTaWduYXR1cmUpO1xuICAgICAgXG4gICAgICByZXR1cm4gc2lnbmF0dXJlID09PSBleHBlY3RlZFNpZ25hdHVyZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignTW9NbyBjYWxsYmFjayB2ZXJpZmljYXRpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgcGF5bWVudCBzdGF0dXNcbiAgICogQHBhcmFtIHtzdHJpbmd9IG9yZGVySWQgLSBPcmRlciBJRFxuICAgKiBAcGFyYW0ge3N0cmluZ30gcmVxdWVzdElkIC0gUmVxdWVzdCBJRFxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3Q+fSAtIFBheW1lbnQgc3RhdHVzXG4gICAqL1xuICBhc3luYyBjaGVja1BheW1lbnRTdGF0dXMob3JkZXJJZCwgcmVxdWVzdElkKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFRoaXMgd291bGQgdHlwaWNhbGx5IGNhbGwgTW9NbydzIHF1ZXJ5IEFQSVxuICAgICAgLy8gRm9yIG5vdywgd2UnbGwgcmV0dXJuIGEgcGxhY2Vob2xkZXIgcmVzcG9uc2VcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHJlc3VsdENvZGU6IDAsXG4gICAgICAgIG1lc3NhZ2U6ICdQYXltZW50IHN0YXR1cyBjaGVjayBub3QgaW1wbGVtZW50ZWQgeWV0J1xuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignUGF5bWVudCBzdGF0dXMgY2hlY2sgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgTW9Nb1NlcnZpY2UoKTsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE1BQU0sR0FBR0MsT0FBTyxDQUFDLFFBQVEsQ0FBQztBQUNoQyxNQUFNQyxLQUFLLEdBQUdELE9BQU8sQ0FBQyxPQUFPLENBQUM7QUFDOUIsTUFBTUUsTUFBTSxHQUFHRixP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","map":{"version":3,"names":["crypto","require","https","moment","MoMoService","constructor","config","accessKey","process","env","MOMO_ACCESS_KEY","secretKey","MOMO_SECRET_KEY","partnerCode","MOMO_PARTNER_CODE","redirectUrl","MOMO_REDIRECT_URL","ipnUrl","MOMO_IPN_URL","requestType","autoCapture","lang","endpoint","MOMO_ENDPOINT","generateSignature","rawSignature","createHmac","update","digest","createPayment","paymentData","orderId","amount","orderInfo","extraData","nowVN","tz","timestamp","valueOf","requestId","join","signature","requestBody","partnerName","storeId","toString","console","log","response","makeHttpsRequest","success","data","error","message","code","Promise","resolve","reject","postData","JSON","stringify","options","hostname","port","path","method","headers","Buffer","byteLength","req","request","res","on","chunk","parse","status","statusCode","resultCode","Error","parseError","destroy","setTimeout","write","end","verifyCallback","callbackData","orderType","transId","payType","responseTime","expectedSignature","checkPaymentStatus","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\services\\","sources":["momoService.js"],"sourcesContent":["const crypto = require('crypto');\nconst https = require('https');\nconst moment = require('moment-timezone');\n\nclass MoMoService {\n  constructor() {\n    // MoMo API configuration - these should be moved to environment variables in production\n    this.config = {\n      accessKey: process.env.MOMO_ACCESS_KEY || 'F8BBA842ECF85',\n      secretKey: process.env.MOMO_SECRET_KEY || 'K951B6PE1waDMi640xX08PD3vg6EkVlz',\n      partnerCode: process.env.MOMO_PARTNER_CODE || 'MOMO',\n      redirectUrl: process.env.MOMO_REDIRECT_URL || 'http://localhost:5173/momo/return',\n      ipnUrl: process.env.MOMO_IPN_URL || 'http://localhost:5003/api/payments/momo/callback',\n      requestType: 'payWithMethod',\n      autoCapture: true,\n      lang: 'vi',\n      endpoint: process.env.MOMO_ENDPOINT || 'https://test-payment.momo.vn/v2/gateway/api/create'\n    };\n  }\n\n  /**\n   * Generate HMAC SHA256 signature for MoMo API\n   * @param {string} rawSignature - Raw signature string\n   * @returns {string} - Generated signature\n   */\n  generateSignature(rawSignature) {\n    return crypto\n      .createHmac('sha256', this.config.secretKey)\n      .update(rawSignature)\n      .digest('hex');\n  }\n\n  /**\n   * Create MoMo payment request\n   * @param {Object} paymentData - Payment information\n   * @param {string} paymentData.orderId - Order ID\n   * @param {number} paymentData.amount - Payment amount\n   * @param {string} paymentData.orderInfo - Order description\n   * @param {string} paymentData.extraData - Additional data (optional)\n   * @returns {Promise<Object>} - MoMo payment response\n   */\n  async createPayment(paymentData) {\n    try {\n      const {\n        orderId,\n        amount,\n        orderInfo = 'Payment for DREAM COFFEE order',\n        extraData = ''\n      } = paymentData;\n\n      // Generate unique request ID using Vietnam timezone\n      const nowVN = moment.tz('Asia/Ho_Chi_Minh');\n      const timestamp = nowVN.valueOf(); // Get timestamp in milliseconds\n      const requestId = `${this.config.partnerCode}${timestamp}`;\n      \n      // Create raw signature string\n      const rawSignature = [\n        `accessKey=${this.config.accessKey}`,\n        `amount=${amount}`,\n        `extraData=${extraData}`,\n        `ipnUrl=${this.config.ipnUrl}`,\n        `orderId=${orderId}`,\n        `orderInfo=${orderInfo}`,\n        `partnerCode=${this.config.partnerCode}`,\n        `redirectUrl=${this.config.redirectUrl}`,\n        `requestId=${requestId}`,\n        `requestType=${this.config.requestType}`\n      ].join('&');\n\n      // Generate signature\n      const signature = this.generateSignature(rawSignature);\n\n      // Prepare request body\n      const requestBody = {\n        partnerCode: this.config.partnerCode,\n        partnerName: 'DREAM COFFEE',\n        storeId: 'DreamCoffeeStore',\n        requestId,\n        amount: amount.toString(),\n        orderId,\n        orderInfo,\n        redirectUrl: this.config.redirectUrl,\n        ipnUrl: this.config.ipnUrl,\n        lang: this.config.lang,\n        requestType: this.config.requestType,\n        autoCapture: this.config.autoCapture,\n        extraData,\n        signature\n      };\n\n      console.log('MoMo Payment Request:', {\n        orderId,\n        amount,\n        requestId,\n        rawSignature\n      });\n\n      // Make request to MoMo API\n      const response = await this.makeHttpsRequest(requestBody);\n      \n      return {\n        success: true,\n        data: response,\n        requestId,\n        orderId\n      };\n    } catch (error) {\n      console.error('MoMo payment creation failed:', error);\n      return {\n        success: false,\n        error: error.message,\n        code: error.code || 'MOMO_ERROR'\n      };\n    }\n  }\n\n  /**\n   * Make HTTPS request to MoMo API\n   * @param {Object} requestBody - Request payload\n   * @returns {Promise<Object>} - API response\n   */\n  makeHttpsRequest(requestBody) {\n    return new Promise((resolve, reject) => {\n      const postData = JSON.stringify(requestBody);\n      \n      const options = {\n        hostname: 'test-payment.momo.vn',\n        port: 443,\n        path: '/v2/gateway/api/create',\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Content-Length': Buffer.byteLength(postData)\n        }\n      };\n\n      const req = https.request(options, (res) => {\n        let data = '';\n        \n        res.on('data', (chunk) => {\n          data += chunk;\n        });\n        \n        res.on('end', () => {\n          try {\n            const response = JSON.parse(data);\n            console.log('MoMo API Response:', {\n              status: res.statusCode,\n              resultCode: response.resultCode,\n              message: response.message\n            });\n            \n            if (res.statusCode === 200) {\n              resolve(response);\n            } else {\n              reject(new Error(`HTTP ${res.statusCode}: ${response.message || 'Unknown error'}`));\n            }\n          } catch (parseError) {\n            reject(new Error(`Failed to parse MoMo response: ${parseError.message}`));\n          }\n        });\n      });\n\n      req.on('error', (error) => {\n        console.error('MoMo HTTPS request error:', error);\n        reject(new Error(`Network error: ${error.message}`));\n      });\n\n      req.on('timeout', () => {\n        req.destroy();\n        reject(new Error('Request timeout'));\n      });\n\n      // Set timeout\n      req.setTimeout(30000); // 30 seconds\n      \n      // Send request\n      req.write(postData);\n      req.end();\n    });\n  }\n\n  /**\n   * Verify MoMo callback signature\n   * @param {Object} callbackData - Callback data from MoMo\n   * @returns {boolean} - Signature verification result\n   */\n  verifyCallback(callbackData) {\n    try {\n      const {\n        partnerCode,\n        orderId,\n        requestId,\n        amount,\n        orderInfo,\n        orderType,\n        transId,\n        resultCode,\n        message,\n        payType,\n        responseTime,\n        extraData,\n        signature\n      } = callbackData;\n\n      // Create raw signature for verification\n      const rawSignature = [\n        `accessKey=${this.config.accessKey}`,\n        `amount=${amount}`,\n        `extraData=${extraData}`,\n        `message=${message}`,\n        `orderId=${orderId}`,\n        `orderInfo=${orderInfo}`,\n        `orderType=${orderType}`,\n        `partnerCode=${partnerCode}`,\n        `payType=${payType}`,\n        `requestId=${requestId}`,\n        `responseTime=${responseTime}`,\n        `resultCode=${resultCode}`,\n        `transId=${transId}`\n      ].join('&');\n\n      const expectedSignature = this.generateSignature(rawSignature);\n      \n      return signature === expectedSignature;\n    } catch (error) {\n      console.error('MoMo callback verification failed:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Check payment status\n   * @param {string} orderId - Order ID\n   * @param {string} requestId - Request ID\n   * @returns {Promise<Object>} - Payment status\n   */\n  async checkPaymentStatus(orderId, requestId) {\n    try {\n      // This would typically call MoMo's query API\n      // For now, we'll return a placeholder response\n      return {\n        success: true,\n        resultCode: 0,\n        message: 'Payment status check not implemented yet'\n      };\n    } catch (error) {\n      console.error('Payment status check failed:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n}\n\nmodule.exports = new MoMoService();"],"mappings":"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","ignoreList":[]}},"mtime":1757590229097},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\config\\\\vnpay.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const crypto = require('crypto');\nconst moment = require('moment-timezone');\nclass VNPayConfig {\n  constructor() {\n    this.vnp_TmnCode = process.env.VNP_TMNCODE;\n    this.vnp_HashSecret = process.env.VNP_HASHSECRET;\n    this.vnp_Url = 'https://sandbox.vnpayment.vn/paymentv2/vpcpay.html';\n    this.vnp_ReturnUrl = process.env.VNP_RETURN_URL;\n    this.vnp_IpnUrl = process.env.VNP_IPN_URL || `${process.env.VNP_RETURN_URL}/ipn`;\n    this.vnp_Version = '2.1.0';\n    this.vnp_Command = 'pay';\n    this.vnp_CurrCode = 'VND';\n    this.vnp_Locale = 'vn';\n  }\n\n  // Sort object by key\n  sortObject(obj) {\n    let sorted = {};\n    let str = [];\n    let key;\n    for (key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        str.push(encodeURIComponent(key));\n      }\n    }\n    str.sort();\n    for (key = 0; key < str.length; key++) {\n      sorted[str[key]] = encodeURIComponent(obj[str[key]]).replace(/%20/g, \"+\");\n    }\n    return sorted;\n  }\n\n  // Create payment URL\n  createPaymentUrl(orderId, amount, orderInfo, ipAddr, bankCode = '') {\n    // Validate required parameters\n    if (!orderId || !amount || !orderInfo || !ipAddr) {\n      throw new Error('Missing required parameters for VNPay payment');\n    }\n\n    // Validate amount (must be positive integer)\n    const amountInt = parseInt(amount);\n    if (isNaN(amountInt) || amountInt <= 0) {\n      throw new Error('Invalid amount for VNPay payment');\n    }\n\n    // Validate orderId format (alphanumeric only, max 100 chars)\n    if (!/^[a-zA-Z0-9]+$/.test(orderId) || orderId.length > 100) {\n      throw new Error('Invalid orderId format for VNPay payment');\n    }\n\n    // Use Vietnam timezone for consistent time handling in production\n    const nowVN = moment.tz('Asia/Ho_Chi_Minh');\n    const vnp_CreateDate = nowVN.format('YYYYMMDDHHmmss');\n    const vnp_ExpireDate = nowVN.clone().add(15, 'minutes').format('YYYYMMDDHHmmss');\n\n    // Clean orderInfo to remove special characters and limit length\n    const cleanOrderInfo = orderInfo.replace(/[^a-zA-Z0-9\\s]/g, '').trim().substring(0, 255);\n    let vnp_Params = {\n      vnp_Version: this.vnp_Version,\n      vnp_Command: this.vnp_Command,\n      vnp_TmnCode: this.vnp_TmnCode,\n      vnp_Locale: this.vnp_Locale,\n      vnp_CurrCode: this.vnp_CurrCode,\n      vnp_TxnRef: orderId,\n      vnp_OrderInfo: cleanOrderInfo,\n      vnp_OrderType: 'other',\n      vnp_Amount: amountInt * 100,\n      // VNPay requires amount in VND cents\n      vnp_ReturnUrl: this.vnp_ReturnUrl,\n      vnp_IpAddr: ipAddr,\n      vnp_CreateDate: vnp_CreateDate,\n      vnp_ExpireDate: vnp_ExpireDate\n    };\n    if (bankCode) {\n      vnp_Params.vnp_BankCode = bankCode;\n    }\n    vnp_Params = this.sortObject(vnp_Params);\n    const qs = require('qs');\n    const signData = qs.stringify(vnp_Params, {\n      encode: false\n    });\n    const hmac = crypto.createHmac('sha512', this.vnp_HashSecret);\n    const signed = hmac.update(Buffer.from(signData, 'utf-8')).digest('hex');\n    vnp_Params.vnp_SecureHash = signed;\n    return this.vnp_Url + '?' + qs.stringify(vnp_Params, {\n      encode: false\n    });\n  }\n\n  // Verify return URL\n  verifyReturnUrl(vnp_Params) {\n    const secureHash = vnp_Params.vnp_SecureHash;\n    delete vnp_Params.vnp_SecureHash;\n    delete vnp_Params.vnp_SecureHashType;\n    const sortedParams = this.sortObject(vnp_Params);\n    const qs = require('qs');\n    const signData = qs.stringify(sortedParams, {\n      encode: false\n    });\n    const hmac = crypto.createHmac('sha512', this.vnp_HashSecret);\n    const signed = hmac.update(Buffer.from(signData, 'utf-8')).digest('hex');\n    return secureHash === signed;\n  }\n\n  // Format date for VNPay\n  formatDate(date) {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    const hours = String(date.getHours()).padStart(2, '0');\n    const minutes = String(date.getMinutes()).padStart(2, '0');\n    const seconds = String(date.getSeconds()).padStart(2, '0');\n    return `${year}${month}${day}${hours}${minutes}${seconds}`;\n  }\n\n  // Get payment status message\n  getPaymentStatus(responseCode) {\n    const statusMap = {\n      '00': 'Giao dịch thành công',\n      '07': 'Trừ tiền thành công. Giao dịch bị nghi ngờ (liên quan tới lừa đảo, giao dịch bất thường).',\n      '09': 'Giao dịch không thành công do: Thẻ/Tài khoản của khách hàng chưa đăng ký dịch vụ InternetBanking tại ngân hàng.',\n      '10': 'Giao dịch không thành công do: Khách hàng xác thực thông tin thẻ/tài khoản không đúng quá 3 lần',\n      '11': 'Giao dịch không thành công do: Đã hết hạn chờ thanh toán. Xin quý khách vui lòng thực hiện lại giao dịch.',\n      '12': 'Giao dịch không thành công do: Thẻ/Tài khoản của khách hàng bị khóa.',\n      '13': 'Giao dịch không thành công do Quý khách nhập sai mật khẩu xác thực giao dịch (OTP). Xin quý khách vui lòng thực hiện lại giao dịch.',\n      '24': 'Giao dịch không thành công do: Khách hàng hủy giao dịch',\n      '51': 'Giao dịch không thành công do: Tài khoản của quý khách không đủ số dư để thực hiện giao dịch.',\n      '65': 'Giao dịch không thành công do: Tài khoản của Quý khách đã vượt quá hạn mức giao dịch trong ngày.',\n      '75': 'Ngân hàng thanh toán đang bảo trì.',\n      '79': 'Giao dịch không thành công do: KH nhập sai mật khẩu thanh toán quá số lần quy định. Xin quý khách vui lòng thực hiện lại giao dịch',\n      '99': 'Các lỗi khác (lỗi còn lại, không có trong danh sách mã lỗi đã liệt kê)'\n    };\n    return statusMap[responseCode] || 'Lỗi không xác định';\n  }\n}\nmodule.exports = new VNPayConfig();\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcnlwdG8iLCJyZXF1aXJlIiwibW9tZW50IiwiVk5QYXlDb25maWciLCJjb25zdHJ1Y3RvciIsInZucF9UbW5Db2RlIiwicHJvY2VzcyIsImVudiIsIlZOUF9UTU5DT0RFIiwidm5wX0hhc2hTZWNyZXQiLCJWTlBfSEFTSFNFQ1JFVCIsInZucF9VcmwiLCJ2bnBfUmV0dXJuVXJsIiwiVk5QX1JFVFVSTl9VUkwiLCJ2bnBfSXBuVXJsIiwiVk5QX0lQTl9VUkwiLCJ2bnBfVmVyc2lvbiIsInZucF9Db21tYW5kIiwidm5wX0N1cnJDb2RlIiwidm5wX0xvY2FsZSIsInNvcnRPYmplY3QiLCJvYmoiLCJzb3J0ZWQiLCJzdHIiLCJrZXkiLCJoYXNPd25Qcm9wZXJ0eSIsInB1c2giLCJlbmNvZGVVUklDb21wb25lbnQiLCJzb3J0IiwibGVuZ3RoIiwicmVwbGFjZSIsImNyZWF0ZVBheW1lbnRVcmwiLCJvcmRlcklkIiwiYW1vdW50Iiwib3JkZXJJbmZvIiwiaXBBZGRyIiwiYmFua0NvZGUiLCJFcnJvciIsImFtb3VudEludCIsInBhcnNlSW50IiwiaXNOYU4iLCJ0ZXN0Iiwibm93Vk4iLCJ0eiIsInZucF9DcmVhdGVEYXRlIiwiZm9ybWF0Iiwidm5wX0V4cGlyZURhdGUiLCJjbG9uZSIsImFkZCIsImNsZWFuT3JkZXJJbmZvIiwidHJpbSIsInN1YnN0cmluZyIsInZucF9QYXJhbXMiLCJ2bnBfVHhuUmVmIiwidm5wX09yZGVySW5mbyIsInZucF9PcmRlclR5cGUiLCJ2bnBfQW1vdW50Iiwidm5wX0lwQWRkciIsInZucF9CYW5rQ29kZSIsInFzIiwic2lnbkRhdGEiLCJzdHJpbmdpZnkiLCJlbmNvZGUiLCJobWFjIiwiY3JlYXRlSG1hYyIsInNpZ25lZCIsInVwZGF0ZSIsIkJ1ZmZlciIsImZyb20iLCJkaWdlc3QiLCJ2bnBfU2VjdXJlSGFzaCIsInZlcmlmeVJldHVyblVybCIsInNlY3VyZUhhc2giLCJ2bnBfU2VjdXJlSGFzaFR5cGUiLCJzb3J0ZWRQYXJhbXMiLCJmb3JtYXREYXRlIiwiZGF0ZSIsInllYXIiLCJnZXRGdWxsWWVhciIsIm1vbnRoIiwiU3RyaW5nIiwiZ2V0TW9udGgiLCJwYWRTdGFydCIsImRheSIsImdldERhdGUiLCJob3VycyIsImdldEhvdXJzIiwibWludXRlcyIsImdldE1pbnV0ZXMiLCJzZWNvbmRzIiwiZ2V0U2Vjb25kcyIsImdldFBheW1lbnRTdGF0dXMiLCJyZXNwb25zZUNvZGUiLCJzdGF0dXNNYXAiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xcY29uZmlnXFwiLCJzb3VyY2VzIjpbInZucGF5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNyeXB0byA9IHJlcXVpcmUoJ2NyeXB0bycpO1xuY29uc3QgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50LXRpbWV6b25lJyk7XG5cbmNsYXNzIFZOUGF5Q29uZmlnIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy52bnBfVG1uQ29kZSA9IHByb2Nlc3MuZW52LlZOUF9UTU5DT0RFO1xuICAgIHRoaXMudm5wX0hhc2hTZWNyZXQgPSBwcm9jZXNzLmVudi5WTlBfSEFTSFNFQ1JFVDtcbiAgICB0aGlzLnZucF9VcmwgPSAnaHR0cHM6Ly9zYW5kYm94LnZucGF5bWVudC52bi9wYXltZW50djIvdnBjcGF5Lmh0bWwnO1xuICAgIHRoaXMudm5wX1JldHVyblVybCA9IHByb2Nlc3MuZW52LlZOUF9SRVRVUk5fVVJMO1xuICAgIHRoaXMudm5wX0lwblVybCA9IHByb2Nlc3MuZW52LlZOUF9JUE5fVVJMIHx8IGAke3Byb2Nlc3MuZW52LlZOUF9SRVRVUk5fVVJMfS9pcG5gO1xuICAgIHRoaXMudm5wX1ZlcnNpb24gPSAnMi4xLjAnO1xuICAgIHRoaXMudm5wX0NvbW1hbmQgPSAncGF5JztcbiAgICB0aGlzLnZucF9DdXJyQ29kZSA9ICdWTkQnO1xuICAgIHRoaXMudm5wX0xvY2FsZSA9ICd2bic7XG4gIH1cblxuICAvLyBTb3J0IG9iamVjdCBieSBrZXlcbiAgc29ydE9iamVjdChvYmopIHtcbiAgICBsZXQgc29ydGVkID0ge307XG4gICAgbGV0IHN0ciA9IFtdO1xuICAgIGxldCBrZXk7XG4gICAgZm9yIChrZXkgaW4gb2JqKSB7XG4gICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgc3RyLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGtleSkpO1xuICAgICAgfVxuICAgIH1cbiAgICBzdHIuc29ydCgpO1xuICAgIGZvciAoa2V5ID0gMDsga2V5IDwgc3RyLmxlbmd0aDsga2V5KyspIHtcbiAgICAgIHNvcnRlZFtzdHJba2V5XV0gPSBlbmNvZGVVUklDb21wb25lbnQob2JqW3N0cltrZXldXSkucmVwbGFjZSgvJTIwL2csIFwiK1wiKTtcbiAgICB9XG4gICAgcmV0dXJuIHNvcnRlZDtcbiAgfVxuXG4gIC8vIENyZWF0ZSBwYXltZW50IFVSTFxuICBjcmVhdGVQYXltZW50VXJsKG9yZGVySWQsIGFtb3VudCwgb3JkZXJJbmZvLCBpcEFkZHIsIGJhbmtDb2RlID0gJycpIHtcbiAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBwYXJhbWV0ZXJzXG4gICAgaWYgKCFvcmRlcklkIHx8ICFhbW91bnQgfHwgIW9yZGVySW5mbyB8fCAhaXBBZGRyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQgcGFyYW1ldGVycyBmb3IgVk5QYXkgcGF5bWVudCcpO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGFtb3VudCAobXVzdCBiZSBwb3NpdGl2ZSBpbnRlZ2VyKVxuICAgIGNvbnN0IGFtb3VudEludCA9IHBhcnNlSW50KGFtb3VudCk7XG4gICAgaWYgKGlzTmFOKGFtb3VudEludCkgfHwgYW1vdW50SW50IDw9IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhbW91bnQgZm9yIFZOUGF5IHBheW1lbnQnKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBvcmRlcklkIGZvcm1hdCAoYWxwaGFudW1lcmljIG9ubHksIG1heCAxMDAgY2hhcnMpXG4gICAgaWYgKCEvXlthLXpBLVowLTldKyQvLnRlc3Qob3JkZXJJZCkgfHwgb3JkZXJJZC5sZW5ndGggPiAxMDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBvcmRlcklkIGZvcm1hdCBmb3IgVk5QYXkgcGF5bWVudCcpO1xuICAgIH1cblxuICAgIC8vIFVzZSBWaWV0bmFtIHRpbWV6b25lIGZvciBjb25zaXN0ZW50IHRpbWUgaGFuZGxpbmcgaW4gcHJvZHVjdGlvblxuICAgIGNvbnN0IG5vd1ZOID0gbW9tZW50LnR6KCdBc2lhL0hvX0NoaV9NaW5oJyk7XG4gICAgY29uc3Qgdm5wX0NyZWF0ZURhdGUgPSBub3dWTi5mb3JtYXQoJ1lZWVlNTURESEhtbXNzJyk7XG4gICAgY29uc3Qgdm5wX0V4cGlyZURhdGUgPSBub3dWTi5jbG9uZSgpLmFkZCgxNSwgJ21pbnV0ZXMnKS5mb3JtYXQoJ1lZWVlNTURESEhtbXNzJyk7XG5cbiAgICAvLyBDbGVhbiBvcmRlckluZm8gdG8gcmVtb3ZlIHNwZWNpYWwgY2hhcmFjdGVycyBhbmQgbGltaXQgbGVuZ3RoXG4gICAgY29uc3QgY2xlYW5PcmRlckluZm8gPSBvcmRlckluZm8ucmVwbGFjZSgvW15hLXpBLVowLTlcXHNdL2csICcnKS50cmltKCkuc3Vic3RyaW5nKDAsIDI1NSk7XG5cbiAgICBsZXQgdm5wX1BhcmFtcyA9IHtcbiAgICAgIHZucF9WZXJzaW9uOiB0aGlzLnZucF9WZXJzaW9uLFxuICAgICAgdm5wX0NvbW1hbmQ6IHRoaXMudm5wX0NvbW1hbmQsXG4gICAgICB2bnBfVG1uQ29kZTogdGhpcy52bnBfVG1uQ29kZSxcbiAgICAgIHZucF9Mb2NhbGU6IHRoaXMudm5wX0xvY2FsZSxcbiAgICAgIHZucF9DdXJyQ29kZTogdGhpcy52bnBfQ3VyckNvZGUsXG4gICAgICB2bnBfVHhuUmVmOiBvcmRlcklkLFxuICAgICAgdm5wX09yZGVySW5mbzogY2xlYW5PcmRlckluZm8sXG4gICAgICB2bnBfT3JkZXJUeXBlOiAnb3RoZXInLFxuICAgICAgdm5wX0Ftb3VudDogYW1vdW50SW50ICogMTAwLCAvLyBWTlBheSByZXF1aXJlcyBhbW91bnQgaW4gVk5EIGNlbnRzXG4gICAgICB2bnBfUmV0dXJuVXJsOiB0aGlzLnZucF9SZXR1cm5VcmwsXG4gICAgICB2bnBfSXBBZGRyOiBpcEFkZHIsXG4gICAgICB2bnBfQ3JlYXRlRGF0ZTogdm5wX0NyZWF0ZURhdGUsXG4gICAgICB2bnBfRXhwaXJlRGF0ZTogdm5wX0V4cGlyZURhdGVcbiAgICB9O1xuXG4gICAgaWYgKGJhbmtDb2RlKSB7XG4gICAgICB2bnBfUGFyYW1zLnZucF9CYW5rQ29kZSA9IGJhbmtDb2RlO1xuICAgIH1cblxuICAgIHZucF9QYXJhbXMgPSB0aGlzLnNvcnRPYmplY3Qodm5wX1BhcmFtcyk7XG5cbiAgICBjb25zdCBxcyA9IHJlcXVpcmUoJ3FzJyk7XG4gICAgY29uc3Qgc2lnbkRhdGEgPSBxcy5zdHJpbmdpZnkodm5wX1BhcmFtcywgeyBlbmNvZGU6IGZhbHNlIH0pO1xuICAgIGNvbnN0IGhtYWMgPSBjcnlwdG8uY3JlYXRlSG1hYygnc2hhNTEyJywgdGhpcy52bnBfSGFzaFNlY3JldCk7XG4gICAgY29uc3Qgc2lnbmVkID0gaG1hYy51cGRhdGUoQnVmZmVyLmZyb20oc2lnbkRhdGEsICd1dGYtOCcpKS5kaWdlc3QoJ2hleCcpO1xuICAgIHZucF9QYXJhbXMudm5wX1NlY3VyZUhhc2ggPSBzaWduZWQ7XG5cbiAgICByZXR1cm4gdGhpcy52bnBfVXJsICsgJz8nICsgcXMuc3RyaW5naWZ5KHZucF9QYXJhbXMsIHsgZW5jb2RlOiBmYWxzZSB9KTtcbiAgfVxuXG4gIC8vIFZlcmlmeSByZXR1cm4gVVJMXG4gIHZlcmlmeVJldHVyblVybCh2bnBfUGFyYW1zKSB7XG4gICAgY29uc3Qgc2VjdXJlSGFzaCA9IHZucF9QYXJhbXMudm5wX1NlY3VyZUhhc2g7XG4gICAgZGVsZXRlIHZucF9QYXJhbXMudm5wX1NlY3VyZUhhc2g7XG4gICAgZGVsZXRlIHZucF9QYXJhbXMudm5wX1NlY3VyZUhhc2hUeXBlO1xuXG4gICAgY29uc3Qgc29ydGVkUGFyYW1zID0gdGhpcy5zb3J0T2JqZWN0KHZucF9QYXJhbXMpO1xuICAgIFxuICAgIGNvbnN0IHFzID0gcmVxdWlyZSgncXMnKTtcbiAgICBjb25zdCBzaWduRGF0YSA9IHFzLnN0cmluZ2lmeShzb3J0ZWRQYXJhbXMsIHsgZW5jb2RlOiBmYWxzZSB9KTtcbiAgICBjb25zdCBobWFjID0gY3J5cHRvLmNyZWF0ZUhtYWMoJ3NoYTUxMicsIHRoaXMudm5wX0hhc2hTZWNyZXQpO1xuICAgIGNvbnN0IHNpZ25lZCA9IGhtYWMudXBkYXRlKEJ1ZmZlci5mcm9tKHNpZ25EYXRhLCAndXRmLTgnKSkuZGlnZXN0KCdoZXgnKTtcblxuICAgIHJldHVybiBzZWN1cmVIYXNoID09PSBzaWduZWQ7XG4gIH1cblxuICAvLyBGb3JtYXQgZGF0ZSBmb3IgVk5QYXlcbiAgZm9ybWF0RGF0ZShkYXRlKSB7XG4gICAgY29uc3QgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICBjb25zdCBtb250aCA9IFN0cmluZyhkYXRlLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgIGNvbnN0IGRheSA9IFN0cmluZyhkYXRlLmdldERhdGUoKSkucGFkU3RhcnQoMiwgJzAnKTtcbiAgICBjb25zdCBob3VycyA9IFN0cmluZyhkYXRlLmdldEhvdXJzKCkpLnBhZFN0YXJ0KDIsICcwJyk7XG4gICAgY29uc3QgbWludXRlcyA9IFN0cmluZyhkYXRlLmdldE1pbnV0ZXMoKSkucGFkU3RhcnQoMiwgJzAnKTtcbiAgICBjb25zdCBzZWNvbmRzID0gU3RyaW5nKGRhdGUuZ2V0U2Vjb25kcygpKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgIHJldHVybiBgJHt5ZWFyfSR7bW9udGh9JHtkYXl9JHtob3Vyc30ke21pbnV0ZXN9JHtzZWNvbmRzfWA7XG4gIH1cblxuICAvLyBHZXQgcGF5bWVudCBzdGF0dXMgbWVzc2FnZVxuICBnZXRQYXltZW50U3RhdHVzKHJlc3BvbnNlQ29kZSkge1xuICAgIGNvbnN0IHN0YXR1c01hcCA9IHtcbiAgICAgICcwMCc6ICdHaWFvIGThu4tjaCB0aMOgbmggY8O0bmcnLFxuICAgICAgJzA3JzogJ1Ry4burIHRp4buBbiB0aMOgbmggY8O0bmcuIEdpYW8gZOG7i2NoIGLhu4sgbmdoaSBuZ+G7nSAobGnDqm4gcXVhbiB04bubaSBs4burYSDEkeG6o28sIGdpYW8gZOG7i2NoIGLhuqV0IHRoxrDhu51uZykuJyxcbiAgICAgICcwOSc6ICdHaWFvIGThu4tjaCBraMO0bmcgdGjDoG5oIGPDtG5nIGRvOiBUaOG6uy9Uw6BpIGtob+G6o24gY+G7p2Ega2jDoWNoIGjDoG5nIGNoxrBhIMSRxINuZyBrw70gZOG7i2NoIHbhu6UgSW50ZXJuZXRCYW5raW5nIHThuqFpIG5nw6JuIGjDoG5nLicsXG4gICAgICAnMTAnOiAnR2lhbyBk4buLY2gga2jDtG5nIHRow6BuaCBjw7RuZyBkbzogS2jDoWNoIGjDoG5nIHjDoWMgdGjhu7FjIHRow7RuZyB0aW4gdGjhursvdMOgaSBraG/huqNuIGtow7RuZyDEkcO6bmcgcXXDoSAzIGzhuqduJyxcbiAgICAgICcxMSc6ICdHaWFvIGThu4tjaCBraMO0bmcgdGjDoG5oIGPDtG5nIGRvOiDEkMOjIGjhur90IGjhuqFuIGNo4budIHRoYW5oIHRvw6FuLiBYaW4gcXXDvSBraMOhY2ggdnVpIGzDsm5nIHRo4buxYyBoaeG7h24gbOG6oWkgZ2lhbyBk4buLY2guJyxcbiAgICAgICcxMic6ICdHaWFvIGThu4tjaCBraMO0bmcgdGjDoG5oIGPDtG5nIGRvOiBUaOG6uy9Uw6BpIGtob+G6o24gY+G7p2Ega2jDoWNoIGjDoG5nIGLhu4sga2jDs2EuJyxcbiAgICAgICcxMyc6ICdHaWFvIGThu4tjaCBraMO0bmcgdGjDoG5oIGPDtG5nIGRvIFF1w70ga2jDoWNoIG5o4bqtcCBzYWkgbeG6rXQga2jhuql1IHjDoWMgdGjhu7FjIGdpYW8gZOG7i2NoIChPVFApLiBYaW4gcXXDvSBraMOhY2ggdnVpIGzDsm5nIHRo4buxYyBoaeG7h24gbOG6oWkgZ2lhbyBk4buLY2guJyxcbiAgICAgICcyNCc6ICdHaWFvIGThu4tjaCBraMO0bmcgdGjDoG5oIGPDtG5nIGRvOiBLaMOhY2ggaMOgbmcgaOG7p3kgZ2lhbyBk4buLY2gnLFxuICAgICAgJzUxJzogJ0dpYW8gZOG7i2NoIGtow7RuZyB0aMOgbmggY8O0bmcgZG86IFTDoGkga2hv4bqjbiBj4bunYSBxdcO9IGtow6FjaCBraMO0bmcgxJHhu6cgc+G7kSBkxrAgxJHhu4MgdGjhu7FjIGhp4buHbiBnaWFvIGThu4tjaC4nLFxuICAgICAgJzY1JzogJ0dpYW8gZOG7i2NoIGtow7RuZyB0aMOgbmggY8O0bmcgZG86IFTDoGkga2hv4bqjbiBj4bunYSBRdcO9IGtow6FjaCDEkcOjIHbGsOG7o3QgcXXDoSBo4bqhbiBt4bupYyBnaWFvIGThu4tjaCB0cm9uZyBuZ8OgeS4nLFxuICAgICAgJzc1JzogJ05nw6JuIGjDoG5nIHRoYW5oIHRvw6FuIMSRYW5nIGLhuqNvIHRyw6wuJyxcbiAgICAgICc3OSc6ICdHaWFvIGThu4tjaCBraMO0bmcgdGjDoG5oIGPDtG5nIGRvOiBLSCBuaOG6rXAgc2FpIG3huq10IGto4bqpdSB0aGFuaCB0b8OhbiBxdcOhIHPhu5EgbOG6p24gcXV5IMSR4buLbmguIFhpbiBxdcO9IGtow6FjaCB2dWkgbMOybmcgdGjhu7FjIGhp4buHbiBs4bqhaSBnaWFvIGThu4tjaCcsXG4gICAgICAnOTknOiAnQ8OhYyBs4buXaSBraMOhYyAobOG7l2kgY8OybiBs4bqhaSwga2jDtG5nIGPDsyB0cm9uZyBkYW5oIHPDoWNoIG3DoyBs4buXaSDEkcOjIGxp4buHdCBrw6opJ1xuICAgIH07XG4gICAgcmV0dXJuIHN0YXR1c01hcFtyZXNwb25zZUNvZGVdIHx8ICdM4buXaSBraMO0bmcgeMOhYyDEkeG7i25oJztcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBWTlBheUNvbmZpZygpOyJdLCJtYXBw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QUFDLENBQUM7SUFDL0IsTUFBTUMsS0FBSyxHQUFHQyxNQUFNLENBQUNKLElBQUksQ0FBQ0ssUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQ0MsUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUM7SUFDMUQsTUFBTUMsR0FBRyxHQUFHSCxNQUFNLENBQUNKLElBQUksQ0FBQ1EsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDRixRQUFRLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQztJQUNuRCxNQUFNRyxLQUFLLEdBQUdMLE1BQU0sQ0FBQ0osSUFBSSxDQUFDVSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUNKLFFBQVEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDO0lBQ3RELE1BQU1LLE9BQU8sR0FBR1AsTUFBTSxDQUFDSixJQUFJLENBQUNZLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQ04sUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUM7SUFDMUQsTUFBTU8sT0FBTyxHQUFHVCxNQUFNLENBQUNKLElBQUksQ0FBQ2MsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDUixRQUFRLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQztJQUMxRCxPQUFPLEdBQUdMLElBQUksR0FBR0UsS0FBSyxHQUFHSSxHQUFHLEdBQUdFLEtBQUssR0FBR0UsT0FBTyxHQUFHRSxPQUFPLEVBQUU7RUFDNUQ7O0VBRUE7RUFDQUUsZ0JBQWdCQSxDQUFDQyxZQUFZLEVBQUU7SUFDN0IsTUFBTUMsU0FBUyxHQUFHO01BQ2hCLElBQUksRUFBRSxzQkFBc0I7TUFDNUIsSUFBSSxFQUFFLDJGQUEyRjtNQUNqRyxJQUFJLEVBQUUsaUhBQWlIO01BQ3ZILElBQUksRUFBRSxpR0FBaUc7TUFDdkcsSUFBSSxFQUFFLDJHQUEyRztNQUNqSCxJQUFJLEVBQUUsc0VBQXNFO01BQzVFLElBQUksRUFBRSxxSUFBcUk7TUFDM0ksSUFBSSxFQUFFLHlEQUF5RDtNQUMvRCxJQUFJLEVBQUUsK0ZBQStGO01BQ3JHLElBQUksRUFBRSxrR0FBa0c7TUFDeEcsSUFBSSxFQUFFLG9DQUFvQztNQUMxQyxJQUFJLEVBQUUsb0lBQW9JO01BQzFJLElBQUksRUFBRTtJQUNSLENBQUM7SUFDRCxPQUFPQSxTQUFTLENBQUNELFlBQVksQ0FBQyxJQUFJLG9CQUFvQjtFQUN4RDtBQUNGO0FBRUFFLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHLElBQUk1RixXQUFXLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==","map":{"version":3,"names":["crypto","require","moment","VNPayConfig","constructor","vnp_TmnCode","process","env","VNP_TMNCODE","vnp_HashSecret","VNP_HASHSECRET","vnp_Url","vnp_ReturnUrl","VNP_RETURN_URL","vnp_IpnUrl","VNP_IPN_URL","vnp_Version","vnp_Command","vnp_CurrCode","vnp_Locale","sortObject","obj","sorted","str","key","hasOwnProperty","push","encodeURIComponent","sort","length","replace","createPaymentUrl","orderId","amount","orderInfo","ipAddr","bankCode","Error","amountInt","parseInt","isNaN","test","nowVN","tz","vnp_CreateDate","format","vnp_ExpireDate","clone","add","cleanOrderInfo","trim","substring","vnp_Params","vnp_TxnRef","vnp_OrderInfo","vnp_OrderType","vnp_Amount","vnp_IpAddr","vnp_BankCode","qs","signData","stringify","encode","hmac","createHmac","signed","update","Buffer","from","digest","vnp_SecureHash","verifyReturnUrl","secureHash","vnp_SecureHashType","sortedParams","formatDate","date","year","getFullYear","month","String","getMonth","padStart","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","getPaymentStatus","responseCode","statusMap","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\config\\","sources":["vnpay.js"],"sourcesContent":["const crypto = require('crypto');\nconst moment = require('moment-timezone');\n\nclass VNPayConfig {\n  constructor() {\n    this.vnp_TmnCode = process.env.VNP_TMNCODE;\n    this.vnp_HashSecret = process.env.VNP_HASHSECRET;\n    this.vnp_Url = 'https://sandbox.vnpayment.vn/paymentv2/vpcpay.html';\n    this.vnp_ReturnUrl = process.env.VNP_RETURN_URL;\n    this.vnp_IpnUrl = process.env.VNP_IPN_URL || `${process.env.VNP_RETURN_URL}/ipn`;\n    this.vnp_Version = '2.1.0';\n    this.vnp_Command = 'pay';\n    this.vnp_CurrCode = 'VND';\n    this.vnp_Locale = 'vn';\n  }\n\n  // Sort object by key\n  sortObject(obj) {\n    let sorted = {};\n    let str = [];\n    let key;\n    for (key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        str.push(encodeURIComponent(key));\n      }\n    }\n    str.sort();\n    for (key = 0; key < str.length; key++) {\n      sorted[str[key]] = encodeURIComponent(obj[str[key]]).replace(/%20/g, \"+\");\n    }\n    return sorted;\n  }\n\n  // Create payment URL\n  createPaymentUrl(orderId, amount, orderInfo, ipAddr, bankCode = '') {\n    // Validate required parameters\n    if (!orderId || !amount || !orderInfo || !ipAddr) {\n      throw new Error('Missing required parameters for VNPay payment');\n    }\n\n    // Validate amount (must be positive integer)\n    const amountInt = parseInt(amount);\n    if (isNaN(amountInt) || amountInt <= 0) {\n      throw new Error('Invalid amount for VNPay payment');\n    }\n\n    // Validate orderId format (alphanumeric only, max 100 chars)\n    if (!/^[a-zA-Z0-9]+$/.test(orderId) || orderId.length > 100) {\n      throw new Error('Invalid orderId format for VNPay payment');\n    }\n\n    // Use Vietnam timezone for consistent time handling in production\n    const nowVN = moment.tz('Asia/Ho_Chi_Minh');\n    const vnp_CreateDate = nowVN.format('YYYYMMDDHHmmss');\n    const vnp_ExpireDate = nowVN.clone().add(15, 'minutes').format('YYYYMMDDHHmmss');\n\n    // Clean orderInfo to remove special characters and limit length\n    const cleanOrderInfo = orderInfo.replace(/[^a-zA-Z0-9\\s]/g, '').trim().substring(0, 255);\n\n    let vnp_Params = {\n      vnp_Version: this.vnp_Version,\n      vnp_Command: this.vnp_Command,\n      vnp_TmnCode: this.vnp_TmnCode,\n      vnp_Locale: this.vnp_Locale,\n      vnp_CurrCode: this.vnp_CurrCode,\n      vnp_TxnRef: orderId,\n      vnp_OrderInfo: cleanOrderInfo,\n      vnp_OrderType: 'other',\n      vnp_Amount: amountInt * 100, // VNPay requires amount in VND cents\n      vnp_ReturnUrl: this.vnp_ReturnUrl,\n      vnp_IpAddr: ipAddr,\n      vnp_CreateDate: vnp_CreateDate,\n      vnp_ExpireDate: vnp_ExpireDate\n    };\n\n    if (bankCode) {\n      vnp_Params.vnp_BankCode = bankCode;\n    }\n\n    vnp_Params = this.sortObject(vnp_Params);\n\n    const qs = require('qs');\n    const signData = qs.stringify(vnp_Params, { encode: false });\n    const hmac = crypto.createHmac('sha512', this.vnp_HashSecret);\n    const signed = hmac.update(Buffer.from(signData, 'utf-8')).digest('hex');\n    vnp_Params.vnp_SecureHash = signed;\n\n    return this.vnp_Url + '?' + qs.stringify(vnp_Params, { encode: false });\n  }\n\n  // Verify return URL\n  verifyReturnUrl(vnp_Params) {\n    const secureHash = vnp_Params.vnp_SecureHash;\n    delete vnp_Params.vnp_SecureHash;\n    delete vnp_Params.vnp_SecureHashType;\n\n    const sortedParams = this.sortObject(vnp_Params);\n    \n    const qs = require('qs');\n    const signData = qs.stringify(sortedParams, { encode: false });\n    const hmac = crypto.createHmac('sha512', this.vnp_HashSecret);\n    const signed = hmac.update(Buffer.from(signData, 'utf-8')).digest('hex');\n\n    return secureHash === signed;\n  }\n\n  // Format date for VNPay\n  formatDate(date) {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    const hours = String(date.getHours()).padStart(2, '0');\n    const minutes = String(date.getMinutes()).padStart(2, '0');\n    const seconds = String(date.getSeconds()).padStart(2, '0');\n    return `${year}${month}${day}${hours}${minutes}${seconds}`;\n  }\n\n  // Get payment status message\n  getPaymentStatus(responseCode) {\n    const statusMap = {\n      '00': 'Giao dịch thành công',\n      '07': 'Trừ tiền thành công. Giao dịch bị nghi ngờ (liên quan tới lừa đảo, giao dịch bất thường).',\n      '09': 'Giao dịch không thành công do: Thẻ/Tài khoản của khách hàng chưa đăng ký dịch vụ InternetBanking tại ngân hàng.',\n      '10': 'Giao dịch không thành công do: Khách hàng xác thực thông tin thẻ/tài khoản không đúng quá 3 lần',\n      '11': 'Giao dịch không thành công do: Đã hết hạn chờ thanh toán. Xin quý khách vui lòng thực hiện lại giao dịch.',\n      '12': 'Giao dịch không thành công do: Thẻ/Tài khoản của khách hàng bị khóa.',\n      '13': 'Giao dịch không thành công do Quý khách nhập sai mật khẩu xác thực giao dịch (OTP). Xin quý khách vui lòng thực hiện lại giao dịch.',\n      '24': 'Giao dịch không thành công do: Khách hàng hủy giao dịch',\n      '51': 'Giao dịch không thành công do: Tài khoản của quý khách không đủ số dư để thực hiện giao dịch.',\n      '65': 'Giao dịch không thành công do: Tài khoản của Quý khách đã vượt quá hạn mức giao dịch trong ngày.',\n      '75': 'Ngân hàng thanh toán đang bảo trì.',\n      '79': 'Giao dịch không thành công do: KH nhập sai mật khẩu thanh toán quá số lần quy định. Xin quý khách vui lòng thực hiện lại giao dịch',\n      '99': 'Các lỗi khác (lỗi còn lại, không có trong danh sách mã lỗi đã liệt kê)'\n    };\n    return statusMap[responseCode] || 'Lỗi không xác định';\n  }\n}\n\nmodule.exports = new VNPayConfig();"],"mappings":"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","ignoreList":[]}},"mtime":1757590214224},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\upload.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst multer = require('multer');\nconst {\n  uploadToCloudinary\n} = require('../config/cloudinary');\nconst router = express.Router();\n\n// Configure multer for memory storage\nconst storage = multer.memoryStorage();\n\n// File filter for images only\nconst fileFilter = (req, file, cb) => {\n  if (file.mimetype.startsWith('image/')) {\n    cb(null, true);\n  } else {\n    cb(new Error('Only image files are allowed!'), false);\n  }\n};\n\n// Configure multer\nconst upload = multer({\n  storage: storage,\n  fileFilter: fileFilter,\n  limits: {\n    fileSize: 5 * 1024 * 1024 // 5MB limit\n  }\n});\n\n// @route   POST /api/upload/image\n// @desc    Upload image to Cloudinary\n// @access  Public (can be made private later)\nrouter.post('/image', upload.single('image'), async (req, res) => {\n  try {\n    if (!req.file) {\n      return res.status(400).json({\n        success: false,\n        message: 'No image file provided'\n      });\n    }\n\n    // Upload to Cloudinary\n    const result = await uploadToCloudinary(req.file.buffer, {\n      folder: 'webcaffe/products',\n      transformation: [{\n        width: 800,\n        height: 600,\n        crop: 'fill',\n        quality: 'auto'\n      }, {\n        format: 'webp'\n      }]\n    });\n    res.json({\n      success: true,\n      data: {\n        imageUrl: result.url,\n        imagePublicId: result.publicId,\n        width: result.width,\n        height: result.height,\n        format: result.format\n      },\n      message: 'Image uploaded successfully'\n    });\n  } catch (error) {\n    console.error('Error uploading image:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Failed to upload image',\n      error: error.message\n    });\n  }\n});\n\n// @route   DELETE /api/upload/image/:publicId\n// @desc    Delete uploaded image from Cloudinary\n// @access  Private/Admin\nrouter.delete('/image/:publicId', async (req, res) => {\n  try {\n    const {\n      deleteFromCloudinary\n    } = require('../config/cloudinary');\n    const publicId = req.params.publicId;\n\n    // Delete from Cloudinary\n    const result = await deleteFromCloudinary(publicId);\n    if (result.result === 'ok') {\n      res.json({\n        success: true,\n        message: 'Image deleted successfully'\n      });\n    } else {\n      res.status(404).json({\n        success: false,\n        message: 'Image not found or already deleted'\n      });\n    }\n  } catch (error) {\n    console.error('Error deleting image:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while deleting image'\n    });\n  }\n});\n\n// Error handling middleware for multer\nrouter.use((error, req, res, next) => {\n  if (error instanceof multer.MulterError) {\n    if (error.code === 'LIMIT_FILE_SIZE') {\n      return res.status(400).json({\n        success: false,\n        message: 'File too large. Maximum size is 5MB.'\n      });\n    }\n  }\n  if (error.message) {\n    return res.status(400).json({\n      success: false,\n      message: error.message\n    });\n  }\n  next(error);\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsIm11bHRlciIsInVwbG9hZFRvQ2xvdWRpbmFyeSIsInJvdXRlciIsIlJvdXRlciIsInN0b3JhZ2UiLCJtZW1vcnlTdG9yYWdlIiwiZmlsZUZpbHRlciIsInJlcSIsImZpbGUiLCJjYiIsIm1pbWV0eXBlIiwic3RhcnRzV2l0aCIsIkVycm9yIiwidXBsb2FkIiwibGltaXRzIiwiZmlsZVNpemUiLCJwb3N0Iiwic2luZ2xlIiwicmVzIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwicmVzdWx0IiwiYnVmZmVyIiwiZm9sZGVyIiwidHJhbnNmb3JtYXRpb24iLCJ3aWR0aCIsImhlaWdodCIsImNyb3AiLCJxdWFsaXR5IiwiZm9ybWF0IiwiZGF0YSIsImltYWdlVXJsIiwidXJsIiwiaW1hZ2VQdWJsaWNJZCIsInB1YmxpY0lkIiwiZXJyb3IiLCJjb25zb2xlIiwiZGVsZXRlIiwiZGVsZXRlRnJvbUNsb3VkaW5hcnkiLCJwYXJhbXMiLCJ1c2UiLCJuZXh0IiwiTXVsdGVyRXJyb3IiLCJjb2RlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXHJvdXRlc1xcIiwic291cmNlcyI6WyJ1cGxvYWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IG11bHRlciA9IHJlcXVpcmUoJ211bHRlcicpO1xuY29uc3QgeyB1cGxvYWRUb0Nsb3VkaW5hcnkgfSA9IHJlcXVpcmUoJy4uL2NvbmZpZy9jbG91ZGluYXJ5Jyk7XG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4vLyBDb25maWd1cmUgbXVsdGVyIGZvciBtZW1vcnkgc3RvcmFnZVxuY29uc3Qgc3RvcmFnZSA9IG11bHRlci5tZW1vcnlTdG9yYWdlKCk7XG5cbi8vIEZpbGUgZmlsdGVyIGZvciBpbWFnZXMgb25seVxuY29uc3QgZmlsZUZpbHRlciA9IChyZXEsIGZpbGUsIGNiKSA9PiB7XG4gIGlmIChmaWxlLm1pbWV0eXBlLnN0YXJ0c1dpdGgoJ2ltYWdlLycpKSB7XG4gICAgY2IobnVsbCwgdHJ1ZSk7XG4gIH0gZWxzZSB7XG4gICAgY2IobmV3IEVycm9yKCdPbmx5IGltYWdlIGZpbGVzIGFyZSBhbGxvd2VkIScpLCBmYWxzZSk7XG4gIH1cbn07XG5cbi8vIENvbmZpZ3VyZSBtdWx0ZXJcbmNvbnN0IHVwbG9hZCA9IG11bHRlcih7XG4gIHN0b3JhZ2U6IHN0b3JhZ2UsXG4gIGZpbGVGaWx0ZXI6IGZpbGVGaWx0ZXIsXG4gIGxpbWl0czoge1xuICAgIGZpbGVTaXplOiA1ICogMTAyNCAqIDEwMjQsIC8vIDVNQiBsaW1pdFxuICB9LFxufSk7XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS91cGxvYWQvaW1hZ2Vcbi8vIEBkZXNjICAgIFVwbG9hZCBpbWFnZSB0byBDbG91ZGluYXJ5XG4vLyBAYWNjZXNzICBQdWJsaWMgKGNhbiBiZSBtYWRlIHByaXZhdGUgbGF0ZXIpXG5yb3V0ZXIucG9zdCgnL2ltYWdlJywgdXBsb2FkLnNpbmdsZSgnaW1hZ2UnKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgaWYgKCFyZXEuZmlsZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdObyBpbWFnZSBmaWxlIHByb3ZpZGVkJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVXBsb2FkIHRvIENsb3VkaW5hcnlcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGxvYWRUb0Nsb3VkaW5hcnkocmVxLmZpbGUuYnVmZmVyLCB7XG4gICAgICBmb2xkZXI6ICd3ZWJjYWZmZS9wcm9kdWN0cycsXG4gICAgICB0cmFuc2Zvcm1hdGlvbjogW1xuICAgICAgICB7IHdpZHRoOiA4MDAsIGhlaWdodDogNjAwLCBjcm9wOiAnZmlsbCcsIHF1YWxpdHk6ICdhdXRvJyB9LFxuICAgICAgICB7IGZvcm1hdDogJ3dlYnAnIH1cbiAgICAgIF1cbiAgICB9KTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGltYWdlVXJsOiByZXN1bHQudXJsLFxuICAgICAgICBpbWFnZVB1YmxpY0lkOiByZXN1bHQucHVibGljSWQsXG4gICAgICAgIHdpZHRoOiByZXN1bHQud2lkdGgsXG4gICAgICAgIGhlaWdodDogcmVzdWx0LmhlaWdodCxcbiAgICAgICAgZm9ybWF0OiByZXN1bHQuZm9ybWF0XG4gICAgICB9LFxuICAgICAgbWVzc2FnZTogJ0ltYWdlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseSdcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGxvYWRpbmcgaW1hZ2U6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGxvYWQgaW1hZ2UnLFxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIERFTEVURSAvYXBpL3VwbG9hZC9pbWFnZS86cHVibGljSWRcbi8vIEBkZXNjICAgIERlbGV0ZSB1cGxvYWRlZCBpbWFnZSBmcm9tIENsb3VkaW5hcnlcbi8vIEBhY2Nlc3MgIFByaXZhdGUvQWRtaW5cbnJvdXRlci5kZWxldGUoJy9pbWFnZS86cHVibGljSWQnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRlbGV0ZUZyb21DbG91ZGluYXJ5IH0gPSByZXF1aXJlKCcuLi9jb25maWcvY2xvdWRpbmFyeScpO1xuICAgIGNvbnN0IHB1YmxpY0lkID0gcmVxLnBhcmFtcy5wdWJsaWNJZDtcblxuICAgIC8vIERlbGV0ZSBmcm9tIENsb3VkaW5hcnlcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkZWxldGVGcm9tQ2xvdWRpbmFyeShwdWJsaWNJZCk7XG5cbiAgICBpZiAocmVzdWx0LnJlc3VsdCA9PT0gJ29rJykge1xuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnSW1hZ2UgZGVsZXRlZCBzdWNjZXNzZnVsbHknXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ltYWdlIG5vdCBmb3VuZCBvciBhbHJlYWR5IGRlbGV0ZWQnXG4gICAgICB9KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgaW1hZ2U6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBkZWxldGluZyBpbWFnZSdcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEVycm9yIGhhbmRsaW5nIG1pZGRsZXdhcmUgZm9yIG11bHRlclxucm91dGVyLnVzZSgoZXJyb3IsIHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIG11bHRlci5NdWx0ZXJFcnJvcikge1xuICAgIGlmIChlcnJvci5jb2RlID09PSAnTElNSVRfRklMRV9TSVpFJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdGaWxlIHRvbyBsYXJnZS4gTWF4aW11bSBzaXplIGlzIDVNQi4nXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgXG4gIGlmIChlcnJvci5tZXNzYWdlKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZVxuICAgIH0pO1xuICB9XG4gIFxuICBuZXh0KGVycm9yKTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdELE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDaEMsTUFBTTtFQUFFRTtBQUFtQixDQUFDLEdBQUdGLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQztBQUM5RCxNQUFNRyxNQUFNLEdBQUdKLE9BQU8sQ0FBQ0ssTUFBTSxDQUFDLENBQUM7O0FBRS9CO0FBQ0EsTUFBTUMsT0FBTyxHQUFHSixNQUFNLENBQUNLLGFBQWEsQ0FBQyxDQUFDOztBQUV0QztBQUNBLE1BQU1DLFVBQVUsR0FBR0EsQ0FBQ0MsR0FBRyxFQUFFQyxJQUFJLEVBQUVDLEVBQUUsS0FBSztFQUNwQyxJQUFJRCxJQUFJLENBQUNFLFFBQVEsQ0FBQ0MsVUFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFO0lBQ3RDRixFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztFQUNoQixDQUFDLE1BQU07SUFDTEEsRUFBRSxDQUFDLElBQUlHLEtBQUssQ0FBQywrQkFBK0IsQ0FBQyxFQUFFLEtBQUssQ0FBQztFQUN2RDtBQUNGLENBQUM7O0FBRUQ7QUFDQSxNQUFNQyxNQUFNLEdBQUdiLE1BQU0sQ0FBQztFQUNwQkksT0FBTyxFQUFFQSxPQUFPO0VBQ2hCRSxVQUFVLEVBQUVBLFVBQVU7RUFDdEJRLE1BQU0sRUFBRTtJQUNOQyxRQUFRLEVBQUUsQ0FBQyxHQUFHLElBQUksR0FBRyxJQUFJLENBQUU7RUFDN0I7QUFDRixDQUFDLENBQUM7O0FBRUY7QUFDQTtBQUNBO0FBQ0FiLE1BQU0sQ0FBQ2MsSUFBSSxDQUFDLFFBQVEsRUFBRUgsTUFBTSxDQUFDSSxNQUFN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","map":{"version":3,"names":["express","require","multer","uploadToCloudinary","router","Router","storage","memoryStorage","fileFilter","req","file","cb","mimetype","startsWith","Error","upload","limits","fileSize","post","single","res","status","json","success","message","result","buffer","folder","transformation","width","height","crop","quality","format","data","imageUrl","url","imagePublicId","publicId","error","console","delete","deleteFromCloudinary","params","use","next","MulterError","code","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["upload.js"],"sourcesContent":["const express = require('express');\nconst multer = require('multer');\nconst { uploadToCloudinary } = require('../config/cloudinary');\nconst router = express.Router();\n\n// Configure multer for memory storage\nconst storage = multer.memoryStorage();\n\n// File filter for images only\nconst fileFilter = (req, file, cb) => {\n  if (file.mimetype.startsWith('image/')) {\n    cb(null, true);\n  } else {\n    cb(new Error('Only image files are allowed!'), false);\n  }\n};\n\n// Configure multer\nconst upload = multer({\n  storage: storage,\n  fileFilter: fileFilter,\n  limits: {\n    fileSize: 5 * 1024 * 1024, // 5MB limit\n  },\n});\n\n// @route   POST /api/upload/image\n// @desc    Upload image to Cloudinary\n// @access  Public (can be made private later)\nrouter.post('/image', upload.single('image'), async (req, res) => {\n  try {\n    if (!req.file) {\n      return res.status(400).json({\n        success: false,\n        message: 'No image file provided'\n      });\n    }\n\n    // Upload to Cloudinary\n    const result = await uploadToCloudinary(req.file.buffer, {\n      folder: 'webcaffe/products',\n      transformation: [\n        { width: 800, height: 600, crop: 'fill', quality: 'auto' },\n        { format: 'webp' }\n      ]\n    });\n\n    res.json({\n      success: true,\n      data: {\n        imageUrl: result.url,\n        imagePublicId: result.publicId,\n        width: result.width,\n        height: result.height,\n        format: result.format\n      },\n      message: 'Image uploaded successfully'\n    });\n  } catch (error) {\n    console.error('Error uploading image:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Failed to upload image',\n      error: error.message\n    });\n  }\n});\n\n// @route   DELETE /api/upload/image/:publicId\n// @desc    Delete uploaded image from Cloudinary\n// @access  Private/Admin\nrouter.delete('/image/:publicId', async (req, res) => {\n  try {\n    const { deleteFromCloudinary } = require('../config/cloudinary');\n    const publicId = req.params.publicId;\n\n    // Delete from Cloudinary\n    const result = await deleteFromCloudinary(publicId);\n\n    if (result.result === 'ok') {\n      res.json({\n        success: true,\n        message: 'Image deleted successfully'\n      });\n    } else {\n      res.status(404).json({\n        success: false,\n        message: 'Image not found or already deleted'\n      });\n    }\n  } catch (error) {\n    console.error('Error deleting image:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while deleting image'\n    });\n  }\n});\n\n// Error handling middleware for multer\nrouter.use((error, req, res, next) => {\n  if (error instanceof multer.MulterError) {\n    if (error.code === 'LIMIT_FILE_SIZE') {\n      return res.status(400).json({\n        success: false,\n        message: 'File too large. Maximum size is 5MB.'\n      });\n    }\n  }\n  \n  if (error.message) {\n    return res.status(400).json({\n      success: false,\n      message: error.message\n    });\n  }\n  \n  next(error);\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1757433504901},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\config\\\\cloudinary.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const cloudinary = require('cloudinary').v2;\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET\n});\n\n// Upload image to Cloudinary\nconst uploadToCloudinary = (buffer, options = {}) => {\n  return new Promise((resolve, reject) => {\n    const uploadOptions = {\n      resource_type: 'image',\n      folder: 'webcaffe/products',\n      transformation: [{\n        width: 800,\n        height: 600,\n        crop: 'fill',\n        quality: 'auto'\n      }, {\n        format: 'webp'\n      }],\n      ...options\n    };\n    cloudinary.uploader.upload_stream(uploadOptions, (error, result) => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve({\n          url: result.secure_url,\n          publicId: result.public_id,\n          width: result.width,\n          height: result.height,\n          format: result.format\n        });\n      }\n    }).end(buffer);\n  });\n};\n\n// Delete image from Cloudinary\nconst deleteFromCloudinary = async publicId => {\n  try {\n    const result = await cloudinary.uploader.destroy(publicId);\n    return result;\n  } catch (error) {\n    console.error('Error deleting image from Cloudinary:', error);\n    throw error;\n  }\n};\nmodule.exports = {\n  cloudinary,\n  uploadToCloudinary,\n  deleteFromCloudinary\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjbG91ZGluYXJ5IiwicmVxdWlyZSIsInYyIiwiY29uZmlnIiwiY2xvdWRfbmFtZSIsInByb2Nlc3MiLCJlbnYiLCJDTE9VRElOQVJZX0NMT1VEX05BTUUiLCJhcGlfa2V5IiwiQ0xPVURJTkFSWV9BUElfS0VZIiwiYXBpX3NlY3JldCIsIkNMT1VESU5BUllfQVBJX1NFQ1JFVCIsInVwbG9hZFRvQ2xvdWRpbmFyeSIsImJ1ZmZlciIsIm9wdGlvbnMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInVwbG9hZE9wdGlvbnMiLCJyZXNvdXJjZV90eXBlIiwiZm9sZGVyIiwidHJhbnNmb3JtYXRpb24iLCJ3aWR0aCIsImhlaWdodCIsImNyb3AiLCJxdWFsaXR5IiwiZm9ybWF0IiwidXBsb2FkZXIiLCJ1cGxvYWRfc3RyZWFtIiwiZXJyb3IiLCJyZXN1bHQiLCJ1cmwiLCJzZWN1cmVfdXJsIiwicHVibGljSWQiLCJwdWJsaWNfaWQiLCJlbmQiLCJkZWxldGVGcm9tQ2xvdWRpbmFyeSIsImRlc3Ryb3kiLCJjb25zb2xlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXGNvbmZpZ1xcIiwic291cmNlcyI6WyJjbG91ZGluYXJ5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNsb3VkaW5hcnkgPSByZXF1aXJlKCdjbG91ZGluYXJ5JykudjI7XG5cbi8vIENvbmZpZ3VyZSBDbG91ZGluYXJ5XG5jbG91ZGluYXJ5LmNvbmZpZyh7XG4gIGNsb3VkX25hbWU6IHByb2Nlc3MuZW52LkNMT1VESU5BUllfQ0xPVURfTkFNRSxcbiAgYXBpX2tleTogcHJvY2Vzcy5lbnYuQ0xPVURJTkFSWV9BUElfS0VZLFxuICBhcGlfc2VjcmV0OiBwcm9jZXNzLmVudi5DTE9VRElOQVJZX0FQSV9TRUNSRVQsXG59KTtcblxuLy8gVXBsb2FkIGltYWdlIHRvIENsb3VkaW5hcnlcbmNvbnN0IHVwbG9hZFRvQ2xvdWRpbmFyeSA9IChidWZmZXIsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IHVwbG9hZE9wdGlvbnMgPSB7XG4gICAgICByZXNvdXJjZV90eXBlOiAnaW1hZ2UnLFxuICAgICAgZm9sZGVyOiAnd2ViY2FmZmUvcHJvZHVjdHMnLFxuICAgICAgdHJhbnNmb3JtYXRpb246IFtcbiAgICAgICAgeyB3aWR0aDogODAwLCBoZWlnaHQ6IDYwMCwgY3JvcDogJ2ZpbGwnLCBxdWFsaXR5OiAnYXV0bycgfSxcbiAgICAgICAgeyBmb3JtYXQ6ICd3ZWJwJyB9XG4gICAgICBdLFxuICAgICAgLi4ub3B0aW9uc1xuICAgIH07XG5cbiAgICBjbG91ZGluYXJ5LnVwbG9hZGVyLnVwbG9hZF9zdHJlYW0oXG4gICAgICB1cGxvYWRPcHRpb25zLFxuICAgICAgKGVycm9yLCByZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgIHVybDogcmVzdWx0LnNlY3VyZV91cmwsXG4gICAgICAgICAgICBwdWJsaWNJZDogcmVzdWx0LnB1YmxpY19pZCxcbiAgICAgICAgICAgIHdpZHRoOiByZXN1bHQud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHJlc3VsdC5oZWlnaHQsXG4gICAgICAgICAgICBmb3JtYXQ6IHJlc3VsdC5mb3JtYXRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICkuZW5kKGJ1ZmZlcik7XG4gIH0pO1xufTtcblxuLy8gRGVsZXRlIGltYWdlIGZyb20gQ2xvdWRpbmFyeVxuY29uc3QgZGVsZXRlRnJvbUNsb3VkaW5hcnkgPSBhc3luYyAocHVibGljSWQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbG91ZGluYXJ5LnVwbG9hZGVyLmRlc3Ryb3kocHVibGljSWQpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgaW1hZ2UgZnJvbSBDbG91ZGluYXJ5OicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGNsb3VkaW5hcnksXG4gIHVwbG9hZFRvQ2xvdWRpbmFyeSxcbiAgZGVsZXRlRnJvbUNsb3VkaW5hcnlcbn07Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxVQUFVLEdBQUdDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQ0MsRUFBRTs7QUFFM0M7QUFDQUYsVUFBVSxDQUFDRyxNQUFNLENBQUM7RUFDaEJDLFVBQVUsRUFBRUMsT0FBTyxDQUFDQyxHQUFHLENBQUNDLHFCQUFxQjtFQUM3Q0MsT0FBTyxFQUFFSCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0csa0JBQWtCO0VBQ3ZDQyxVQUFVLEVBQUVMLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDSztBQUMxQixDQUFDLENBQUM7O0FBRUY7QUFDQSxNQUFNQyxrQkFBa0IsR0FBR0EsQ0FBQ0MsTUFBTSxFQUFFQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLEtBQUs7RUFDbkQsT0FBTyxJQUFJQyxPQUFPLENBQUMsQ0FBQ0MsT0FBTyxFQUFFQyxNQUFNLEtBQUs7SUFDdEMsTUFBTUMsYUFBYSxHQUFHO01BQ3BCQyxhQUFhLEVBQUUsT0FBTztNQUN0QkMsTUFBTSxFQUFFLG1CQUFtQjtNQUMzQkMsY0FBYyxFQUFFLENBQ2Q7UUFBRUMsS0FBSyxFQUFFLEdBQUc7UUFBRUMsTUFBTSxFQUFFLEdBQUc7UUFBRUMsSUFBSSxFQUFFLE1BQU07UUFBRUMsT0FBTyxFQUFFO01BQU8sQ0FBQyxFQUMxRDtRQUFFQyxNQUFNLEVBQUU7TUFBTyxDQUFDLENBQ25CO01BQ0QsR0FBR1o7SUFDTCxDQUFDO0lBRURkLFVBQVUsQ0FBQzJCLFFBQVEsQ0FBQ0MsYUFBYSxDQUMvQlYsYUFBYSxFQUNiLENBQUNXLEtBQUssRUFBRUMsTUFBTSxLQUFLO01BQ2pCLElBQUlELEtBQUssRUFBRTtRQUNUWixNQUFNLENBQUNZLEtBQUssQ0FBQztNQUNmLENBQUMsTUFBTTtRQUNMYixPQUFPLENBQUM7VUFDTmUsR0FBRyxFQUFFRCxNQUFNLENBQUNFLFVBQVU7VUFDdEJDLFFBQVEsRUFBRUgsTUFBTSxDQUFDSSxTQUFTO1VBQzFCWixLQUFLLEVBQUVRLE1BQU0sQ0FBQ1IsS0FBSztVQUNuQkMsTUFBTSxFQUFFTyxNQUFNLENBQUNQLE1BQU07VUFDckJHLE1BQU0sRUFBRUksTUFBTSxDQUFDSjtRQUNqQixDQUFDLENBQUM7TUFDSjtJQUNGLENBQ0YsQ0FBQyxDQUFDUyxHQUFHLENBQUN0QixNQUFNLENBQUM7RUFDZixDQUFDLENBQUM7QUFDSixDQUFDOztBQUVEO0FBQ0EsTUFBTXVCLG9CQUFvQixHQUFHLE1BQU9ILFFBQVEsSUFBSztFQUMvQyxJQUFJO0lBQ0YsTUFBTUgsTUFBTSxHQUFHLE1BQU05QixVQUFVLENBQUMyQixRQUFRLENBQUNVLE9BQU8sQ0FBQ0osUUFBUSxDQUFDO0lBQzFELE9BQU9ILE1BQU07RUFDZixDQUFDLENBQUMsT0FBT0QsS0FBSyxFQUFFO0lBQ2RTLE9BQU8sQ0FBQ1QsS0FBSyxDQUFDLHVDQUF1QyxFQUFFQSxLQUFLLENBQUM7SUFDN0QsTUFBTUEsS0FBSztFQUNiO0FBQ0YsQ0FBQztBQUVEVSxNQUFNLENBQUNDLE9BQU8sR0FBRztFQUNmeEMsVUFBVTtFQUNWWSxrQkFBa0I7RUFDbEJ3QjtBQUNGLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=","map":{"version":3,"names":["cloudinary","require","v2","config","cloud_name","process","env","CLOUDINARY_CLOUD_NAME","api_key","CLOUDINARY_API_KEY","api_secret","CLOUDINARY_API_SECRET","uploadToCloudinary","buffer","options","Promise","resolve","reject","uploadOptions","resource_type","folder","transformation","width","height","crop","quality","format","uploader","upload_stream","error","result","url","secure_url","publicId","public_id","end","deleteFromCloudinary","destroy","console","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\config\\","sources":["cloudinary.js"],"sourcesContent":["const cloudinary = require('cloudinary').v2;\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\n// Upload image to Cloudinary\nconst uploadToCloudinary = (buffer, options = {}) => {\n  return new Promise((resolve, reject) => {\n    const uploadOptions = {\n      resource_type: 'image',\n      folder: 'webcaffe/products',\n      transformation: [\n        { width: 800, height: 600, crop: 'fill', quality: 'auto' },\n        { format: 'webp' }\n      ],\n      ...options\n    };\n\n    cloudinary.uploader.upload_stream(\n      uploadOptions,\n      (error, result) => {\n        if (error) {\n          reject(error);\n        } else {\n          resolve({\n            url: result.secure_url,\n            publicId: result.public_id,\n            width: result.width,\n            height: result.height,\n            format: result.format\n          });\n        }\n      }\n    ).end(buffer);\n  });\n};\n\n// Delete image from Cloudinary\nconst deleteFromCloudinary = async (publicId) => {\n  try {\n    const result = await cloudinary.uploader.destroy(publicId);\n    return result;\n  } catch (error) {\n    console.error('Error deleting image from Cloudinary:', error);\n    throw error;\n  }\n};\n\nmodule.exports = {\n  cloudinary,\n  uploadToCloudinary,\n  deleteFromCloudinary\n};"],"mappings":"AAAA,MAAMA,UAAU,GAAGC,OAAO,CAAC,YAAY,CAAC,CAACC,EAAE;;AAE3C;AACAF,UAAU,CAACG,MAAM,CAAC;EAChBC,UAAU,EAAEC,OAAO,CAACC,GAAG,CAACC,qBAAqB;EAC7CC,OAAO,EAAEH,OAAO,CAACC,GAAG,CAACG,kBAAkB;EACvCC,UAAU,EAAEL,OAAO,CAACC,GAAG,CAACK;AAC1B,CAAC,CAAC;;AAEF;AACA,MAAMC,kBAAkB,GAAGA,CAACC,MAAM,EAAEC,OAAO,GAAG,CAAC,CAAC,KAAK;EACnD,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACtC,MAAMC,aAAa,GAAG;MACpBC,aAAa,EAAE,OAAO;MACtBC,MAAM,EAAE,mBAAmB;MAC3BC,cAAc,EAAE,CACd;QAAEC,KAAK,EAAE,GAAG;QAAEC,MAAM,EAAE,GAAG;QAAEC,IAAI,EAAE,MAAM;QAAEC,OAAO,EAAE;MAAO,CAAC,EAC1D;QAAEC,MAAM,EAAE;MAAO,CAAC,CACnB;MACD,GAAGZ;IACL,CAAC;IAEDd,UAAU,CAAC2B,QAAQ,CAACC,aAAa,CAC/BV,aAAa,EACb,CAACW,KAAK,EAAEC,MAAM,KAAK;MACjB,IAAID,KAAK,EAAE;QACTZ,MAAM,CAACY,KAAK,CAAC;MACf,CAAC,MAAM;QACLb,OAAO,CAAC;UACNe,GAAG,EAAED,MAAM,CAACE,UAAU;UACtBC,QAAQ,EAAEH,MAAM,CAACI,SAAS;UAC1BZ,KAAK,EAAEQ,MAAM,CAACR,KAAK;UACnBC,MAAM,EAAEO,MAAM,CAACP,MAAM;UACrBG,MAAM,EAAEI,MAAM,CAACJ;QACjB,CAAC,CAAC;MACJ;IACF,CACF,CAAC,CAACS,GAAG,CAACtB,MAAM,CAAC;EACf,CAAC,CAAC;AACJ,CAAC;;AAED;AACA,MAAMuB,oBAAoB,GAAG,MAAOH,QAAQ,IAAK;EAC/C,IAAI;IACF,MAAMH,MAAM,GAAG,MAAM9B,UAAU,CAAC2B,QAAQ,CAACU,OAAO,CAACJ,QAAQ,CAAC;IAC1D,OAAOH,MAAM;EACf,CAAC,CAAC,OAAOD,KAAK,EAAE;IACdS,OAAO,CAACT,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;IAC7D,MAAMA,KAAK;EACb;AACF,CAAC;AAEDU,MAAM,CAACC,OAAO,GAAG;EACfxC,UAAU;EACVY,kBAAkB;EAClBwB;AACF,CAAC","ignoreList":[]}},"mtime":1757349245117},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\admin.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect,\n  authorize\n} = require('../middleware/auth');\nconst User = require('../models/User');\nconst Product = require('../models/Product');\nconst Order = require('../models/Order');\nconst mongoose = require('mongoose');\n\n// Dashboard statistics\n// @route   GET /api/admin/dashboard/stats\n// @desc    Get dashboard statistics for admin\n// @access  Private (Admin only)\nrouter.get('/dashboard/stats', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get total products count\n    const totalProducts = await Product.countDocuments();\n\n    // Get total orders count\n    const totalOrders = await Order.countDocuments();\n\n    // Get total customers count (users with customer role)\n    const totalCustomers = await User.countDocuments({\n      role: 'customer'\n    });\n\n    // Get total revenue from completed orders\n    const revenueResult = await Order.aggregate([{\n      $match: {\n        status: {\n          $in: ['completed', 'ready']\n        },\n        paymentStatus: 'paid'\n      }\n    }, {\n      $group: {\n        _id: null,\n        totalRevenue: {\n          $sum: '$total'\n        }\n      }\n    }]);\n    const totalRevenue = revenueResult.length > 0 ? revenueResult[0].totalRevenue : 0;\n    res.json({\n      success: true,\n      data: {\n        totalProducts,\n        totalOrders,\n        totalCustomers,\n        totalRevenue\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching dashboard stats:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching dashboard statistics'\n    });\n  }\n});\n\n// @route   GET /api/admin/revenue/total\n// @desc    Get detailed total revenue calculation from completed orders\n// @access  Private (Admin only)\nrouter.get('/revenue/total', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get detailed revenue breakdown from completed orders\n    const revenueBreakdown = await Order.aggregate([{\n      $match: {\n        status: {\n          $in: ['completed', 'ready']\n        },\n        paymentStatus: 'paid'\n      }\n    }, {\n      $group: {\n        _id: null,\n        totalRevenue: {\n          $sum: '$total'\n        },\n        totalSubtotal: {\n          $sum: '$subtotal'\n        },\n        totalTax: {\n          $sum: '$tax'\n        },\n        totalDiscount: {\n          $sum: '$discount'\n        },\n        orderCount: {\n          $sum: 1\n        },\n        averageOrderValue: {\n          $avg: '$total'\n        }\n      }\n    }]);\n\n    // Get revenue by payment method\n    const revenueByPaymentMethod = await Order.aggregate([{\n      $match: {\n        status: {\n          $in: ['completed', 'ready']\n        },\n        paymentStatus: 'paid'\n      }\n    }, {\n      $group: {\n        _id: '$paymentMethod',\n        revenue: {\n          $sum: '$total'\n        },\n        orderCount: {\n          $sum: 1\n        }\n      }\n    }, {\n      $sort: {\n        revenue: -1\n      }\n    }]);\n\n    // Get revenue by order type\n    const revenueByOrderType = await Order.aggregate([{\n      $match: {\n        status: {\n          $in: ['completed', 'ready']\n        },\n        paymentStatus: 'paid'\n      }\n    }, {\n      $group: {\n        _id: '$orderType',\n        revenue: {\n          $sum: '$total'\n        },\n        orderCount: {\n          $sum: 1\n        }\n      }\n    }, {\n      $sort: {\n        revenue: -1\n      }\n    }]);\n\n    // Get all completed orders for verification\n    const completedOrders = await Order.find({\n      status: {\n        $in: ['completed', 'ready']\n      },\n      paymentStatus: 'paid'\n    }).select('orderNumber total status paymentStatus createdAt paymentMethod orderType');\n    const breakdown = revenueBreakdown[0] || {\n      totalRevenue: 0,\n      totalSubtotal: 0,\n      totalTax: 0,\n      totalDiscount: 0,\n      orderCount: 0,\n      averageOrderValue: 0\n    };\n    res.json({\n      success: true,\n      data: {\n        summary: {\n          totalRevenue: breakdown.totalRevenue,\n          totalSubtotal: breakdown.totalSubtotal,\n          totalTax: breakdown.totalTax,\n          totalDiscount: breakdown.totalDiscount,\n          completedOrderCount: breakdown.orderCount,\n          averageOrderValue: breakdown.averageOrderValue\n        },\n        breakdown: {\n          byPaymentMethod: revenueByPaymentMethod,\n          byOrderType: revenueByOrderType\n        },\n        completedOrders: completedOrders.map(order => ({\n          orderNumber: order.orderNumber,\n          total: order.total,\n          status: order.status,\n          paymentStatus: order.paymentStatus,\n          paymentMethod: order.paymentMethod,\n          orderType: order.orderType,\n          createdAt: order.createdAt\n        }))\n      },\n      message: `Total revenue calculated from ${breakdown.orderCount} completed orders`\n    });\n  } catch (error) {\n    console.error('Error calculating total revenue:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while calculating total revenue'\n    });\n  }\n});\n\n// @route   GET /api/admin/dashboard/recent-orders\n// @desc    Get recent orders for admin dashboard\n// @access  Private (Admin only)\nrouter.get('/dashboard/recent-orders', protect, authorize('admin'), async (req, res) => {\n  try {\n    const limit = parseInt(req.query.limit) || 5;\n    const recentOrders = await Order.find().populate('customer', 'firstName lastName email phone address').sort({\n      createdAt: -1\n    }).limit(limit).select('orderNumber customer total status createdAt');\n\n    // Format the response\n    const formattedOrders = recentOrders.map(order => ({\n      _id: order._id,\n      orderNumber: order.orderNumber,\n      customer: order.customer,\n      customerName: order.customer ? `${order.customer.firstName} ${order.customer.lastName}` : 'Unknown Customer',\n      customerEmail: order.customer ? order.customer.email : '',\n      total: order.total,\n      status: order.status,\n      createdAt: order.createdAt\n    }));\n    res.json({\n      success: true,\n      data: formattedOrders\n    });\n  } catch (error) {\n    console.error('Error fetching recent orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching recent orders'\n    });\n  }\n});\n\n// @route   GET /api/admin/dashboard/analytics\n// @desc    Get detailed analytics for admin dashboard\n// @access  Private (Admin only)\nrouter.get('/dashboard/analytics', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get orders by status\n    const ordersByStatus = await Order.aggregate([{\n      $group: {\n        _id: '$status',\n        count: {\n          $sum: 1\n        }\n      }\n    }]);\n\n    // Get revenue by month (last 6 months)\n    const sixMonthsAgo = new Date();\n    sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\n    const revenueByMonth = await Order.aggregate([{\n      $match: {\n        createdAt: {\n          $gte: sixMonthsAgo\n        },\n        status: {\n          $in: ['completed', 'ready']\n        },\n        paymentStatus: 'paid'\n      }\n    }, {\n      $group: {\n        _id: {\n          year: {\n            $year: '$createdAt'\n          },\n          month: {\n            $month: '$createdAt'\n          }\n        },\n        revenue: {\n          $sum: '$total'\n        },\n        orderCount: {\n          $sum: 1\n        }\n      }\n    }, {\n      $sort: {\n        '_id.year': 1,\n        '_id.month': 1\n      }\n    }]);\n\n    // Get top selling products\n    const topProducts = await Order.aggregate([{\n      $unwind: '$items'\n    }, {\n      $group: {\n        _id: '$items.product',\n        name: {\n          $first: '$items.name'\n        },\n        totalSold: {\n          $sum: '$items.quantity'\n        },\n        totalRevenue: {\n          $sum: {\n            $multiply: ['$items.price', '$items.quantity']\n          }\n        }\n      }\n    }, {\n      $sort: {\n        totalSold: -1\n      }\n    }, {\n      $limit: 5\n    }]);\n\n    // Get customer growth (new customers per month)\n    const customerGrowth = await User.aggregate([{\n      $match: {\n        role: 'customer',\n        createdAt: {\n          $gte: sixMonthsAgo\n        }\n      }\n    }, {\n      $group: {\n        _id: {\n          year: {\n            $year: '$createdAt'\n          },\n          month: {\n            $month: '$createdAt'\n          }\n        },\n        newCustomers: {\n          $sum: 1\n        }\n      }\n    }, {\n      $sort: {\n        '_id.year': 1,\n        '_id.month': 1\n      }\n    }]);\n    res.json({\n      success: true,\n      data: {\n        ordersByStatus: ordersByStatus.reduce((acc, item) => {\n          acc[item._id] = item.count;\n          return acc;\n        }, {}),\n        revenueByMonth,\n        topProducts,\n        customerGrowth\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching analytics:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching analytics'\n    });\n  }\n});\nrouter.get('/orders', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = {};\n    if (status && status !== 'all') {\n      filter.status = status;\n    }\n    if (search) {\n      filter.$or = [{\n        orderNumber: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        'customer.firstName': {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        'customer.lastName': {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        'customer.email': {\n          $regex: search,\n          $options: 'i'\n        }\n      }];\n    }\n    const skip = (page - 1) * limit;\n    const orders = await Order.find(filter).populate('customer', 'firstName lastName email phone address').sort({\n      [sortBy]: sortOrder\n    }).skip(skip).limit(limit);\n    const totalOrders = await Order.countDocuments(filter);\n    const totalPages = Math.ceil(totalOrders / limit);\n    res.json({\n      success: true,\n      data: {\n        orders,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalOrders,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching orders'\n    });\n  }\n});\n\n// @route   GET /api/admin/orders/:id\n// @desc    Get single order details\n// @access  Private (Admin only)\nrouter.get('/orders/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const order = await Order.findById(req.params.id).populate('customer', 'firstName lastName email phone address');\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: order\n    });\n  } catch (error) {\n    console.error('Error fetching order details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order details'\n    });\n  }\n});\n\n// @route   PUT /api/admin/orders/:id/status\n// @desc    Update order status\n// @access  Private (Admin only)\nrouter.put('/orders/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const {\n      status\n    } = req.body;\n    const validStatuses = ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'];\n    if (!validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order status'\n      });\n    }\n    const order = await Order.findById(req.params.id);\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n    order.status = status;\n    order.updatedAt = new Date();\n    await order.save();\n    res.json({\n      success: true,\n      message: 'Order status updated successfully',\n      data: order\n    });\n  } catch (error) {\n    console.error('Error updating order status:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating order status'\n    });\n  }\n});\n\n// Customer Management Routes\n\n// @route   GET /api/admin/customers\n// @desc    Get all customers with filtering and pagination\n// @access  Private (Admin only)\nrouter.get('/customers', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = {\n      role: 'customer'\n    };\n    if (search) {\n      filter.$or = [{\n        firstName: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        lastName: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        email: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        phone: {\n          $regex: search,\n          $options: 'i'\n        }\n      }];\n    }\n    const skip = (page - 1) * limit;\n    const customers = await User.find(filter).select('-password').sort({\n      [sortBy]: sortOrder\n    }).skip(skip).limit(limit);\n\n    // Get order statistics for each customer\n    const customersWithStats = await Promise.all(customers.map(async customer => {\n      const orderStats = await Order.aggregate([{\n        $match: {\n          customer: customer._id\n        }\n      }, {\n        $group: {\n          _id: null,\n          totalOrders: {\n            $sum: 1\n          },\n          totalSpent: {\n            $sum: '$total'\n          },\n          lastOrderDate: {\n            $max: '$createdAt'\n          }\n        }\n      }]);\n      return {\n        ...customer.toObject(),\n        orderStats: orderStats[0] || {\n          totalOrders: 0,\n          totalSpent: 0,\n          lastOrderDate: null\n        }\n      };\n    }));\n    const totalCustomers = await User.countDocuments(filter);\n    const totalPages = Math.ceil(totalCustomers / limit);\n    res.json({\n      success: true,\n      data: {\n        customers: customersWithStats,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalCustomers,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching customers:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching customers'\n    });\n  }\n});\n\n// @route   GET /api/admin/customers/:id\n// @desc    Get single customer details with order history\n// @access  Private (Admin only)\nrouter.get('/customers/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const customer = await User.findById(req.params.id).select('-password');\n    if (!customer || customer.role !== 'customer') {\n      return res.status(404).json({\n        success: false,\n        message: 'Customer not found'\n      });\n    }\n\n    // Get customer's order history\n    const orders = await Order.find({\n      customer: req.params.id\n    }).sort({\n      createdAt: -1\n    }).limit(10);\n\n    // Get customer statistics\n    const stats = await Order.aggregate([{\n      $match: {\n        customer: mongoose.Types.ObjectId(req.params.id)\n      }\n    }, {\n      $group: {\n        _id: null,\n        totalOrders: {\n          $sum: 1\n        },\n        totalSpent: {\n          $sum: '$total'\n        },\n        averageOrderValue: {\n          $avg: '$total'\n        },\n        lastOrderDate: {\n          $max: '$createdAt'\n        },\n        firstOrderDate: {\n          $min: '$createdAt'\n        }\n      }\n    }]);\n    res.json({\n      success: true,\n      data: {\n        customer,\n        orders,\n        stats: stats[0] || {\n          totalOrders: 0,\n          totalSpent: 0,\n          averageOrderValue: 0,\n          lastOrderDate: null,\n          firstOrderDate: null\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching customer details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching customer details'\n    });\n  }\n});\n\n// Contact Management Routes\n\n// @route   GET /api/admin/contacts\n// @desc    Get all contact messages with filtering and pagination\n// @access  Private (Admin only)\nrouter.get('/contacts', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = {};\n    if (status && status !== 'all') {\n      filter.status = status;\n    }\n    if (search) {\n      filter.$or = [{\n        name: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        email: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        subject: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        ticketId: {\n          $regex: search,\n          $options: 'i'\n        }\n      }];\n    }\n    const skip = (page - 1) * limit;\n    const contacts = await Contact.find(filter).sort({\n      [sortBy]: sortOrder\n    }).skip(skip).limit(limit);\n    const totalContacts = await Contact.countDocuments(filter);\n    const totalPages = Math.ceil(totalContacts / limit);\n    res.json({\n      success: true,\n      data: {\n        contacts,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalContacts,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching contacts:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching contacts'\n    });\n  }\n});\n\n// @route   GET /api/admin/contacts/:id\n// @desc    Get single contact message details\n// @access  Private (Admin only)\nrouter.get('/contacts/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const contact = await Contact.findById(req.params.id);\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Error fetching contact details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching contact details'\n    });\n  }\n});\n\n// @route   PUT /api/admin/contacts/:id/status\n// @desc    Update contact message status\n// @access  Private (Admin only)\nrouter.put('/contacts/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const {\n      status\n    } = req.body;\n\n    // Validate status\n    const validStatuses = ['new', 'read', 'replied', 'closed'];\n    if (!validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid status. Must be one of: new, read, replied, closed'\n      });\n    }\n    const contact = await Contact.findByIdAndUpdate(req.params.id, {\n      status,\n      updatedAt: new Date()\n    }, {\n      new: true,\n      runValidators: true\n    });\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: contact,\n      message: 'Contact status updated successfully'\n    });\n  } catch (error) {\n    console.error('Error updating contact status:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating contact status'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJhdXRob3JpemUiLCJVc2VyIiwiUHJvZHVjdCIsIk9yZGVyIiwibW9uZ29vc2UiLCJnZXQiLCJyZXEiLCJyZXMiLCJ0b3RhbFByb2R1Y3RzIiwiY291bnREb2N1bWVudHMiLCJ0b3RhbE9yZGVycyIsInRvdGFsQ3VzdG9tZXJzIiwicm9sZSIsInJldmVudWVSZXN1bHQiLCJhZ2dyZWdhdGUiLCIkbWF0Y2giLCJzdGF0dXMiLCIkaW4iLCJwYXltZW50U3RhdHVzIiwiJGdyb3VwIiwiX2lkIiwidG90YWxSZXZlbnVlIiwiJHN1bSIsImxlbmd0aCIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsImVycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJyZXZlbnVlQnJlYWtkb3duIiwidG90YWxTdWJ0b3RhbCIsInRvdGFsVGF4IiwidG90YWxEaXNjb3VudCIsIm9yZGVyQ291bnQiLCJhdmVyYWdlT3JkZXJWYWx1ZSIsIiRhdmciLCJyZXZlbnVlQnlQYXltZW50TWV0aG9kIiwicmV2ZW51ZSIsIiRzb3J0IiwicmV2ZW51ZUJ5T3JkZXJUeXBlIiwiY29tcGxldGVkT3JkZXJzIiwiZmluZCIsInNlbGVjdCIsImJyZWFrZG93biIsInN1bW1hcnkiLCJjb21wbGV0ZWRPcmRlckNvdW50IiwiYnlQYXltZW50TWV0aG9kIiwiYnlPcmRlclR5cGUiLCJtYXAiLCJvcmRlciIsIm9yZGVyTnVtYmVyIiwidG90YWwiLCJwYXltZW50TWV0aG9kIiwib3JkZXJUeXBlIiwiY3JlYXRlZEF0IiwibGltaXQiLCJwYXJzZUludCIsInF1ZXJ5IiwicmVjZW50T3JkZXJzIiwicG9wdWxhdGUiLCJzb3J0IiwiZm9ybWF0dGVkT3JkZXJzIiwiY3VzdG9tZXIiLCJjdXN0b21lck5hbWUiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsImN1c3RvbWVyRW1haWwiLCJlbWFpbCIsIm9yZGVyc0J5U3RhdHVzIiwiY291bnQiLCJzaXhNb250aHNBZ28iLCJEYXRlIiwic2V0TW9udGgiLCJnZXRNb250aCIsInJldmVudWVCeU1vbnRoIiwiJGd0ZSIsInllYXIiLCIkeWVhciIsIm1vbnRoIiwiJG1vbnRoIiwidG9wUHJvZHVjdHMiLCIkdW53aW5kIiwibmFtZSIsIiRmaXJzdCIsInRvdGFsU29sZCIsIiRtdWx0aXBseSIsIiRsaW1pdCIsImN1c3RvbWVyR3Jvd3RoIiwibmV3Q3VzdG9tZXJzIiwicmVkdWNlIiwiYWNjIiwiaXRlbSIsInBhZ2UiLCJzZWFyY2giLCJzb3J0QnkiLCJzb3J0T3JkZXIiLCJmaWx0ZXIiLCIkb3IiLCIkcmVnZXgiLCIkb3B0aW9ucyIsInNraXAiLCJvcmRlcnMiLCJ0b3RhbFBhZ2VzIiwiTWF0aCIsImNlaWwiLCJwYWdpbmF0aW9uIiwiY3VycmVudFBhZ2UiLCJoYXNOZXh0IiwiaGFzUHJldiIsImZpbmRCeUlkIiwicGFyYW1zIiwiaWQiLCJwdXQiLCJib2R5IiwidmFsaWRTdGF0dXNlcyIsImluY2x1ZGVzIiwidXBkYXRlZEF0Iiwic2F2ZSIsInBob25lIiwiY3VzdG9tZXJzIiwiY3VzdG9tZXJzV2l0aFN0YXRzIiwiUHJvbWlzZSIsImFsbCIsIm9yZGVyU3RhdHMiLCJ0b3RhbFNwZW50IiwibGFzdE9yZGVyRGF0ZSIsIiRtYXgiLCJ0b09iamVjdCIsInN0YXRzIiwiVHlwZXMiLCJPYmplY3RJZCIsImZpcnN0T3JkZXJEYXRlIiwiJG1pbiIsIkNvbnRhY3QiLCJzdWJqZWN0IiwidGlja2V0SWQiLCJjb250YWN0cyIsInRvdGFsQ29udGFjdHMiLCJjb250YWN0IiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJuZXciLCJydW5WYWxpZGF0b3JzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXHJvdXRlc1xcIiwic291cmNlcyI6WyJhZG1pbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcbmNvbnN0IHsgcHJvdGVjdCwgYXV0aG9yaXplIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xuY29uc3QgUHJvZHVjdCA9IHJlcXVpcmUoJy4uL21vZGVscy9Qcm9kdWN0Jyk7XG5jb25zdCBPcmRlciA9IHJlcXVpcmUoJy4uL21vZGVscy9PcmRlcicpO1xuY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuXG4vLyBEYXNoYm9hcmQgc3RhdGlzdGljc1xuLy8gQHJvdXRlICAgR0VUIC9hcGkvYWRtaW4vZGFzaGJvYXJkL3N0YXRzXG4vLyBAZGVzYyAgICBHZXQgZGFzaGJvYXJkIHN0YXRpc3RpY3MgZm9yIGFkbWluXG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbiBvbmx5KVxucm91dGVyLmdldCgnL2Rhc2hib2FyZC9zdGF0cycsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgLy8gR2V0IHRvdGFsIHByb2R1Y3RzIGNvdW50XG4gICAgY29uc3QgdG90YWxQcm9kdWN0cyA9IGF3YWl0IFByb2R1Y3QuY291bnREb2N1bWVudHMoKTtcblxuICAgIC8vIEdldCB0b3RhbCBvcmRlcnMgY291bnRcbiAgICBjb25zdCB0b3RhbE9yZGVycyA9IGF3YWl0IE9yZGVyLmNvdW50RG9jdW1lbnRzKCk7XG5cbiAgICAvLyBHZXQgdG90YWwgY3VzdG9tZXJzIGNvdW50ICh1c2VycyB3aXRoIGN1c3RvbWVyIHJvbGUpXG4gICAgY29uc3QgdG90YWxDdXN0b21lcnMgPSBhd2FpdCBVc2VyLmNvdW50RG9jdW1lbnRzKHsgcm9sZTogJ2N1c3RvbWVyJyB9KTtcblxuICAgIC8vIEdldCB0b3RhbCByZXZlbnVlIGZyb20gY29tcGxldGVkIG9yZGVyc1xuICAgIGNvbnN0IHJldmVudWVSZXN1bHQgPSBhd2FpdCBPcmRlci5hZ2dyZWdhdGUoW1xuICAgICAge1xuICAgICAgICAkbWF0Y2g6IHtcbiAgICAgICAgICBzdGF0dXM6IHsgJGluOiBbJ2NvbXBsZXRlZCcsICdyZWFkeSddIH0sXG4gICAgICAgICAgcGF5bWVudFN0YXR1czogJ3BhaWQnXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgICRncm91cDoge1xuICAgICAgICAgIF9pZDogbnVsbCxcbiAgICAgICAgICB0b3RhbFJldmVudWU6IHsgJHN1bTogJyR0b3RhbCcgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgXSk7XG5cbiAgICBjb25zdCB0b3RhbFJldmVudWUgPSByZXZlbnVlUmVzdWx0Lmxlbmd0aCA+IDAgPyByZXZlbnVlUmVzdWx0WzBdLnRvdGFsUmV2ZW51ZSA6IDA7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICB0b3RhbFByb2R1Y3RzLFxuICAgICAgICB0b3RhbE9yZGVycyxcbiAgICAgICAgdG90YWxDdXN0b21lcnMsXG4gICAgICAgIHRvdGFsUmV2ZW51ZVxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGRhc2hib2FyZCBzdGF0czonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIGRhc2hib2FyZCBzdGF0aXN0aWNzJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvYWRtaW4vcmV2ZW51ZS90b3RhbFxuLy8gQGRlc2MgICAgR2V0IGRldGFpbGVkIHRvdGFsIHJldmVudWUgY2FsY3VsYXRpb24gZnJvbSBjb21wbGV0ZWQgb3JkZXJzXG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbiBvbmx5KVxucm91dGVyLmdldCgnL3JldmVudWUvdG90YWwnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIC8vIEdldCBkZXRhaWxlZCByZXZlbnVlIGJyZWFrZG93biBmcm9tIGNvbXBsZXRlZCBvcmRlcnNcbiAgICBjb25zdCByZXZlbnVlQnJlYWtkb3duID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHtcbiAgICAgICAgJG1hdGNoOiB7XG4gICAgICAgICAgc3RhdHVzOiB7ICRpbjogWydjb21wbGV0ZWQnLCAncmVhZHknXSB9LFxuICAgICAgICAgIHBheW1lbnRTdGF0dXM6ICdwYWlkJ1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkZ3JvdXA6IHtcbiAgICAgICAgICBfaWQ6IG51bGwsXG4gICAgICAgICAgdG90YWxSZXZlbnVlOiB7ICRzdW06ICckdG90YWwnIH0sXG4gICAgICAgICAgdG90YWxTdWJ0b3RhbDogeyAkc3VtOiAnJHN1YnRvdGFsJyB9LFxuICAgICAgICAgIHRvdGFsVGF4OiB7ICRzdW06ICckdGF4JyB9LFxuICAgICAgICAgIHRvdGFsRGlzY291bnQ6IHsgJHN1bTogJyRkaXNjb3VudCcgfSxcbiAgICAgICAgICBvcmRlckNvdW50OiB7ICRzdW06IDEgfSxcbiAgICAgICAgICBhdmVyYWdlT3JkZXJWYWx1ZTogeyAkYXZnOiAnJHRvdGFsJyB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBdKTtcblxuICAgIC8vIEdldCByZXZlbnVlIGJ5IHBheW1lbnQgbWV0aG9kXG4gICAgY29uc3QgcmV2ZW51ZUJ5UGF5bWVudE1ldGhvZCA9IGF3YWl0IE9yZGVyLmFnZ3JlZ2F0ZShbXG4gICAgICB7XG4gICAgICAgICRtYXRjaDoge1xuICAgICAgICAgIHN0YXR1czogeyAkaW46IFsnY29tcGxldGVkJywgJ3JlYWR5J10gfSxcbiAgICAgICAgICBwYXltZW50U3RhdHVzOiAncGFpZCdcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJGdyb3VwOiB7XG4gICAgICAgICAgX2lkOiAnJHBheW1lbnRNZXRob2QnLFxuICAgICAgICAgIHJldmVudWU6IHsgJHN1bTogJyR0b3RhbCcgfSxcbiAgICAgICAgICBvcmRlckNvdW50OiB7ICRzdW06IDEgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkc29ydDogeyByZXZlbnVlOiAtMSB9XG4gICAgICB9XG4gICAgXSk7XG5cbiAgICAvLyBHZXQgcmV2ZW51ZSBieSBvcmRlciB0eXBlXG4gICAgY29uc3QgcmV2ZW51ZUJ5T3JkZXJUeXBlID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHtcbiAgICAgICAgJG1hdGNoOiB7XG4gICAgICAgICAgc3RhdHVzOiB7ICRpbjogWydjb21wbGV0ZWQnLCAncmVhZHknXSB9LFxuICAgICAgICAgIHBheW1lbnRTdGF0dXM6ICdwYWlkJ1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkZ3JvdXA6IHtcbiAgICAgICAgICBfaWQ6ICckb3JkZXJUeXBlJyxcbiAgICAgICAgICByZXZlbnVlOiB7ICRzdW06ICckdG90YWwnIH0sXG4gICAgICAgICAgb3JkZXJDb3VudDogeyAkc3VtOiAxIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJHNvcnQ6IHsgcmV2ZW51ZTogLTEgfVxuICAgICAgfVxuICAgIF0pO1xuXG4gICAgLy8gR2V0IGFsbCBjb21wbGV0ZWQgb3JkZXJzIGZvciB2ZXJpZmljYXRpb25cbiAgICBjb25zdCBjb21wbGV0ZWRPcmRlcnMgPSBhd2FpdCBPcmRlci5maW5kKHtcbiAgICAgIHN0YXR1czogeyAkaW46IFsnY29tcGxldGVkJywgJ3JlYWR5J10gfSxcbiAgICAgIHBheW1lbnRTdGF0dXM6ICdwYWlkJ1xuICAgIH0pLnNlbGVjdCgnb3JkZXJOdW1iZXIgdG90YWwgc3RhdHVzIHBheW1lbnRTdGF0dXMgY3JlYXRlZEF0IHBheW1lbnRNZXRob2Qgb3JkZXJUeXBlJyk7XG5cbiAgICBjb25zdCBicmVha2Rvd24gPSByZXZlbnVlQnJlYWtkb3duWzBdIHx8IHtcbiAgICAgIHRvdGFsUmV2ZW51ZTogMCxcbiAgICAgIHRvdGFsU3VidG90YWw6IDAsXG4gICAgICB0b3RhbFRheDogMCxcbiAgICAgIHRvdGFsRGlzY291bnQ6IDAsXG4gICAgICBvcmRlckNvdW50OiAwLFxuICAgICAgYXZlcmFnZU9yZGVyVmFsdWU6IDBcbiAgICB9O1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgc3VtbWFyeToge1xuICAgICAgICAgIHRvdGFsUmV2ZW51ZTogYnJlYWtkb3duLnRvdGFsUmV2ZW51ZSxcbiAgICAgICAgICB0b3RhbFN1YnRvdGFsOiBicmVha2Rvd24udG90YWxTdWJ0b3RhbCxcbiAgICAgICAgICB0b3RhbFRheDogYnJlYWtkb3duLnRvdGFsVGF4LFxuICAgICAgICAgIHRvdGFsRGlzY291bnQ6IGJyZWFrZG93bi50b3RhbERpc2NvdW50LFxuICAgICAgICAgIGNvbXBsZXRlZE9yZGVyQ291bnQ6IGJyZWFrZG93bi5vcmRlckNvdW50LFxuICAgICAgICAgIGF2ZXJhZ2VPcmRlclZhbHVlOiBicmVha2Rvd24uYXZlcmFnZU9yZGVyVmFsdWVcbiAgICAgICAgfSxcbiAgICAgICAgYnJlYWtkb3duOiB7XG4gICAgICAgICAgYnlQYXltZW50TWV0aG9kOiByZXZlbnVlQnlQYXltZW50TWV0aG9kLFxuICAgICAgICAgIGJ5T3JkZXJUeXBlOiByZXZlbnVlQnlPcmRlclR5cGVcbiAgICAgICAgfSxcbiAgICAgICAgY29tcGxldGVkT3JkZXJzOiBjb21wbGV0ZWRPcmRlcnMubWFwKG9yZGVyID0+ICh7XG4gICAgICAgICAgb3JkZXJOdW1iZXI6IG9yZGVyLm9yZGVyTnVtYmVyLFxuICAgICAgICAgIHRvdGFsOiBvcmRlci50b3RhbCxcbiAgICAgICAgICBzdGF0dXM6IG9yZGVyLnN0YXR1cyxcbiAgICAgICAgICBwYXltZW50U3RhdHVzOiBvcmRlci5wYXltZW50U3RhdHVzLFxuICAgICAgICAgIHBheW1lbnRNZXRob2Q6IG9yZGVyLnBheW1lbnRNZXRob2QsXG4gICAgICAgICAgb3JkZXJUeXBlOiBvcmRlci5vcmRlclR5cGUsXG4gICAgICAgICAgY3JlYXRlZEF0OiBvcmRlci5jcmVhdGVkQXRcbiAgICAgICAgfSkpXG4gICAgICB9LFxuICAgICAgbWVzc2FnZTogYFRvdGFsIHJldmVudWUgY2FsY3VsYXRlZCBmcm9tICR7YnJlYWtkb3duLm9yZGVyQ291bnR9IGNvbXBsZXRlZCBvcmRlcnNgXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2FsY3VsYXRpbmcgdG90YWwgcmV2ZW51ZTonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGNhbGN1bGF0aW5nIHRvdGFsIHJldmVudWUnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9hZG1pbi9kYXNoYm9hcmQvcmVjZW50LW9yZGVyc1xuLy8gQGRlc2MgICAgR2V0IHJlY2VudCBvcmRlcnMgZm9yIGFkbWluIGRhc2hib2FyZFxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoQWRtaW4gb25seSlcbnJvdXRlci5nZXQoJy9kYXNoYm9hcmQvcmVjZW50LW9yZGVycycsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgbGltaXQgPSBwYXJzZUludChyZXEucXVlcnkubGltaXQpIHx8IDU7XG5cbiAgICBjb25zdCByZWNlbnRPcmRlcnMgPSBhd2FpdCBPcmRlci5maW5kKClcbiAgICAgIC5wb3B1bGF0ZSgnY3VzdG9tZXInLCAnZmlyc3ROYW1lIGxhc3ROYW1lIGVtYWlsIHBob25lIGFkZHJlc3MnKVxuICAgICAgLnNvcnQoeyBjcmVhdGVkQXQ6IC0xIH0pXG4gICAgICAubGltaXQobGltaXQpXG4gICAgICAuc2VsZWN0KCdvcmRlck51bWJlciBjdXN0b21lciB0b3RhbCBzdGF0dXMgY3JlYXRlZEF0Jyk7XG5cbiAgICAvLyBGb3JtYXQgdGhlIHJlc3BvbnNlXG4gICAgY29uc3QgZm9ybWF0dGVkT3JkZXJzID0gcmVjZW50T3JkZXJzLm1hcChvcmRlciA9PiAoe1xuICAgICAgX2lkOiBvcmRlci5faWQsXG4gICAgICBvcmRlck51bWJlcjogb3JkZXIub3JkZXJOdW1iZXIsXG4gICAgICBjdXN0b21lcjogb3JkZXIuY3VzdG9tZXIsXG4gICAgICBjdXN0b21lck5hbWU6IG9yZGVyLmN1c3RvbWVyID8gYCR7b3JkZXIuY3VzdG9tZXIuZmlyc3ROYW1lfSAke29yZGVyLmN1c3RvbWVyLmxhc3ROYW1lfWAgOiAnVW5rbm93biBDdXN0b21lcicsXG4gICAgICBjdXN0b21lckVtYWlsOiBvcmRlci5jdXN0b21lciA/IG9yZGVyLmN1c3RvbWVyLmVtYWlsIDogJycsXG4gICAgICB0b3RhbDogb3JkZXIudG90YWwsXG4gICAgICBzdGF0dXM6IG9yZGVyLnN0YXR1cyxcbiAgICAgIGNyZWF0ZWRBdDogb3JkZXIuY3JlYXRlZEF0XG4gICAgfSkpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IGZvcm1hdHRlZE9yZGVyc1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHJlY2VudCBvcmRlcnM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyByZWNlbnQgb3JkZXJzJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvYWRtaW4vZGFzaGJvYXJkL2FuYWx5dGljc1xuLy8gQGRlc2MgICAgR2V0IGRldGFpbGVkIGFuYWx5dGljcyBmb3IgYWRtaW4gZGFzaGJvYXJkXG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbiBvbmx5KVxucm91dGVyLmdldCgnL2Rhc2hib2FyZC9hbmFseXRpY3MnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIC8vIEdldCBvcmRlcnMgYnkgc3RhdHVzXG4gICAgY29uc3Qgb3JkZXJzQnlTdGF0dXMgPSBhd2FpdCBPcmRlci5hZ2dyZWdhdGUoW1xuICAgICAge1xuICAgICAgICAkZ3JvdXA6IHtcbiAgICAgICAgICBfaWQ6ICckc3RhdHVzJyxcbiAgICAgICAgICBjb3VudDogeyAkc3VtOiAxIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIF0pO1xuXG4gICAgLy8gR2V0IHJldmVudWUgYnkgbW9udGggKGxhc3QgNiBtb250aHMpXG4gICAgY29uc3Qgc2l4TW9udGhzQWdvID0gbmV3IERhdGUoKTtcbiAgICBzaXhNb250aHNBZ28uc2V0TW9udGgoc2l4TW9udGhzQWdvLmdldE1vbnRoKCkgLSA2KTtcblxuICAgIGNvbnN0IHJldmVudWVCeU1vbnRoID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHtcbiAgICAgICAgJG1hdGNoOiB7XG4gICAgICAgICAgY3JlYXRlZEF0OiB7ICRndGU6IHNpeE1vbnRoc0FnbyB9LFxuICAgICAgICAgIHN0YXR1czogeyAkaW46IFsnY29tcGxldGVkJywgJ3JlYWR5J10gfSxcbiAgICAgICAgICBwYXltZW50U3RhdHVzOiAncGFpZCdcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJGdyb3VwOiB7XG4gICAgICAgICAgX2lkOiB7XG4gICAgICAgICAgICB5ZWFyOiB7ICR5ZWFyOiAnJGNyZWF0ZWRBdCcgfSxcbiAgICAgICAgICAgIG1vbnRoOiB7ICRtb250aDogJyRjcmVhdGVkQXQnIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHJldmVudWU6IHsgJHN1bTogJyR0b3RhbCcgfSxcbiAgICAgICAgICBvcmRlckNvdW50OiB7ICRzdW06IDEgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkc29ydDogeyAnX2lkLnllYXInOiAxLCAnX2lkLm1vbnRoJzogMSB9XG4gICAgICB9XG4gICAgXSk7XG5cbiAgICAvLyBHZXQgdG9wIHNlbGxpbmcgcHJvZHVjdHNcbiAgICBjb25zdCB0b3BQcm9kdWN0cyA9IGF3YWl0IE9yZGVyLmFnZ3JlZ2F0ZShbXG4gICAgICB7ICR1bndpbmQ6ICckaXRlbXMnIH0sXG4gICAgICB7XG4gICAgICAgICRncm91cDoge1xuICAgICAgICAgIF9pZDogJyRpdGVtcy5wcm9kdWN0JyxcbiAgICAgICAgICBuYW1lOiB7ICRmaXJzdDogJyRpdGVtcy5uYW1lJyB9LFxuICAgICAgICAgIHRvdGFsU29sZDogeyAkc3VtOiAnJGl0ZW1zLnF1YW50aXR5JyB9LFxuICAgICAgICAgIHRvdGFsUmV2ZW51ZTogeyAkc3VtOiB7ICRtdWx0aXBseTogWyckaXRlbXMucHJpY2UnLCAnJGl0ZW1zLnF1YW50aXR5J10gfSB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7ICRzb3J0OiB7IHRvdGFsU29sZDogLTEgfSB9LFxuICAgICAgeyAkbGltaXQ6IDUgfVxuICAgIF0pO1xuXG4gICAgLy8gR2V0IGN1c3RvbWVyIGdyb3d0aCAobmV3IGN1c3RvbWVycyBwZXIgbW9udGgpXG4gICAgY29uc3QgY3VzdG9tZXJHcm93dGggPSBhd2FpdCBVc2VyLmFnZ3JlZ2F0ZShbXG4gICAgICB7XG4gICAgICAgICRtYXRjaDoge1xuICAgICAgICAgIHJvbGU6ICdjdXN0b21lcicsXG4gICAgICAgICAgY3JlYXRlZEF0OiB7ICRndGU6IHNpeE1vbnRoc0FnbyB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgICRncm91cDoge1xuICAgICAgICAgIF9pZDoge1xuICAgICAgICAgICAgeWVhcjogeyAkeWVhcjogJyRjcmVhdGVkQXQnIH0sXG4gICAgICAgICAgICBtb250aDogeyAkbW9udGg6ICckY3JlYXRlZEF0JyB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBuZXdDdXN0b21lcnM6IHsgJHN1bTogMSB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgICRzb3J0OiB7ICdfaWQueWVhcic6IDEsICdfaWQubW9udGgnOiAxIH1cbiAgICAgIH1cbiAgICBdKTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG9yZGVyc0J5U3RhdHVzOiBvcmRlcnNCeVN0YXR1cy5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xuICAgICAgICAgIGFjY1tpdGVtLl9pZF0gPSBpdGVtLmNvdW50O1xuICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIHt9KSxcbiAgICAgICAgcmV2ZW51ZUJ5TW9udGgsXG4gICAgICAgIHRvcFByb2R1Y3RzLFxuICAgICAgICBjdXN0b21lckdyb3d0aFxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGFuYWx5dGljczonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIGFuYWx5dGljcydcbiAgICB9KTtcbiAgfVxufSk7XG5cblxuXG5yb3V0ZXIuZ2V0KCcvb3JkZXJzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQocmVxLnF1ZXJ5LnBhZ2UpIHx8IDE7XG4gICAgY29uc3QgbGltaXQgPSBwYXJzZUludChyZXEucXVlcnkubGltaXQpIHx8IDEwO1xuICAgIGNvbnN0IHN0YXR1cyA9IHJlcS5xdWVyeS5zdGF0dXM7XG4gICAgY29uc3Qgc2VhcmNoID0gcmVxLnF1ZXJ5LnNlYXJjaDtcbiAgICBjb25zdCBzb3J0QnkgPSByZXEucXVlcnkuc29ydEJ5IHx8ICdjcmVhdGVkQXQnO1xuICAgIGNvbnN0IHNvcnRPcmRlciA9IHJlcS5xdWVyeS5zb3J0T3JkZXIgPT09ICdhc2MnID8gMSA6IC0xO1xuXG4gICAgLy8gQnVpbGQgZmlsdGVyIG9iamVjdFxuICAgIGxldCBmaWx0ZXIgPSB7fTtcbiAgICBpZiAoc3RhdHVzICYmIHN0YXR1cyAhPT0gJ2FsbCcpIHtcbiAgICAgIGZpbHRlci5zdGF0dXMgPSBzdGF0dXM7XG4gICAgfVxuICAgIGlmIChzZWFyY2gpIHtcbiAgICAgIGZpbHRlci4kb3IgPSBbXG4gICAgICAgIHsgb3JkZXJOdW1iZXI6IHsgJHJlZ2V4OiBzZWFyY2gsICRvcHRpb25zOiAnaScgfSB9LFxuICAgICAgICB7ICdjdXN0b21lci5maXJzdE5hbWUnOiB7ICRyZWdleDogc2VhcmNoLCAkb3B0aW9uczogJ2knIH0gfSxcbiAgICAgICAgeyAnY3VzdG9tZXIubGFzdE5hbWUnOiB7ICRyZWdleDogc2VhcmNoLCAkb3B0aW9uczogJ2knIH0gfSxcbiAgICAgICAgeyAnY3VzdG9tZXIuZW1haWwnOiB7ICRyZWdleDogc2VhcmNoLCAkb3B0aW9uczogJ2knIH0gfVxuICAgICAgXTtcbiAgICB9XG5cbiAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuXG4gICAgY29uc3Qgb3JkZXJzID0gYXdhaXQgT3JkZXIuZmluZChmaWx0ZXIpXG4gICAgICAucG9wdWxhdGUoJ2N1c3RvbWVyJywgJ2ZpcnN0TmFtZSBsYXN0TmFtZSBlbWFpbCBwaG9uZSBhZGRyZXNzJylcbiAgICAgIC5zb3J0KHsgW3NvcnRCeV06IHNvcnRPcmRlciB9KVxuICAgICAgLnNraXAoc2tpcClcbiAgICAgIC5saW1pdChsaW1pdCk7XG5cbiAgICBjb25zdCB0b3RhbE9yZGVycyA9IGF3YWl0IE9yZGVyLmNvdW50RG9jdW1lbnRzKGZpbHRlcik7XG4gICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbE9yZGVycyAvIGxpbWl0KTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG9yZGVycyxcbiAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgIGN1cnJlbnRQYWdlOiBwYWdlLFxuICAgICAgICAgIHRvdGFsUGFnZXMsXG4gICAgICAgICAgdG90YWxPcmRlcnMsXG4gICAgICAgICAgaGFzTmV4dDogcGFnZSA8IHRvdGFsUGFnZXMsXG4gICAgICAgICAgaGFzUHJldjogcGFnZSA+IDFcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIG9yZGVyczonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIG9yZGVycydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2FkbWluL29yZGVycy86aWRcbi8vIEBkZXNjICAgIEdldCBzaW5nbGUgb3JkZXIgZGV0YWlsc1xuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoQWRtaW4gb25seSlcbnJvdXRlci5nZXQoJy9vcmRlcnMvOmlkJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpXG4gICAgICAucG9wdWxhdGUoJ2N1c3RvbWVyJywgJ2ZpcnN0TmFtZSBsYXN0TmFtZSBlbWFpbCBwaG9uZSBhZGRyZXNzJyk7XG5cbiAgICBpZiAoIW9yZGVyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBvcmRlclxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIG9yZGVyIGRldGFpbHM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBvcmRlciBkZXRhaWxzJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUFVUIC9hcGkvYWRtaW4vb3JkZXJzLzppZC9zdGF0dXNcbi8vIEBkZXNjICAgIFVwZGF0ZSBvcmRlciBzdGF0dXNcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKEFkbWluIG9ubHkpXG5yb3V0ZXIucHV0KCcvb3JkZXJzLzppZC9zdGF0dXMnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgc3RhdHVzIH0gPSByZXEuYm9keTtcbiAgICBjb25zdCB2YWxpZFN0YXR1c2VzID0gWydwZW5kaW5nJywgJ2NvbmZpcm1lZCcsICdwcmVwYXJpbmcnLCAncmVhZHknLCAnY29tcGxldGVkJywgJ2NhbmNlbGxlZCddO1xuXG4gICAgaWYgKCF2YWxpZFN0YXR1c2VzLmluY2x1ZGVzKHN0YXR1cykpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBvcmRlciBzdGF0dXMnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpO1xuXG4gICAgaWYgKCFvcmRlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBvcmRlci5zdGF0dXMgPSBzdGF0dXM7XG4gICAgb3JkZXIudXBkYXRlZEF0ID0gbmV3IERhdGUoKTtcblxuICAgIGF3YWl0IG9yZGVyLnNhdmUoKTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnT3JkZXIgc3RhdHVzIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIGRhdGE6IG9yZGVyXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgb3JkZXIgc3RhdHVzOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgdXBkYXRpbmcgb3JkZXIgc3RhdHVzJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQ3VzdG9tZXIgTWFuYWdlbWVudCBSb3V0ZXNcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvYWRtaW4vY3VzdG9tZXJzXG4vLyBAZGVzYyAgICBHZXQgYWxsIGN1c3RvbWVycyB3aXRoIGZpbHRlcmluZyBhbmQgcGFnaW5hdGlvblxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoQWRtaW4gb25seSlcbnJvdXRlci5nZXQoJy9jdXN0b21lcnMnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHBhZ2UgPSBwYXJzZUludChyZXEucXVlcnkucGFnZSkgfHwgMTtcbiAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHJlcS5xdWVyeS5saW1pdCkgfHwgMTA7XG4gICAgY29uc3Qgc2VhcmNoID0gcmVxLnF1ZXJ5LnNlYXJjaDtcbiAgICBjb25zdCBzb3J0QnkgPSByZXEucXVlcnkuc29ydEJ5IHx8ICdjcmVhdGVkQXQnO1xuICAgIGNvbnN0IHNvcnRPcmRlciA9IHJlcS5xdWVyeS5zb3J0T3JkZXIgPT09ICdhc2MnID8gMSA6IC0xO1xuXG4gICAgLy8gQnVpbGQgZmlsdGVyIG9iamVjdFxuICAgIGxldCBmaWx0ZXIgPSB7IHJvbGU6ICdjdXN0b21lcicgfTtcbiAgICBpZiAoc2VhcmNoKSB7XG4gICAgICBmaWx0ZXIuJG9yID0gW1xuICAgICAgICB7IGZpcnN0TmFtZTogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH0sXG4gICAgICAgIHsgbGFzdE5hbWU6IHsgJHJlZ2V4OiBzZWFyY2gsICRvcHRpb25zOiAnaScgfSB9LFxuICAgICAgICB7IGVtYWlsOiB7ICRyZWdleDogc2VhcmNoLCAkb3B0aW9uczogJ2knIH0gfSxcbiAgICAgICAgeyBwaG9uZTogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH1cbiAgICAgIF07XG4gICAgfVxuXG4gICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcblxuICAgIGNvbnN0IGN1c3RvbWVycyA9IGF3YWl0IFVzZXIuZmluZChmaWx0ZXIpXG4gICAgICAuc2VsZWN0KCctcGFzc3dvcmQnKVxuICAgICAgLnNvcnQoeyBbc29ydEJ5XTogc29ydE9yZGVyIH0pXG4gICAgICAuc2tpcChza2lwKVxuICAgICAgLmxpbWl0KGxpbWl0KTtcblxuICAgIC8vIEdldCBvcmRlciBzdGF0aXN0aWNzIGZvciBlYWNoIGN1c3RvbWVyXG4gICAgY29uc3QgY3VzdG9tZXJzV2l0aFN0YXRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBjdXN0b21lcnMubWFwKGFzeW5jIChjdXN0b21lcikgPT4ge1xuICAgICAgICBjb25zdCBvcmRlclN0YXRzID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgICAgICB7ICRtYXRjaDogeyBjdXN0b21lcjogY3VzdG9tZXIuX2lkIH0gfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICAkZ3JvdXA6IHtcbiAgICAgICAgICAgICAgX2lkOiBudWxsLFxuICAgICAgICAgICAgICB0b3RhbE9yZGVyczogeyAkc3VtOiAxIH0sXG4gICAgICAgICAgICAgIHRvdGFsU3BlbnQ6IHsgJHN1bTogJyR0b3RhbCcgfSxcbiAgICAgICAgICAgICAgbGFzdE9yZGVyRGF0ZTogeyAkbWF4OiAnJGNyZWF0ZWRBdCcgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgXSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5jdXN0b21lci50b09iamVjdCgpLFxuICAgICAgICAgIG9yZGVyU3RhdHM6IG9yZGVyU3RhdHNbMF0gfHwge1xuICAgICAgICAgICAgdG90YWxPcmRlcnM6IDAsXG4gICAgICAgICAgICB0b3RhbFNwZW50OiAwLFxuICAgICAgICAgICAgbGFzdE9yZGVyRGF0ZTogbnVsbFxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIGNvbnN0IHRvdGFsQ3VzdG9tZXJzID0gYXdhaXQgVXNlci5jb3VudERvY3VtZW50cyhmaWx0ZXIpO1xuICAgIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwodG90YWxDdXN0b21lcnMgLyBsaW1pdCk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBjdXN0b21lcnM6IGN1c3RvbWVyc1dpdGhTdGF0cyxcbiAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgIGN1cnJlbnRQYWdlOiBwYWdlLFxuICAgICAgICAgIHRvdGFsUGFnZXMsXG4gICAgICAgICAgdG90YWxDdXN0b21lcnMsXG4gICAgICAgICAgaGFzTmV4dDogcGFnZSA8IHRvdGFsUGFnZXMsXG4gICAgICAgICAgaGFzUHJldjogcGFnZSA+IDFcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGN1c3RvbWVyczonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIGN1c3RvbWVycydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2FkbWluL2N1c3RvbWVycy86aWRcbi8vIEBkZXNjICAgIEdldCBzaW5nbGUgY3VzdG9tZXIgZGV0YWlscyB3aXRoIG9yZGVyIGhpc3Rvcnlcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKEFkbWluIG9ubHkpXG5yb3V0ZXIuZ2V0KCcvY3VzdG9tZXJzLzppZCcsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY3VzdG9tZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpXG4gICAgICAuc2VsZWN0KCctcGFzc3dvcmQnKTtcblxuICAgIGlmICghY3VzdG9tZXIgfHwgY3VzdG9tZXIucm9sZSAhPT0gJ2N1c3RvbWVyJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdDdXN0b21lciBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBHZXQgY3VzdG9tZXIncyBvcmRlciBoaXN0b3J5XG4gICAgY29uc3Qgb3JkZXJzID0gYXdhaXQgT3JkZXIuZmluZCh7IGN1c3RvbWVyOiByZXEucGFyYW1zLmlkIH0pXG4gICAgICAuc29ydCh7IGNyZWF0ZWRBdDogLTEgfSlcbiAgICAgIC5saW1pdCgxMCk7XG5cbiAgICAvLyBHZXQgY3VzdG9tZXIgc3RhdGlzdGljc1xuICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHsgJG1hdGNoOiB7IGN1c3RvbWVyOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZChyZXEucGFyYW1zLmlkKSB9IH0sXG4gICAgICB7XG4gICAgICAgICRncm91cDoge1xuICAgICAgICAgIF9pZDogbnVsbCxcbiAgICAgICAgICB0b3RhbE9yZGVyczogeyAkc3VtOiAxIH0sXG4gICAgICAgICAgdG90YWxTcGVudDogeyAkc3VtOiAnJHRvdGFsJyB9LFxuICAgICAgICAgIGF2ZXJhZ2VPcmRlclZhbHVlOiB7ICRhdmc6ICckdG90YWwnIH0sXG4gICAgICAgICAgbGFzdE9yZGVyRGF0ZTogeyAkbWF4OiAnJGNyZWF0ZWRBdCcgfSxcbiAgICAgICAgICBmaXJzdE9yZGVyRGF0ZTogeyAkbWluOiAnJGNyZWF0ZWRBdCcgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgXSk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBjdXN0b21lcixcbiAgICAgICAgb3JkZXJzLFxuICAgICAgICBzdGF0czogc3RhdHNbMF0gfHwge1xuICAgICAgICAgIHRvdGFsT3JkZXJzOiAwLFxuICAgICAgICAgIHRvdGFsU3BlbnQ6IDAsXG4gICAgICAgICAgYXZlcmFnZU9yZGVyVmFsdWU6IDAsXG4gICAgICAgICAgbGFzdE9yZGVyRGF0ZTogbnVsbCxcbiAgICAgICAgICBmaXJzdE9yZGVyRGF0ZTogbnVsbFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgY3VzdG9tZXIgZGV0YWlsczonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIGN1c3RvbWVyIGRldGFpbHMnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBDb250YWN0IE1hbmFnZW1lbnQgUm91dGVzXG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2FkbWluL2NvbnRhY3RzXG4vLyBAZGVzYyAgICBHZXQgYWxsIGNvbnRhY3QgbWVzc2FnZXMgd2l0aCBmaWx0ZXJpbmcgYW5kIHBhZ2luYXRpb25cbi8vIEBhY2Nlc3MgIFByaXZhdGUgKEFkbWluIG9ubHkpXG5yb3V0ZXIuZ2V0KCcvY29udGFjdHMnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IENvbnRhY3QgPSByZXF1aXJlKCcuLi9tb2RlbHMvQ29udGFjdCcpO1xuICAgIGNvbnN0IHBhZ2UgPSBwYXJzZUludChyZXEucXVlcnkucGFnZSkgfHwgMTtcbiAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHJlcS5xdWVyeS5saW1pdCkgfHwgMTA7XG4gICAgY29uc3Qgc3RhdHVzID0gcmVxLnF1ZXJ5LnN0YXR1cztcbiAgICBjb25zdCBzZWFyY2ggPSByZXEucXVlcnkuc2VhcmNoO1xuICAgIGNvbnN0IHNvcnRCeSA9IHJlcS5xdWVyeS5zb3J0QnkgfHwgJ2NyZWF0ZWRBdCc7XG4gICAgY29uc3Qgc29ydE9yZGVyID0gcmVxLnF1ZXJ5LnNvcnRPcmRlciA9PT0gJ2FzYycgPyAxIDogLTE7XG5cbiAgICAvLyBCdWlsZCBmaWx0ZXIgb2JqZWN0XG4gICAgbGV0IGZpbHRlciA9IHt9O1xuICAgIGlmIChzdGF0dXMgJiYgc3RhdHVzICE9PSAnYWxsJykge1xuICAgICAgZmlsdGVyLnN0YXR1cyA9IHN0YXR1cztcbiAgICB9XG4gICAgaWYgKHNlYXJjaCkge1xuICAgICAgZmlsdGVyLiRvciA9IFtcbiAgICAgICAgeyBuYW1lOiB7ICRyZWdleDogc2VhcmNoLCAkb3B0aW9uczogJ2knIH0gfSxcbiAgICAgICAgeyBlbWFpbDogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH0sXG4gICAgICAgIHsgc3ViamVjdDogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH0sXG4gICAgICAgIHsgdGlja2V0SWQ6IHsgJHJlZ2V4OiBzZWFyY2gsICRvcHRpb25zOiAnaScgfSB9XG4gICAgICBdO1xuICAgIH1cblxuICAgIGNvbnN0IHNraXAgPSAocGFnZSAtIDEpICogbGltaXQ7XG5cbiAgICBjb25zdCBjb250YWN0cyA9IGF3YWl0IENvbnRhY3QuZmluZChmaWx0ZXIpXG4gICAgICAuc29ydCh7IFtzb3J0QnldOiBzb3J0T3JkZXIgfSlcbiAgICAgIC5za2lwKHNraXApXG4gICAgICAubGltaXQobGltaXQpO1xuXG4gICAgY29uc3QgdG90YWxDb250YWN0cyA9IGF3YWl0IENvbnRhY3QuY291bnREb2N1bWVudHMoZmlsdGVyKTtcbiAgICBjb25zdCB0b3RhbFBhZ2VzID0gTWF0aC5jZWlsKHRvdGFsQ29udGFjdHMgLyBsaW1pdCk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBjb250YWN0cyxcbiAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgIGN1cnJlbnRQYWdlOiBwYWdlLFxuICAgICAgICAgIHRvdGFsUGFnZXMsXG4gICAgICAgICAgdG90YWxDb250YWN0cyxcbiAgICAgICAgICBoYXNOZXh0OiBwYWdlIDwgdG90YWxQYWdlcyxcbiAgICAgICAgICBoYXNQcmV2OiBwYWdlID4gMVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgY29udGFjdHM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBjb250YWN0cydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2FkbWluL2NvbnRhY3RzLzppZFxuLy8gQGRlc2MgICAgR2V0IHNpbmdsZSBjb250YWN0IG1lc3NhZ2UgZGV0YWlsc1xuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoQWRtaW4gb25seSlcbnJvdXRlci5nZXQoJy9jb250YWN0cy86aWQnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IENvbnRhY3QgPSByZXF1aXJlKCcuLi9tb2RlbHMvQ29udGFjdCcpO1xuICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBDb250YWN0LmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpO1xuXG4gICAgaWYgKCFjb250YWN0KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0NvbnRhY3QgbWVzc2FnZSBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogY29udGFjdFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGNvbnRhY3QgZGV0YWlsczonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIGNvbnRhY3QgZGV0YWlscydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIFBVVCAvYXBpL2FkbWluL2NvbnRhY3RzLzppZC9zdGF0dXNcbi8vIEBkZXNjICAgIFVwZGF0ZSBjb250YWN0IG1lc3NhZ2Ugc3RhdHVzXG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbiBvbmx5KVxucm91dGVyLnB1dCgnL2NvbnRhY3RzLzppZC9zdGF0dXMnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IENvbnRhY3QgPSByZXF1aXJlKCcuLi9tb2RlbHMvQ29udGFjdCcpO1xuICAgIGNvbnN0IHsgc3RhdHVzIH0gPSByZXEuYm9keTtcblxuICAgIC8vIFZhbGlkYXRlIHN0YXR1c1xuICAgIGNvbnN0IHZhbGlkU3RhdHVzZXMgPSBbJ25ldycsICdyZWFkJywgJ3JlcGxpZWQnLCAnY2xvc2VkJ107XG4gICAgaWYgKCF2YWxpZFN0YXR1c2VzLmluY2x1ZGVzKHN0YXR1cykpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBzdGF0dXMuIE11c3QgYmUgb25lIG9mOiBuZXcsIHJlYWQsIHJlcGxpZWQsIGNsb3NlZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBDb250YWN0LmZpbmRCeUlkQW5kVXBkYXRlKFxuICAgICAgcmVxLnBhcmFtcy5pZCxcbiAgICAgIHsgc3RhdHVzLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSxcbiAgICAgIHsgbmV3OiB0cnVlLCBydW5WYWxpZGF0b3JzOiB0cnVlIH1cbiAgICApO1xuXG4gICAgaWYgKCFjb250YWN0KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0NvbnRhY3QgbWVzc2FnZSBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogY29udGFjdCxcbiAgICAgIG1lc3NhZ2U6ICdDb250YWN0IHN0YXR1cyB1cGRhdGVkIHN1Y2Nlc3NmdWxseSdcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBjb250YWN0IHN0YXR1czonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIHVwZGF0aW5nIGNvbnRhY3Qgc3RhdHVzJ1xuICAgIH0pO1xuICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUNHLE1BQU0sQ0FBQyxDQUFDO0FBQy9CLE1BQU07RUFBRUMsT0FBTztFQUFFQztBQUFVLENBQUMsR0FBR0osT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBQzVELE1BQU1LLElBQUksR0FBR0wsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ3RDLE1BQU1NLE9BQU8sR0FBR04sT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzVDLE1BQU1PLEtBQUssR0FBR1AsT0FBTyxDQUFDLGlCQUFpQixDQUFDO0FBQ3hDLE1BQU1RLFFBQVEsR0FBR1IsT0FBTyxDQUFDLFVBQVUsQ0FBQzs7QUFFcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQUMsTUFBTSxDQUFDUSxHQUFHLENBQUMsa0JB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","map":{"version":3,"names":["express","require","router","Router","protect","authorize","User","Product","Order","mongoose","get","req","res","totalProducts","countDocuments","totalOrders","totalCustomers","role","revenueResult","aggregate","$match","status","$in","paymentStatus","$group","_id","totalRevenue","$sum","length","json","success","data","error","console","message","revenueBreakdown","totalSubtotal","totalTax","totalDiscount","orderCount","averageOrderValue","$avg","revenueByPaymentMethod","revenue","$sort","revenueByOrderType","completedOrders","find","select","breakdown","summary","completedOrderCount","byPaymentMethod","byOrderType","map","order","orderNumber","total","paymentMethod","orderType","createdAt","limit","parseInt","query","recentOrders","populate","sort","formattedOrders","customer","customerName","firstName","lastName","customerEmail","email","ordersByStatus","count","sixMonthsAgo","Date","setMonth","getMonth","revenueByMonth","$gte","year","$year","month","$month","topProducts","$unwind","name","$first","totalSold","$multiply","$limit","customerGrowth","newCustomers","reduce","acc","item","page","search","sortBy","sortOrder","filter","$or","$regex","$options","skip","orders","totalPages","Math","ceil","pagination","currentPage","hasNext","hasPrev","findById","params","id","put","body","validStatuses","includes","updatedAt","save","phone","customers","customersWithStats","Promise","all","orderStats","totalSpent","lastOrderDate","$max","toObject","stats","Types","ObjectId","firstOrderDate","$min","Contact","subject","ticketId","contacts","totalContacts","contact","findByIdAndUpdate","new","runValidators","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["admin.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst { protect, authorize } = require('../middleware/auth');\nconst User = require('../models/User');\nconst Product = require('../models/Product');\nconst Order = require('../models/Order');\nconst mongoose = require('mongoose');\n\n// Dashboard statistics\n// @route   GET /api/admin/dashboard/stats\n// @desc    Get dashboard statistics for admin\n// @access  Private (Admin only)\nrouter.get('/dashboard/stats', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get total products count\n    const totalProducts = await Product.countDocuments();\n\n    // Get total orders count\n    const totalOrders = await Order.countDocuments();\n\n    // Get total customers count (users with customer role)\n    const totalCustomers = await User.countDocuments({ role: 'customer' });\n\n    // Get total revenue from completed orders\n    const revenueResult = await Order.aggregate([\n      {\n        $match: {\n          status: { $in: ['completed', 'ready'] },\n          paymentStatus: 'paid'\n        }\n      },\n      {\n        $group: {\n          _id: null,\n          totalRevenue: { $sum: '$total' }\n        }\n      }\n    ]);\n\n    const totalRevenue = revenueResult.length > 0 ? revenueResult[0].totalRevenue : 0;\n\n    res.json({\n      success: true,\n      data: {\n        totalProducts,\n        totalOrders,\n        totalCustomers,\n        totalRevenue\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching dashboard stats:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching dashboard statistics'\n    });\n  }\n});\n\n// @route   GET /api/admin/revenue/total\n// @desc    Get detailed total revenue calculation from completed orders\n// @access  Private (Admin only)\nrouter.get('/revenue/total', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get detailed revenue breakdown from completed orders\n    const revenueBreakdown = await Order.aggregate([\n      {\n        $match: {\n          status: { $in: ['completed', 'ready'] },\n          paymentStatus: 'paid'\n        }\n      },\n      {\n        $group: {\n          _id: null,\n          totalRevenue: { $sum: '$total' },\n          totalSubtotal: { $sum: '$subtotal' },\n          totalTax: { $sum: '$tax' },\n          totalDiscount: { $sum: '$discount' },\n          orderCount: { $sum: 1 },\n          averageOrderValue: { $avg: '$total' }\n        }\n      }\n    ]);\n\n    // Get revenue by payment method\n    const revenueByPaymentMethod = await Order.aggregate([\n      {\n        $match: {\n          status: { $in: ['completed', 'ready'] },\n          paymentStatus: 'paid'\n        }\n      },\n      {\n        $group: {\n          _id: '$paymentMethod',\n          revenue: { $sum: '$total' },\n          orderCount: { $sum: 1 }\n        }\n      },\n      {\n        $sort: { revenue: -1 }\n      }\n    ]);\n\n    // Get revenue by order type\n    const revenueByOrderType = await Order.aggregate([\n      {\n        $match: {\n          status: { $in: ['completed', 'ready'] },\n          paymentStatus: 'paid'\n        }\n      },\n      {\n        $group: {\n          _id: '$orderType',\n          revenue: { $sum: '$total' },\n          orderCount: { $sum: 1 }\n        }\n      },\n      {\n        $sort: { revenue: -1 }\n      }\n    ]);\n\n    // Get all completed orders for verification\n    const completedOrders = await Order.find({\n      status: { $in: ['completed', 'ready'] },\n      paymentStatus: 'paid'\n    }).select('orderNumber total status paymentStatus createdAt paymentMethod orderType');\n\n    const breakdown = revenueBreakdown[0] || {\n      totalRevenue: 0,\n      totalSubtotal: 0,\n      totalTax: 0,\n      totalDiscount: 0,\n      orderCount: 0,\n      averageOrderValue: 0\n    };\n\n    res.json({\n      success: true,\n      data: {\n        summary: {\n          totalRevenue: breakdown.totalRevenue,\n          totalSubtotal: breakdown.totalSubtotal,\n          totalTax: breakdown.totalTax,\n          totalDiscount: breakdown.totalDiscount,\n          completedOrderCount: breakdown.orderCount,\n          averageOrderValue: breakdown.averageOrderValue\n        },\n        breakdown: {\n          byPaymentMethod: revenueByPaymentMethod,\n          byOrderType: revenueByOrderType\n        },\n        completedOrders: completedOrders.map(order => ({\n          orderNumber: order.orderNumber,\n          total: order.total,\n          status: order.status,\n          paymentStatus: order.paymentStatus,\n          paymentMethod: order.paymentMethod,\n          orderType: order.orderType,\n          createdAt: order.createdAt\n        }))\n      },\n      message: `Total revenue calculated from ${breakdown.orderCount} completed orders`\n    });\n  } catch (error) {\n    console.error('Error calculating total revenue:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while calculating total revenue'\n    });\n  }\n});\n\n// @route   GET /api/admin/dashboard/recent-orders\n// @desc    Get recent orders for admin dashboard\n// @access  Private (Admin only)\nrouter.get('/dashboard/recent-orders', protect, authorize('admin'), async (req, res) => {\n  try {\n    const limit = parseInt(req.query.limit) || 5;\n\n    const recentOrders = await Order.find()\n      .populate('customer', 'firstName lastName email phone address')\n      .sort({ createdAt: -1 })\n      .limit(limit)\n      .select('orderNumber customer total status createdAt');\n\n    // Format the response\n    const formattedOrders = recentOrders.map(order => ({\n      _id: order._id,\n      orderNumber: order.orderNumber,\n      customer: order.customer,\n      customerName: order.customer ? `${order.customer.firstName} ${order.customer.lastName}` : 'Unknown Customer',\n      customerEmail: order.customer ? order.customer.email : '',\n      total: order.total,\n      status: order.status,\n      createdAt: order.createdAt\n    }));\n\n    res.json({\n      success: true,\n      data: formattedOrders\n    });\n  } catch (error) {\n    console.error('Error fetching recent orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching recent orders'\n    });\n  }\n});\n\n// @route   GET /api/admin/dashboard/analytics\n// @desc    Get detailed analytics for admin dashboard\n// @access  Private (Admin only)\nrouter.get('/dashboard/analytics', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get orders by status\n    const ordersByStatus = await Order.aggregate([\n      {\n        $group: {\n          _id: '$status',\n          count: { $sum: 1 }\n        }\n      }\n    ]);\n\n    // Get revenue by month (last 6 months)\n    const sixMonthsAgo = new Date();\n    sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\n\n    const revenueByMonth = await Order.aggregate([\n      {\n        $match: {\n          createdAt: { $gte: sixMonthsAgo },\n          status: { $in: ['completed', 'ready'] },\n          paymentStatus: 'paid'\n        }\n      },\n      {\n        $group: {\n          _id: {\n            year: { $year: '$createdAt' },\n            month: { $month: '$createdAt' }\n          },\n          revenue: { $sum: '$total' },\n          orderCount: { $sum: 1 }\n        }\n      },\n      {\n        $sort: { '_id.year': 1, '_id.month': 1 }\n      }\n    ]);\n\n    // Get top selling products\n    const topProducts = await Order.aggregate([\n      { $unwind: '$items' },\n      {\n        $group: {\n          _id: '$items.product',\n          name: { $first: '$items.name' },\n          totalSold: { $sum: '$items.quantity' },\n          totalRevenue: { $sum: { $multiply: ['$items.price', '$items.quantity'] } }\n        }\n      },\n      { $sort: { totalSold: -1 } },\n      { $limit: 5 }\n    ]);\n\n    // Get customer growth (new customers per month)\n    const customerGrowth = await User.aggregate([\n      {\n        $match: {\n          role: 'customer',\n          createdAt: { $gte: sixMonthsAgo }\n        }\n      },\n      {\n        $group: {\n          _id: {\n            year: { $year: '$createdAt' },\n            month: { $month: '$createdAt' }\n          },\n          newCustomers: { $sum: 1 }\n        }\n      },\n      {\n        $sort: { '_id.year': 1, '_id.month': 1 }\n      }\n    ]);\n\n    res.json({\n      success: true,\n      data: {\n        ordersByStatus: ordersByStatus.reduce((acc, item) => {\n          acc[item._id] = item.count;\n          return acc;\n        }, {}),\n        revenueByMonth,\n        topProducts,\n        customerGrowth\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching analytics:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching analytics'\n    });\n  }\n});\n\n\n\nrouter.get('/orders', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = {};\n    if (status && status !== 'all') {\n      filter.status = status;\n    }\n    if (search) {\n      filter.$or = [\n        { orderNumber: { $regex: search, $options: 'i' } },\n        { 'customer.firstName': { $regex: search, $options: 'i' } },\n        { 'customer.lastName': { $regex: search, $options: 'i' } },\n        { 'customer.email': { $regex: search, $options: 'i' } }\n      ];\n    }\n\n    const skip = (page - 1) * limit;\n\n    const orders = await Order.find(filter)\n      .populate('customer', 'firstName lastName email phone address')\n      .sort({ [sortBy]: sortOrder })\n      .skip(skip)\n      .limit(limit);\n\n    const totalOrders = await Order.countDocuments(filter);\n    const totalPages = Math.ceil(totalOrders / limit);\n\n    res.json({\n      success: true,\n      data: {\n        orders,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalOrders,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching orders'\n    });\n  }\n});\n\n// @route   GET /api/admin/orders/:id\n// @desc    Get single order details\n// @access  Private (Admin only)\nrouter.get('/orders/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const order = await Order.findById(req.params.id)\n      .populate('customer', 'firstName lastName email phone address');\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    res.json({\n      success: true,\n      data: order\n    });\n  } catch (error) {\n    console.error('Error fetching order details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order details'\n    });\n  }\n});\n\n// @route   PUT /api/admin/orders/:id/status\n// @desc    Update order status\n// @access  Private (Admin only)\nrouter.put('/orders/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const { status } = req.body;\n    const validStatuses = ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'];\n\n    if (!validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order status'\n      });\n    }\n\n    const order = await Order.findById(req.params.id);\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    order.status = status;\n    order.updatedAt = new Date();\n\n    await order.save();\n\n    res.json({\n      success: true,\n      message: 'Order status updated successfully',\n      data: order\n    });\n  } catch (error) {\n    console.error('Error updating order status:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating order status'\n    });\n  }\n});\n\n// Customer Management Routes\n\n// @route   GET /api/admin/customers\n// @desc    Get all customers with filtering and pagination\n// @access  Private (Admin only)\nrouter.get('/customers', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = { role: 'customer' };\n    if (search) {\n      filter.$or = [\n        { firstName: { $regex: search, $options: 'i' } },\n        { lastName: { $regex: search, $options: 'i' } },\n        { email: { $regex: search, $options: 'i' } },\n        { phone: { $regex: search, $options: 'i' } }\n      ];\n    }\n\n    const skip = (page - 1) * limit;\n\n    const customers = await User.find(filter)\n      .select('-password')\n      .sort({ [sortBy]: sortOrder })\n      .skip(skip)\n      .limit(limit);\n\n    // Get order statistics for each customer\n    const customersWithStats = await Promise.all(\n      customers.map(async (customer) => {\n        const orderStats = await Order.aggregate([\n          { $match: { customer: customer._id } },\n          {\n            $group: {\n              _id: null,\n              totalOrders: { $sum: 1 },\n              totalSpent: { $sum: '$total' },\n              lastOrderDate: { $max: '$createdAt' }\n            }\n          }\n        ]);\n\n        return {\n          ...customer.toObject(),\n          orderStats: orderStats[0] || {\n            totalOrders: 0,\n            totalSpent: 0,\n            lastOrderDate: null\n          }\n        };\n      })\n    );\n\n    const totalCustomers = await User.countDocuments(filter);\n    const totalPages = Math.ceil(totalCustomers / limit);\n\n    res.json({\n      success: true,\n      data: {\n        customers: customersWithStats,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalCustomers,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching customers:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching customers'\n    });\n  }\n});\n\n// @route   GET /api/admin/customers/:id\n// @desc    Get single customer details with order history\n// @access  Private (Admin only)\nrouter.get('/customers/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const customer = await User.findById(req.params.id)\n      .select('-password');\n\n    if (!customer || customer.role !== 'customer') {\n      return res.status(404).json({\n        success: false,\n        message: 'Customer not found'\n      });\n    }\n\n    // Get customer's order history\n    const orders = await Order.find({ customer: req.params.id })\n      .sort({ createdAt: -1 })\n      .limit(10);\n\n    // Get customer statistics\n    const stats = await Order.aggregate([\n      { $match: { customer: mongoose.Types.ObjectId(req.params.id) } },\n      {\n        $group: {\n          _id: null,\n          totalOrders: { $sum: 1 },\n          totalSpent: { $sum: '$total' },\n          averageOrderValue: { $avg: '$total' },\n          lastOrderDate: { $max: '$createdAt' },\n          firstOrderDate: { $min: '$createdAt' }\n        }\n      }\n    ]);\n\n    res.json({\n      success: true,\n      data: {\n        customer,\n        orders,\n        stats: stats[0] || {\n          totalOrders: 0,\n          totalSpent: 0,\n          averageOrderValue: 0,\n          lastOrderDate: null,\n          firstOrderDate: null\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching customer details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching customer details'\n    });\n  }\n});\n\n// Contact Management Routes\n\n// @route   GET /api/admin/contacts\n// @desc    Get all contact messages with filtering and pagination\n// @access  Private (Admin only)\nrouter.get('/contacts', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = {};\n    if (status && status !== 'all') {\n      filter.status = status;\n    }\n    if (search) {\n      filter.$or = [\n        { name: { $regex: search, $options: 'i' } },\n        { email: { $regex: search, $options: 'i' } },\n        { subject: { $regex: search, $options: 'i' } },\n        { ticketId: { $regex: search, $options: 'i' } }\n      ];\n    }\n\n    const skip = (page - 1) * limit;\n\n    const contacts = await Contact.find(filter)\n      .sort({ [sortBy]: sortOrder })\n      .skip(skip)\n      .limit(limit);\n\n    const totalContacts = await Contact.countDocuments(filter);\n    const totalPages = Math.ceil(totalContacts / limit);\n\n    res.json({\n      success: true,\n      data: {\n        contacts,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalContacts,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching contacts:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching contacts'\n    });\n  }\n});\n\n// @route   GET /api/admin/contacts/:id\n// @desc    Get single contact message details\n// @access  Private (Admin only)\nrouter.get('/contacts/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const contact = await Contact.findById(req.params.id);\n\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Error fetching contact details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching contact details'\n    });\n  }\n});\n\n// @route   PUT /api/admin/contacts/:id/status\n// @desc    Update contact message status\n// @access  Private (Admin only)\nrouter.put('/contacts/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const { status } = req.body;\n\n    // Validate status\n    const validStatuses = ['new', 'read', 'replied', 'closed'];\n    if (!validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid status. Must be one of: new, read, replied, closed'\n      });\n    }\n\n    const contact = await Contact.findByIdAndUpdate(\n      req.params.id,\n      { status, updatedAt: new Date() },\n      { new: true, runValidators: true }\n    );\n\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    res.json({\n      success: true,\n      data: contact,\n      message: 'Contact status updated successfully'\n    });\n  } catch (error) {\n    console.error('Error updating contact status:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating contact status'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1757589771716},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\shop.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst ShopService = require('../services/shopService');\nconst {\n  protect,\n  authorize\n} = require('../middleware/auth');\n\n// @route   GET /api/shop/config\n// @desc    Get shop configuration\n// @access  Public\nrouter.get('/config', async (req, res) => {\n  try {\n    const result = await ShopService.getShopConfig();\n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in shop config route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching shop configuration'\n    });\n  }\n});\n\n// @route   GET /api/shop/complete\n// @desc    Get complete shop data including menu from database\n// @access  Public\nrouter.get('/complete', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in complete shop data route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching complete shop data'\n    });\n  }\n});\n\n// @route   GET /api/shop/status\n// @desc    Get shop status (open/closed)\n// @access  Public\nrouter.get('/status', async (req, res) => {\n  try {\n    const result = await ShopService.getShopStatus();\n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in shop status route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching shop status'\n    });\n  }\n});\n\n// @route   PUT /api/shop/config\n// @desc    Update shop configuration\n// @access  Private (Admin only)\nrouter.put('/config', protect, authorize('admin'), async (req, res) => {\n  try {\n    const result = await ShopService.updateShopConfig(req.body);\n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data,\n        message: result.message\n      });\n    } else {\n      res.status(400).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in update shop config route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating shop configuration'\n    });\n  }\n});\n\n// @route   POST /api/shop/initialize\n// @desc    Initialize default shop data\n// @access  Private (Admin only)\nrouter.post('/initialize', protect, authorize('admin'), async (req, res) => {\n  try {\n    const result = await ShopService.initializeShopData();\n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data,\n        message: result.message\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in initialize shop data route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while initializing shop data'\n    });\n  }\n});\n\n// @route   GET /api/shop/menu\n// @desc    Get menu data from products\n// @access  Public\nrouter.get('/menu', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    if (result.success) {\n      // Return only menu data\n      res.json({\n        success: true,\n        data: {\n          menu: result.data.menu,\n          businessName: result.data.businessName,\n          lastUpdated: result.data.lastUpdated\n        }\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in menu route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching menu data'\n    });\n  }\n});\n\n// @route   GET /api/shop/ai-context\n// @desc    Get shop data formatted for AI context\n// @access  Public\nrouter.get('/ai-context', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    if (result.success) {\n      // Format data specifically for AI context usage\n      const aiContext = {\n        business: result.data.business,\n        businessName: result.data.business.name,\n        storeName: result.data.business.name,\n        location: result.data.location,\n        contact: result.data.contact,\n        hours: result.data.hours,\n        menu: result.data.menu,\n        services: result.data.services,\n        amenities: result.data.amenities,\n        payment: result.data.payment,\n        policies: result.data.policies,\n        responseTemplates: result.data.responseTemplates,\n        lastUpdated: result.data.lastUpdated\n      };\n      res.json({\n        success: true,\n        data: aiContext\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in AI context route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching AI context data'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIlNob3BTZXJ2aWNlIiwicHJvdGVjdCIsImF1dGhvcml6ZSIsImdldCIsInJlcSIsInJlcyIsInJlc3VsdCIsImdldFNob3BDb25maWciLCJzdWNjZXNzIiwianNvbiIsImRhdGEiLCJzdGF0dXMiLCJtZXNzYWdlIiwiZXJyb3IiLCJjb25zb2xlIiwiZ2V0Q29tcGxldGVTaG9wRGF0YSIsImdldFNob3BTdGF0dXMiLCJwdXQiLCJ1cGRhdGVTaG9wQ29uZmlnIiwiYm9keSIsInBvc3QiLCJpbml0aWFsaXplU2hvcERhdGEiLCJtZW51IiwiYnVzaW5lc3NOYW1lIiwibGFzdFVwZGF0ZWQiLCJhaUNvbnRleHQiLCJidXNpbmVzcyIsIm5hbWUiLCJzdG9yZU5hbWUiLCJsb2NhdGlvbiIsImNvbnRhY3QiLCJob3VycyIsInNlcnZpY2VzIiwiYW1lbml0aWVzIiwicGF5bWVudCIsInBvbGljaWVzIiwicmVzcG9uc2VUZW1wbGF0ZXMiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xccm91dGVzXFwiLCJzb3VyY2VzIjpbInNob3AuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5jb25zdCBTaG9wU2VydmljZSA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL3Nob3BTZXJ2aWNlJyk7XG5jb25zdCB7IHByb3RlY3QsIGF1dGhvcml6ZSB9ID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZS9hdXRoJyk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3Nob3AvY29uZmlnXG4vLyBAZGVzYyAgICBHZXQgc2hvcCBjb25maWd1cmF0aW9uXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5nZXQoJy9jb25maWcnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBTaG9wU2VydmljZS5nZXRTaG9wQ29uZmlnKCk7XG4gICAgXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdC5kYXRhXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBzaG9wIGNvbmZpZyByb3V0ZTonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIHNob3AgY29uZmlndXJhdGlvbidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3Nob3AvY29tcGxldGVcbi8vIEBkZXNjICAgIEdldCBjb21wbGV0ZSBzaG9wIGRhdGEgaW5jbHVkaW5nIG1lbnUgZnJvbSBkYXRhYmFzZVxuLy8gQGFjY2VzcyAgUHVibGljXG5yb3V0ZXIuZ2V0KCcvY29tcGxldGUnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBTaG9wU2VydmljZS5nZXRDb21wbGV0ZVNob3BEYXRhKCk7XG4gICAgXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdC5kYXRhXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBjb21wbGV0ZSBzaG9wIGRhdGEgcm91dGU6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBjb21wbGV0ZSBzaG9wIGRhdGEnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9zaG9wL3N0YXR1c1xuLy8gQGRlc2MgICAgR2V0IHNob3Agc3RhdHVzIChvcGVuL2Nsb3NlZClcbi8vIEBhY2Nlc3MgIFB1YmxpY1xucm91dGVyLmdldCgnL3N0YXR1cycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFNob3BTZXJ2aWNlLmdldFNob3BTdGF0dXMoKTtcbiAgICBcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0LmRhdGFcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiByZXN1bHQubWVzc2FnZVxuICAgICAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHNob3Agc3RhdHVzIHJvdXRlOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgc2hvcCBzdGF0dXMnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBQVVQgL2FwaS9zaG9wL2NvbmZpZ1xuLy8gQGRlc2MgICAgVXBkYXRlIHNob3AgY29uZmlndXJhdGlvblxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoQWRtaW4gb25seSlcbnJvdXRlci5wdXQoJy9jb25maWcnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFNob3BTZXJ2aWNlLnVwZGF0ZVNob3BDb25maWcocmVxLmJvZHkpO1xuICAgIFxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQuZGF0YSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiByZXN1bHQubWVzc2FnZVxuICAgICAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZSBzaG9wIGNvbmZpZyByb3V0ZTonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIHVwZGF0aW5nIHNob3AgY29uZmlndXJhdGlvbidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9zaG9wL2luaXRpYWxpemVcbi8vIEBkZXNjICAgIEluaXRpYWxpemUgZGVmYXVsdCBzaG9wIGRhdGFcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKEFkbWluIG9ubHkpXG5yb3V0ZXIucG9zdCgnL2luaXRpYWxpemUnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFNob3BTZXJ2aWNlLmluaXRpYWxpemVTaG9wRGF0YSgpO1xuICAgIFxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQuZGF0YSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiByZXN1bHQubWVzc2FnZVxuICAgICAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGluaXRpYWxpemUgc2hvcCBkYXRhIHJvdXRlOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgaW5pdGlhbGl6aW5nIHNob3AgZGF0YSdcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3Nob3AvbWVudVxuLy8gQGRlc2MgICAgR2V0IG1lbnUgZGF0YSBmcm9tIHByb2R1Y3RzXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5nZXQoJy9tZW51JywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgU2hvcFNlcnZpY2UuZ2V0Q29tcGxldGVTaG9wRGF0YSgpO1xuICAgIFxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgLy8gUmV0dXJuIG9ubHkgbWVudSBkYXRhXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBtZW51OiByZXN1bHQuZGF0YS5tZW51LFxuICAgICAgICAgIGJ1c2luZXNzTmFtZTogcmVzdWx0LmRhdGEuYnVzaW5lc3NOYW1lLFxuICAgICAgICAgIGxhc3RVcGRhdGVkOiByZXN1bHQuZGF0YS5sYXN0VXBkYXRlZFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBtZW51IHJvdXRlOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgbWVudSBkYXRhJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvc2hvcC9haS1jb250ZXh0XG4vLyBAZGVzYyAgICBHZXQgc2hvcCBkYXRhIGZvcm1hdHRlZCBmb3IgQUkgY29udGV4dFxuLy8gQGFjY2VzcyAgUHVibGljXG5yb3V0ZXIuZ2V0KCcvYWktY29udGV4dCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFNob3BTZXJ2aWNlLmdldENvbXBsZXRlU2hvcERhdGEoKTtcbiAgICBcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIC8vIEZvcm1hdCBkYXRhIHNwZWNpZmljYWxseSBmb3IgQUkgY29udGV4dCB1c2FnZVxuICAgICAgY29uc3QgYWlDb250ZXh0ID0ge1xuICAgICAgICBidXNpbmVzczogcmVzdWx0LmRhdGEuYnVzaW5lc3MsXG4gICAgICAgIGJ1c2luZXNzTmFtZTogcmVzdWx0LmRhdGEuYnVzaW5lc3MubmFtZSxcbiAgICAgICAgc3RvcmVOYW1lOiByZXN1bHQuZGF0YS5idXNpbmVzcy5uYW1lLFxuICAgICAgICBsb2NhdGlvbjogcmVzdWx0LmRhdGEubG9jYXRpb24sXG4gICAgICAgIGNvbnRhY3Q6IHJlc3VsdC5kYXRhLmNvbnRhY3QsXG4gICAgICAgIGhvdXJzOiByZXN1bHQuZGF0YS5ob3VycyxcbiAgICAgICAgbWVudTogcmVzdWx0LmRhdGEubWVudSxcbiAgICAgICAgc2VydmljZXM6IHJlc3VsdC5kYXRhLnNlcnZpY2VzLFxuICAgICAgICBhbWVuaXRpZXM6IHJlc3VsdC5kYXRhLmFtZW5pdGllcyxcbiAgICAgICAgcGF5bWVudDogcmVzdWx0LmRhdGEucGF5bWVudCxcbiAgICAgICAgcG9saWNpZXM6IHJlc3VsdC5kYXRhLnBvbGljaWVzLFxuICAgICAgICByZXNwb25zZVRlbXBsYXRlczogcmVzdWx0LmRhdGEucmVzcG9uc2VUZW1wbGF0ZXMsXG4gICAgICAgIGxhc3RVcGRhdGVkOiByZXN1bHQuZGF0YS5sYXN0VXBkYXRlZFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBhaUNvbnRleHRcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiByZXN1bHQubWVzc2FnZVxuICAgICAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIEFJIGNvbnRleHQgcm91dGU6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBBSSBjb250ZXh0IGRhdGEnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTUMsV0FBVyxHQUFHSCxPQUFPLENBQUMseUJBQXlCLENBQUM7QUFDdEQsTUFBTTtFQUFFSSxPQUFPO0VBQUVDO0FBQVUsQ0FBQyxHQUFHTCxPQUFPLENBQUMsb0JBQW9CLENBQUM7O0FBRTVEO0FBQ0E7QUFDQTtBQUNBQyxNQUFNLENBQUNLLEdBQUcsQ0FBQyxTQUFTLEVBQUUsT0FBT0MsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDeEMsSUFBSTtJQUNGLE1BQU1DLE1BQU0sR0FBRyxNQUFNTixXQUFXLENBQUNPLGFBQWEsQ0FBQyxDQUFDO0lBRWhELElBQUlELE1BQU0sQ0FBQ0UsT0FBTyxFQUFFO01BQ2xCSCxHQUFHLENBQUNJLElBQUksQ0FBQztRQUNQRCxPQUFPLEVBQUUsSUFBSTtRQUNiRSxJQUFJLEVBQUVKLE1BQU0sQ0FBQ0k7TUFDZixDQUFDLENBQUM7SUFDSixDQUFDLE1BQU07TUFDTEwsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNGLElBQUksQ0FBQztRQUNuQkQsT0FBTyxFQUFFLEtBQUs7UUFDZEksT0FBTyxFQUFFTixNQUFNLENBQUNNO01BQ2xCLENBQUMsQ0FBQztJQUNKO0VBQ0YsQ0FBQyxDQUFDLE9BQU9DLEtBQUssRUFBRTtJQUNkQyxPQUFPLENBQUNELEtBQUssQ0FBQyw2QkFBNkIsRUFBRUEsS0FBSyxDQUFDO0lBQ25EUixHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0YsSUFBSSxDQUFDO01BQ25CRCxPQUFPLEVB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","map":{"version":3,"names":["express","require","router","Router","ShopService","protect","authorize","get","req","res","result","getShopConfig","success","json","data","status","message","error","console","getCompleteShopData","getShopStatus","put","updateShopConfig","body","post","initializeShopData","menu","businessName","lastUpdated","aiContext","business","name","storeName","location","contact","hours","services","amenities","payment","policies","responseTemplates","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["shop.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst ShopService = require('../services/shopService');\nconst { protect, authorize } = require('../middleware/auth');\n\n// @route   GET /api/shop/config\n// @desc    Get shop configuration\n// @access  Public\nrouter.get('/config', async (req, res) => {\n  try {\n    const result = await ShopService.getShopConfig();\n    \n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in shop config route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching shop configuration'\n    });\n  }\n});\n\n// @route   GET /api/shop/complete\n// @desc    Get complete shop data including menu from database\n// @access  Public\nrouter.get('/complete', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    \n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in complete shop data route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching complete shop data'\n    });\n  }\n});\n\n// @route   GET /api/shop/status\n// @desc    Get shop status (open/closed)\n// @access  Public\nrouter.get('/status', async (req, res) => {\n  try {\n    const result = await ShopService.getShopStatus();\n    \n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in shop status route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching shop status'\n    });\n  }\n});\n\n// @route   PUT /api/shop/config\n// @desc    Update shop configuration\n// @access  Private (Admin only)\nrouter.put('/config', protect, authorize('admin'), async (req, res) => {\n  try {\n    const result = await ShopService.updateShopConfig(req.body);\n    \n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data,\n        message: result.message\n      });\n    } else {\n      res.status(400).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in update shop config route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating shop configuration'\n    });\n  }\n});\n\n// @route   POST /api/shop/initialize\n// @desc    Initialize default shop data\n// @access  Private (Admin only)\nrouter.post('/initialize', protect, authorize('admin'), async (req, res) => {\n  try {\n    const result = await ShopService.initializeShopData();\n    \n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data,\n        message: result.message\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in initialize shop data route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while initializing shop data'\n    });\n  }\n});\n\n// @route   GET /api/shop/menu\n// @desc    Get menu data from products\n// @access  Public\nrouter.get('/menu', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    \n    if (result.success) {\n      // Return only menu data\n      res.json({\n        success: true,\n        data: {\n          menu: result.data.menu,\n          businessName: result.data.businessName,\n          lastUpdated: result.data.lastUpdated\n        }\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in menu route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching menu data'\n    });\n  }\n});\n\n// @route   GET /api/shop/ai-context\n// @desc    Get shop data formatted for AI context\n// @access  Public\nrouter.get('/ai-context', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    \n    if (result.success) {\n      // Format data specifically for AI context usage\n      const aiContext = {\n        business: result.data.business,\n        businessName: result.data.business.name,\n        storeName: result.data.business.name,\n        location: result.data.location,\n        contact: result.data.contact,\n        hours: result.data.hours,\n        menu: result.data.menu,\n        services: result.data.services,\n        amenities: result.data.amenities,\n        payment: result.data.payment,\n        policies: result.data.policies,\n        responseTemplates: result.data.responseTemplates,\n        lastUpdated: result.data.lastUpdated\n      };\n      \n      res.json({\n        success: true,\n        data: aiContext\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in AI context route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching AI context data'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAMC,WAAW,GAAGH,OAAO,CAAC,yBAAyB,CAAC;AACtD,MAAM;EAAEI,OAAO;EAAEC;AAAU,CAAC,GAAGL,OAAO,CAAC,oBAAoB,CAAC;;AAE5D;AACA;AACA;AACAC,MAAM,CAACK,GAAG,CAAC,SAAS,EAAE,OAAOC,GAAG,EAAEC,GAAG,KAAK;EACxC,IAAI;IACF,MAAMC,MAAM,GAAG,MAAMN,WAAW,CAACO,aAAa,CAAC,CAAC;IAEhD,IAAID,MAAM,CAACE,OAAO,EAAE;MAClBH,GAAG,CAACI,IAAI,CAAC;QACPD,OAAO,EAAE,IAAI;QACbE,IAAI,EAAEJ,MAAM,CAACI;MACf,CAAC,CAAC;IACJ,CAAC,MAAM;MACLL,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QACnBD,OAAO,EAAE,KAAK;QACdI,OAAO,EAAEN,MAAM,CAACM;MAClB,CAAC,CAAC;IACJ;EACF,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;IACnDR,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBD,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACAd,MAAM,CAACK,GAAG,CAAC,WAAW,EAAE,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAC1C,IAAI;IACF,MAAMC,MAAM,GAAG,MAAMN,WAAW,CAACe,mBAAmB,CAAC,CAAC;IAEtD,IAAIT,MAAM,CAACE,OAAO,EAAE;MAClBH,GAAG,CAACI,IAAI,CAAC;QACPD,OAAO,EAAE,IAAI;QACbE,IAAI,EAAEJ,MAAM,CAACI;MACf,CAAC,CAAC;IACJ,CAAC,MAAM;MACLL,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QACnBD,OAAO,EAAE,KAAK;QACdI,OAAO,EAAEN,MAAM,CAACM;MAClB,CAAC,CAAC;IACJ;EACF,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;IAC1DR,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBD,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACAd,MAAM,CAACK,GAAG,CAAC,SAAS,EAAE,OAAOC,GAAG,EAAEC,GAAG,KAAK;EACxC,IAAI;IACF,MAAMC,MAAM,GAAG,MAAMN,WAAW,CAACgB,aAAa,CAAC,CAAC;IAEhD,IAAIV,MAAM,CAACE,OAAO,EAAE;MAClBH,GAAG,CAACI,IAAI,CAAC;QACPD,OAAO,EAAE,IAAI;QACbE,IAAI,EAAEJ,MAAM,CAACI;MACf,CAAC,CAAC;IACJ,CAAC,MAAM;MACLL,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QACnBD,OAAO,EAAE,KAAK;QACdI,OAAO,EAAEN,MAAM,CAACM;MAClB,CAAC,CAAC;IACJ;EACF,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;IACnDR,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBD,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACAd,MAAM,CAACmB,GAAG,CAAC,SAAS,EAAEhB,OAAO,EAAEC,SAAS,CAAC,OAAO,CAAC,EAAE,OAAOE,GAAG,EAAEC,GAAG,KAAK;EACrE,IAAI;IACF,MAAMC,MAAM,GAAG,MAAMN,WAAW,CAACkB,gBAAgB,CAACd,GAAG,CAACe,IAAI,CAAC;IAE3D,IAAIb,MAAM,CAACE,OAAO,EAAE;MAClBH,GAAG,CAACI,IAAI,CAAC;QACPD,OAAO,EAAE,IAAI;QACbE,IAAI,EAAEJ,MAAM,CAACI,IAAI;QACjBE,OAAO,EAAEN,MAAM,CAACM;MAClB,CAAC,CAAC;IACJ,CAAC,MAAM;MACLP,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QACnBD,OAAO,EAAE,KAAK;QACdI,OAAO,EAAEN,MAAM,CAACM;MAClB,CAAC,CAAC;IACJ;EACF,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;IAC1DR,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBD,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACAd,MAAM,CAACsB,IAAI,CAAC,aAAa,EAAEnB,OAAO,EAAEC,SAAS,CAAC,OAAO,CAAC,EAAE,OAAOE,GAAG,EAAEC,GAAG,KAAK;EAC1E,IAAI;IACF,MAAMC,MAAM,GAAG,MAAMN,WAAW,CAACqB,kBAAkB,CAAC,CAAC;IAErD,IAAIf,MAAM,CAACE,OAAO,EAAE;MAClBH,GAAG,CAACI,IAAI,CAAC;QACPD,OAAO,EAAE,IAAI;QACbE,IAAI,EAAEJ,MAAM,CAACI,IAAI;QACjBE,OAAO,EAAEN,MAAM,CAACM;MAClB,CAAC,CAAC;IACJ,CAAC,MAAM;MACLP,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QACnBD,OAAO,EAAE,KAAK;QACdI,OAAO,EAAEN,MAAM,CAACM;MAClB,CAAC,CAAC;IACJ;EACF,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;IAC5DR,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBD,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACAd,MAAM,CAACK,GAAG,CAAC,OAAO,EAAE,OAAOC,GAAG,EAAEC,GAAG,KAAK;EACtC,IAAI;IACF,MAAMC,MAAM,GAAG,MAAMN,WAAW,CAACe,mBAAmB,CAAC,CAAC;IAEtD,IAAIT,MAAM,CAACE,OAAO,EAAE;MAClB;MACAH,GAAG,CAACI,IAAI,CAAC;QACPD,OAAO,EAAE,IAAI;QACbE,IAAI,EAAE;UACJY,IAAI,EAAEhB,MAAM,CAACI,IAAI,CAACY,IAAI;UACtBC,YAAY,EAAEjB,MAAM,CAACI,IAAI,CAACa,YAAY;UACtCC,WAAW,EAAElB,MAAM,CAACI,IAAI,CAACc;QAC3B;MACF,CAAC,CAAC;IACJ,CAAC,MAAM;MACLnB,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QACnBD,OAAO,EAAE,KAAK;QACdI,OAAO,EAAEN,MAAM,CAACM;MAClB,CAAC,CAAC;IACJ;EACF,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;IAC5CR,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBD,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACAd,MAAM,CAACK,GAAG,CAAC,aAAa,EAAE,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAC5C,IAAI;IACF,MAAMC,MAAM,GAAG,MAAMN,WAAW,CAACe,mBAAmB,CAAC,CAAC;IAEtD,IAAIT,MAAM,CAACE,OAAO,EAAE;MAClB;MACA,MAAMiB,SAAS,GAAG;QAChBC,QAAQ,EAAEpB,MAAM,CAACI,IAAI,CAACgB,QAAQ;QAC9BH,YAAY,EAAEjB,MAAM,CAACI,IAAI,CAACgB,QAAQ,CAACC,IAAI;QACvCC,SAAS,EAAEtB,MAAM,CAACI,IAAI,CAACgB,QAAQ,CAACC,IAAI;QACpCE,QAAQ,EAAEvB,MAAM,CAACI,IAAI,CAACmB,QAAQ;QAC9BC,OAAO,EAAExB,MAAM,CAACI,IAAI,CAACoB,OAAO;QAC5BC,KAAK,EAAEzB,MAAM,CAACI,IAAI,CAACqB,KAAK;QACxBT,IAAI,EAAEhB,MAAM,CAACI,IAAI,CAACY,IAAI;QACtBU,QAAQ,EAAE1B,MAAM,CAACI,IAAI,CAACsB,QAAQ;QAC9BC,SAAS,EAAE3B,MAAM,CAACI,IAAI,CAACuB,SAAS;QAChCC,OAAO,EAAE5B,MAAM,CAACI,IAAI,CAACwB,OAAO;QAC5BC,QAAQ,EAAE7B,MAAM,CAACI,IAAI,CAACyB,QAAQ;QAC9BC,iBAAiB,EAAE9B,MAAM,CAACI,IAAI,CAAC0B,iBAAiB;QAChDZ,WAAW,EAAElB,MAAM,CAACI,IAAI,CAACc;MAC3B,CAAC;MAEDnB,GAAG,CAACI,IAAI,CAAC;QACPD,OAAO,EAAE,IAAI;QACbE,IAAI,EAAEe;MACR,CAAC,CAAC;IACJ,CAAC,MAAM;MACLpB,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QACnBD,OAAO,EAAE,KAAK;QACdI,OAAO,EAAEN,MAAM,CAACM;MAClB,CAAC,CAAC;IACJ;EACF,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;IAClDR,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBD,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;AAEFyB,MAAM,CAACC,OAAO,GAAGxC,MAAM","ignoreList":[]}},"mtime":1757007726524},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\services\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\services\\\\shopService.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const Shop = require('../models/Shop');\nconst Product = require('../models/Product');\nclass ShopService {\n  /**\n   * Get the active shop configuration\n   * @returns {Promise<Object>} Shop configuration\n   */\n  static async getShopConfig() {\n    try {\n      const shop = await Shop.getActiveShop();\n      return {\n        success: true,\n        data: shop\n      };\n    } catch (error) {\n      console.error('Error fetching shop config:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch shop configuration',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get complete shop data including menu from products\n   * @returns {Promise<Object>} Complete shop data with menu\n   */\n  static async getCompleteShopData() {\n    try {\n      const shop = await Shop.getActiveShop();\n      const products = await Product.find({\n        inStock: true\n      }).sort({\n        category: 1,\n        name: 1\n      });\n\n      // Group products by category to create menu structure\n      const menuCategories = {};\n      products.forEach(product => {\n        if (!menuCategories[product.category]) {\n          menuCategories[product.category] = {\n            name: product.category,\n            vietnamese: this.getCategoryVietnameseName(product.category),\n            items: []\n          };\n        }\n\n        // Format product for menu\n        const menuItem = {\n          id: product._id,\n          name: product.name,\n          description: product.description,\n          price: this.formatPrice(product.price),\n          category: product.category,\n          image: product.image,\n          featured: product.featured,\n          ingredients: product.ingredients || [],\n          nutritionalInfo: product.nutritionalInfo || {},\n          sizes: product.sizes || []\n        };\n        menuCategories[product.category].items.push(menuItem);\n      });\n\n      // Convert to array format\n      const menu = {\n        categories: Object.values(menuCategories),\n        specialties: this.extractSpecialties(products)\n      };\n\n      // Combine shop data with dynamic menu\n      const completeData = {\n        ...shop.toObject(),\n        menu,\n        businessName: shop.business.name,\n        // For backward compatibility\n        storeName: shop.business.name,\n        // For backward compatibility\n        lastUpdated: new Date().toISOString()\n      };\n      return {\n        success: true,\n        data: completeData\n      };\n    } catch (error) {\n      console.error('Error fetching complete shop data:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch complete shop data',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Update shop configuration\n   * @param {Object} updateData - Data to update\n   * @returns {Promise<Object>} Updated shop configuration\n   */\n  static async updateShopConfig(updateData) {\n    try {\n      const shop = await Shop.getActiveShop();\n\n      // Update shop data\n      Object.keys(updateData).forEach(key => {\n        if (updateData[key] !== undefined) {\n          shop[key] = updateData[key];\n        }\n      });\n      await shop.save();\n      return {\n        success: true,\n        data: shop,\n        message: 'Shop configuration updated successfully'\n      };\n    } catch (error) {\n      console.error('Error updating shop config:', error);\n      return {\n        success: false,\n        message: 'Failed to update shop configuration',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get shop status (open/closed)\n   * @returns {Promise<Object>} Shop status information\n   */\n  static async getShopStatus() {\n    try {\n      const shop = await Shop.getActiveShop();\n      const isOpen = shop.isCurrentlyOpen();\n      const now = new Date();\n      const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n      const currentHours = isWeekend ? shop.hours.weekends : shop.hours.weekdays;\n      return {\n        success: true,\n        data: {\n          isOpen,\n          currentHours: currentHours.display,\n          nextChange: this.getNextStatusChange(shop, now),\n          timezone: shop.hours.timezone\n        }\n      };\n    } catch (error) {\n      console.error('Error fetching shop status:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch shop status',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get Vietnamese category name mapping\n   * @param {string} category - English category name\n   * @returns {string} Vietnamese category name\n   */\n  static getCategoryVietnameseName(category) {\n    const mapping = {\n      'Cà phê': 'Cà Phê',\n      'Coffee': 'Cà Phê',\n      'Thức uống đậm vị': 'Thức Uống Đậm Vị',\n      'Đồ uống tươi mát': 'Đồ Uống Tươi Mát',\n      'Bánh ngọt': 'Bánh Ngọt',\n      'Pastries': 'Bánh Ngọt',\n      'Light Meals': 'Món Ăn Nhẹ',\n      'Món ăn nhẹ': 'Món Ăn Nhẹ'\n    };\n    return mapping[category] || category;\n  }\n\n  /**\n   * Format price for display\n   * @param {number} price - Price in number format\n   * @returns {string} Formatted price string\n   */\n  static formatPrice(price) {\n    if (typeof price === 'number') {\n      return `${(price * 1000).toLocaleString('vi-VN')} VND`;\n    }\n    return price;\n  }\n\n  /**\n   * Extract specialties from products\n   * @param {Array} products - Array of products\n   * @returns {Array} Array of specialty items\n   */\n  static extractSpecialties(products) {\n    return products.filter(product => product.featured).map(product => product.name).slice(0, 4); // Limit to 4 specialties\n  }\n\n  /**\n   * Calculate next status change time\n   * @param {Object} shop - Shop configuration\n   * @param {Date} now - Current date\n   * @returns {string} Next status change description\n   */\n  static getNextStatusChange(shop, now) {\n    const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n    const currentHours = isWeekend ? shop.hours.weekends : shop.hours.weekdays;\n    const isOpen = shop.isCurrentlyOpen();\n    if (isOpen) {\n      return `Closes at ${currentHours.close}`;\n    } else {\n      return `Opens at ${currentHours.open}`;\n    }\n  }\n\n  /**\n   * Initialize default shop data if none exists\n   * @returns {Promise<Object>} Initialization result\n   */\n  static async initializeShopData() {\n    try {\n      const existingShop = await Shop.findOne({\n        isActive: true\n      });\n      if (!existingShop) {\n        const defaultShop = new Shop({});\n        await defaultShop.save();\n        return {\n          success: true,\n          message: 'Default shop data initialized',\n          data: defaultShop\n        };\n      }\n      return {\n        success: true,\n        message: 'Shop data already exists',\n        data: existingShop\n      };\n    } catch (error) {\n      console.error('Error initializing shop data:', error);\n      return {\n        success: false,\n        message: 'Failed to initialize shop data',\n        error: error.message\n      };\n    }\n  }\n}\nmodule.exports = ShopService;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaG9wIiwicmVxdWlyZSIsIlByb2R1Y3QiLCJTaG9wU2VydmljZSIsImdldFNob3BDb25maWciLCJzaG9wIiwiZ2V0QWN0aXZlU2hvcCIsInN1Y2Nlc3MiLCJkYXRhIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsImdldENvbXBsZXRlU2hvcERhdGEiLCJwcm9kdWN0cyIsImZpbmQiLCJpblN0b2NrIiwic29ydCIsImNhdGVnb3J5IiwibmFtZSIsIm1lbnVDYXRlZ29yaWVzIiwiZm9yRWFjaCIsInByb2R1Y3QiLCJ2aWV0bmFtZXNlIiwiZ2V0Q2F0ZWdvcnlWaWV0bmFtZXNlTmFtZSIsIml0ZW1zIiwibWVudUl0ZW0iLCJpZCIsIl9pZCIsImRlc2NyaXB0aW9uIiwicHJpY2UiLCJmb3JtYXRQcmljZSIsImltYWdlIiwiZmVhdHVyZWQiLCJpbmdyZWRpZW50cyIsIm51dHJpdGlvbmFsSW5mbyIsInNpemVzIiwicHVzaCIsIm1lbnUiLCJjYXRlZ29yaWVzIiwiT2JqZWN0IiwidmFsdWVzIiwic3BlY2lhbHRpZXMiLCJleHRyYWN0U3BlY2lhbHRpZXMiLCJjb21wbGV0ZURhdGEiLCJ0b09iamVjdCIsImJ1c2luZXNzTmFtZSIsImJ1c2luZXNzIiwic3RvcmVOYW1lIiwibGFzdFVwZGF0ZWQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJ1cGRhdGVTaG9wQ29uZmlnIiwidXBkYXRlRGF0YSIsImtleXMiLCJrZXkiLCJ1bmRlZmluZWQiLCJzYXZlIiwiZ2V0U2hvcFN0YXR1cyIsImlzT3BlbiIsImlzQ3VycmVudGx5T3BlbiIsIm5vdyIsImlzV2Vla2VuZCIsImdldERheSIsImN1cnJlbnRIb3VycyIsImhvdXJzIiwid2Vla2VuZHMiLCJ3ZWVrZGF5cyIsImRpc3BsYXkiLCJuZXh0Q2hhbmdlIiwiZ2V0TmV4dFN0YXR1c0NoYW5nZSIsInRpbWV6b25lIiwibWFwcGluZyIsInRvTG9jYWxlU3RyaW5nIiwiZmlsdGVyIiwibWFwIiwic2xpY2UiLCJjbG9zZSIsIm9wZW4iLCJpbml0aWFsaXplU2hvcERhdGEiLCJleGlzdGluZ1Nob3AiLCJmaW5kT25lIiwiaXNBY3RpdmUiLCJkZWZhdWx0U2hvcCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkQ6XFxjb2RlXFxXZWJDYWZmZVxcYmFja2VuZFxcc3JjXFxzZXJ2aWNlc1xcIiwic291cmNlcyI6WyJzaG9wU2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBTaG9wID0gcmVxdWlyZSgnLi4vbW9kZWxzL1Nob3AnKTtcbmNvbnN0IFByb2R1Y3QgPSByZXF1aXJlKCcuLi9tb2RlbHMvUHJvZHVjdCcpO1xuXG5jbGFzcyBTaG9wU2VydmljZSB7XG4gIC8qKlxuICAgKiBHZXQgdGhlIGFjdGl2ZSBzaG9wIGNvbmZpZ3VyYXRpb25cbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gU2hvcCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0U2hvcENvbmZpZygpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2hvcCA9IGF3YWl0IFNob3AuZ2V0QWN0aXZlU2hvcCgpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogc2hvcFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgc2hvcCBjb25maWc6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggc2hvcCBjb25maWd1cmF0aW9uJyxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb21wbGV0ZSBzaG9wIGRhdGEgaW5jbHVkaW5nIG1lbnUgZnJvbSBwcm9kdWN0c1xuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3Q+fSBDb21wbGV0ZSBzaG9wIGRhdGEgd2l0aCBtZW51XG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0Q29tcGxldGVTaG9wRGF0YSgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2hvcCA9IGF3YWl0IFNob3AuZ2V0QWN0aXZlU2hvcCgpO1xuICAgICAgY29uc3QgcHJvZHVjdHMgPSBhd2FpdCBQcm9kdWN0LmZpbmQoeyBpblN0b2NrOiB0cnVlIH0pLnNvcnQoeyBjYXRlZ29yeTogMSwgbmFtZTogMSB9KTtcbiAgICAgIFxuICAgICAgLy8gR3JvdXAgcHJvZHVjdHMgYnkgY2F0ZWdvcnkgdG8gY3JlYXRlIG1lbnUgc3RydWN0dXJlXG4gICAgICBjb25zdCBtZW51Q2F0ZWdvcmllcyA9IHt9O1xuICAgICAgXG4gICAgICBwcm9kdWN0cy5mb3JFYWNoKHByb2R1Y3QgPT4ge1xuICAgICAgICBpZiAoIW1lbnVDYXRlZ29yaWVzW3Byb2R1Y3QuY2F0ZWdvcnldKSB7XG4gICAgICAgICAgbWVudUNhdGVnb3JpZXNbcHJvZHVjdC5jYXRlZ29yeV0gPSB7XG4gICAgICAgICAgICBuYW1lOiBwcm9kdWN0LmNhdGVnb3J5LFxuICAgICAgICAgICAgdmlldG5hbWVzZTogdGhpcy5nZXRDYXRlZ29yeVZpZXRuYW1lc2VOYW1lKHByb2R1Y3QuY2F0ZWdvcnkpLFxuICAgICAgICAgICAgaXRlbXM6IFtdXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gRm9ybWF0IHByb2R1Y3QgZm9yIG1lbnVcbiAgICAgICAgY29uc3QgbWVudUl0ZW0gPSB7XG4gICAgICAgICAgaWQ6IHByb2R1Y3QuX2lkLFxuICAgICAgICAgIG5hbWU6IHByb2R1Y3QubmFtZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogcHJvZHVjdC5kZXNjcmlwdGlvbixcbiAgICAgICAgICBwcmljZTogdGhpcy5mb3JtYXRQcmljZShwcm9kdWN0LnByaWNlKSxcbiAgICAgICAgICBjYXRlZ29yeTogcHJvZHVjdC5jYXRlZ29yeSxcbiAgICAgICAgICBpbWFnZTogcHJvZHVjdC5pbWFnZSxcbiAgICAgICAgICBmZWF0dXJlZDogcHJvZHVjdC5mZWF0dXJlZCxcbiAgICAgICAgICBpbmdyZWRpZW50czogcHJvZHVjdC5pbmdyZWRpZW50cyB8fCBbXSxcbiAgICAgICAgICBudXRyaXRpb25hbEluZm86IHByb2R1Y3QubnV0cml0aW9uYWxJbmZvIHx8IHt9LFxuICAgICAgICAgIHNpemVzOiBwcm9kdWN0LnNpemVzIHx8IFtdXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBtZW51Q2F0ZWdvcmllc1twcm9kdWN0LmNhdGVnb3J5XS5pdGVtcy5wdXNoKG1lbnVJdGVtKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBDb252ZXJ0IHRvIGFycmF5IGZvcm1hdFxuICAgICAgY29uc3QgbWVudSA9IHtcbiAgICAgICAgY2F0ZWdvcmllczogT2JqZWN0LnZhbHVlcyhtZW51Q2F0ZWdvcmllcyksXG4gICAgICAgIHNwZWNpYWx0aWVzOiB0aGlzLmV4dHJhY3RTcGVjaWFsdGllcyhwcm9kdWN0cylcbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vIENvbWJpbmUgc2hvcCBkYXRhIHdpdGggZHluYW1pYyBtZW51XG4gICAgICBjb25zdCBjb21wbGV0ZURhdGEgPSB7XG4gICAgICAgIC4uLnNob3AudG9PYmplY3QoKSxcbiAgICAgICAgbWVudSxcbiAgICAgICAgYnVzaW5lc3NOYW1lOiBzaG9wLmJ1c2luZXNzLm5hbWUsIC8vIEZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gICAgICAgIHN0b3JlTmFtZTogc2hvcC5idXNpbmVzcy5uYW1lLCAgICAvLyBGb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9O1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjb21wbGV0ZURhdGFcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGNvbXBsZXRlIHNob3AgZGF0YTonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBjb21wbGV0ZSBzaG9wIGRhdGEnLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNob3AgY29uZmlndXJhdGlvblxuICAgKiBAcGFyYW0ge09iamVjdH0gdXBkYXRlRGF0YSAtIERhdGEgdG8gdXBkYXRlXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IFVwZGF0ZWQgc2hvcCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgdXBkYXRlU2hvcENvbmZpZyh1cGRhdGVEYXRhKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNob3AgPSBhd2FpdCBTaG9wLmdldEFjdGl2ZVNob3AoKTtcbiAgICAgIFxuICAgICAgLy8gVXBkYXRlIHNob3AgZGF0YVxuICAgICAgT2JqZWN0LmtleXModXBkYXRlRGF0YSkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICBpZiAodXBkYXRlRGF0YVtrZXldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBzaG9wW2tleV0gPSB1cGRhdGVEYXRhW2tleV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBzaG9wLnNhdmUoKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogc2hvcCxcbiAgICAgICAgbWVzc2FnZTogJ1Nob3AgY29uZmlndXJhdGlvbiB1cGRhdGVkIHN1Y2Nlc3NmdWxseSdcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHNob3AgY29uZmlnOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwZGF0ZSBzaG9wIGNvbmZpZ3VyYXRpb24nLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNob3Agc3RhdHVzIChvcGVuL2Nsb3NlZClcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gU2hvcCBzdGF0dXMgaW5mb3JtYXRpb25cbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRTaG9wU3RhdHVzKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzaG9wID0gYXdhaXQgU2hvcC5nZXRBY3RpdmVTaG9wKCk7XG4gICAgICBjb25zdCBpc09wZW4gPSBzaG9wLmlzQ3VycmVudGx5T3BlbigpO1xuICAgICAgXG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgaXNXZWVrZW5kID0gbm93LmdldERheSgpID09PSAwIHx8IG5vdy5nZXREYXkoKSA9PT0gNjtcbiAgICAgIGNvbnN0IGN1cnJlbnRIb3VycyA9IGlzV2Vla2VuZCA/IHNob3AuaG91cnMud2Vla2VuZHMgOiBzaG9wLmhvdXJzLndlZWtkYXlzO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaXNPcGVuLFxuICAgICAgICAgIGN1cnJlbnRIb3VyczogY3VycmVudEhvdXJzLmRpc3BsYXksXG4gICAgICAgICAgbmV4dENoYW5nZTogdGhpcy5nZXROZXh0U3RhdHVzQ2hhbmdlKHNob3AsIG5vdyksXG4gICAgICAgICAgdGltZXpvbmU6IHNob3AuaG91cnMudGltZXpvbmVcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgc2hvcCBzdGF0dXM6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggc2hvcCBzdGF0dXMnLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IFZpZXRuYW1lc2UgY2F0ZWdvcnkgbmFtZSBtYXBwaW5nXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjYXRlZ29yeSAtIEVuZ2xpc2ggY2F0ZWdvcnkgbmFtZVxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSBWaWV0bmFtZXNlIGNhdGVnb3J5IG5hbWVcbiAgICovXG4gIHN0YXRpYyBnZXRDYXRlZ29yeVZpZXRuYW1lc2VOYW1lKGNhdGVnb3J5KSB7XG4gICAgY29uc3QgbWFwcGluZyA9IHtcbiAgICAgICdDw6AgcGjDqic6ICdDw6AgUGjDqicsXG4gICAgICAnQ29mZmVlJzogJ0PDoCBQaMOqJyxcbiAgICAgICdUaOG7qWMgdeG7kW5nIMSR4bqtbSB24buLJzogJ1Ro4bupYyBV4buRbmcgxJDhuq1tIFbhu4snLFxuICAgICAgJ8SQ4buTIHXhu5FuZyB0xrDGoWkgbcOhdCc6ICfEkOG7kyBV4buRbmcgVMawxqFpIE3DoXQnLFxuICAgICAgJ0LDoW5oIG5n4buNdCc6ICdCw6FuaCBOZ+G7jXQnLFxuICAgICAgJ1Bhc3RyaWVzJzogJ0LDoW5oIE5n4buNdCcsXG4gICAgICAnTGlnaHQgTWVhbHMnOiAnTcOzbiDEgm4gTmjhurknLFxuICAgICAgJ03Ds24gxINuIG5o4bq5JzogJ03Ds24gxIJuIE5o4bq5J1xuICAgIH07XG4gICAgXG4gICAgcmV0dXJuIG1hcHBpbmdbY2F0ZWdvcnldIHx8IGNhdGVnb3J5O1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBwcmljZSBmb3IgZGlzcGxheVxuICAgKiBAcGFyYW0ge251bWJlcn0gcHJpY2UgLSBQcmljZSBpbiBudW1iZXIgZm9ybWF0XG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IEZvcm1hdHRlZCBwcmljZSBzdHJpbmdcbiAgICovXG4gIHN0YXRpYyBmb3JtYXRQcmljZShwcmljZSkge1xuICAgIGlmICh0eXBlb2YgcHJpY2UgPT09ICdudW1iZXInKSB7XG4gICAgICByZXR1cm4gYCR7KHByaWNlICogMTAwMCkudG9Mb2NhbGVTdHJpbmcoJ3ZpLVZOJyl9IFZORGA7XG4gICAgfVxuICAgIHJldHVybiBwcmljZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IHNwZWNpYWx0aWVzIGZyb20gcHJvZHVjdHNcbiAgICogQHBhcmFtIHtBcnJheX0gcHJvZHVjdHMgLSBBcnJheSBvZiBwcm9kdWN0c1xuICAgKiBAcmV0dXJucyB7QXJyYXl9IEFycmF5IG9mIHNwZWNpYWx0eSBpdGVtc1xuICAgKi9cbiAgc3RhdGljIGV4dHJhY3RTcGVjaWFsdGllcyhwcm9kdWN0cykge1xuICAgIHJldHVybiBwcm9kdWN0c1xuICAgICAgLmZpbHRlcihwcm9kdWN0ID0+IHByb2R1Y3QuZmVhdHVyZWQpXG4gICAgICAubWFwKHByb2R1Y3QgPT4gcHJvZHVjdC5uYW1lKVxuICAgICAgLnNsaWNlKDAsIDQpOyAvLyBMaW1pdCB0byA0IHNwZWNpYWx0aWVzXG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIG5leHQgc3RhdHVzIGNoYW5nZSB0aW1lXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBzaG9wIC0gU2hvcCBjb25maWd1cmF0aW9uXG4gICAqIEBwYXJhbSB7RGF0ZX0gbm93IC0gQ3VycmVudCBkYXRlXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IE5leHQgc3RhdHVzIGNoYW5nZSBkZXNjcmlwdGlvblxuICAgKi9cbiAgc3RhdGljIGdldE5leHRTdGF0dXNDaGFuZ2Uoc2hvcCwgbm93KSB7XG4gICAgY29uc3QgaXNXZWVrZW5kID0gbm93LmdldERheSgpID09PSAwIHx8IG5vdy5nZXREYXkoKSA9PT0gNjtcbiAgICBjb25zdCBjdXJyZW50SG91cnMgPSBpc1dlZWtlbmQgPyBzaG9wLmhvdXJzLndlZWtlbmRzIDogc2hvcC5ob3Vycy53ZWVrZGF5cztcbiAgICBjb25zdCBpc09wZW4gPSBzaG9wLmlzQ3VycmVudGx5T3BlbigpO1xuICAgIFxuICAgIGlmIChpc09wZW4pIHtcbiAgICAgIHJldHVybiBgQ2xvc2VzIGF0ICR7Y3VycmVudEhvdXJzLmNsb3NlfWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgT3BlbnMgYXQgJHtjdXJyZW50SG91cnMub3Blbn1gO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIGRlZmF1bHQgc2hvcCBkYXRhIGlmIG5vbmUgZXhpc3RzXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IEluaXRpYWxpemF0aW9uIHJlc3VsdFxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGluaXRpYWxpemVTaG9wRGF0YSgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZXhpc3RpbmdTaG9wID0gYXdhaXQgU2hvcC5maW5kT25lKHsgaXNBY3RpdmU6IHRydWUgfSk7XG4gICAgICBcbiAgICAgIGlmICghZXhpc3RpbmdTaG9wKSB7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRTaG9wID0gbmV3IFNob3Aoe30pO1xuICAgICAgICBhd2FpdCBkZWZhdWx0U2hvcC5zYXZlKCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogJ0RlZmF1bHQgc2hvcCBkYXRhIGluaXRpYWxpemVkJyxcbiAgICAgICAgICBkYXRhOiBkZWZhdWx0U2hvcFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnU2hvcCBkYXRhIGFscmVhZHkgZXhpc3RzJyxcbiAgICAgICAgZGF0YTogZXhpc3RpbmdTaG9wXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbml0aWFsaXppbmcgc2hvcCBkYXRhOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGluaXRpYWxpemUgc2hvcCBkYXRhJyxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICAgIH07XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gU2hvcFNlcnZpY2U7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUN0QyxNQUFNQyxPQUFPLEdBQUdELE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUU1QyxNQUFNRSxXQUFXLENBQUM7RUFDaEI7QUFDRjtBQUNBO0FBQ0E7RUFDRSxhQUFhQyxhQUFhQSxDQUFBLEVBQUc7SUFDM0IsSUFBSTtNQUNGLE1BQU1DLElBQUksR0FBRyxNQUFNTCxJQUFJLENBQUNNLGFBQWEsQ0FBQyxDQUFDO01BQ3ZDLE9BQU87UUFDTEMsT0FBTyxFQUFFLElBQUk7UUFDYkMsSUFBSSxFQUFFSDtNQUNSLENBQUM7SUFDSCxDQUFDLENBQUMsT0FBT0ksS0FBSyxFQUFFO01BQ2RDLE9BQU8sQ0FBQ0QsS0FBSyxDQUFDLDZCQUE2QixFQUFFQSxLQUFLLENBQUM7TUFDbkQsT0FBTztRQUNMRixPQUFPLEVBQUUsS0FBSztRQUNkSSxPQUFPLEVBQUUsb0NBQW9DO1FBQzdDRixLQUFLLEVBQUVBLEtBQUssQ0FBQ0U7TUFDZixDQUFDO0lBQ0g7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtFQUNFLGFBQWFDLG1CQUFtQkEsQ0FBQSxFQUFHO0lBQ2pDLElBQUk7TUFDRixNQUFNUCxJQUFJLEdBQUcsTUFB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","map":{"version":3,"names":["Shop","require","Product","ShopService","getShopConfig","shop","getActiveShop","success","data","error","console","message","getCompleteShopData","products","find","inStock","sort","category","name","menuCategories","forEach","product","vietnamese","getCategoryVietnameseName","items","menuItem","id","_id","description","price","formatPrice","image","featured","ingredients","nutritionalInfo","sizes","push","menu","categories","Object","values","specialties","extractSpecialties","completeData","toObject","businessName","business","storeName","lastUpdated","Date","toISOString","updateShopConfig","updateData","keys","key","undefined","save","getShopStatus","isOpen","isCurrentlyOpen","now","isWeekend","getDay","currentHours","hours","weekends","weekdays","display","nextChange","getNextStatusChange","timezone","mapping","toLocaleString","filter","map","slice","close","open","initializeShopData","existingShop","findOne","isActive","defaultShop","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\services\\","sources":["shopService.js"],"sourcesContent":["const Shop = require('../models/Shop');\nconst Product = require('../models/Product');\n\nclass ShopService {\n  /**\n   * Get the active shop configuration\n   * @returns {Promise<Object>} Shop configuration\n   */\n  static async getShopConfig() {\n    try {\n      const shop = await Shop.getActiveShop();\n      return {\n        success: true,\n        data: shop\n      };\n    } catch (error) {\n      console.error('Error fetching shop config:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch shop configuration',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get complete shop data including menu from products\n   * @returns {Promise<Object>} Complete shop data with menu\n   */\n  static async getCompleteShopData() {\n    try {\n      const shop = await Shop.getActiveShop();\n      const products = await Product.find({ inStock: true }).sort({ category: 1, name: 1 });\n      \n      // Group products by category to create menu structure\n      const menuCategories = {};\n      \n      products.forEach(product => {\n        if (!menuCategories[product.category]) {\n          menuCategories[product.category] = {\n            name: product.category,\n            vietnamese: this.getCategoryVietnameseName(product.category),\n            items: []\n          };\n        }\n        \n        // Format product for menu\n        const menuItem = {\n          id: product._id,\n          name: product.name,\n          description: product.description,\n          price: this.formatPrice(product.price),\n          category: product.category,\n          image: product.image,\n          featured: product.featured,\n          ingredients: product.ingredients || [],\n          nutritionalInfo: product.nutritionalInfo || {},\n          sizes: product.sizes || []\n        };\n        \n        menuCategories[product.category].items.push(menuItem);\n      });\n      \n      // Convert to array format\n      const menu = {\n        categories: Object.values(menuCategories),\n        specialties: this.extractSpecialties(products)\n      };\n      \n      // Combine shop data with dynamic menu\n      const completeData = {\n        ...shop.toObject(),\n        menu,\n        businessName: shop.business.name, // For backward compatibility\n        storeName: shop.business.name,    // For backward compatibility\n        lastUpdated: new Date().toISOString()\n      };\n      \n      return {\n        success: true,\n        data: completeData\n      };\n    } catch (error) {\n      console.error('Error fetching complete shop data:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch complete shop data',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Update shop configuration\n   * @param {Object} updateData - Data to update\n   * @returns {Promise<Object>} Updated shop configuration\n   */\n  static async updateShopConfig(updateData) {\n    try {\n      const shop = await Shop.getActiveShop();\n      \n      // Update shop data\n      Object.keys(updateData).forEach(key => {\n        if (updateData[key] !== undefined) {\n          shop[key] = updateData[key];\n        }\n      });\n      \n      await shop.save();\n      \n      return {\n        success: true,\n        data: shop,\n        message: 'Shop configuration updated successfully'\n      };\n    } catch (error) {\n      console.error('Error updating shop config:', error);\n      return {\n        success: false,\n        message: 'Failed to update shop configuration',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get shop status (open/closed)\n   * @returns {Promise<Object>} Shop status information\n   */\n  static async getShopStatus() {\n    try {\n      const shop = await Shop.getActiveShop();\n      const isOpen = shop.isCurrentlyOpen();\n      \n      const now = new Date();\n      const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n      const currentHours = isWeekend ? shop.hours.weekends : shop.hours.weekdays;\n      \n      return {\n        success: true,\n        data: {\n          isOpen,\n          currentHours: currentHours.display,\n          nextChange: this.getNextStatusChange(shop, now),\n          timezone: shop.hours.timezone\n        }\n      };\n    } catch (error) {\n      console.error('Error fetching shop status:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch shop status',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get Vietnamese category name mapping\n   * @param {string} category - English category name\n   * @returns {string} Vietnamese category name\n   */\n  static getCategoryVietnameseName(category) {\n    const mapping = {\n      'Cà phê': 'Cà Phê',\n      'Coffee': 'Cà Phê',\n      'Thức uống đậm vị': 'Thức Uống Đậm Vị',\n      'Đồ uống tươi mát': 'Đồ Uống Tươi Mát',\n      'Bánh ngọt': 'Bánh Ngọt',\n      'Pastries': 'Bánh Ngọt',\n      'Light Meals': 'Món Ăn Nhẹ',\n      'Món ăn nhẹ': 'Món Ăn Nhẹ'\n    };\n    \n    return mapping[category] || category;\n  }\n\n  /**\n   * Format price for display\n   * @param {number} price - Price in number format\n   * @returns {string} Formatted price string\n   */\n  static formatPrice(price) {\n    if (typeof price === 'number') {\n      return `${(price * 1000).toLocaleString('vi-VN')} VND`;\n    }\n    return price;\n  }\n\n  /**\n   * Extract specialties from products\n   * @param {Array} products - Array of products\n   * @returns {Array} Array of specialty items\n   */\n  static extractSpecialties(products) {\n    return products\n      .filter(product => product.featured)\n      .map(product => product.name)\n      .slice(0, 4); // Limit to 4 specialties\n  }\n\n  /**\n   * Calculate next status change time\n   * @param {Object} shop - Shop configuration\n   * @param {Date} now - Current date\n   * @returns {string} Next status change description\n   */\n  static getNextStatusChange(shop, now) {\n    const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n    const currentHours = isWeekend ? shop.hours.weekends : shop.hours.weekdays;\n    const isOpen = shop.isCurrentlyOpen();\n    \n    if (isOpen) {\n      return `Closes at ${currentHours.close}`;\n    } else {\n      return `Opens at ${currentHours.open}`;\n    }\n  }\n\n  /**\n   * Initialize default shop data if none exists\n   * @returns {Promise<Object>} Initialization result\n   */\n  static async initializeShopData() {\n    try {\n      const existingShop = await Shop.findOne({ isActive: true });\n      \n      if (!existingShop) {\n        const defaultShop = new Shop({});\n        await defaultShop.save();\n        \n        return {\n          success: true,\n          message: 'Default shop data initialized',\n          data: defaultShop\n        };\n      }\n      \n      return {\n        success: true,\n        message: 'Shop data already exists',\n        data: existingShop\n      };\n    } catch (error) {\n      console.error('Error initializing shop data:', error);\n      return {\n        success: false,\n        message: 'Failed to initialize shop data',\n        error: error.message\n      };\n    }\n  }\n}\n\nmodule.exports = ShopService;"],"mappings":"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","ignoreList":[]}},"mtime":1757007727401},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\Shop.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const mongoose = require('mongoose');\nconst shopSchema = new mongoose.Schema({\n  business: {\n    name: {\n      type: String,\n      required: [true, 'Business name is required'],\n      trim: true,\n      default: 'DREAM COFFEE'\n    },\n    type: {\n      type: String,\n      default: 'Premium Coffee Shop'\n    },\n    description: {\n      type: String,\n      default: 'A premium coffee shop in the heart of Ho Chi Minh City, offering exceptional coffee, pastries, and a welcoming atmosphere for work and relaxation.'\n    },\n    established: {\n      type: String,\n      default: '2020'\n    },\n    mission: {\n      type: String,\n      default: 'To provide the finest coffee experience while fostering community connections.'\n    }\n  },\n  location: {\n    address: {\n      type: String,\n      required: [true, 'Address is required'],\n      default: '123 Đường Cà Phê, Quận 1, Thành phố Hồ Chí Minh'\n    },\n    englishAddress: {\n      type: String,\n      default: '123 Coffee Street, District 1, Ho Chi Minh City'\n    },\n    city: {\n      type: String,\n      default: 'Ho Chi Minh City'\n    },\n    district: {\n      type: String,\n      default: 'District 1'\n    },\n    country: {\n      type: String,\n      default: 'Vietnam'\n    },\n    coordinates: {\n      lat: {\n        type: Number,\n        default: 10.7769\n      },\n      lng: {\n        type: Number,\n        default: 106.7009\n      }\n    },\n    landmarks: {\n      type: String,\n      default: 'Near Ben Thanh Market, walking distance from Nguyen Hue Walking Street'\n    }\n  },\n  contact: {\n    phone: {\n      type: String,\n      required: [true, 'Phone number is required'],\n      default: '+84 28 1234 5678'\n    },\n    hotline: {\n      type: String,\n      default: '+84 28 1234 5678'\n    },\n    email: {\n      type: String,\n      required: [true, 'Email is required'],\n      match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email'],\n      default: 'info@dreamcoffee.vn'\n    },\n    website: {\n      type: String,\n      default: 'https://dreamcoffee.vn'\n    },\n    socialMedia: {\n      facebook: {\n        type: String,\n        default: 'https://facebook.com/dreamcoffee'\n      },\n      instagram: {\n        type: String,\n        default: 'https://instagram.com/dreamcoffee'\n      },\n      twitter: {\n        type: String,\n        default: 'https://twitter.com/dreamcoffee'\n      }\n    }\n  },\n  hours: {\n    weekdays: {\n      open: {\n        type: String,\n        default: '06:00'\n      },\n      close: {\n        type: String,\n        default: '20:00'\n      },\n      display: {\n        type: String,\n        default: 'Thứ 2 - Thứ 6: 6:00 - 20:00 (GMT+7)'\n      }\n    },\n    weekends: {\n      open: {\n        type: String,\n        default: '07:00'\n      },\n      close: {\n        type: String,\n        default: '19:00'\n      },\n      display: {\n        type: String,\n        default: 'Thứ 7 - Chủ Nhật: 7:00 - 19:00 (GMT+7)'\n      }\n    },\n    timezone: {\n      type: String,\n      default: 'GMT+7 (ICT)'\n    },\n    notes: {\n      type: String,\n      default: 'Closed on major holidays'\n    },\n    kitchen: {\n      type: String,\n      default: 'Kitchen closes 30 minutes before closing time'\n    }\n  },\n  services: {\n    dineIn: {\n      type: Boolean,\n      default: true\n    },\n    takeaway: {\n      type: Boolean,\n      default: true\n    },\n    delivery: {\n      type: Boolean,\n      default: true\n    },\n    catering: {\n      type: Boolean,\n      default: true\n    },\n    events: {\n      available: {\n        type: Boolean,\n        default: true\n      },\n      notice: {\n        type: String,\n        default: 'Contact us at least 48 hours in advance for bookings'\n      },\n      types: [{\n        type: String,\n        default: ['Private events', 'Meetings', 'Celebrations']\n      }]\n    },\n    wholesale: {\n      available: {\n        type: Boolean,\n        default: true\n      },\n      contact: {\n        type: String,\n        default: 'wholesale@dreamcoffee.vn'\n      },\n      description: {\n        type: String,\n        default: 'Coffee beans and catering services for businesses'\n      }\n    }\n  },\n  amenities: [{\n    type: String,\n    default: ['Free WiFi', 'Air Conditioning', 'Outdoor Seating', 'Power Outlets', 'Free Parking (20 spots, including 2 accessible spaces)', 'Pet Friendly', 'Study Area', 'Meeting Rooms']\n  }],\n  payment: {\n    methods: [{\n      type: String,\n      default: ['Cash', 'Credit Card', 'Debit Card', 'Mobile Payment', 'Bank Transfer']\n    }],\n    currency: {\n      type: String,\n      default: 'VND (Vietnamese Dong)'\n    }\n  },\n  policies: {\n    wifi: {\n      type: String,\n      default: 'Free high-speed WiFi for all customers'\n    },\n    parking: {\n      type: String,\n      default: 'Free parking available - 20 spots including 2 accessible spaces'\n    },\n    pets: {\n      type: String,\n      default: 'Pet-friendly environment'\n    },\n    smoking: {\n      type: String,\n      default: 'Non-smoking establishment'\n    },\n    reservations: {\n      type: String,\n      default: 'Walk-ins welcome, reservations recommended for groups of 6+'\n    }\n  },\n  responseTemplates: {\n    greeting: {\n      type: String,\n      default: 'Xin chào! Tôi là trợ lý AI của DREAM COFFEE. Tôi có thể giúp bạn tìm hiểu về menu, giờ mở cửa, địa chỉ và các dịch vụ của chúng tôi. Bạn cần hỗ trợ gì?'\n    },\n    fallback: {\n      type: String,\n      default: 'Xin lỗi, tôi không hiểu câu hỏi của bạn. Bạn có thể hỏi về menu, giờ mở cửa, địa chỉ, hoặc các dịch vụ của DREAM COFFEE không?'\n    },\n    contact: {\n      type: String,\n      default: 'Bạn có thể liên hệ với chúng tôi qua:\\n📞 Điện thoại: +84 28 1234 5678\\n📧 Email: info@dreamcoffee.vn\\n📍 Địa chỉ: 123 Đường Cà Phê, Quận 1, TP.HCM'\n    }\n  },\n  // This will be true for the main shop configuration\n  isActive: {\n    type: Boolean,\n    default: true\n  }\n}, {\n  timestamps: true\n});\n\n// Index for better performance\nshopSchema.index({\n  isActive: 1\n});\n\n// Static method to get the active shop configuration\nshopSchema.statics.getActiveShop = async function () {\n  let shop = await this.findOne({\n    isActive: true\n  });\n\n  // If no shop exists, create default one\n  if (!shop) {\n    shop = new this({});\n    await shop.save();\n  }\n  return shop;\n};\n\n// Instance method to check if currently open\nshopSchema.methods.isCurrentlyOpen = function () {\n  const now = new Date();\n  const currentHour = now.getHours();\n  const currentMinute = now.getMinutes();\n  const currentTime = currentHour * 60 + currentMinute;\n  const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n  const hours = isWeekend ? this.hours.weekends : this.hours.weekdays;\n  const [openHour, openMinute] = hours.open.split(':').map(Number);\n  const [closeHour, closeMinute] = hours.close.split(':').map(Number);\n  const openTime = openHour * 60 + openMinute;\n  const closeTime = closeHour * 60 + closeMinute;\n  return currentTime >= openTime && currentTime <= closeTime;\n};\nmodule.exports = mongoose.model('Shop', shopSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJzaG9wU2NoZW1hIiwiU2NoZW1hIiwiYnVzaW5lc3MiLCJuYW1lIiwidHlwZSIsIlN0cmluZyIsInJlcXVpcmVkIiwidHJpbSIsImRlZmF1bHQiLCJkZXNjcmlwdGlvbiIsImVzdGFibGlzaGVkIiwibWlzc2lvbiIsImxvY2F0aW9uIiwiYWRkcmVzcyIsImVuZ2xpc2hBZGRyZXNzIiwiY2l0eSIsImRpc3RyaWN0IiwiY291bnRyeSIsImNvb3JkaW5hdGVzIiwibGF0IiwiTnVtYmVyIiwibG5nIiwibGFuZG1hcmtzIiwiY29udGFjdCIsInBob25lIiwiaG90bGluZSIsImVtYWlsIiwibWF0Y2giLCJ3ZWJzaXRlIiwic29jaWFsTWVkaWEiLCJmYWNlYm9vayIsImluc3RhZ3JhbSIsInR3aXR0ZXIiLCJob3VycyIsIndlZWtkYXlzIiwib3BlbiIsImNsb3NlIiwiZGlzcGxheSIsIndlZWtlbmRzIiwidGltZXpvbmUiLCJub3RlcyIsImtpdGNoZW4iLCJzZXJ2aWNlcyIsImRpbmVJbiIsIkJvb2xlYW4iLCJ0YWtlYXdheSIsImRlbGl2ZXJ5IiwiY2F0ZXJpbmciLCJldmVudHMiLCJhdmFpbGFibGUiLCJub3RpY2UiLCJ0eXBlcyIsIndob2xlc2FsZSIsImFtZW5pdGllcyIsInBheW1lbnQiLCJtZXRob2RzIiwiY3VycmVuY3kiLCJwb2xpY2llcyIsIndpZmkiLCJwYXJraW5nIiwicGV0cyIsInNtb2tpbmciLCJyZXNlcnZhdGlvbnMiLCJyZXNwb25zZVRlbXBsYXRlcyIsImdyZWV0aW5nIiwiZmFsbGJhY2siLCJpc0FjdGl2ZSIsInRpbWVzdGFtcHMiLCJpbmRleCIsInN0YXRpY3MiLCJnZXRBY3RpdmVTaG9wIiwic2hvcCIsImZpbmRPbmUiLCJzYXZlIiwiaXNDdXJyZW50bHlPcGVuIiwibm93IiwiRGF0ZSIsImN1cnJlbnRIb3VyIiwiZ2V0SG91cnMiLCJjdXJyZW50TWludXRlIiwiZ2V0TWludXRlcyIsImN1cnJlbnRUaW1lIiwiaXNXZWVrZW5kIiwiZ2V0RGF5Iiwib3BlbkhvdXIiLCJvcGVuTWludXRlIiwic3BsaXQiLCJtYXAiLCJjbG9zZUhvdXIiLCJjbG9zZU1pbnV0ZSIsIm9wZW5UaW1lIiwiY2xvc2VUaW1lIiwibW9kdWxlIiwiZXhwb3J0cyIsIm1vZGVsIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xcbW9kZWxzXFwiLCJzb3VyY2VzIjpbIlNob3AuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuXG5jb25zdCBzaG9wU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gIGJ1c2luZXNzOiB7XG4gICAgbmFtZToge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgcmVxdWlyZWQ6IFt0cnVlLCAnQnVzaW5lc3MgbmFtZSBpcyByZXF1aXJlZCddLFxuICAgICAgdHJpbTogdHJ1ZSxcbiAgICAgIGRlZmF1bHQ6ICdEUkVBTSBDT0ZGRUUnXG4gICAgfSxcbiAgICB0eXBlOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnUHJlbWl1bSBDb2ZmZWUgU2hvcCdcbiAgICB9LFxuICAgIGRlc2NyaXB0aW9uOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnQSBwcmVtaXVtIGNvZmZlZSBzaG9wIGluIHRoZSBoZWFydCBvZiBIbyBDaGkgTWluaCBDaXR5LCBvZmZlcmluZyBleGNlcHRpb25hbCBjb2ZmZWUsIHBhc3RyaWVzLCBhbmQgYSB3ZWxjb21pbmcgYXRtb3NwaGVyZSBmb3Igd29yayBhbmQgcmVsYXhhdGlvbi4nXG4gICAgfSxcbiAgICBlc3RhYmxpc2hlZDoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJzIwMjAnXG4gICAgfSxcbiAgICBtaXNzaW9uOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnVG8gcHJvdmlkZSB0aGUgZmluZXN0IGNvZmZlZSBleHBlcmllbmNlIHdoaWxlIGZvc3RlcmluZyBjb21tdW5pdHkgY29ubmVjdGlvbnMuJ1xuICAgIH1cbiAgfSxcblxuICBsb2NhdGlvbjoge1xuICAgIGFkZHJlc3M6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ0FkZHJlc3MgaXMgcmVxdWlyZWQnXSxcbiAgICAgIGRlZmF1bHQ6ICcxMjMgxJDGsOG7nW5nIEPDoCBQaMOqLCBRdeG6rW4gMSwgVGjDoG5oIHBo4buRIEjhu5MgQ2jDrSBNaW5oJ1xuICAgIH0sXG4gICAgZW5nbGlzaEFkZHJlc3M6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcxMjMgQ29mZmVlIFN0cmVldCwgRGlzdHJpY3QgMSwgSG8gQ2hpIE1pbmggQ2l0eSdcbiAgICB9LFxuICAgIGNpdHk6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdIbyBDaGkgTWluaCBDaXR5J1xuICAgIH0sXG4gICAgZGlzdHJpY3Q6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdEaXN0cmljdCAxJ1xuICAgIH0sXG4gICAgY291bnRyeToge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ1ZpZXRuYW0nXG4gICAgfSxcbiAgICBjb29yZGluYXRlczoge1xuICAgICAgbGF0OiB7XG4gICAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgICAgZGVmYXVsdDogMTAuNzc2OVxuICAgICAgfSxcbiAgICAgIGxuZzoge1xuICAgICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICAgIGRlZmF1bHQ6IDEwNi43MDA5XG4gICAgICB9XG4gICAgfSxcbiAgICBsYW5kbWFya3M6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdOZWFyIEJlbiBUaGFuaCBNYXJrZXQsIHdhbGtpbmcgZGlzdGFuY2UgZnJvbSBOZ3V5ZW4gSHVlIFdhbGtpbmcgU3RyZWV0J1xuICAgIH1cbiAgfSxcblxuICBjb250YWN0OiB7XG4gICAgcGhvbmU6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ1Bob25lIG51bWJlciBpcyByZXF1aXJlZCddLFxuICAgICAgZGVmYXVsdDogJys4NCAyOCAxMjM0IDU2NzgnXG4gICAgfSxcbiAgICBob3RsaW5lOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnKzg0IDI4IDEyMzQgNTY3OCdcbiAgICB9LFxuICAgIGVtYWlsOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICByZXF1aXJlZDogW3RydWUsICdFbWFpbCBpcyByZXF1aXJlZCddLFxuICAgICAgbWF0Y2g6IFsvXlxcdysoW1xcLi1dP1xcdyspKkBcXHcrKFtcXC4tXT9cXHcrKSooXFwuXFx3ezIsM30pKyQvLCAnUGxlYXNlIGVudGVyIGEgdmFsaWQgZW1haWwnXSxcbiAgICAgIGRlZmF1bHQ6ICdpbmZvQGRyZWFtY29mZmVlLnZuJ1xuICAgIH0sXG4gICAgd2Vic2l0ZToge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ2h0dHBzOi8vZHJlYW1jb2ZmZWUudm4nXG4gICAgfSxcbiAgICBzb2NpYWxNZWRpYToge1xuICAgICAgZmFjZWJvb2s6IHtcbiAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICBkZWZhdWx0OiAnaHR0cHM6Ly9mYWNlYm9vay5jb20vZHJlYW1jb2ZmZWUnXG4gICAgICB9LFxuICAgICAgaW5zdGFncmFtOiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogJ2h0dHBzOi8vaW5zdGFncmFtLmNvbS9kcmVhbWNvZmZlZSdcbiAgICAgIH0sXG4gICAgICB0d2l0dGVyOiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogJ2h0dHBzOi8vdHdpdHRlci5jb20vZHJlYW1jb2ZmZWUnXG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIGhvdXJzOiB7XG4gICAgd2Vla2RheXM6IHtcbiAgICAgIG9wZW46IHtcbiAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICBkZWZhdWx0OiAnMDY6MDAnXG4gICAgICB9LFxuICAgICAgY2xvc2U6IHtcbiAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICBkZWZhdWx0OiAnMjA6MDAnXG4gICAgICB9LFxuICAgICAgZGlzcGxheToge1xuICAgICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICAgIGRlZmF1bHQ6ICdUaOG7qSAyIC0gVGjhu6kgNjogNjowMCAtIDIwOjAwIChHTVQrNyknXG4gICAgICB9XG4gICAgfSxcbiAgICB3ZWVrZW5kczoge1xuICAgICAgb3Blbjoge1xuICAgICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICAgIGRlZmF1bHQ6ICcwNzowMCdcbiAgICAgIH0sXG4gICAgICBjbG9zZToge1xuICAgICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICAgIGRlZmF1bHQ6ICcxOTowMCdcbiAgICAgIH0sXG4gICAgICBkaXNwbGF5OiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogJ1Ro4bupIDcgLSBDaOG7pyBOaOG6rXQ6IDc6MDAgLSAxOTowMCAoR01UKzcpJ1xuICAgICAgfVxuICAgIH0sXG4gICAgdGltZXpvbmU6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdHTVQrNyAoSUNUKSdcbiAgICB9LFxuICAgIG5vdGVzOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnQ2xvc2VkIG9uIG1ham9yIGhvbGlkYXlzJ1xuICAgIH0sXG4gICAga2l0Y2hlbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ0tpdGNoZW4gY2xvc2VzIDMwIG1pbnV0ZXMgYmVmb3JlIGNsb3NpbmcgdGltZSdcbiAgICB9XG4gIH0sXG5cbiAgc2VydmljZXM6IHtcbiAgICBkaW5lSW46IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiB0cnVlXG4gICAgfSxcbiAgICB0YWtlYXdheToge1xuICAgICAgdHlwZTogQm9vbGVhbixcbiAgICAgIGRlZmF1bHQ6IHRydWVcbiAgICB9LFxuICAgIGRlbGl2ZXJ5OiB7XG4gICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgZGVmYXVsdDogdHJ1ZVxuICAgIH0sXG4gICAgY2F0ZXJpbmc6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiB0cnVlXG4gICAgfSxcbiAgICBldmVudHM6IHtcbiAgICAgIGF2YWlsYWJsZToge1xuICAgICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgICBkZWZhdWx0OiB0cnVlXG4gICAgICB9LFxuICAgICAgbm90aWNlOiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogJ0NvbnRhY3QgdXMgYXQgbGVhc3QgNDggaG91cnMgaW4gYWR2YW5jZSBmb3IgYm9va2luZ3MnXG4gICAgICB9LFxuICAgICAgdHlwZXM6IFt7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogWydQcml2YXRlIGV2ZW50cycsICdNZWV0aW5ncycsICdDZWxlYnJhdGlvbnMnXVxuICAgICAgfV1cbiAgICB9LFxuICAgIHdob2xlc2FsZToge1xuICAgICAgYXZhaWxhYmxlOiB7XG4gICAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICAgIGRlZmF1bHQ6IHRydWVcbiAgICAgIH0sXG4gICAgICBjb250YWN0OiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogJ3dob2xlc2FsZUBkcmVhbWNvZmZlZS52bidcbiAgICAgIH0sXG4gICAgICBkZXNjcmlwdGlvbjoge1xuICAgICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICAgIGRlZmF1bHQ6ICdDb2ZmZWUgYmVhbnMgYW5kIGNhdGVyaW5nIHNlcnZpY2VzIGZvciBidXNpbmVzc2VzJ1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBhbWVuaXRpZXM6IFt7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIGRlZmF1bHQ6IFtcbiAgICAgICdGcmVlIFdpRmknLFxuICAgICAgJ0FpciBDb25kaXRpb25pbmcnLFxuICAgICAgJ091dGRvb3IgU2VhdGluZycsXG4gICAgICAnUG93ZXIgT3V0bGV0cycsXG4gICAgICAnRnJlZSBQYXJraW5nICgyMCBzcG90cywgaW5jbHVkaW5nIDIgYWNjZXNzaWJsZSBzcGFjZXMpJyxcbiAgICAgICdQZXQgRnJpZW5kbHknLFxuICAgICAgJ1N0dWR5IEFyZWEnLFxuICAgICAgJ01lZXRpbmcgUm9vbXMnXG4gICAgXVxuICB9XSxcblxuICBwYXltZW50OiB7XG4gICAgbWV0aG9kczogW3tcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6IFsnQ2FzaCcsICdDcmVkaXQgQ2FyZCcsICdEZWJpdCBDYXJkJywgJ01vYmlsZSBQYXltZW50JywgJ0JhbmsgVHJhbnNmZXInXVxuICAgIH1dLFxuICAgIGN1cnJlbmN5OiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnVk5EIChWaWV0bmFtZXNlIERvbmcpJ1xuICAgIH1cbiAgfSxcblxuICBwb2xpY2llczoge1xuICAgIHdpZmk6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdGcmVlIGhpZ2gtc3BlZWQgV2lGaSBmb3IgYWxsIGN1c3RvbWVycydcbiAgICB9LFxuICAgIHBhcmtpbmc6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdGcmVlIHBhcmtpbmcgYXZhaWxhYmxlIC0gMjAgc3BvdHMgaW5jbHVkaW5nIDIgYWNjZXNzaWJsZSBzcGFjZXMnXG4gICAgfSxcbiAgICBwZXRzOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnUGV0LWZyaWVuZGx5IGVudmlyb25tZW50J1xuICAgIH0sXG4gICAgc21va2luZzoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ05vbi1zbW9raW5nIGVzdGFibGlzaG1lbnQnXG4gICAgfSxcbiAgICByZXNlcnZhdGlvbnM6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdXYWxrLWlucyB3ZWxjb21lLCByZXNlcnZhdGlvbnMgcmVjb21tZW5kZWQgZm9yIGdyb3VwcyBvZiA2KydcbiAgICB9XG4gIH0sXG5cbiAgcmVzcG9uc2VUZW1wbGF0ZXM6IHtcbiAgICBncmVldGluZzoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ1hpbiBjaMOgbyEgVMO0aSBsw6AgdHLhu6MgbMO9IEFJIGPhu6dhIERSRUFNIENPRkZFRS4gVMO0aSBjw7MgdGjhu4MgZ2nDunAgYuG6oW4gdMOsbSBoaeG7g3UgduG7gSBtZW51LCBnaeG7nSBt4bufIGPhu61hLCDEkeG7i2EgY2jhu4kgdsOgIGPDoWMgZOG7i2NoIHbhu6UgY+G7p2EgY2jDum5nIHTDtGkuIELhuqFuIGPhuqduIGjhu5cgdHLhu6MgZ8OsPydcbiAgICB9LFxuICAgIGZhbGxiYWNrOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnWGluIGzhu5dpLCB0w7RpIGtow7RuZyBoaeG7g3UgY8OidSBo4buPaSBj4bunYSBi4bqhbi4gQuG6oW4gY8OzIHRo4buDIGjhu49pIHbhu4EgbWVudSwgZ2nhu50gbeG7nyBj4butYSwgxJHhu4thIGNo4buJLCBob+G6t2MgY8OhYyBk4buLY2ggduG7pSBj4bunYSBEUkVBTSBDT0ZGRUUga2jDtG5nPydcbiAgICB9LFxuICAgIGNvbnRhY3Q6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdC4bqhbiBjw7MgdGjhu4MgbGnDqm4gaOG7hyB24bubaSBjaMO6bmcgdMO0aSBxdWE6XFxu8J+TniDEkGnhu4duIHRob+G6oWk6ICs4NCAyOCAxMjM0IDU2NzhcXG7wn5OnIEVtYWlsOiBpbmZvQGRyZWFtY29mZmVlLnZuXFxu8J+TjSDEkOG7i2EgY2jhu4k6IDEyMyDEkMaw4budbmcgQ8OgIFBow6osIFF14bqtbiAxLCBUUC5IQ00nXG4gICAgfVxuICB9LFxuXG4gIC8vIFRoaXMgd2lsbCBiZSB0cnVlIGZvciB0aGUgbWFpbiBzaG9wIGNvbmZpZ3VyYXRpb25cbiAgaXNBY3RpdmU6IHtcbiAgICB0eXBlOiBCb29sZWFuLFxuICAgIGRlZmF1bHQ6IHRydWVcbiAgfVxufSwge1xuICB0aW1lc3RhbXBzOiB0cnVlXG59KTtcblxuLy8gSW5kZXggZm9yIGJldHRlciBwZXJmb3JtYW5jZVxuc2hvcFNjaGVtYS5pbmRleCh7IGlzQWN0aXZlOiAxIH0pO1xuXG4vLyBTdGF0aWMgbWV0aG9kIHRvIGdldCB0aGUgYWN0aXZlIHNob3AgY29uZmlndXJhdGlvblxuc2hvcFNjaGVtYS5zdGF0aWNzLmdldEFjdGl2ZVNob3AgPSBhc3luYyBmdW5jdGlvbigpIHtcbiAgbGV0IHNob3AgPSBhd2FpdCB0aGlzLmZpbmRPbmUoeyBpc0FjdGl2ZTogdHJ1ZSB9KTtcbiAgXG4gIC8vIElmIG5vIHNob3AgZXhpc3RzLCBjcmVhdGUgZGVmYXVsdCBvbmVcbiAgaWYgKCFzaG9wKSB7XG4gICAgc2hvcCA9IG5ldyB0aGlzKHt9KTtcbiAgICBhd2FpdCBzaG9wLnNhdmUoKTtcbiAgfVxuICBcbiAgcmV0dXJuIHNob3A7XG59O1xuXG4vLyBJbnN0YW5jZSBtZXRob2QgdG8gY2hlY2sgaWYgY3VycmVudGx5IG9wZW5cbnNob3BTY2hlbWEubWV0aG9kcy5pc0N1cnJlbnRseU9wZW4gPSBmdW5jdGlvbigpIHtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgY29uc3QgY3VycmVudEhvdXIgPSBub3cuZ2V0SG91cnMoKTtcbiAgY29uc3QgY3VycmVudE1pbnV0ZSA9IG5vdy5nZXRNaW51dGVzKCk7XG4gIGNvbnN0IGN1cnJlbnRUaW1lID0gY3VycmVudEhvdXIgKiA2MCArIGN1cnJlbnRNaW51dGU7XG4gIFxuICBjb25zdCBpc1dlZWtlbmQgPSBub3cuZ2V0RGF5KCkgPT09IDAgfHwgbm93LmdldERheSgpID09PSA2O1xuICBjb25zdCBob3VycyA9IGlzV2Vla2VuZCA/IHRoaXMuaG91cnMud2Vla2VuZHMgOiB0aGlzLmhvdXJzLndlZWtkYXlzO1xuICBcbiAgY29uc3QgW29wZW5Ib3VyLCBvcGVuTWludXRlXSA9IGhvdXJzLm9wZW4uc3BsaXQoJzonKS5tYXAoTnVtYmVyKTtcbiAgY29uc3QgW2Nsb3NlSG91ciwgY2xvc2VNaW51dGVdID0gaG91cnMuY2xvc2Uuc3BsaXQoJzonKS5tYXAoTnVtYmVyKTtcbiAgXG4gIGNvbnN0IG9wZW5UaW1lID0gb3BlbkhvdXIgKiA2MCArIG9wZW5NaW51dGU7XG4gIGNvbnN0IGNsb3NlVGltZSA9IGNsb3NlSG91ciAqIDYwICsgY2xvc2VNaW51dGU7XG4gIFxuICByZXR1cm4gY3VycmVudFRpbWUgPj0gb3BlblRpbWUgJiYgY3VycmVudFRpbWUgPD0gY2xvc2VUaW1lO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBtb25nb29zZS5tb2RlbCgnU2hvcCcsIHNob3BTY2hlbWEpOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRXBDLE1BQU1DLFVBQVUsR0FBRyxJQUFJRixRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUNyQ0MsUUFBUSxFQUFFO0lBQ1JDLElBQUksRUFBRTtNQUNKQyxJQUFJLEVBQUVDLE1BQU07TUFDWkMsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLDJCQUEyQixDQUFDO01BQzdDQyxJQUFJLEVBQUUsSUFBSTtNQUNWQyxPQUFPLEVBQUU7SUFDWCxDQUFDO0lBQ0RKLElBQUksRUFBRTtNQUNKQSxJQUFJLEVBQUVDLE1BQU07TUFDWkcsT0FBTyxFQUFFO0lBQ1gsQ0FBQztJQUNEQyxXQUFXLEVBQUU7TUFDWEwsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYLENB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","map":{"version":3,"names":["mongoose","require","shopSchema","Schema","business","name","type","String","required","trim","default","description","established","mission","location","address","englishAddress","city","district","country","coordinates","lat","Number","lng","landmarks","contact","phone","hotline","email","match","website","socialMedia","facebook","instagram","twitter","hours","weekdays","open","close","display","weekends","timezone","notes","kitchen","services","dineIn","Boolean","takeaway","delivery","catering","events","available","notice","types","wholesale","amenities","payment","methods","currency","policies","wifi","parking","pets","smoking","reservations","responseTemplates","greeting","fallback","isActive","timestamps","index","statics","getActiveShop","shop","findOne","save","isCurrentlyOpen","now","Date","currentHour","getHours","currentMinute","getMinutes","currentTime","isWeekend","getDay","openHour","openMinute","split","map","closeHour","closeMinute","openTime","closeTime","module","exports","model"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\models\\","sources":["Shop.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst shopSchema = new mongoose.Schema({\n  business: {\n    name: {\n      type: String,\n      required: [true, 'Business name is required'],\n      trim: true,\n      default: 'DREAM COFFEE'\n    },\n    type: {\n      type: String,\n      default: 'Premium Coffee Shop'\n    },\n    description: {\n      type: String,\n      default: 'A premium coffee shop in the heart of Ho Chi Minh City, offering exceptional coffee, pastries, and a welcoming atmosphere for work and relaxation.'\n    },\n    established: {\n      type: String,\n      default: '2020'\n    },\n    mission: {\n      type: String,\n      default: 'To provide the finest coffee experience while fostering community connections.'\n    }\n  },\n\n  location: {\n    address: {\n      type: String,\n      required: [true, 'Address is required'],\n      default: '123 Đường Cà Phê, Quận 1, Thành phố Hồ Chí Minh'\n    },\n    englishAddress: {\n      type: String,\n      default: '123 Coffee Street, District 1, Ho Chi Minh City'\n    },\n    city: {\n      type: String,\n      default: 'Ho Chi Minh City'\n    },\n    district: {\n      type: String,\n      default: 'District 1'\n    },\n    country: {\n      type: String,\n      default: 'Vietnam'\n    },\n    coordinates: {\n      lat: {\n        type: Number,\n        default: 10.7769\n      },\n      lng: {\n        type: Number,\n        default: 106.7009\n      }\n    },\n    landmarks: {\n      type: String,\n      default: 'Near Ben Thanh Market, walking distance from Nguyen Hue Walking Street'\n    }\n  },\n\n  contact: {\n    phone: {\n      type: String,\n      required: [true, 'Phone number is required'],\n      default: '+84 28 1234 5678'\n    },\n    hotline: {\n      type: String,\n      default: '+84 28 1234 5678'\n    },\n    email: {\n      type: String,\n      required: [true, 'Email is required'],\n      match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email'],\n      default: 'info@dreamcoffee.vn'\n    },\n    website: {\n      type: String,\n      default: 'https://dreamcoffee.vn'\n    },\n    socialMedia: {\n      facebook: {\n        type: String,\n        default: 'https://facebook.com/dreamcoffee'\n      },\n      instagram: {\n        type: String,\n        default: 'https://instagram.com/dreamcoffee'\n      },\n      twitter: {\n        type: String,\n        default: 'https://twitter.com/dreamcoffee'\n      }\n    }\n  },\n\n  hours: {\n    weekdays: {\n      open: {\n        type: String,\n        default: '06:00'\n      },\n      close: {\n        type: String,\n        default: '20:00'\n      },\n      display: {\n        type: String,\n        default: 'Thứ 2 - Thứ 6: 6:00 - 20:00 (GMT+7)'\n      }\n    },\n    weekends: {\n      open: {\n        type: String,\n        default: '07:00'\n      },\n      close: {\n        type: String,\n        default: '19:00'\n      },\n      display: {\n        type: String,\n        default: 'Thứ 7 - Chủ Nhật: 7:00 - 19:00 (GMT+7)'\n      }\n    },\n    timezone: {\n      type: String,\n      default: 'GMT+7 (ICT)'\n    },\n    notes: {\n      type: String,\n      default: 'Closed on major holidays'\n    },\n    kitchen: {\n      type: String,\n      default: 'Kitchen closes 30 minutes before closing time'\n    }\n  },\n\n  services: {\n    dineIn: {\n      type: Boolean,\n      default: true\n    },\n    takeaway: {\n      type: Boolean,\n      default: true\n    },\n    delivery: {\n      type: Boolean,\n      default: true\n    },\n    catering: {\n      type: Boolean,\n      default: true\n    },\n    events: {\n      available: {\n        type: Boolean,\n        default: true\n      },\n      notice: {\n        type: String,\n        default: 'Contact us at least 48 hours in advance for bookings'\n      },\n      types: [{\n        type: String,\n        default: ['Private events', 'Meetings', 'Celebrations']\n      }]\n    },\n    wholesale: {\n      available: {\n        type: Boolean,\n        default: true\n      },\n      contact: {\n        type: String,\n        default: 'wholesale@dreamcoffee.vn'\n      },\n      description: {\n        type: String,\n        default: 'Coffee beans and catering services for businesses'\n      }\n    }\n  },\n\n  amenities: [{\n    type: String,\n    default: [\n      'Free WiFi',\n      'Air Conditioning',\n      'Outdoor Seating',\n      'Power Outlets',\n      'Free Parking (20 spots, including 2 accessible spaces)',\n      'Pet Friendly',\n      'Study Area',\n      'Meeting Rooms'\n    ]\n  }],\n\n  payment: {\n    methods: [{\n      type: String,\n      default: ['Cash', 'Credit Card', 'Debit Card', 'Mobile Payment', 'Bank Transfer']\n    }],\n    currency: {\n      type: String,\n      default: 'VND (Vietnamese Dong)'\n    }\n  },\n\n  policies: {\n    wifi: {\n      type: String,\n      default: 'Free high-speed WiFi for all customers'\n    },\n    parking: {\n      type: String,\n      default: 'Free parking available - 20 spots including 2 accessible spaces'\n    },\n    pets: {\n      type: String,\n      default: 'Pet-friendly environment'\n    },\n    smoking: {\n      type: String,\n      default: 'Non-smoking establishment'\n    },\n    reservations: {\n      type: String,\n      default: 'Walk-ins welcome, reservations recommended for groups of 6+'\n    }\n  },\n\n  responseTemplates: {\n    greeting: {\n      type: String,\n      default: 'Xin chào! Tôi là trợ lý AI của DREAM COFFEE. Tôi có thể giúp bạn tìm hiểu về menu, giờ mở cửa, địa chỉ và các dịch vụ của chúng tôi. Bạn cần hỗ trợ gì?'\n    },\n    fallback: {\n      type: String,\n      default: 'Xin lỗi, tôi không hiểu câu hỏi của bạn. Bạn có thể hỏi về menu, giờ mở cửa, địa chỉ, hoặc các dịch vụ của DREAM COFFEE không?'\n    },\n    contact: {\n      type: String,\n      default: 'Bạn có thể liên hệ với chúng tôi qua:\\n📞 Điện thoại: +84 28 1234 5678\\n📧 Email: info@dreamcoffee.vn\\n📍 Địa chỉ: 123 Đường Cà Phê, Quận 1, TP.HCM'\n    }\n  },\n\n  // This will be true for the main shop configuration\n  isActive: {\n    type: Boolean,\n    default: true\n  }\n}, {\n  timestamps: true\n});\n\n// Index for better performance\nshopSchema.index({ isActive: 1 });\n\n// Static method to get the active shop configuration\nshopSchema.statics.getActiveShop = async function() {\n  let shop = await this.findOne({ isActive: true });\n  \n  // If no shop exists, create default one\n  if (!shop) {\n    shop = new this({});\n    await shop.save();\n  }\n  \n  return shop;\n};\n\n// Instance method to check if currently open\nshopSchema.methods.isCurrentlyOpen = function() {\n  const now = new Date();\n  const currentHour = now.getHours();\n  const currentMinute = now.getMinutes();\n  const currentTime = currentHour * 60 + currentMinute;\n  \n  const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n  const hours = isWeekend ? this.hours.weekends : this.hours.weekdays;\n  \n  const [openHour, openMinute] = hours.open.split(':').map(Number);\n  const [closeHour, closeMinute] = hours.close.split(':').map(Number);\n  \n  const openTime = openHour * 60 + openMinute;\n  const closeTime = closeHour * 60 + closeMinute;\n  \n  return currentTime >= openTime && currentTime <= closeTime;\n};\n\nmodule.exports = mongoose.model('Shop', shopSchema);"],"mappings":"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","ignoreList":[]}},"mtime":1757007725785},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\contact.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst Contact = require('../models/Contact');\nconst {\n  protect,\n  authorize\n} = require('../middleware/auth');\n\n// @route   POST /api/contact\n// @desc    Submit contact form\n// @access  Public\nrouter.post('/', async (req, res) => {\n  try {\n    const {\n      name,\n      email,\n      subject,\n      message\n    } = req.body;\n\n    // Validate required fields\n    if (!name || !email || !subject || !message) {\n      return res.status(400).json({\n        success: false,\n        message: 'All fields are required'\n      });\n    }\n\n    // Create new contact message\n    const contact = new Contact({\n      name: name.trim(),\n      email: email.trim(),\n      subject: subject.trim(),\n      message: message.trim()\n    });\n    await contact.save();\n    res.status(201).json({\n      success: true,\n      message: 'Your message has been received',\n      data: {\n        ticketId: contact.ticketId,\n        expectedResponseTime: '24-48 hours'\n      }\n    });\n  } catch (error) {\n    console.error('Contact form submission error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error. Please try again later.'\n    });\n  }\n});\n\n// @route   GET /api/contact\n// @desc    Get all contact messages (Admin only)\n// @access  Private/Admin\nrouter.get('/', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const skip = (page - 1) * limit;\n\n    // Build query\n    let query = {};\n    if (status && ['new', 'read', 'replied', 'closed'].includes(status)) {\n      query.status = status;\n    }\n\n    // Get contacts with pagination\n    const contacts = await Contact.find(query).sort({\n      createdAt: -1\n    }).skip(skip).limit(limit);\n\n    // Get total count for pagination\n    const total = await Contact.countDocuments(query);\n    res.json({\n      success: true,\n      data: {\n        contacts,\n        pagination: {\n          current: page,\n          pages: Math.ceil(total / limit),\n          total,\n          limit\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Get contacts error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   GET /api/contact/:id\n// @desc    Get single contact message (Admin only)\n// @access  Private/Admin\nrouter.get('/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const contact = await Contact.findById(req.params.id);\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    // Mark as read if not already\n    if (!contact.isRead) {\n      contact.isRead = true;\n      contact.status = 'read';\n      await contact.save();\n    }\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Get contact error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   PUT /api/contact/:id/status\n// @desc    Update contact message status (Admin only)\n// @access  Private/Admin\nrouter.put('/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const {\n      status\n    } = req.body;\n    if (!['new', 'read', 'replied', 'closed'].includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid status'\n      });\n    }\n    const contact = await Contact.findById(req.params.id);\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n    contact.status = status;\n    if (status !== 'new') {\n      contact.isRead = true;\n    }\n    await contact.save();\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Update contact status error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   DELETE /api/contact/:id\n// @desc    Delete contact message (Admin only)\n// @access  Private/Admin\nrouter.delete('/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const contact = await Contact.findById(req.params.id);\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n    await Contact.findByIdAndDelete(req.params.id);\n    res.json({\n      success: true,\n      message: 'Contact message deleted successfully'\n    });\n  } catch (error) {\n    console.error('Delete contact error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIkNvbnRhY3QiLCJwcm90ZWN0IiwiYXV0aG9yaXplIiwicG9zdCIsInJlcSIsInJlcyIsIm5hbWUiLCJlbWFpbCIsInN1YmplY3QiLCJtZXNzYWdlIiwiYm9keSIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwiY29udGFjdCIsInRyaW0iLCJzYXZlIiwiZGF0YSIsInRpY2tldElkIiwiZXhwZWN0ZWRSZXNwb25zZVRpbWUiLCJlcnJvciIsImNvbnNvbGUiLCJnZXQiLCJwYWdlIiwicGFyc2VJbnQiLCJxdWVyeSIsImxpbWl0Iiwic2tpcCIsImluY2x1ZGVzIiwiY29udGFjdHMiLCJmaW5kIiwic29ydCIsImNyZWF0ZWRBdCIsInRvdGFsIiwiY291bnREb2N1bWVudHMiLCJwYWdpbmF0aW9uIiwiY3VycmVudCIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJmaW5kQnlJZCIsInBhcmFtcyIsImlkIiwiaXNSZWFkIiwicHV0IiwiZGVsZXRlIiwiZmluZEJ5SWRBbmREZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xccm91dGVzXFwiLCJzb3VyY2VzIjpbImNvbnRhY3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5jb25zdCBDb250YWN0ID0gcmVxdWlyZSgnLi4vbW9kZWxzL0NvbnRhY3QnKTtcbmNvbnN0IHsgcHJvdGVjdCwgYXV0aG9yaXplIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcblxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL2NvbnRhY3Rcbi8vIEBkZXNjICAgIFN1Ym1pdCBjb250YWN0IGZvcm1cbi8vIEBhY2Nlc3MgIFB1YmxpY1xucm91dGVyLnBvc3QoJy8nLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IG5hbWUsIGVtYWlsLCBzdWJqZWN0LCBtZXNzYWdlIH0gPSByZXEuYm9keTtcblxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgIGlmICghbmFtZSB8fCAhZW1haWwgfHwgIXN1YmplY3QgfHwgIW1lc3NhZ2UpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQWxsIGZpZWxkcyBhcmUgcmVxdWlyZWQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgbmV3IGNvbnRhY3QgbWVzc2FnZVxuICAgIGNvbnN0IGNvbnRhY3QgPSBuZXcgQ29udGFjdCh7XG4gICAgICBuYW1lOiBuYW1lLnRyaW0oKSxcbiAgICAgIGVtYWlsOiBlbWFpbC50cmltKCksXG4gICAgICBzdWJqZWN0OiBzdWJqZWN0LnRyaW0oKSxcbiAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UudHJpbSgpXG4gICAgfSk7XG5cbiAgICBhd2FpdCBjb250YWN0LnNhdmUoKTtcblxuICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnWW91ciBtZXNzYWdlIGhhcyBiZWVuIHJlY2VpdmVkJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdGlja2V0SWQ6IGNvbnRhY3QudGlja2V0SWQsXG4gICAgICAgIGV4cGVjdGVkUmVzcG9uc2VUaW1lOiAnMjQtNDggaG91cnMnXG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQ29udGFjdCBmb3JtIHN1Ym1pc3Npb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9jb250YWN0XG4vLyBAZGVzYyAgICBHZXQgYWxsIGNvbnRhY3QgbWVzc2FnZXMgKEFkbWluIG9ubHkpXG4vLyBAYWNjZXNzICBQcml2YXRlL0FkbWluXG5yb3V0ZXIuZ2V0KCcvJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQocmVxLnF1ZXJ5LnBhZ2UpIHx8IDE7XG4gICAgY29uc3QgbGltaXQgPSBwYXJzZUludChyZXEucXVlcnkubGltaXQpIHx8IDEwO1xuICAgIGNvbnN0IHN0YXR1cyA9IHJlcS5xdWVyeS5zdGF0dXM7XG4gICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcblxuICAgIC8vIEJ1aWxkIHF1ZXJ5XG4gICAgbGV0IHF1ZXJ5ID0ge307XG4gICAgaWYgKHN0YXR1cyAmJiBbJ25ldycsICdyZWFkJywgJ3JlcGxpZWQnLCAnY2xvc2VkJ10uaW5jbHVkZXMoc3RhdHVzKSkge1xuICAgICAgcXVlcnkuc3RhdHVzID0gc3RhdHVzO1xuICAgIH1cblxuICAgIC8vIEdldCBjb250YWN0cyB3aXRoIHBhZ2luYXRpb25cbiAgICBjb25zdCBjb250YWN0cyA9IGF3YWl0IENvbnRhY3QuZmluZChxdWVyeSlcbiAgICAgIC5zb3J0KHsgY3JlYXRlZEF0OiAtMSB9KVxuICAgICAgLnNraXAoc2tpcClcbiAgICAgIC5saW1pdChsaW1pdCk7XG5cbiAgICAvLyBHZXQgdG90YWwgY291bnQgZm9yIHBhZ2luYXRpb25cbiAgICBjb25zdCB0b3RhbCA9IGF3YWl0IENvbnRhY3QuY291bnREb2N1bWVudHMocXVlcnkpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgY29udGFjdHMsXG4gICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICBjdXJyZW50OiBwYWdlLFxuICAgICAgICAgIHBhZ2VzOiBNYXRoLmNlaWwodG90YWwgLyBsaW1pdCksXG4gICAgICAgICAgdG90YWwsXG4gICAgICAgICAgbGltaXRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0dldCBjb250YWN0cyBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvY29udGFjdC86aWRcbi8vIEBkZXNjICAgIEdldCBzaW5nbGUgY29udGFjdCBtZXNzYWdlIChBZG1pbiBvbmx5KVxuLy8gQGFjY2VzcyAgUHJpdmF0ZS9BZG1pblxucm91dGVyLmdldCgnLzppZCcsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29udGFjdCA9IGF3YWl0IENvbnRhY3QuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCk7XG5cbiAgICBpZiAoIWNvbnRhY3QpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQ29udGFjdCBtZXNzYWdlIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE1hcmsgYXMgcmVhZCBpZiBub3QgYWxyZWFkeVxuICAgIGlmICghY29udGFjdC5pc1JlYWQpIHtcbiAgICAgIGNvbnRhY3QuaXNSZWFkID0gdHJ1ZTtcbiAgICAgIGNvbnRhY3Quc3RhdHVzID0gJ3JlYWQnO1xuICAgICAgYXdhaXQgY29udGFjdC5zYXZlKCk7XG4gICAgfVxuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IGNvbnRhY3RcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdHZXQgY29udGFjdCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUFVUIC9hcGkvY29udGFjdC86aWQvc3RhdHVzXG4vLyBAZGVzYyAgICBVcGRhdGUgY29udGFjdCBtZXNzYWdlIHN0YXR1cyAoQWRtaW4gb25seSlcbi8vIEBhY2Nlc3MgIFByaXZhdGUvQWRtaW5cbnJvdXRlci5wdXQoJy86aWQvc3RhdHVzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHN0YXR1cyB9ID0gcmVxLmJvZHk7XG5cbiAgICBpZiAoIVsnbmV3JywgJ3JlYWQnLCAncmVwbGllZCcsICdjbG9zZWQnXS5pbmNsdWRlcyhzdGF0dXMpKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgc3RhdHVzJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgY29udGFjdCA9IGF3YWl0IENvbnRhY3QuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCk7XG5cbiAgICBpZiAoIWNvbnRhY3QpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQ29udGFjdCBtZXNzYWdlIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnRhY3Quc3RhdHVzID0gc3RhdHVzO1xuICAgIGlmIChzdGF0dXMgIT09ICduZXcnKSB7XG4gICAgICBjb250YWN0LmlzUmVhZCA9IHRydWU7XG4gICAgfVxuICAgIGF3YWl0IGNvbnRhY3Quc2F2ZSgpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IGNvbnRhY3RcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdVcGRhdGUgY29udGFjdCBzdGF0dXMgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIERFTEVURSAvYXBpL2NvbnRhY3QvOmlkXG4vLyBAZGVzYyAgICBEZWxldGUgY29udGFjdCBtZXNzYWdlIChBZG1pbiBvbmx5KVxuLy8gQGFjY2VzcyAgUHJpdmF0ZS9BZG1pblxucm91dGVyLmRlbGV0ZSgnLzppZCcsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29udGFjdCA9IGF3YWl0IENvbnRhY3QuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCk7XG5cbiAgICBpZiAoIWNvbnRhY3QpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQ29udGFjdCBtZXNzYWdlIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGF3YWl0IENvbnRhY3QuZmluZEJ5SWRBbmREZWxldGUocmVxLnBhcmFtcy5pZCk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ0NvbnRhY3QgbWVzc2FnZSBkZWxldGVkIHN1Y2Nlc3NmdWxseSdcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdEZWxldGUgY29udGFjdCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xuICAgIH0pO1xuICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUNHLE1BQU0sQ0FBQyxDQUFDO0FBQy9CLE1BQU1DLE9BQU8sR0FBR0gsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzVDLE1BQU07RUFBRUksT0FBTztFQUFFQztBQUFVLENBQUMsR0FBR0wsT0FBTyxDQUFDLG9CQUFvQixDQUFDOztBQUU1RDtBQUNBO0FBQ0E7QUFDQUMsTUFBTSxDQUFDSyxJQUFJLENBQUMsR0FBRyxFQUFFLE9BQU9DLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQ25DLElBQUk7SUFDRixNQUFNO01BQUVDLElBQUk7TUFBRUMsS0FBSztNQUFFQyxPQUFPO01BQUVDO0lBQVEsQ0FBQyxHQUFHTCxHQUFHLENBQUNNLElBQUk7O0lBRWxEO0lBQ0EsSUFBSSxDQUFDSixJQUFJLElBQUksQ0FBQ0MsS0FBSyxJQUFJLENBQUNDLE9BQU8sSUFBSSxDQUFDQyxPQUFPLEVBQUU7TUFDM0MsT0FBT0osR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztRQUMxQkMsT0FBTyxFQUFFLEtBQUs7UUFDZEosT0FBTyxFQUFFO01BQ1gsQ0FBQyxDQUFDO0lBQ0o7O0lBRUE7SUFDQSxNQUFNSyxPQUFPLEdBQUcsSUFBSWQsT0FBTyxDQUFDO01BQzFCTSxJQUFJLEVBQUVBLElBQUksQ0FBQ1MsSUFBSSxDQUFDLENB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","map":{"version":3,"names":["express","require","router","Router","Contact","protect","authorize","post","req","res","name","email","subject","message","body","status","json","success","contact","trim","save","data","ticketId","expectedResponseTime","error","console","get","page","parseInt","query","limit","skip","includes","contacts","find","sort","createdAt","total","countDocuments","pagination","current","pages","Math","ceil","findById","params","id","isRead","put","delete","findByIdAndDelete","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["contact.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst Contact = require('../models/Contact');\nconst { protect, authorize } = require('../middleware/auth');\n\n// @route   POST /api/contact\n// @desc    Submit contact form\n// @access  Public\nrouter.post('/', async (req, res) => {\n  try {\n    const { name, email, subject, message } = req.body;\n\n    // Validate required fields\n    if (!name || !email || !subject || !message) {\n      return res.status(400).json({\n        success: false,\n        message: 'All fields are required'\n      });\n    }\n\n    // Create new contact message\n    const contact = new Contact({\n      name: name.trim(),\n      email: email.trim(),\n      subject: subject.trim(),\n      message: message.trim()\n    });\n\n    await contact.save();\n\n    res.status(201).json({\n      success: true,\n      message: 'Your message has been received',\n      data: {\n        ticketId: contact.ticketId,\n        expectedResponseTime: '24-48 hours'\n      }\n    });\n  } catch (error) {\n    console.error('Contact form submission error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error. Please try again later.'\n    });\n  }\n});\n\n// @route   GET /api/contact\n// @desc    Get all contact messages (Admin only)\n// @access  Private/Admin\nrouter.get('/', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const skip = (page - 1) * limit;\n\n    // Build query\n    let query = {};\n    if (status && ['new', 'read', 'replied', 'closed'].includes(status)) {\n      query.status = status;\n    }\n\n    // Get contacts with pagination\n    const contacts = await Contact.find(query)\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(limit);\n\n    // Get total count for pagination\n    const total = await Contact.countDocuments(query);\n\n    res.json({\n      success: true,\n      data: {\n        contacts,\n        pagination: {\n          current: page,\n          pages: Math.ceil(total / limit),\n          total,\n          limit\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Get contacts error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   GET /api/contact/:id\n// @desc    Get single contact message (Admin only)\n// @access  Private/Admin\nrouter.get('/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const contact = await Contact.findById(req.params.id);\n\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    // Mark as read if not already\n    if (!contact.isRead) {\n      contact.isRead = true;\n      contact.status = 'read';\n      await contact.save();\n    }\n\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Get contact error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   PUT /api/contact/:id/status\n// @desc    Update contact message status (Admin only)\n// @access  Private/Admin\nrouter.put('/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const { status } = req.body;\n\n    if (!['new', 'read', 'replied', 'closed'].includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid status'\n      });\n    }\n\n    const contact = await Contact.findById(req.params.id);\n\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    contact.status = status;\n    if (status !== 'new') {\n      contact.isRead = true;\n    }\n    await contact.save();\n\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Update contact status error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   DELETE /api/contact/:id\n// @desc    Delete contact message (Admin only)\n// @access  Private/Admin\nrouter.delete('/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const contact = await Contact.findById(req.params.id);\n\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    await Contact.findByIdAndDelete(req.params.id);\n\n    res.json({\n      success: true,\n      message: 'Contact message deleted successfully'\n    });\n  } catch (error) {\n    console.error('Delete contact error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1757503867690},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\Contact.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const mongoose = require('mongoose');\nconst contactSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: [true, 'Name is required'],\n    trim: true,\n    maxlength: [100, 'Name cannot exceed 100 characters']\n  },\n  email: {\n    type: String,\n    required: [true, 'Email is required'],\n    lowercase: true,\n    trim: true,\n    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email']\n  },\n  subject: {\n    type: String,\n    required: [true, 'Subject is required'],\n    trim: true,\n    maxlength: [200, 'Subject cannot exceed 200 characters']\n  },\n  message: {\n    type: String,\n    required: [true, 'Message is required'],\n    trim: true,\n    maxlength: [2000, 'Message cannot exceed 2000 characters']\n  },\n  ticketId: {\n    type: String,\n    unique: true,\n    required: false // Auto-generated in pre-save hook\n  },\n  status: {\n    type: String,\n    enum: ['new', 'read', 'replied', 'closed'],\n    default: 'new'\n  },\n  isRead: {\n    type: Boolean,\n    default: false\n  }\n}, {\n  timestamps: true // Adds createdAt and updatedAt automatically\n});\n\n// Generate ticket ID before saving\ncontactSchema.pre('save', function (next) {\n  if (!this.ticketId) {\n    this.ticketId = 'WC-' + Math.random().toString(36).substr(2, 6).toUpperCase();\n  }\n  next();\n});\n\n// Index for faster queries\ncontactSchema.index({\n  createdAt: -1\n});\ncontactSchema.index({\n  status: 1\n});\ncontactSchema.index({\n  ticketId: 1\n});\nmodule.exports = mongoose.model('Contact', contactSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJjb250YWN0U2NoZW1hIiwiU2NoZW1hIiwibmFtZSIsInR5cGUiLCJTdHJpbmciLCJyZXF1aXJlZCIsInRyaW0iLCJtYXhsZW5ndGgiLCJlbWFpbCIsImxvd2VyY2FzZSIsIm1hdGNoIiwic3ViamVjdCIsIm1lc3NhZ2UiLCJ0aWNrZXRJZCIsInVuaXF1ZSIsInN0YXR1cyIsImVudW0iLCJkZWZhdWx0IiwiaXNSZWFkIiwiQm9vbGVhbiIsInRpbWVzdGFtcHMiLCJwcmUiLCJuZXh0IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwidG9VcHBlckNhc2UiLCJpbmRleCIsImNyZWF0ZWRBdCIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2RlbCJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXG1vZGVsc1xcIiwic291cmNlcyI6WyJDb250YWN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcblxuY29uc3QgY29udGFjdFNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICBuYW1lOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ05hbWUgaXMgcmVxdWlyZWQnXSxcbiAgICB0cmltOiB0cnVlLFxuICAgIG1heGxlbmd0aDogWzEwMCwgJ05hbWUgY2Fubm90IGV4Y2VlZCAxMDAgY2hhcmFjdGVycyddXG4gIH0sXG4gIGVtYWlsOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ0VtYWlsIGlzIHJlcXVpcmVkJ10sXG4gICAgbG93ZXJjYXNlOiB0cnVlLFxuICAgIHRyaW06IHRydWUsXG4gICAgbWF0Y2g6IFsvXlxcdysoW1xcLi1dP1xcdyspKkBcXHcrKFtcXC4tXT9cXHcrKSooXFwuXFx3ezIsM30pKyQvLCAnUGxlYXNlIGVudGVyIGEgdmFsaWQgZW1haWwnXVxuICB9LFxuICBzdWJqZWN0OiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ1N1YmplY3QgaXMgcmVxdWlyZWQnXSxcbiAgICB0cmltOiB0cnVlLFxuICAgIG1heGxlbmd0aDogWzIwMCwgJ1N1YmplY3QgY2Fubm90IGV4Y2VlZCAyMDAgY2hhcmFjdGVycyddXG4gIH0sXG4gIG1lc3NhZ2U6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgcmVxdWlyZWQ6IFt0cnVlLCAnTWVzc2FnZSBpcyByZXF1aXJlZCddLFxuICAgIHRyaW06IHRydWUsXG4gICAgbWF4bGVuZ3RoOiBbMjAwMCwgJ01lc3NhZ2UgY2Fubm90IGV4Y2VlZCAyMDAwIGNoYXJhY3RlcnMnXVxuICB9LFxuICB0aWNrZXRJZDoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICB1bmlxdWU6IHRydWUsXG4gICAgcmVxdWlyZWQ6IGZhbHNlIC8vIEF1dG8tZ2VuZXJhdGVkIGluIHByZS1zYXZlIGhvb2tcbiAgfSxcbiAgc3RhdHVzOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIGVudW06IFsnbmV3JywgJ3JlYWQnLCAncmVwbGllZCcsICdjbG9zZWQnXSxcbiAgICBkZWZhdWx0OiAnbmV3J1xuICB9LFxuICBpc1JlYWQ6IHtcbiAgICB0eXBlOiBCb29sZWFuLFxuICAgIGRlZmF1bHQ6IGZhbHNlXG4gIH1cbn0sIHtcbiAgdGltZXN0YW1wczogdHJ1ZSAvLyBBZGRzIGNyZWF0ZWRBdCBhbmQgdXBkYXRlZEF0IGF1dG9tYXRpY2FsbHlcbn0pO1xuXG4vLyBHZW5lcmF0ZSB0aWNrZXQgSUQgYmVmb3JlIHNhdmluZ1xuY29udGFjdFNjaGVtYS5wcmUoJ3NhdmUnLCBmdW5jdGlvbihuZXh0KSB7XG4gIGlmICghdGhpcy50aWNrZXRJZCkge1xuICAgIHRoaXMudGlja2V0SWQgPSAnV0MtJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA2KS50b1VwcGVyQ2FzZSgpO1xuICB9XG4gIG5leHQoKTtcbn0pO1xuXG4vLyBJbmRleCBmb3IgZmFzdGVyIHF1ZXJpZXNcbmNvbnRhY3RTY2hlbWEuaW5kZXgoeyBjcmVhdGVkQXQ6IC0xIH0pO1xuY29udGFjdFNjaGVtYS5pbmRleCh7IHN0YXR1czogMSB9KTtcbmNvbnRhY3RTY2hlbWEuaW5kZXgoeyB0aWNrZXRJZDogMSB9KTtcblxubW9kdWxlLmV4cG9ydHMgPSBtb25nb29zZS5tb2RlbCgnQ29udGFjdCcsIGNvbnRhY3RTY2hlbWEpOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRXBDLE1BQU1DLGFBQWEsR0FBRyxJQUFJRixRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUN4Q0MsSUFBSSxFQUFFO0lBQ0pDLElBQUksRUFBRUMsTUFBTTtJQUNaQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsa0JBQWtCLENBQUM7SUFDcENDLElBQUksRUFBRSxJQUFJO0lBQ1ZDLFNBQVMsRUFBRSxDQUFDLEdBQUcsRUFBRSxtQ0FBbUM7RUFDdEQsQ0FBQztFQUNEQyxLQUFLLEVBQUU7SUFDTEwsSUFBSSxFQUFFQyxNQUFNO0lBQ1pDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxtQkFBbUIsQ0FBQztJQUNyQ0ksU0FBUyxFQUFFLElBQUk7SUFDZkgsSUFBSSxFQUFFLElBQUk7SUFDVkksS0FBSyxFQUFFLENBQUMsK0NBQStDLEVBQUUsNEJBQTRCO0VBQ3ZGLENBQUM7RUFDREMsT0FBTyxFQUFFO0lBQ1BSLElBQUksRUFBRUMsTUFBTTtJQUNaQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUscUJBQXFCLENBQUM7SUFDdkNDLElBQUksRUFBRSxJQUFJO0lBQ1ZDLFNBQVMsRUFBRSxDQUFDLEdBQUcsRUFBRSxzQ0FBc0M7RUFDekQsQ0FBQztFQUNESyxPQUFPLEVBQUU7SUFDUFQsSUFBSSxFQUFFQyxNQUFNO0lBQ1pDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxxQkFBcUIsQ0FBQztJQUN2Q0MsSUFBSSxFQUFFLElBQUk7SUFDVkMsU0FBUyxFQUFFLENBQUMsSUFBSSxFQUFFLHVDQUF1QztFQUMzRCxDQUFDO0VBQ0RNLFFBQVEsRUFBRTtJQUNSVixJQUFJLEVBQUVDLE1BQU07SUFDWlUsTUFBTSxFQUFFLElBQUk7SUFDWlQsUUFBUSxFQUFFLEtBQUssQ0FBQztFQUNsQixDQUFDO0VBQ0RVLE1BQU0sRUFBRTtJQUNOWixJQUFJLEVBQUVDLE1BQU07SUFDWlksSUFBSSxFQUFFLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsUUFBUSxDQUFDO0lBQzFDQyxPQUFPLEVBQUU7RUFDWCxDQUFDO0VBQ0RDLE1BQU0sRUFBRTtJQUNOZixJQUFJLEVBQUVnQixPQUFPO0lBQ2JGLE9BQU8sRUFBRTtFQUNYO0FBQ0YsQ0FBQyxFQUFFO0VBQ0RHLFVBQVUsRUFBRSxJQUFJLENBQUM7QUFDbkIsQ0FBQyxDQUFDOztBQUVGO0FBQ0FwQixhQUFhLENBQUNxQixHQUFHLENBQUMsTUFBTSxFQUFFLFVBQVNDLElBQUksRUFBRTtFQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDVCxRQUFRLEVBQUU7SUFDbEIsSUFBSSxDQUFDQSxRQUFRLEdBQUcsS0FBSyxHQUFHVSxJQUFJLENBQUNDLE1BQU0sQ0FBQyxDQUFDLENBQUNDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQ0MsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7RUFDL0U7RUFDQUwsSUFBSSxDQUFDLENBQUM7QUFDUixDQUFDLENBQUM7O0FBRUY7QUFDQXRCLGFBQWEsQ0FBQzRCLEtBQUssQ0FBQztFQUFFQyxTQUFTLEVBQUUsQ0FBQztBQUFFLENBQUMsQ0FBQztBQUN0QzdCLGFBQWEsQ0FBQzRCLEtBQUssQ0FBQztFQUFFYixNQUFNLEVBQUU7QUFBRSxDQUFDLENBQUM7QUFDbENmLGFBQWEsQ0FBQzRCLEtBQUssQ0FBQztFQUFFZixRQUFRLEVBQUU7QUFBRSxDQUFDLENBQUM7QUFFcENpQixNQUFNLENBQUNDLE9BQU8sR0FBR2pDLFFBQVEsQ0FBQ2tDLEtBQUssQ0FBQyxTQUFTLEVBQUVoQyxhQUFhLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=","map":{"version":3,"names":["mongoose","require","contactSchema","Schema","name","type","String","required","trim","maxlength","email","lowercase","match","subject","message","ticketId","unique","status","enum","default","isRead","Boolean","timestamps","pre","next","Math","random","toString","substr","toUpperCase","index","createdAt","module","exports","model"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\models\\","sources":["Contact.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst contactSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: [true, 'Name is required'],\n    trim: true,\n    maxlength: [100, 'Name cannot exceed 100 characters']\n  },\n  email: {\n    type: String,\n    required: [true, 'Email is required'],\n    lowercase: true,\n    trim: true,\n    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email']\n  },\n  subject: {\n    type: String,\n    required: [true, 'Subject is required'],\n    trim: true,\n    maxlength: [200, 'Subject cannot exceed 200 characters']\n  },\n  message: {\n    type: String,\n    required: [true, 'Message is required'],\n    trim: true,\n    maxlength: [2000, 'Message cannot exceed 2000 characters']\n  },\n  ticketId: {\n    type: String,\n    unique: true,\n    required: false // Auto-generated in pre-save hook\n  },\n  status: {\n    type: String,\n    enum: ['new', 'read', 'replied', 'closed'],\n    default: 'new'\n  },\n  isRead: {\n    type: Boolean,\n    default: false\n  }\n}, {\n  timestamps: true // Adds createdAt and updatedAt automatically\n});\n\n// Generate ticket ID before saving\ncontactSchema.pre('save', function(next) {\n  if (!this.ticketId) {\n    this.ticketId = 'WC-' + Math.random().toString(36).substr(2, 6).toUpperCase();\n  }\n  next();\n});\n\n// Index for faster queries\ncontactSchema.index({ createdAt: -1 });\ncontactSchema.index({ status: 1 });\ncontactSchema.index({ ticketId: 1 });\n\nmodule.exports = mongoose.model('Contact', contactSchema);"],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAMC,aAAa,GAAG,IAAIF,QAAQ,CAACG,MAAM,CAAC;EACxCC,IAAI,EAAE;IACJC,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,CAAC,IAAI,EAAE,kBAAkB,CAAC;IACpCC,IAAI,EAAE,IAAI;IACVC,SAAS,EAAE,CAAC,GAAG,EAAE,mCAAmC;EACtD,CAAC;EACDC,KAAK,EAAE;IACLL,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,CAAC,IAAI,EAAE,mBAAmB,CAAC;IACrCI,SAAS,EAAE,IAAI;IACfH,IAAI,EAAE,IAAI;IACVI,KAAK,EAAE,CAAC,+CAA+C,EAAE,4BAA4B;EACvF,CAAC;EACDC,OAAO,EAAE;IACPR,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,CAAC,IAAI,EAAE,qBAAqB,CAAC;IACvCC,IAAI,EAAE,IAAI;IACVC,SAAS,EAAE,CAAC,GAAG,EAAE,sCAAsC;EACzD,CAAC;EACDK,OAAO,EAAE;IACPT,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,CAAC,IAAI,EAAE,qBAAqB,CAAC;IACvCC,IAAI,EAAE,IAAI;IACVC,SAAS,EAAE,CAAC,IAAI,EAAE,uCAAuC;EAC3D,CAAC;EACDM,QAAQ,EAAE;IACRV,IAAI,EAAEC,MAAM;IACZU,MAAM,EAAE,IAAI;IACZT,QAAQ,EAAE,KAAK,CAAC;EAClB,CAAC;EACDU,MAAM,EAAE;IACNZ,IAAI,EAAEC,MAAM;IACZY,IAAI,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,QAAQ,CAAC;IAC1CC,OAAO,EAAE;EACX,CAAC;EACDC,MAAM,EAAE;IACNf,IAAI,EAAEgB,OAAO;IACbF,OAAO,EAAE;EACX;AACF,CAAC,EAAE;EACDG,UAAU,EAAE,IAAI,CAAC;AACnB,CAAC,CAAC;;AAEF;AACApB,aAAa,CAACqB,GAAG,CAAC,MAAM,EAAE,UAASC,IAAI,EAAE;EACvC,IAAI,CAAC,IAAI,CAACT,QAAQ,EAAE;IAClB,IAAI,CAACA,QAAQ,GAAG,KAAK,GAAGU,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;EAC/E;EACAL,IAAI,CAAC,CAAC;AACR,CAAC,CAAC;;AAEF;AACAtB,aAAa,CAAC4B,KAAK,CAAC;EAAEC,SAAS,EAAE,CAAC;AAAE,CAAC,CAAC;AACtC7B,aAAa,CAAC4B,KAAK,CAAC;EAAEb,MAAM,EAAE;AAAE,CAAC,CAAC;AAClCf,aAAa,CAAC4B,KAAK,CAAC;EAAEf,QAAQ,EAAE;AAAE,CAAC,CAAC;AAEpCiB,MAAM,CAACC,OAAO,GAAGjC,QAAQ,CAACkC,KAAK,CAAC,SAAS,EAAEhC,aAAa,CAAC","ignoreList":[]}},"mtime":1757504373425}}
=======
{"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst cors = require('cors');\nconst mongoose = require('mongoose');\nconst path = require('path');\nrequire('dotenv').config();\n// Restart trigger\n\nconst app = express();\nconst PORT = process.env.PORT || 5002;\n\n// Middleware\napp.use(cors());\napp.use(express.json());\napp.use(express.urlencoded({\n  extended: true\n}));\n\n// Serve static files from uploads directory\napp.use('/uploads', express.static(path.join(__dirname, '../uploads')));\n\n// Database connection\nconst connectDB = async () => {\n  try {\n    console.log('Connecting to MongoDB...');\n    await mongoose.connect(process.env.MONGODB_URI);\n    console.log('MongoDB connected successfully - nodemon restart triggered');\n  } catch (error) {\n    console.error('MongoDB connection failed:', error.message);\n    console.log('\\n=== DATABASE SETUP REQUIRED ===');\n    console.log('MongoDB is not running or not installed.');\n    console.log('To set up MongoDB:');\n    console.log('1. Install MongoDB Community Server from: https://www.mongodb.com/try/download/community');\n    console.log('2. Start MongoDB service');\n    console.log('3. Restart this server');\n    console.log('\\nFor now, the server will continue without database connectivity.');\n    console.log('Some features may not work properly until MongoDB is set up.');\n    console.log('================================\\n');\n  }\n};\n\n// Routes\napp.get('/', (req, res) => {\n  res.json({\n    message: 'DREAM COFFEE API is running!'\n  });\n});\n\n// Import routes\napp.use('/api/products', require('./routes/products'));\napp.use('/api/auth', require('./routes/auth'));\napp.use('/api/orders', require('./routes/orders'));\napp.use('/api/payments', require('./routes/payments'));\napp.use('/api/upload', require('./routes/upload'));\napp.use('/api/admin', require('./routes/admin'));\napp.use('/api/shop', require('./routes/shop'));\napp.use('/api/contact', require('./routes/contact'));\n// app.use('/api/users', require('./routes/users'));\n\n// Error handling middleware\napp.use((err, req, res, next) => {\n  console.error(err.stack);\n  res.status(500).json({\n    message: 'Something went wrong!'\n  });\n});\n\n// 404 handler\napp.use('*', (req, res) => {\n  res.status(404).json({\n    message: 'Route not found'\n  });\n});\n\n// Start server\nconst startServer = async () => {\n  await connectDB();\n  app.listen(PORT, () => {\n    console.log(`Server is running on port ${PORT}`);\n    console.log(`API available at http://localhost:${PORT}`);\n  });\n};\nstartServer(); // restart with port 5002\n// trigger restart\n// Config updated\n// Port updated to 3002\n// Port updated to 3005\n// Port updated to 5000\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImNvcnMiLCJtb25nb29zZSIsInBhdGgiLCJjb25maWciLCJhcHAiLCJQT1JUIiwicHJvY2VzcyIsImVudiIsInVzZSIsImpzb24iLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJzdGF0aWMiLCJqb2luIiwiX19kaXJuYW1lIiwiY29ubmVjdERCIiwiY29uc29sZSIsImxvZyIsImNvbm5lY3QiLCJNT05HT0RCX1VSSSIsImVycm9yIiwibWVzc2FnZSIsImdldCIsInJlcSIsInJlcyIsImVyciIsIm5leHQiLCJzdGFjayIsInN0YXR1cyIsInN0YXJ0U2VydmVyIiwibGlzdGVuIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xcIiwic291cmNlcyI6WyJpbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3QgY29ycyA9IHJlcXVpcmUoJ2NvcnMnKTtcbmNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5yZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKTtcbi8vIFJlc3RhcnQgdHJpZ2dlclxuXG5jb25zdCBhcHAgPSBleHByZXNzKCk7XG5jb25zdCBQT1JUID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCA1MDAyO1xuXG4vLyBNaWRkbGV3YXJlXG5hcHAudXNlKGNvcnMoKSk7XG5hcHAudXNlKGV4cHJlc3MuanNvbigpKTtcbmFwcC51c2UoZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUgfSkpO1xuXG4vLyBTZXJ2ZSBzdGF0aWMgZmlsZXMgZnJvbSB1cGxvYWRzIGRpcmVjdG9yeVxuYXBwLnVzZSgnL3VwbG9hZHMnLCBleHByZXNzLnN0YXRpYyhwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vdXBsb2FkcycpKSk7XG5cbi8vIERhdGFiYXNlIGNvbm5lY3Rpb25cbmNvbnN0IGNvbm5lY3REQiA9IGFzeW5jICgpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnQ29ubmVjdGluZyB0byBNb25nb0RCLi4uJyk7XG4gICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdChwcm9jZXNzLmVudi5NT05HT0RCX1VSSSk7XG4gICAgY29uc29sZS5sb2coJ01vbmdvREIgY29ubmVjdGVkIHN1Y2Nlc3NmdWxseSAtIG5vZGVtb24gcmVzdGFydCB0cmlnZ2VyZWQnKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdNb25nb0RCIGNvbm5lY3Rpb24gZmFpbGVkOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIGNvbnNvbGUubG9nKCdcXG49PT0gREFUQUJBU0UgU0VUVVAgUkVRVUlSRUQgPT09Jyk7XG4gICAgY29uc29sZS5sb2coJ01vbmdvREIgaXMgbm90IHJ1bm5pbmcgb3Igbm90IGluc3RhbGxlZC4nKTtcbiAgICBjb25zb2xlLmxvZygnVG8gc2V0IHVwIE1vbmdvREI6Jyk7XG4gICAgY29uc29sZS5sb2coJzEuIEluc3RhbGwgTW9uZ29EQiBDb21tdW5pdHkgU2VydmVyIGZyb206IGh0dHBzOi8vd3d3Lm1vbmdvZGIuY29tL3RyeS9kb3dubG9hZC9jb21tdW5pdHknKTtcbiAgICBjb25zb2xlLmxvZygnMi4gU3RhcnQgTW9uZ29EQiBzZXJ2aWNlJyk7XG4gICAgY29uc29sZS5sb2coJzMuIFJlc3RhcnQgdGhpcyBzZXJ2ZXInKTtcbiAgICBjb25zb2xlLmxvZygnXFxuRm9yIG5vdywgdGhlIHNlcnZlciB3aWxsIGNvbnRpbnVlIHdpdGhvdXQgZGF0YWJhc2UgY29ubmVjdGl2aXR5LicpO1xuICAgIGNvbnNvbGUubG9nKCdTb21lIGZlYXR1cmVzIG1heSBub3Qgd29yayBwcm9wZXJseSB1bnRpbCBNb25nb0RCIGlzIHNldCB1cC4nKTtcbiAgICBjb25zb2xlLmxvZygnPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cXG4nKTtcbiAgfVxufTtcblxuLy8gUm91dGVzXG5hcHAuZ2V0KCcvJywgKHJlcSwgcmVzKSA9PiB7XG4gIHJlcy5qc29uKHsgbWVzc2FnZTogJ0RSRUFNIENPRkZFRSBBUEkgaXMgcnVubmluZyEnIH0pO1xufSk7XG5cbi8vIEltcG9ydCByb3V0ZXNcbmFwcC51c2UoJy9hcGkvcHJvZHVjdHMnLCByZXF1aXJlKCcuL3JvdXRlcy9wcm9kdWN0cycpKTtcbmFwcC51c2UoJy9hcGkvYXV0aCcsIHJlcXVpcmUoJy4vcm91dGVzL2F1dGgnKSk7XG5hcHAudXNlKCcvYXBpL29yZGVycycsIHJlcXVpcmUoJy4vcm91dGVzL29yZGVycycpKTtcbmFwcC51c2UoJy9hcGkvcGF5bWVudHMnLCByZXF1aXJlKCcuL3JvdXRlcy9wYXltZW50cycpKTtcbmFwcC51c2UoJy9hcGkvdXBsb2FkJywgcmVxdWlyZSgnLi9yb3V0ZXMvdXBsb2FkJykpO1xuYXBwLnVzZSgnL2FwaS9hZG1pbicsIHJlcXVpcmUoJy4vcm91dGVzL2FkbWluJykpO1xuYXBwLnVzZSgnL2FwaS9zaG9wJywgcmVxdWlyZSgnLi9yb3V0ZXMvc2hvcCcpKTtcbmFwcC51c2UoJy9hcGkvY29udGFjdCcsIHJlcXVpcmUoJy4vcm91dGVzL2NvbnRhY3QnKSk7XG4vLyBhcHAudXNlKCcvYXBpL3VzZXJzJywgcmVxdWlyZSgnLi9yb3V0ZXMvdXNlcnMnKSk7XG5cbi8vIEVycm9yIGhhbmRsaW5nIG1pZGRsZXdhcmVcbmFwcC51c2UoKGVyciwgcmVxLCByZXMsIG5leHQpID0+IHtcbiAgY29uc29sZS5lcnJvcihlcnIuc3RhY2spO1xuICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdTb21ldGhpbmcgd2VudCB3cm9uZyEnIH0pO1xufSk7XG5cbi8vIDQwNCBoYW5kbGVyXG5hcHAudXNlKCcqJywgKHJlcSwgcmVzKSA9PiB7XG4gIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ1JvdXRlIG5vdCBmb3VuZCcgfSk7XG59KTtcblxuLy8gU3RhcnQgc2VydmVyXG5jb25zdCBzdGFydFNlcnZlciA9IGFzeW5jICgpID0+IHtcbiAgYXdhaXQgY29ubmVjdERCKCk7XG4gIGFwcC5saXN0ZW4oUE9SVCwgKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBTZXJ2ZXIgaXMgcnVubmluZyBvbiBwb3J0ICR7UE9SVH1gKTtcbiAgICBjb25zb2xlLmxvZyhgQVBJIGF2YWlsYWJsZSBhdCBodHRwOi8vbG9jYWxob3N0OiR7UE9SVH1gKTtcbiAgfSk7XG59O1xuXG5zdGFydFNlcnZlcigpOy8vIHJlc3RhcnQgd2l0aCBwb3J0IDUwMDJcbi8vIHRyaWdnZXIgcmVzdGFydFxuLy8gQ29uZmlnIHVwZGF0ZWRcbi8vIFBvcnQgdXBkYXRlZCB0byAzMDAyXG4vLyBQb3J0IHVwZGF0ZWQgdG8gMzAwNVxuLy8gUG9ydCB1cGRhdGVkIHRvIDUwMDBcbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLElBQUksR0FBR0QsT0FBTyxDQUFDLE1BQU0sQ0FBQztBQUM1QixNQUFNRSxRQUFRLEdBQUdGLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFDcEMsTUFBTUcsSUFBSSxHQUFHSCxPQUFPLENBQUMsTUFBTSxDQUFDO0FBQzVCQSxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUNJLE1BQU0sQ0FBQyxDQUFDO0FBQzFCOztBQUVBLE1BQU1DLEdBQUcsR0FBR04sT0FBTyxDQUFDLENBQUM7QUFDckIsTUFBTU8sSUFBSSxHQUFHQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0YsSUFBSSxJQUFJLElBQUk7O0FBRXJDO0FBQ0FELEdBQUcsQ0FBQ0ksR0FBRyxDQUFDUixJQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ2ZJLEdBQUcsQ0FBQ0ksR0FBRyxDQUFDVixPQUFPLENBQUNXLElBQUksQ0FBQyxDQUFDLENBQUM7QUFDdkJMLEdBQUcsQ0FBQ0ksR0FBRyxDQUFDVixPQUFPLENBQUNZLFVBQVUsQ0FBQztFQUFFQyxRQUFR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","map":{"version":3,"names":["express","require","cors","mongoose","path","config","app","PORT","process","env","use","json","urlencoded","extended","static","join","__dirname","connectDB","console","log","connect","MONGODB_URI","error","message","get","req","res","err","next","stack","status","startServer","listen"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\","sources":["index.js"],"sourcesContent":["const express = require('express');\nconst cors = require('cors');\nconst mongoose = require('mongoose');\nconst path = require('path');\nrequire('dotenv').config();\n// Restart trigger\n\nconst app = express();\nconst PORT = process.env.PORT || 5002;\n\n// Middleware\napp.use(cors());\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\n// Serve static files from uploads directory\napp.use('/uploads', express.static(path.join(__dirname, '../uploads')));\n\n// Database connection\nconst connectDB = async () => {\n  try {\n    console.log('Connecting to MongoDB...');\n    await mongoose.connect(process.env.MONGODB_URI);\n    console.log('MongoDB connected successfully - nodemon restart triggered');\n  } catch (error) {\n    console.error('MongoDB connection failed:', error.message);\n    console.log('\\n=== DATABASE SETUP REQUIRED ===');\n    console.log('MongoDB is not running or not installed.');\n    console.log('To set up MongoDB:');\n    console.log('1. Install MongoDB Community Server from: https://www.mongodb.com/try/download/community');\n    console.log('2. Start MongoDB service');\n    console.log('3. Restart this server');\n    console.log('\\nFor now, the server will continue without database connectivity.');\n    console.log('Some features may not work properly until MongoDB is set up.');\n    console.log('================================\\n');\n  }\n};\n\n// Routes\napp.get('/', (req, res) => {\n  res.json({ message: 'DREAM COFFEE API is running!' });\n});\n\n// Import routes\napp.use('/api/products', require('./routes/products'));\napp.use('/api/auth', require('./routes/auth'));\napp.use('/api/orders', require('./routes/orders'));\napp.use('/api/payments', require('./routes/payments'));\napp.use('/api/upload', require('./routes/upload'));\napp.use('/api/admin', require('./routes/admin'));\napp.use('/api/shop', require('./routes/shop'));\napp.use('/api/contact', require('./routes/contact'));\n// app.use('/api/users', require('./routes/users'));\n\n// Error handling middleware\napp.use((err, req, res, next) => {\n  console.error(err.stack);\n  res.status(500).json({ message: 'Something went wrong!' });\n});\n\n// 404 handler\napp.use('*', (req, res) => {\n  res.status(404).json({ message: 'Route not found' });\n});\n\n// Start server\nconst startServer = async () => {\n  await connectDB();\n  app.listen(PORT, () => {\n    console.log(`Server is running on port ${PORT}`);\n    console.log(`API available at http://localhost:${PORT}`);\n  });\n};\n\nstartServer();// restart with port 5002\n// trigger restart\n// Config updated\n// Port updated to 3002\n// Port updated to 3005\n// Port updated to 5000\n"],"mappings":"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","ignoreList":[]}},"mtime":1757571731047},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\products.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst Product = require('../models/Product');\nconst router = express.Router();\n\n// Sample products data for seeding (will be moved to database)\n// Products are now stored in MongoDB\n// Use the seedProducts.js script to populate the database with sample data\n\n// @route   GET /api/products\n// @desc    Get all products with optional filtering\n// @access  Public\nrouter.get('/', async (req, res) => {\n  try {\n    const {\n      category,\n      featured,\n      search,\n      page = 1,\n      limit = 10,\n      includeOutOfStock\n    } = req.query;\n\n    // Build query object\n    let query = {};\n\n    // Only filter by inStock if includeOutOfStock is not set to 'true'\n    if (includeOutOfStock !== 'true') {\n      query.inStock = true;\n    }\n    if (category) {\n      query.category = new RegExp(category, 'i');\n    }\n    if (featured === 'true') {\n      query.featured = true;\n    }\n    if (search) {\n      query.$or = [{\n        name: new RegExp(search, 'i')\n      }, {\n        description: new RegExp(search, 'i')\n      }];\n    }\n\n    // Calculate pagination\n    const pageNum = parseInt(page);\n    const limitNum = parseInt(limit);\n    const skip = (pageNum - 1) * limitNum;\n\n    // Execute queries\n    const [products, total] = await Promise.all([Product.find(query).skip(skip).limit(limitNum).sort({\n      createdAt: -1\n    }), Product.countDocuments(query)]);\n    res.json({\n      success: true,\n      data: products,\n      pagination: {\n        current: pageNum,\n        pages: Math.ceil(total / limitNum),\n        total: total\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching products:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching products'\n    });\n  }\n});\n\n// @route   GET /api/products/categories\n// @desc    Get all product categories\n// @access  Public\nrouter.get('/categories', async (req, res) => {\n  try {\n    // Return the enum categories from the schema instead of existing data\n    const categories = ['Cà phê', 'Thức uống đậm vị', 'Đồ uống tươi mát', 'Bánh ngọt'];\n    res.json({\n      success: true,\n      data: categories\n    });\n  } catch (error) {\n    console.error('Error fetching categories:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching categories'\n    });\n  }\n});\n\n// @route   GET /api/products/featured\n// @desc    Get featured products\n// @access  Public\nrouter.get('/featured', async (req, res) => {\n  try {\n    const featuredProducts = await Product.find({\n      featured: true,\n      inStock: true\n    });\n    res.json({\n      success: true,\n      data: featuredProducts\n    });\n  } catch (error) {\n    console.error('Error fetching featured products:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching featured products'\n    });\n  }\n});\n\n// @route   GET /api/products/bestsellers\n// @desc    Get best selling products\n// @access  Public\nrouter.get('/bestsellers', async (req, res) => {\n  try {\n    const Order = require('../models/Order');\n\n    // Get top selling products from order data\n    const bestSellers = await Order.aggregate([{\n      $unwind: '$items'\n    }, {\n      $group: {\n        _id: '$items.product',\n        name: {\n          $first: '$items.name'\n        },\n        totalSold: {\n          $sum: '$items.quantity'\n        },\n        totalRevenue: {\n          $sum: {\n            $multiply: ['$items.price', '$items.quantity']\n          }\n        }\n      }\n    }, {\n      $sort: {\n        totalSold: -1\n      }\n    }, {\n      $limit: 6\n    }]);\n\n    // Get full product details for best sellers\n    const productIds = bestSellers.map(item => item._id).filter(id => id);\n    const products = await Product.find({\n      _id: {\n        $in: productIds\n      },\n      inStock: true\n    });\n\n    // Merge sales data with product details\n    const bestSellerProducts = products.map(product => {\n      const salesData = bestSellers.find(item => item._id && item._id.toString() === product._id.toString());\n      return {\n        ...product.toObject(),\n        totalSold: salesData ? salesData.totalSold : 0\n      };\n    });\n\n    // Sort by total sold and limit to 6\n    bestSellerProducts.sort((a, b) => b.totalSold - a.totalSold);\n    res.json({\n      success: true,\n      data: bestSellerProducts.slice(0, 6)\n    });\n  } catch (error) {\n    console.error('Error fetching best sellers:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching best sellers'\n    });\n  }\n});\n\n// @route   GET /api/products/:id\n// @desc    Get single product\n// @access  Public\nrouter.get('/:id', async (req, res) => {\n  try {\n    const product = await Product.findById(req.params.id);\n    if (!product) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: product\n    });\n  } catch (error) {\n    console.error('Error fetching product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching product'\n    });\n  }\n});\n\n// @route   POST /api/products\n// @desc    Create new product\n// @access  Private/Admin\nrouter.post('/', async (req, res) => {\n  try {\n    const {\n      name,\n      category,\n      description,\n      price,\n      image,\n      imageUrl,\n      imagePublicId,\n      featured,\n      sizes\n    } = req.body;\n    const productData = {\n      name,\n      category,\n      description,\n      price: parseFloat(price),\n      image,\n      imageUrl,\n      imagePublicId,\n      featured: featured || false,\n      inStock: true,\n      sizes: sizes || [{\n        name: 'Regular',\n        price: parseFloat(price)\n      }]\n    };\n    const newProduct = await Product.create(productData);\n    res.status(201).json({\n      success: true,\n      data: newProduct\n    });\n  } catch (error) {\n    console.error('Error creating product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating product'\n    });\n  }\n});\n\n// @route   PUT /api/products/:id\n// @desc    Update product\n// @access  Private/Admin\nrouter.put('/:id', async (req, res) => {\n  try {\n    const {\n      name,\n      category,\n      description,\n      price,\n      image,\n      imageUrl,\n      imagePublicId,\n      featured,\n      inStock,\n      sizes\n    } = req.body;\n\n    // Get the existing product to check for old image\n    const existingProduct = await Product.findById(req.params.id);\n    if (!existingProduct) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n\n    // If updating with a new Cloudinary image, delete the old one\n    if (imagePublicId && existingProduct.imagePublicId && existingProduct.imagePublicId !== imagePublicId) {\n      try {\n        const {\n          deleteFromCloudinary\n        } = require('../config/cloudinary');\n        await deleteFromCloudinary(existingProduct.imagePublicId);\n      } catch (cloudinaryError) {\n        console.error('Error deleting old image from Cloudinary:', cloudinaryError);\n        // Continue with update even if Cloudinary deletion fails\n      }\n    }\n    const updateData = {};\n    if (name !== undefined) updateData.name = name;\n    if (category !== undefined) updateData.category = category;\n    if (description !== undefined) updateData.description = description;\n    if (price !== undefined) updateData.price = parseFloat(price);\n    if (image !== undefined) updateData.image = image;\n    if (imageUrl !== undefined) updateData.imageUrl = imageUrl;\n    if (imagePublicId !== undefined) updateData.imagePublicId = imagePublicId;\n    if (featured !== undefined) updateData.featured = featured;\n    if (inStock !== undefined) updateData.inStock = inStock;\n    if (sizes !== undefined) updateData.sizes = sizes;\n    const updatedProduct = await Product.findByIdAndUpdate(req.params.id, updateData, {\n      new: true,\n      runValidators: true\n    });\n    res.json({\n      success: true,\n      data: updatedProduct\n    });\n  } catch (error) {\n    console.error('Error updating product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating product'\n    });\n  }\n});\n\n// @route   DELETE /api/products/:id\n// @desc    Delete product\n// @access  Private/Admin\nrouter.delete('/:id', async (req, res) => {\n  try {\n    const product = await Product.findById(req.params.id);\n    if (!product) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n\n    // Delete image from Cloudinary if it exists\n    if (product.imagePublicId) {\n      try {\n        const {\n          deleteFromCloudinary\n        } = require('../config/cloudinary');\n        await deleteFromCloudinary(product.imagePublicId);\n      } catch (cloudinaryError) {\n        console.error('Error deleting image from Cloudinary:', cloudinaryError);\n        // Continue with product deletion even if Cloudinary deletion fails\n      }\n    }\n    const deletedProduct = await Product.findByIdAndDelete(req.params.id);\n    res.json({\n      success: true,\n      data: deletedProduct,\n      message: 'Product deleted successfully'\n    });\n  } catch (error) {\n    console.error('Error deleting product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while deleting product'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsIlByb2R1Y3QiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJnZXQiLCJyZXEiLCJyZXMiLCJjYXRlZ29yeSIsImZlYXR1cmVkIiwic2VhcmNoIiwicGFnZSIsImxpbWl0IiwiaW5jbHVkZU91dE9mU3RvY2siLCJxdWVyeSIsImluU3RvY2siLCJSZWdFeHAiLCIkb3IiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJwYWdlTnVtIiwicGFyc2VJbnQiLCJsaW1pdE51bSIsInNraXAiLCJwcm9kdWN0cyIsInRvdGFsIiwiUHJvbWlzZSIsImFsbCIsImZpbmQiLCJzb3J0IiwiY3JlYXRlZEF0IiwiY291bnREb2N1bWVudHMiLCJqc29uIiwic3VjY2VzcyIsImRhdGEiLCJwYWdpbmF0aW9uIiwiY3VycmVudCIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJlcnJvciIsImNvbnNvbGUiLCJzdGF0dXMiLCJtZXNzYWdlIiwiY2F0ZWdvcmllcyIsImZlYXR1cmVkUHJvZHVjdHMiLCJPcmRlciIsImJlc3RTZWxsZXJzIiwiYWdncmVnYXRlIiwiJHVud2luZCIsIiRncm91cCIsIl9pZCIsIiRmaXJzdCIsInRvdGFsU29sZCIsIiRzdW0iLCJ0b3RhbFJldmVudWUiLCIkbXVsdGlwbHkiLCIkc29ydCIsIiRsaW1pdCIsInByb2R1Y3RJZHMiLCJtYXAiLCJpdGVtIiwiZmlsdGVyIiwiaWQiLCIkaW4iLCJiZXN0U2VsbGVyUHJvZHVjdHMiLCJwcm9kdWN0Iiwic2FsZXNEYXRhIiwidG9TdHJpbmciLCJ0b09iamVjdCIsImEiLCJiIiwic2xpY2UiLCJmaW5kQnlJZCIsInBhcmFtcyIsInBvc3QiLCJwcmljZSIsImltYWdlIiwiaW1hZ2VVcmwiLCJpbWFnZVB1YmxpY0lkIiwic2l6ZXMiLCJib2R5IiwicHJvZHVjdERhdGEiLCJwYXJzZUZsb2F0IiwibmV3UHJvZHVjdCIsImNyZWF0ZSIsInB1dCIsImV4aXN0aW5nUHJvZHVjdCIsImRlbGV0ZUZyb21DbG91ZGluYXJ5IiwiY2xvdWRpbmFyeUVycm9yIiwidXBkYXRlRGF0YSIsInVuZGVmaW5lZCIsInVwZGF0ZWRQcm9kdWN0IiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJuZXciLCJydW5WYWxpZGF0b3JzIiwiZGVsZXRlIiwiZGVsZXRlZFByb2R1Y3QiLCJmaW5kQnlJZEFuZERlbGV0ZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkQ6XFxjb2RlXFxXZWJDYWZmZVxcYmFja2VuZFxcc3JjXFxyb3V0ZXNcXCIsInNvdXJjZXMiOlsicHJvZHVjdHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IFByb2R1Y3QgPSByZXF1aXJlKCcuLi9tb2RlbHMvUHJvZHVjdCcpO1xuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcblxuLy8gU2FtcGxlIHByb2R1Y3RzIGRhdGEgZm9yIHNlZWRpbmcgKHdpbGwgYmUgbW92ZWQgdG8gZGF0YWJhc2UpXG4vLyBQcm9kdWN0cyBhcmUgbm93IHN0b3JlZCBpbiBNb25nb0RCXG4vLyBVc2UgdGhlIHNlZWRQcm9kdWN0cy5qcyBzY3JpcHQgdG8gcG9wdWxhdGUgdGhlIGRhdGFiYXNlIHdpdGggc2FtcGxlIGRhdGFcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvcHJvZHVjdHNcbi8vIEBkZXNjICAgIEdldCBhbGwgcHJvZHVjdHMgd2l0aCBvcHRpb25hbCBmaWx0ZXJpbmdcbi8vIEBhY2Nlc3MgIFB1YmxpY1xucm91dGVyLmdldCgnLycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgY2F0ZWdvcnksIGZlYXR1cmVkLCBzZWFyY2gsIHBhZ2UgPSAxLCBsaW1pdCA9IDEwLCBpbmNsdWRlT3V0T2ZTdG9jayB9ID0gcmVxLnF1ZXJ5O1xuICAgIFxuICAgIC8vIEJ1aWxkIHF1ZXJ5IG9iamVjdFxuICAgIGxldCBxdWVyeSA9IHt9O1xuICAgIFxuICAgIC8vIE9ubHkgZmlsdGVyIGJ5IGluU3RvY2sgaWYgaW5jbHVkZU91dE9mU3RvY2sgaXMgbm90IHNldCB0byAndHJ1ZSdcbiAgICBpZiAoaW5jbHVkZU91dE9mU3RvY2sgIT09ICd0cnVlJykge1xuICAgICAgcXVlcnkuaW5TdG9jayA9IHRydWU7XG4gICAgfVxuICAgIFxuICAgIGlmIChjYXRlZ29yeSkge1xuICAgICAgcXVlcnkuY2F0ZWdvcnkgPSBuZXcgUmVnRXhwKGNhdGVnb3J5LCAnaScpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoZmVhdHVyZWQgPT09ICd0cnVlJykge1xuICAgICAgcXVlcnkuZmVhdHVyZWQgPSB0cnVlO1xuICAgIH1cbiAgICBcbiAgICBpZiAoc2VhcmNoKSB7XG4gICAgICBxdWVyeS4kb3IgPSBbXG4gICAgICAgIHsgbmFtZTogbmV3IFJlZ0V4cChzZWFyY2gsICdpJykgfSxcbiAgICAgICAgeyBkZXNjcmlwdGlvbjogbmV3IFJlZ0V4cChzZWFyY2gsICdpJykgfVxuICAgICAgXTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIHBhZ2luYXRpb25cbiAgICBjb25zdCBwYWdlTnVtID0gcGFyc2VJbnQocGFnZSk7XG4gICAgY29uc3QgbGltaXROdW0gPSBwYXJzZUludChsaW1pdCk7XG4gICAgY29uc3Qgc2tpcCA9IChwYWdlTnVtIC0gMSkgKiBsaW1pdE51bTtcbiAgICBcbiAgICAvLyBFeGVjdXRlIHF1ZXJpZXNcbiAgICBjb25zdCBbcHJvZHVjdHMsIHRvdGFsXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgIFByb2R1Y3QuZmluZChxdWVyeSlcbiAgICAgICAgLnNraXAoc2tpcClcbiAgICAgICAgLmxpbWl0KGxpbWl0TnVtKVxuICAgICAgICAuc29ydCh7IGNyZWF0ZWRBdDogLTEgfSksXG4gICAgICBQcm9kdWN0LmNvdW50RG9jdW1lbnRzKHF1ZXJ5KVxuICAgIF0pO1xuICAgIFxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBwcm9kdWN0cyxcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgY3VycmVudDogcGFnZU51bSxcbiAgICAgICAgcGFnZXM6IE1hdGguY2VpbCh0b3RhbCAvIGxpbWl0TnVtKSxcbiAgICAgICAgdG90YWw6IHRvdGFsXG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvZHVjdHM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBwcm9kdWN0cydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3Byb2R1Y3RzL2NhdGVnb3JpZXNcbi8vIEBkZXNjICAgIEdldCBhbGwgcHJvZHVjdCBjYXRlZ29yaWVzXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5nZXQoJy9jYXRlZ29yaWVzJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgLy8gUmV0dXJuIHRoZSBlbnVtIGNhdGVnb3JpZXMgZnJvbSB0aGUgc2NoZW1hIGluc3RlYWQgb2YgZXhpc3RpbmcgZGF0YVxuICAgIGNvbnN0IGNhdGVnb3JpZXMgPSBbJ0PDoCBwaMOqJywgJ1Ro4bupYyB14buRbmcgxJHhuq1tIHbhu4snLCAnxJDhu5MgdeG7kW5nIHTGsMahaSBtw6F0JywgJ0LDoW5oIG5n4buNdCddO1xuICAgIFxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBjYXRlZ29yaWVzXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgY2F0ZWdvcmllczonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIGNhdGVnb3JpZXMnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9wcm9kdWN0cy9mZWF0dXJlZFxuLy8gQGRlc2MgICAgR2V0IGZlYXR1cmVkIHByb2R1Y3RzXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5nZXQoJy9mZWF0dXJlZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGZlYXR1cmVkUHJvZHVjdHMgPSBhd2FpdCBQcm9kdWN0LmZpbmQoeyBmZWF0dXJlZDogdHJ1ZSwgaW5TdG9jazogdHJ1ZSB9KTtcbiAgICBcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogZmVhdHVyZWRQcm9kdWN0c1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGZlYXR1cmVkIHByb2R1Y3RzOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgZmVhdHVyZWQgcHJvZHVjdHMnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9wcm9kdWN0cy9iZXN0c2VsbGVyc1xuLy8gQGRlc2MgICAgR2V0IGJlc3Qgc2VsbGluZyBwcm9kdWN0c1xuLy8gQGFjY2VzcyAgUHVibGljXG5yb3V0ZXIuZ2V0KCcvYmVzdHNlbGxlcnMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBPcmRlciA9IHJlcXVpcmUoJy4uL21vZGVscy9PcmRlcicpO1xuICAgIFxuICAgIC8vIEdldCB0b3Agc2VsbGluZyBwcm9kdWN0cyBmcm9tIG9yZGVyIGRhdGFcbiAgICBjb25zdCBiZXN0U2VsbGVycyA9IGF3YWl0IE9yZGVyLmFnZ3JlZ2F0ZShbXG4gICAgICB7ICR1bndpbmQ6ICckaXRlbXMnIH0sXG4gICAgICB7XG4gICAgICAgICRncm91cDoge1xuICAgICAgICAgIF9pZDogJyRpdGVtcy5wcm9kdWN0JyxcbiAgICAgICAgICBuYW1lOiB7ICRmaXJzdDogJyRpdGVtcy5uYW1lJyB9LFxuICAgICAgICAgIHRvdGFsU29sZDogeyAkc3VtOiAnJGl0ZW1zLnF1YW50aXR5JyB9LFxuICAgICAgICAgIHRvdGFsUmV2ZW51ZTogeyAkc3VtOiB7ICRtdWx0aXBseTogWyckaXRlbXMucHJpY2UnLCAnJGl0ZW1zLnF1YW50aXR5J10gfSB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7ICRzb3J0OiB7IHRvdGFsU29sZDogLTEgfSB9LFxuICAgICAgeyAkbGltaXQ6IDYgfVxuICAgIF0pO1xuICAgIFxuICAgIC8vIEdldCBmdWxsIHByb2R1Y3QgZGV0YWlscyBmb3IgYmVzdCBzZWxsZXJzXG4gICAgY29uc3QgcHJvZHVjdElkcyA9IGJlc3RTZWxsZXJzLm1hcChpdGVtID0+IGl0ZW0uX2lkKS5maWx0ZXIoaWQgPT4gaWQpO1xuICAgIGNvbnN0IHByb2R1Y3RzID0gYXdhaXQgUHJvZHVjdC5maW5kKHsgXG4gICAgICBfaWQ6IHsgJGluOiBwcm9kdWN0SWRzIH0sIFxuICAgICAgaW5TdG9jazogdHJ1ZSBcbiAgICB9KTtcbiAgICBcbiAgICAvLyBNZXJnZSBzYWxlcyBkYXRhIHdpdGggcHJvZHVjdCBkZXRhaWxzXG4gICAgY29uc3QgYmVzdFNlbGxlclByb2R1Y3RzID0gcHJvZHVjdHMubWFwKHByb2R1Y3QgPT4ge1xuICAgICAgY29uc3Qgc2FsZXNEYXRhID0gYmVzdFNlbGxlcnMuZmluZChpdGVtID0+IFxuICAgICAgICBpdGVtLl9pZCAmJiBpdGVtLl9pZC50b1N0cmluZygpID09PSBwcm9kdWN0Ll9pZC50b1N0cmluZygpXG4gICAgICApO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucHJvZHVjdC50b09iamVjdCgpLFxuICAgICAgICB0b3RhbFNvbGQ6IHNhbGVzRGF0YSA/IHNhbGVzRGF0YS50b3RhbFNvbGQgOiAwXG4gICAgICB9O1xuICAgIH0pO1xuICAgIFxuICAgIC8vIFNvcnQgYnkgdG90YWwgc29sZCBhbmQgbGltaXQgdG8gNlxuICAgIGJlc3RTZWxsZXJQcm9kdWN0cy5zb3J0KChhLCBiKSA9PiBiLnRvdGFsU29sZCAtIGEudG90YWxTb2xkKTtcbiAgICBcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogYmVzdFNlbGxlclByb2R1Y3RzLnNsaWNlKDAsIDYpXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgYmVzdCBzZWxsZXJzOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgYmVzdCBzZWxsZXJzJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvcHJvZHVjdHMvOmlkXG4vLyBAZGVzYyAgICBHZXQgc2luZ2xlIHByb2R1Y3Rcbi8vIEBhY2Nlc3MgIFB1YmxpY1xucm91dGVyLmdldCgnLzppZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpO1xuICAgIFxuICAgIGlmICghcHJvZHVjdCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdQcm9kdWN0IG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogcHJvZHVjdFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHByb2R1Y3Q6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBwcm9kdWN0J1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3Byb2R1Y3RzXG4vLyBAZGVzYyAgICBDcmVhdGUgbmV3IHByb2R1Y3Rcbi8vIEBhY2Nlc3MgIFByaXZhdGUvQWRtaW5cbnJvdXRlci5wb3N0KCcvJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBuYW1lLCBjYXRlZ29yeSwgZGVzY3JpcHRpb24sIHByaWNlLCBpbWFnZSwgaW1hZ2VVcmwsIGltYWdlUHVibGljSWQsIGZlYXR1cmVkLCBzaXplcyB9ID0gcmVxLmJvZHk7XG4gICAgXG4gICAgY29uc3QgcHJvZHVjdERhdGEgPSB7XG4gICAgICBuYW1lLFxuICAgICAgY2F0ZWdvcnksXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHByaWNlOiBwYXJzZUZsb2F0KHByaWNlKSxcbiAgICAgIGltYWdlLFxuICAgICAgaW1hZ2VVcmwsXG4gICAgICBpbWFnZVB1YmxpY0lkLFxuICAgICAgZmVhdHVyZWQ6IGZlYXR1cmVkIHx8IGZhbHNlLFxuICAgICAgaW5TdG9jazogdHJ1ZSxcbiAgICAgIHNpemVzOiBzaXplcyB8fCBbeyBuYW1lOiAnUmVndWxhcicsIHByaWNlOiBwYXJzZUZsb2F0KHByaWNlKSB9XVxuICAgIH07XG4gICAgXG4gICAgY29uc3QgbmV3UHJvZHVjdCA9IGF3YWl0IFByb2R1Y3QuY3JlYXRlKHByb2R1Y3REYXRhKTtcbiAgICBcbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogbmV3UHJvZHVjdFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHByb2R1Y3Q6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBjcmVhdGluZyBwcm9kdWN0J1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUFVUIC9hcGkvcHJvZHVjdHMvOmlkXG4vLyBAZGVzYyAgICBVcGRhdGUgcHJvZHVjdFxuLy8gQGFjY2VzcyAgUHJpdmF0ZS9BZG1pblxucm91dGVyLnB1dCgnLzppZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgbmFtZSwgY2F0ZWdvcnksIGRlc2NyaXB0aW9uLCBwcmljZSwgaW1hZ2UsIGltYWdlVXJsLCBpbWFnZVB1YmxpY0lkLCBmZWF0dXJlZCwgaW5TdG9jaywgc2l6ZXMgfSA9IHJlcS5ib2R5O1xuICAgIFxuICAgIC8vIEdldCB0aGUgZXhpc3RpbmcgcHJvZHVjdCB0byBjaGVjayBmb3Igb2xkIGltYWdlXG4gICAgY29uc3QgZXhpc3RpbmdQcm9kdWN0ID0gYXdhaXQgUHJvZHVjdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcbiAgICBpZiAoIWV4aXN0aW5nUHJvZHVjdCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdQcm9kdWN0IG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBJZiB1cGRhdGluZyB3aXRoIGEgbmV3IENsb3VkaW5hcnkgaW1hZ2UsIGRlbGV0ZSB0aGUgb2xkIG9uZVxuICAgIGlmIChpbWFnZVB1YmxpY0lkICYmIGV4aXN0aW5nUHJvZHVjdC5pbWFnZVB1YmxpY0lkICYmIGV4aXN0aW5nUHJvZHVjdC5pbWFnZVB1YmxpY0lkICE9PSBpbWFnZVB1YmxpY0lkKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGRlbGV0ZUZyb21DbG91ZGluYXJ5IH0gPSByZXF1aXJlKCcuLi9jb25maWcvY2xvdWRpbmFyeScpO1xuICAgICAgICBhd2FpdCBkZWxldGVGcm9tQ2xvdWRpbmFyeShleGlzdGluZ1Byb2R1Y3QuaW1hZ2VQdWJsaWNJZCk7XG4gICAgICB9IGNhdGNoIChjbG91ZGluYXJ5RXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgb2xkIGltYWdlIGZyb20gQ2xvdWRpbmFyeTonLCBjbG91ZGluYXJ5RXJyb3IpO1xuICAgICAgICAvLyBDb250aW51ZSB3aXRoIHVwZGF0ZSBldmVuIGlmIENsb3VkaW5hcnkgZGVsZXRpb24gZmFpbHNcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgY29uc3QgdXBkYXRlRGF0YSA9IHt9O1xuICAgIGlmIChuYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubmFtZSA9IG5hbWU7XG4gICAgaWYgKGNhdGVnb3J5ICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuY2F0ZWdvcnkgPSBjYXRlZ29yeTtcbiAgICBpZiAoZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgIGlmIChwcmljZSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnByaWNlID0gcGFyc2VGbG9hdChwcmljZSk7XG4gICAgaWYgKGltYWdlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuaW1hZ2UgPSBpbWFnZTtcbiAgICBpZiAoaW1hZ2VVcmwgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5pbWFnZVVybCA9IGltYWdlVXJsO1xuICAgIGlmIChpbWFnZVB1YmxpY0lkICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuaW1hZ2VQdWJsaWNJZCA9IGltYWdlUHVibGljSWQ7XG4gICAgaWYgKGZlYXR1cmVkICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuZmVhdHVyZWQgPSBmZWF0dXJlZDtcbiAgICBpZiAoaW5TdG9jayAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmluU3RvY2sgPSBpblN0b2NrO1xuICAgIGlmIChzaXplcyAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnNpemVzID0gc2l6ZXM7XG4gICAgXG4gICAgY29uc3QgdXBkYXRlZFByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkQW5kVXBkYXRlKFxuICAgICAgcmVxLnBhcmFtcy5pZCxcbiAgICAgIHVwZGF0ZURhdGEsXG4gICAgICB7IG5ldzogdHJ1ZSwgcnVuVmFsaWRhdG9yczogdHJ1ZSB9XG4gICAgKTtcbiAgICBcblxuICAgIFxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB1cGRhdGVkUHJvZHVjdFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHByb2R1Y3Q6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSB1cGRhdGluZyBwcm9kdWN0J1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgREVMRVRFIC9hcGkvcHJvZHVjdHMvOmlkXG4vLyBAZGVzYyAgICBEZWxldGUgcHJvZHVjdFxuLy8gQGFjY2VzcyAgUHJpdmF0ZS9BZG1pblxucm91dGVyLmRlbGV0ZSgnLzppZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpO1xuICAgIFxuICAgIGlmICghcHJvZHVjdCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdQcm9kdWN0IG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBEZWxldGUgaW1hZ2UgZnJvbSBDbG91ZGluYXJ5IGlmIGl0IGV4aXN0c1xuICAgIGlmIChwcm9kdWN0LmltYWdlUHVibGljSWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgZGVsZXRlRnJvbUNsb3VkaW5hcnkgfSA9IHJlcXVpcmUoJy4uL2NvbmZpZy9jbG91ZGluYXJ5Jyk7XG4gICAgICAgIGF3YWl0IGRlbGV0ZUZyb21DbG91ZGluYXJ5KHByb2R1Y3QuaW1hZ2VQdWJsaWNJZCk7XG4gICAgICB9IGNhdGNoIChjbG91ZGluYXJ5RXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgaW1hZ2UgZnJvbSBDbG91ZGluYXJ5OicsIGNsb3VkaW5hcnlFcnJvcik7XG4gICAgICAgIC8vIENvbnRpbnVlIHdpdGggcHJvZHVjdCBkZWxldGlvbiBldmVuIGlmIENsb3VkaW5hcnkgZGVsZXRpb24gZmFpbHNcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgY29uc3QgZGVsZXRlZFByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkQW5kRGVsZXRlKHJlcS5wYXJhbXMuaWQpO1xuICAgIFxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBkZWxldGVkUHJvZHVjdCxcbiAgICAgIG1lc3NhZ2U6ICdQcm9kdWN0IGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5J1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRlbGV0aW5nIHByb2R1Y3Q6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBkZWxldGluZyBwcm9kdWN0J1xuICAgIH0pO1xuICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDNUMsTUFBTUUsTUFBTSxHQUFHSCxPQUFPLENBQUNJLE1BQU0sQ0FBQyxDQUFDOztBQUUvQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0FELE1BQU0sQ0FBQ0UsR0FBRyxDQUFDLEdBQUcsRUFBRSxPQUFPQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUNsQyxJQUFJO0lBQ0YsTUFBTTtNQUFFQyxRQUFRO01BQUVDLFFBQVE7TUFBRUMsTUFBTTtNQUFFQyxJQUFJLEdBQUcsQ0FBQztNQUFFQyxLQUFLLEdBQUcsRUFBRTtNQUFFQztJQUFrQixDQUFDLEdBQUdQLEdBQUcsQ0FBQ1EsS0FBSzs7SUFFekY7SUFDQSxJQUFJQSxLQUFLLEdBQUcsQ0FBQyxDQUFDOztJQUVkO0lBQ0EsSUFBSUQsaUJBQWlCLEtBQUssTUFBTSxFQUFFO01BQ2hDQyxLQUFLLENBQUNDLE9BQU8sR0FBRyxJQUFJO0lBQ3RCO0lBRUEsSUFBSVAsUUFBUSxFQUFFO01BQ1pNLEtBQUssQ0FBQ04sUUFBUSxHQUFHLElBQUlRLE1BQU0sQ0FBQ1IsUUFBUSxFQUFFLEdBQUcsQ0FBQztJQUM1QztJQUVBLElBQUlDLFFBQVEsS0FBSyxNQUFNLEVBQUU7TUFDdkJLLEtBQUssQ0FBQ0wsUUFBUSxHQUFHLElBQUk7SUFDdkI7SUFFQSxJQUFJQyxNQUFNLEVBQUU7TUFDVkksS0FBSyxDQUFDRyxHQUFHLEdBQUcsQ0FDVjtRQUFFQyxJQUFJLEVBQUUsSUFBSUYsTUFBTSxDQUFDTixNQUFNLEVBQUUsR0FBRztNQUFFLENBQUMsRUFDakM7UUFBRVMsV0FBVyxFQUFFLElBQUlILE1BQU0sQ0FBQ04s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","map":{"version":3,"names":["express","require","Product","router","Router","get","req","res","category","featured","search","page","limit","includeOutOfStock","query","inStock","RegExp","$or","name","description","pageNum","parseInt","limitNum","skip","products","total","Promise","all","find","sort","createdAt","countDocuments","json","success","data","pagination","current","pages","Math","ceil","error","console","status","message","categories","featuredProducts","Order","bestSellers","aggregate","$unwind","$group","_id","$first","totalSold","$sum","totalRevenue","$multiply","$sort","$limit","productIds","map","item","filter","id","$in","bestSellerProducts","product","salesData","toString","toObject","a","b","slice","findById","params","post","price","image","imageUrl","imagePublicId","sizes","body","productData","parseFloat","newProduct","create","put","existingProduct","deleteFromCloudinary","cloudinaryError","updateData","undefined","updatedProduct","findByIdAndUpdate","new","runValidators","delete","deletedProduct","findByIdAndDelete","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["products.js"],"sourcesContent":["const express = require('express');\nconst Product = require('../models/Product');\nconst router = express.Router();\n\n// Sample products data for seeding (will be moved to database)\n// Products are now stored in MongoDB\n// Use the seedProducts.js script to populate the database with sample data\n\n// @route   GET /api/products\n// @desc    Get all products with optional filtering\n// @access  Public\nrouter.get('/', async (req, res) => {\n  try {\n    const { category, featured, search, page = 1, limit = 10, includeOutOfStock } = req.query;\n    \n    // Build query object\n    let query = {};\n    \n    // Only filter by inStock if includeOutOfStock is not set to 'true'\n    if (includeOutOfStock !== 'true') {\n      query.inStock = true;\n    }\n    \n    if (category) {\n      query.category = new RegExp(category, 'i');\n    }\n    \n    if (featured === 'true') {\n      query.featured = true;\n    }\n    \n    if (search) {\n      query.$or = [\n        { name: new RegExp(search, 'i') },\n        { description: new RegExp(search, 'i') }\n      ];\n    }\n    \n    // Calculate pagination\n    const pageNum = parseInt(page);\n    const limitNum = parseInt(limit);\n    const skip = (pageNum - 1) * limitNum;\n    \n    // Execute queries\n    const [products, total] = await Promise.all([\n      Product.find(query)\n        .skip(skip)\n        .limit(limitNum)\n        .sort({ createdAt: -1 }),\n      Product.countDocuments(query)\n    ]);\n    \n    res.json({\n      success: true,\n      data: products,\n      pagination: {\n        current: pageNum,\n        pages: Math.ceil(total / limitNum),\n        total: total\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching products:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching products'\n    });\n  }\n});\n\n// @route   GET /api/products/categories\n// @desc    Get all product categories\n// @access  Public\nrouter.get('/categories', async (req, res) => {\n  try {\n    // Return the enum categories from the schema instead of existing data\n    const categories = ['Cà phê', 'Thức uống đậm vị', 'Đồ uống tươi mát', 'Bánh ngọt'];\n    \n    res.json({\n      success: true,\n      data: categories\n    });\n  } catch (error) {\n    console.error('Error fetching categories:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching categories'\n    });\n  }\n});\n\n// @route   GET /api/products/featured\n// @desc    Get featured products\n// @access  Public\nrouter.get('/featured', async (req, res) => {\n  try {\n    const featuredProducts = await Product.find({ featured: true, inStock: true });\n    \n    res.json({\n      success: true,\n      data: featuredProducts\n    });\n  } catch (error) {\n    console.error('Error fetching featured products:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching featured products'\n    });\n  }\n});\n\n// @route   GET /api/products/bestsellers\n// @desc    Get best selling products\n// @access  Public\nrouter.get('/bestsellers', async (req, res) => {\n  try {\n    const Order = require('../models/Order');\n    \n    // Get top selling products from order data\n    const bestSellers = await Order.aggregate([\n      { $unwind: '$items' },\n      {\n        $group: {\n          _id: '$items.product',\n          name: { $first: '$items.name' },\n          totalSold: { $sum: '$items.quantity' },\n          totalRevenue: { $sum: { $multiply: ['$items.price', '$items.quantity'] } }\n        }\n      },\n      { $sort: { totalSold: -1 } },\n      { $limit: 6 }\n    ]);\n    \n    // Get full product details for best sellers\n    const productIds = bestSellers.map(item => item._id).filter(id => id);\n    const products = await Product.find({ \n      _id: { $in: productIds }, \n      inStock: true \n    });\n    \n    // Merge sales data with product details\n    const bestSellerProducts = products.map(product => {\n      const salesData = bestSellers.find(item => \n        item._id && item._id.toString() === product._id.toString()\n      );\n      return {\n        ...product.toObject(),\n        totalSold: salesData ? salesData.totalSold : 0\n      };\n    });\n    \n    // Sort by total sold and limit to 6\n    bestSellerProducts.sort((a, b) => b.totalSold - a.totalSold);\n    \n    res.json({\n      success: true,\n      data: bestSellerProducts.slice(0, 6)\n    });\n  } catch (error) {\n    console.error('Error fetching best sellers:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching best sellers'\n    });\n  }\n});\n\n// @route   GET /api/products/:id\n// @desc    Get single product\n// @access  Public\nrouter.get('/:id', async (req, res) => {\n  try {\n    const product = await Product.findById(req.params.id);\n    \n    if (!product) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n    \n    res.json({\n      success: true,\n      data: product\n    });\n  } catch (error) {\n    console.error('Error fetching product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching product'\n    });\n  }\n});\n\n// @route   POST /api/products\n// @desc    Create new product\n// @access  Private/Admin\nrouter.post('/', async (req, res) => {\n  try {\n    const { name, category, description, price, image, imageUrl, imagePublicId, featured, sizes } = req.body;\n    \n    const productData = {\n      name,\n      category,\n      description,\n      price: parseFloat(price),\n      image,\n      imageUrl,\n      imagePublicId,\n      featured: featured || false,\n      inStock: true,\n      sizes: sizes || [{ name: 'Regular', price: parseFloat(price) }]\n    };\n    \n    const newProduct = await Product.create(productData);\n    \n    res.status(201).json({\n      success: true,\n      data: newProduct\n    });\n  } catch (error) {\n    console.error('Error creating product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating product'\n    });\n  }\n});\n\n// @route   PUT /api/products/:id\n// @desc    Update product\n// @access  Private/Admin\nrouter.put('/:id', async (req, res) => {\n  try {\n    const { name, category, description, price, image, imageUrl, imagePublicId, featured, inStock, sizes } = req.body;\n    \n    // Get the existing product to check for old image\n    const existingProduct = await Product.findById(req.params.id);\n    if (!existingProduct) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n    \n    // If updating with a new Cloudinary image, delete the old one\n    if (imagePublicId && existingProduct.imagePublicId && existingProduct.imagePublicId !== imagePublicId) {\n      try {\n        const { deleteFromCloudinary } = require('../config/cloudinary');\n        await deleteFromCloudinary(existingProduct.imagePublicId);\n      } catch (cloudinaryError) {\n        console.error('Error deleting old image from Cloudinary:', cloudinaryError);\n        // Continue with update even if Cloudinary deletion fails\n      }\n    }\n    \n    const updateData = {};\n    if (name !== undefined) updateData.name = name;\n    if (category !== undefined) updateData.category = category;\n    if (description !== undefined) updateData.description = description;\n    if (price !== undefined) updateData.price = parseFloat(price);\n    if (image !== undefined) updateData.image = image;\n    if (imageUrl !== undefined) updateData.imageUrl = imageUrl;\n    if (imagePublicId !== undefined) updateData.imagePublicId = imagePublicId;\n    if (featured !== undefined) updateData.featured = featured;\n    if (inStock !== undefined) updateData.inStock = inStock;\n    if (sizes !== undefined) updateData.sizes = sizes;\n    \n    const updatedProduct = await Product.findByIdAndUpdate(\n      req.params.id,\n      updateData,\n      { new: true, runValidators: true }\n    );\n    \n\n    \n    res.json({\n      success: true,\n      data: updatedProduct\n    });\n  } catch (error) {\n    console.error('Error updating product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating product'\n    });\n  }\n});\n\n// @route   DELETE /api/products/:id\n// @desc    Delete product\n// @access  Private/Admin\nrouter.delete('/:id', async (req, res) => {\n  try {\n    const product = await Product.findById(req.params.id);\n    \n    if (!product) {\n      return res.status(404).json({\n        success: false,\n        message: 'Product not found'\n      });\n    }\n    \n    // Delete image from Cloudinary if it exists\n    if (product.imagePublicId) {\n      try {\n        const { deleteFromCloudinary } = require('../config/cloudinary');\n        await deleteFromCloudinary(product.imagePublicId);\n      } catch (cloudinaryError) {\n        console.error('Error deleting image from Cloudinary:', cloudinaryError);\n        // Continue with product deletion even if Cloudinary deletion fails\n      }\n    }\n    \n    const deletedProduct = await Product.findByIdAndDelete(req.params.id);\n    \n    res.json({\n      success: true,\n      data: deletedProduct,\n      message: 'Product deleted successfully'\n    });\n  } catch (error) {\n    console.error('Error deleting product:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while deleting product'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1757524331863},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\Product.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const mongoose = require('mongoose');\nconst productSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: [true, 'Product name is required'],\n    trim: true,\n    maxlength: [100, 'Product name cannot exceed 100 characters']\n  },\n  description: {\n    type: String,\n    required: [true, 'Product description is required'],\n    maxlength: [500, 'Description cannot exceed 500 characters']\n  },\n  price: {\n    type: Number,\n    required: [true, 'Product price is required'],\n    min: [0, 'Price cannot be negative']\n  },\n  category: {\n    type: String,\n    required: [true, 'Product category is required'],\n    enum: ['Cà phê', 'Thức uống đậm vị', 'Đồ uống tươi mát', 'Bánh ngọt'],\n    trim: true\n  },\n  image: {\n    type: String,\n    default: '/images/default-product.jpg'\n  },\n  imageUrl: {\n    type: String,\n    default: null\n  },\n  imagePublicId: {\n    type: String,\n    default: null\n  },\n  inStock: {\n    type: Boolean,\n    default: true\n  },\n  featured: {\n    type: Boolean,\n    default: false\n  },\n  ingredients: [{\n    type: String,\n    trim: true\n  }],\n  nutritionalInfo: {\n    calories: {\n      type: Number,\n      min: 0\n    },\n    protein: {\n      type: Number,\n      min: 0\n    },\n    carbs: {\n      type: Number,\n      min: 0\n    },\n    fat: {\n      type: Number,\n      min: 0\n    }\n  },\n  sizes: [{\n    name: {\n      type: String,\n      required: true\n    },\n    // Small, Medium, Large\n    price: {\n      type: Number,\n      required: true,\n      min: 0\n    },\n    available: {\n      type: Boolean,\n      default: true\n    }\n  }]\n}, {\n  timestamps: true\n});\n\n// Index for better search performance\nproductSchema.index({\n  name: 'text',\n  description: 'text'\n});\nproductSchema.index({\n  category: 1\n});\nproductSchema.index({\n  featured: 1\n});\nproductSchema.index({\n  inStock: 1\n});\nmodule.exports = mongoose.model('Product', productSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJwcm9kdWN0U2NoZW1hIiwiU2NoZW1hIiwibmFtZSIsInR5cGUiLCJTdHJpbmciLCJyZXF1aXJlZCIsInRyaW0iLCJtYXhsZW5ndGgiLCJkZXNjcmlwdGlvbiIsInByaWNlIiwiTnVtYmVyIiwibWluIiwiY2F0ZWdvcnkiLCJlbnVtIiwiaW1hZ2UiLCJkZWZhdWx0IiwiaW1hZ2VVcmwiLCJpbWFnZVB1YmxpY0lkIiwiaW5TdG9jayIsIkJvb2xlYW4iLCJmZWF0dXJlZCIsImluZ3JlZGllbnRzIiwibnV0cml0aW9uYWxJbmZvIiwiY2Fsb3JpZXMiLCJwcm90ZWluIiwiY2FyYnMiLCJmYXQiLCJzaXplcyIsImF2YWlsYWJsZSIsInRpbWVzdGFtcHMiLCJpbmRleCIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2RlbCJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXG1vZGVsc1xcIiwic291cmNlcyI6WyJQcm9kdWN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcblxuY29uc3QgcHJvZHVjdFNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICBuYW1lOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ1Byb2R1Y3QgbmFtZSBpcyByZXF1aXJlZCddLFxuICAgIHRyaW06IHRydWUsXG4gICAgbWF4bGVuZ3RoOiBbMTAwLCAnUHJvZHVjdCBuYW1lIGNhbm5vdCBleGNlZWQgMTAwIGNoYXJhY3RlcnMnXVxuICB9LFxuICBkZXNjcmlwdGlvbjoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICByZXF1aXJlZDogW3RydWUsICdQcm9kdWN0IGRlc2NyaXB0aW9uIGlzIHJlcXVpcmVkJ10sXG4gICAgbWF4bGVuZ3RoOiBbNTAwLCAnRGVzY3JpcHRpb24gY2Fubm90IGV4Y2VlZCA1MDAgY2hhcmFjdGVycyddXG4gIH0sXG4gIHByaWNlOiB7XG4gICAgdHlwZTogTnVtYmVyLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ1Byb2R1Y3QgcHJpY2UgaXMgcmVxdWlyZWQnXSxcbiAgICBtaW46IFswLCAnUHJpY2UgY2Fubm90IGJlIG5lZ2F0aXZlJ11cbiAgfSxcbiAgY2F0ZWdvcnk6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgcmVxdWlyZWQ6IFt0cnVlLCAnUHJvZHVjdCBjYXRlZ29yeSBpcyByZXF1aXJlZCddLFxuICAgIGVudW06IFsnQ8OgIHBow6onLCAnVGjhu6ljIHXhu5FuZyDEkeG6rW0gduG7iycsICfEkOG7kyB14buRbmcgdMawxqFpIG3DoXQnLCAnQsOhbmggbmfhu410J10sXG4gICAgdHJpbTogdHJ1ZVxuICB9LFxuICBpbWFnZToge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICBkZWZhdWx0OiAnL2ltYWdlcy9kZWZhdWx0LXByb2R1Y3QuanBnJ1xuICB9LFxuICBpbWFnZVVybDoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICBkZWZhdWx0OiBudWxsXG4gIH0sXG4gIGltYWdlUHVibGljSWQ6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgZGVmYXVsdDogbnVsbFxuICB9LFxuICBpblN0b2NrOiB7XG4gICAgdHlwZTogQm9vbGVhbixcbiAgICBkZWZhdWx0OiB0cnVlXG4gIH0sXG4gIGZlYXR1cmVkOiB7XG4gICAgdHlwZTogQm9vbGVhbixcbiAgICBkZWZhdWx0OiBmYWxzZVxuICB9LFxuICBpbmdyZWRpZW50czogW3tcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgdHJpbTogdHJ1ZVxuICB9XSxcbiAgbnV0cml0aW9uYWxJbmZvOiB7XG4gICAgY2Fsb3JpZXM6IHsgdHlwZTogTnVtYmVyLCBtaW46IDAgfSxcbiAgICBwcm90ZWluOiB7IHR5cGU6IE51bWJlciwgbWluOiAwIH0sXG4gICAgY2FyYnM6IHsgdHlwZTogTnVtYmVyLCBtaW46IDAgfSxcbiAgICBmYXQ6IHsgdHlwZTogTnVtYmVyLCBtaW46IDAgfVxuICB9LFxuICBzaXplczogW3tcbiAgICBuYW1lOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUgfSwgLy8gU21hbGwsIE1lZGl1bSwgTGFyZ2VcbiAgICBwcmljZTogeyB0eXBlOiBOdW1iZXIsIHJlcXVpcmVkOiB0cnVlLCBtaW46IDAgfSxcbiAgICBhdmFpbGFibGU6IHsgdHlwZTogQm9vbGVhbiwgZGVmYXVsdDogdHJ1ZSB9XG4gIH1dXG59LCB7XG4gIHRpbWVzdGFtcHM6IHRydWVcbn0pO1xuXG4vLyBJbmRleCBmb3IgYmV0dGVyIHNlYXJjaCBwZXJmb3JtYW5jZVxucHJvZHVjdFNjaGVtYS5pbmRleCh7IG5hbWU6ICd0ZXh0JywgZGVzY3JpcHRpb246ICd0ZXh0JyB9KTtcbnByb2R1Y3RTY2hlbWEuaW5kZXgoeyBjYXRlZ29yeTogMSB9KTtcbnByb2R1Y3RTY2hlbWEuaW5kZXgoeyBmZWF0dXJlZDogMSB9KTtcbnByb2R1Y3RTY2hlbWEuaW5kZXgoeyBpblN0b2NrOiAxIH0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IG1vbmdvb3NlLm1vZGVsKCdQcm9kdWN0JywgcHJvZHVjdFNjaGVtYSk7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFFcEMsTUFBTUMsYUFBYSxHQUFHLElBQUlGLFFBQVEsQ0FBQ0csTUFBTSxDQUFDO0VBQ3hDQyxJQUFJLEVBQUU7SUFDSkMsSUFBSSxFQUFFQyxNQUFNO0lBQ1pDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSwwQkFBMEIsQ0FBQztJQUM1Q0MsSUFBSSxFQUFFLElBQUk7SUFDVkMsU0FBUyxFQUFFLENBQUMsR0FBRyxFQUFFLDJDQUEyQztFQUM5RCxDQUFDO0VBQ0RDLFdBQVcsRUFBRTtJQUNYTCxJQUFJLEVBQUVDLE1BQU07SUFDWkMsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLGlDQUFpQyxDQUFDO0lBQ25ERSxTQUFTLEVBQUUsQ0FBQyxHQUFHLEVBQUUsMENBQTBD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","map":{"version":3,"names":["mongoose","require","productSchema","Schema","name","type","String","required","trim","maxlength","description","price","Number","min","category","enum","image","default","imageUrl","imagePublicId","inStock","Boolean","featured","ingredients","nutritionalInfo","calories","protein","carbs","fat","sizes","available","timestamps","index","module","exports","model"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\models\\","sources":["Product.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst productSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: [true, 'Product name is required'],\n    trim: true,\n    maxlength: [100, 'Product name cannot exceed 100 characters']\n  },\n  description: {\n    type: String,\n    required: [true, 'Product description is required'],\n    maxlength: [500, 'Description cannot exceed 500 characters']\n  },\n  price: {\n    type: Number,\n    required: [true, 'Product price is required'],\n    min: [0, 'Price cannot be negative']\n  },\n  category: {\n    type: String,\n    required: [true, 'Product category is required'],\n    enum: ['Cà phê', 'Thức uống đậm vị', 'Đồ uống tươi mát', 'Bánh ngọt'],\n    trim: true\n  },\n  image: {\n    type: String,\n    default: '/images/default-product.jpg'\n  },\n  imageUrl: {\n    type: String,\n    default: null\n  },\n  imagePublicId: {\n    type: String,\n    default: null\n  },\n  inStock: {\n    type: Boolean,\n    default: true\n  },\n  featured: {\n    type: Boolean,\n    default: false\n  },\n  ingredients: [{\n    type: String,\n    trim: true\n  }],\n  nutritionalInfo: {\n    calories: { type: Number, min: 0 },\n    protein: { type: Number, min: 0 },\n    carbs: { type: Number, min: 0 },\n    fat: { type: Number, min: 0 }\n  },\n  sizes: [{\n    name: { type: String, required: true }, // Small, Medium, Large\n    price: { type: Number, required: true, min: 0 },\n    available: { type: Boolean, default: true }\n  }]\n}, {\n  timestamps: true\n});\n\n// Index for better search performance\nproductSchema.index({ name: 'text', description: 'text' });\nproductSchema.index({ category: 1 });\nproductSchema.index({ featured: 1 });\nproductSchema.index({ inStock: 1 });\n\nmodule.exports = mongoose.model('Product', productSchema);"],"mappings":"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","ignoreList":[]}},"mtime":1757433503379},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\auth.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst jwt = require('jsonwebtoken');\nconst User = require('../models/User');\nconst {\n  protect\n} = require('../middleware/auth');\n\n// Generate JWT Token\nconst generateToken = userId => {\n  return jwt.sign({\n    userId\n  }, process.env.JWT_SECRET || 'fallback_secret', {\n    expiresIn: process.env.JWT_EXPIRE || '30d'\n  });\n};\n\n// @route   POST /api/auth/register\n// @desc    Register a new user\n// @access  Public\nrouter.post('/register', async (req, res) => {\n  try {\n    const {\n      firstName,\n      lastName,\n      email,\n      password,\n      phone,\n      role\n    } = req.body;\n\n    // Check if user already exists\n    const existingUser = await User.findOne({\n      email: email.toLowerCase().trim()\n    });\n    if (existingUser) {\n      return res.status(400).json({\n        success: false,\n        message: 'User already exists with this email'\n      });\n    }\n\n    // Create new user (password will be hashed automatically by the User model)\n    const newUser = new User({\n      firstName,\n      lastName,\n      email: email.toLowerCase().trim(),\n      password,\n      phone,\n      role: role || 'customer'\n    });\n    await newUser.save();\n\n    // Generate token\n    const token = generateToken(newUser._id);\n\n    // Remove password from response\n    const userResponse = {\n      _id: newUser._id,\n      firstName: newUser.firstName,\n      lastName: newUser.lastName,\n      email: newUser.email,\n      phone: newUser.phone,\n      role: newUser.role,\n      createdAt: newUser.createdAt\n    };\n    res.status(201).json({\n      success: true,\n      token,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Registration error:', error);\n\n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n\n    // Handle duplicate key error\n    if (error.code === 11000) {\n      return res.status(400).json({\n        success: false,\n        message: 'User already exists with this email'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error during registration'\n    });\n  }\n});\n\n// @route   POST /api/auth/login\n// @desc    Login user\n// @access  Public\nrouter.post('/login', async (req, res) => {\n  try {\n    const {\n      email,\n      password\n    } = req.body;\n\n    // Find user by email (include password for comparison)\n    const user = await User.findOne({\n      email: email.toLowerCase().trim()\n    }).select('+password');\n    if (!user) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid credentials'\n      });\n    }\n\n    // Check if user is active\n    if (!user.isActive) {\n      return res.status(401).json({\n        success: false,\n        message: 'Account is deactivated'\n      });\n    }\n\n    // Check password using the model method\n    const isMatch = await user.comparePassword(password);\n    if (!isMatch) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid credentials'\n      });\n    }\n\n    // Generate token\n    const token = generateToken(user._id);\n\n    // Remove password from response\n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      createdAt: user.createdAt\n    };\n    res.json({\n      success: true,\n      token,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Login error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error during login'\n    });\n  }\n});\n\n// @route   GET /api/auth/me\n// @desc    Get current user\n// @access  Private\nrouter.get('/me', protect, async (req, res) => {\n  try {\n    // req.user is set by the auth middleware\n    const user = await User.findById(req.user._id);\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n\n    // Check if user is active\n    if (!user.isActive) {\n      return res.status(401).json({\n        success: false,\n        message: 'Account is deactivated'\n      });\n    }\n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      createdAt: user.createdAt\n    };\n    res.json({\n      success: true,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Get user error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   PUT /api/auth/profile\n// @desc    Update user profile\n// @access  Private\nrouter.put('/profile', protect, async (req, res) => {\n  try {\n    const {\n      firstName,\n      lastName,\n      email,\n      phone,\n      address,\n      preferences\n    } = req.body;\n\n    // Find the current user\n    const user = await User.findById(req.user._id);\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n\n    // Check if email is being changed and if it already exists\n    if (email && email.toLowerCase().trim() !== user.email) {\n      const existingUser = await User.findOne({\n        email: email.toLowerCase().trim(),\n        _id: {\n          $ne: user._id\n        }\n      });\n      if (existingUser) {\n        return res.status(400).json({\n          success: false,\n          message: 'Email already exists'\n        });\n      }\n    }\n\n    // Update user fields\n    if (firstName) user.firstName = firstName;\n    if (lastName) user.lastName = lastName;\n    if (email) user.email = email.toLowerCase().trim();\n    if (phone) user.phone = phone;\n    if (address) {\n      user.address = {\n        ...user.address,\n        ...address\n      };\n    }\n    if (preferences) {\n      user.preferences = {\n        ...user.preferences,\n        ...preferences\n      };\n    }\n    await user.save();\n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      address: user.address,\n      preferences: user.preferences,\n      createdAt: user.createdAt,\n      updatedAt: user.updatedAt\n    };\n    res.json({\n      success: true,\n      message: 'Profile updated successfully',\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Profile update error:', error);\n\n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n\n    // Handle duplicate key error\n    if (error.code === 11000) {\n      return res.status(400).json({\n        success: false,\n        message: 'Email already exists'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error during profile update'\n    });\n  }\n});\n\n// @route   PUT /api/auth/password\n// @desc    Change user password\n// @access  Private\nrouter.put('/password', protect, async (req, res) => {\n  try {\n    const {\n      currentPassword,\n      newPassword\n    } = req.body;\n    if (!currentPassword || !newPassword) {\n      return res.status(400).json({\n        success: false,\n        message: 'Current password and new password are required'\n      });\n    }\n    if (newPassword.length < 6) {\n      return res.status(400).json({\n        success: false,\n        message: 'New password must be at least 6 characters long'\n      });\n    }\n\n    // Find the current user with password\n    const user = await User.findById(req.user._id).select('+password');\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n\n    // Check current password\n    const isMatch = await user.comparePassword(currentPassword);\n    if (!isMatch) {\n      return res.status(400).json({\n        success: false,\n        message: 'Current password is incorrect'\n      });\n    }\n\n    // Update password (will be hashed automatically by the User model)\n    user.password = newPassword;\n    await user.save();\n    res.json({\n      success: true,\n      message: 'Password updated successfully'\n    });\n  } catch (error) {\n    console.error('Password update error:', error);\n\n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error during password update'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsImp3dCIsIlVzZXIiLCJwcm90ZWN0IiwiZ2VuZXJhdGVUb2tlbiIsInVzZXJJZCIsInNpZ24iLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImV4cGlyZXNJbiIsIkpXVF9FWFBJUkUiLCJwb3N0IiwicmVxIiwicmVzIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJlbWFpbCIsInBhc3N3b3JkIiwicGhvbmUiLCJyb2xlIiwiYm9keSIsImV4aXN0aW5nVXNlciIsImZpbmRPbmUiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJuZXdVc2VyIiwic2F2ZSIsInRva2VuIiwiX2lkIiwidXNlclJlc3BvbnNlIiwiY3JlYXRlZEF0IiwidXNlciIsImVycm9yIiwiY29uc29sZSIsIm5hbWUiLCJtZXNzYWdlcyIsIk9iamVjdCIsInZhbHVlcyIsImVycm9ycyIsIm1hcCIsImVyciIsImpvaW4iLCJjb2RlIiwic2VsZWN0IiwiaXNBY3RpdmUiLCJpc01hdGNoIiwiY29tcGFyZVBhc3N3b3JkIiwibG95YWx0eVBvaW50cyIsImdldCIsImZpbmRCeUlkIiwicHV0IiwiYWRkcmVzcyIsInByZWZlcmVuY2VzIiwiJG5lIiwidXBkYXRlZEF0IiwiY3VycmVudFBhc3N3b3JkIiwibmV3UGFzc3dvcmQiLCJsZW5ndGgiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xccm91dGVzXFwiLCJzb3VyY2VzIjpbImF1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5jb25zdCBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKTtcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xuY29uc3QgeyBwcm90ZWN0IH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcblxuLy8gR2VuZXJhdGUgSldUIFRva2VuXG5jb25zdCBnZW5lcmF0ZVRva2VuID0gKHVzZXJJZCkgPT4ge1xuICByZXR1cm4gand0LnNpZ24oeyB1c2VySWQgfSwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCB8fCAnZmFsbGJhY2tfc2VjcmV0Jywge1xuICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSRSB8fCAnMzBkJ1xuICB9KTtcbn07XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9hdXRoL3JlZ2lzdGVyXG4vLyBAZGVzYyAgICBSZWdpc3RlciBhIG5ldyB1c2VyXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5wb3N0KCcvcmVnaXN0ZXInLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGZpcnN0TmFtZSwgbGFzdE5hbWUsIGVtYWlsLCBwYXNzd29yZCwgcGhvbmUsIHJvbGUgfSA9IHJlcS5ib2R5O1xuICAgIFxuICAgIC8vIENoZWNrIGlmIHVzZXIgYWxyZWFkeSBleGlzdHNcbiAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKS50cmltKCkgfSk7XG4gICAgaWYgKGV4aXN0aW5nVXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdVc2VyIGFscmVhZHkgZXhpc3RzIHdpdGggdGhpcyBlbWFpbCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBDcmVhdGUgbmV3IHVzZXIgKHBhc3N3b3JkIHdpbGwgYmUgaGFzaGVkIGF1dG9tYXRpY2FsbHkgYnkgdGhlIFVzZXIgbW9kZWwpXG4gICAgY29uc3QgbmV3VXNlciA9IG5ldyBVc2VyKHtcbiAgICAgIGZpcnN0TmFtZSxcbiAgICAgIGxhc3ROYW1lLFxuICAgICAgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkudHJpbSgpLFxuICAgICAgcGFzc3dvcmQsXG4gICAgICBwaG9uZSxcbiAgICAgIHJvbGU6IHJvbGUgfHwgJ2N1c3RvbWVyJ1xuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IG5ld1VzZXIuc2F2ZSgpO1xuICAgIFxuICAgIC8vIEdlbmVyYXRlIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSBnZW5lcmF0ZVRva2VuKG5ld1VzZXIuX2lkKTtcbiAgICBcbiAgICAvLyBSZW1vdmUgcGFzc3dvcmQgZnJvbSByZXNwb25zZVxuICAgIGNvbnN0IHVzZXJSZXNwb25zZSA9IHtcbiAgICAgIF9pZDogbmV3VXNlci5faWQsXG4gICAgICBmaXJzdE5hbWU6IG5ld1VzZXIuZmlyc3ROYW1lLFxuICAgICAgbGFzdE5hbWU6IG5ld1VzZXIubGFzdE5hbWUsXG4gICAgICBlbWFpbDogbmV3VXNlci5lbWFpbCxcbiAgICAgIHBob25lOiBuZXdVc2VyLnBob25lLFxuICAgICAgcm9sZTogbmV3VXNlci5yb2xlLFxuICAgICAgY3JlYXRlZEF0OiBuZXdVc2VyLmNyZWF0ZWRBdFxuICAgIH07XG4gICAgXG4gICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHRva2VuLFxuICAgICAgdXNlcjogdXNlclJlc3BvbnNlXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignUmVnaXN0cmF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICBcbiAgICAvLyBIYW5kbGUgdmFsaWRhdGlvbiBlcnJvcnNcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1ZhbGlkYXRpb25FcnJvcicpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gT2JqZWN0LnZhbHVlcyhlcnJvci5lcnJvcnMpLm1hcChlcnIgPT4gZXJyLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VzLmpvaW4oJywgJylcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgZHVwbGljYXRlIGtleSBlcnJvclxuICAgIGlmIChlcnJvci5jb2RlID09PSAxMTAwMCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdVc2VyIGFscmVhZHkgZXhpc3RzIHdpdGggdGhpcyBlbWFpbCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3IgZHVyaW5nIHJlZ2lzdHJhdGlvbidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9hdXRoL2xvZ2luXG4vLyBAZGVzYyAgICBMb2dpbiB1c2VyXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5wb3N0KCcvbG9naW4nLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XG4gICAgXG4gICAgLy8gRmluZCB1c2VyIGJ5IGVtYWlsIChpbmNsdWRlIHBhc3N3b3JkIGZvciBjb21wYXJpc29uKVxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKS50cmltKCkgfSkuc2VsZWN0KCcrcGFzc3dvcmQnKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBjcmVkZW50aWFscydcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGFjdGl2ZVxuICAgIGlmICghdXNlci5pc0FjdGl2ZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdBY2NvdW50IGlzIGRlYWN0aXZhdGVkJ1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIHBhc3N3b3JkIHVzaW5nIHRoZSBtb2RlbCBtZXRob2RcbiAgICBjb25zdCBpc01hdGNoID0gYXdhaXQgdXNlci5jb21wYXJlUGFzc3dvcmQocGFzc3dvcmQpO1xuICAgIGlmICghaXNNYXRjaCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGNyZWRlbnRpYWxzJ1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIEdlbmVyYXRlIHRva2VuXG4gICAgY29uc3QgdG9rZW4gPSBnZW5lcmF0ZVRva2VuKHVzZXIuX2lkKTtcbiAgICBcbiAgICAvLyBSZW1vdmUgcGFzc3dvcmQgZnJvbSByZXNwb25zZVxuICAgIGNvbnN0IHVzZXJSZXNwb25zZSA9IHtcbiAgICAgIF9pZDogdXNlci5faWQsXG4gICAgICBmaXJzdE5hbWU6IHVzZXIuZmlyc3ROYW1lLFxuICAgICAgbGFzdE5hbWU6IHVzZXIubGFzdE5hbWUsXG4gICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgIHBob25lOiB1c2VyLnBob25lLFxuICAgICAgcm9sZTogdXNlci5yb2xlLFxuICAgICAgaXNBY3RpdmU6IHVzZXIuaXNBY3RpdmUsXG4gICAgICBsb3lhbHR5UG9pbnRzOiB1c2VyLmxveWFsdHlQb2ludHMsXG4gICAgICBjcmVhdGVkQXQ6IHVzZXIuY3JlYXRlZEF0XG4gICAgfTtcbiAgICBcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgdG9rZW4sXG4gICAgICB1c2VyOiB1c2VyUmVzcG9uc2VcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdMb2dpbiBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIGR1cmluZyBsb2dpbidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2F1dGgvbWVcbi8vIEBkZXNjICAgIEdldCBjdXJyZW50IHVzZXJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcbnJvdXRlci5nZXQoJy9tZScsIHByb3RlY3QsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIC8vIHJlcS51c2VyIGlzIHNldCBieSB0aGUgYXV0aCBtaWRkbGV3YXJlXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQocmVxLnVzZXIuX2lkKTtcbiAgICBcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhY3RpdmVcbiAgICBpZiAoIXVzZXIuaXNBY3RpdmUpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQWNjb3VudCBpcyBkZWFjdGl2YXRlZCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCB1c2VyUmVzcG9uc2UgPSB7XG4gICAgICBfaWQ6IHVzZXIuX2lkLFxuICAgICAgZmlyc3ROYW1lOiB1c2VyLmZpcnN0TmFtZSxcbiAgICAgIGxhc3ROYW1lOiB1c2VyLmxhc3ROYW1lLFxuICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICBwaG9uZTogdXNlci5waG9uZSxcbiAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICAgIGlzQWN0aXZlOiB1c2VyLmlzQWN0aXZlLFxuICAgICAgbG95YWx0eVBvaW50czogdXNlci5sb3lhbHR5UG9pbnRzLFxuICAgICAgY3JlYXRlZEF0OiB1c2VyLmNyZWF0ZWRBdFxuICAgIH07XG4gICAgXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHVzZXI6IHVzZXJSZXNwb25zZVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0dldCB1c2VyIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBQVVQgL2FwaS9hdXRoL3Byb2ZpbGVcbi8vIEBkZXNjICAgIFVwZGF0ZSB1c2VyIHByb2ZpbGVcbi8vIEBhY2Nlc3MgIFByaXZhdGVcbnJvdXRlci5wdXQoJy9wcm9maWxlJywgcHJvdGVjdCwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBmaXJzdE5hbWUsIGxhc3ROYW1lLCBlbWFpbCwgcGhvbmUsIGFkZHJlc3MsIHByZWZlcmVuY2VzIH0gPSByZXEuYm9keTtcbiAgICBcbiAgICAvLyBGaW5kIHRoZSBjdXJyZW50IHVzZXJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEudXNlci5faWQpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiBlbWFpbCBpcyBiZWluZyBjaGFuZ2VkIGFuZCBpZiBpdCBhbHJlYWR5IGV4aXN0c1xuICAgIGlmIChlbWFpbCAmJiBlbWFpbC50b0xvd2VyQ2FzZSgpLnRyaW0oKSAhPT0gdXNlci5lbWFpbCkge1xuICAgICAgY29uc3QgZXhpc3RpbmdVc2VyID0gYXdhaXQgVXNlci5maW5kT25lKHsgXG4gICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLnRyaW0oKSxcbiAgICAgICAgX2lkOiB7ICRuZTogdXNlci5faWQgfVxuICAgICAgfSk7XG4gICAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ0VtYWlsIGFscmVhZHkgZXhpc3RzJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gVXBkYXRlIHVzZXIgZmllbGRzXG4gICAgaWYgKGZpcnN0TmFtZSkgdXNlci5maXJzdE5hbWUgPSBmaXJzdE5hbWU7XG4gICAgaWYgKGxhc3ROYW1lKSB1c2VyLmxhc3ROYW1lID0gbGFzdE5hbWU7XG4gICAgaWYgKGVtYWlsKSB1c2VyLmVtYWlsID0gZW1haWwudG9Mb3dlckNhc2UoKS50cmltKCk7XG4gICAgaWYgKHBob25lKSB1c2VyLnBob25lID0gcGhvbmU7XG4gICAgaWYgKGFkZHJlc3MpIHtcbiAgICAgIHVzZXIuYWRkcmVzcyA9IHtcbiAgICAgICAgLi4udXNlci5hZGRyZXNzLFxuICAgICAgICAuLi5hZGRyZXNzXG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAocHJlZmVyZW5jZXMpIHtcbiAgICAgIHVzZXIucHJlZmVyZW5jZXMgPSB7XG4gICAgICAgIC4uLnVzZXIucHJlZmVyZW5jZXMsXG4gICAgICAgIC4uLnByZWZlcmVuY2VzXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICBhd2FpdCB1c2VyLnNhdmUoKTtcbiAgICBcbiAgICBjb25zdCB1c2VyUmVzcG9uc2UgPSB7XG4gICAgICBfaWQ6IHVzZXIuX2lkLFxuICAgICAgZmlyc3ROYW1lOiB1c2VyLmZpcnN0TmFtZSxcbiAgICAgIGxhc3ROYW1lOiB1c2VyLmxhc3ROYW1lLFxuICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICBwaG9uZTogdXNlci5waG9uZSxcbiAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICAgIGlzQWN0aXZlOiB1c2VyLmlzQWN0aXZlLFxuICAgICAgbG95YWx0eVBvaW50czogdXNlci5sb3lhbHR5UG9pbnRzLFxuICAgICAgYWRkcmVzczogdXNlci5hZGRyZXNzLFxuICAgICAgcHJlZmVyZW5jZXM6IHVzZXIucHJlZmVyZW5jZXMsXG4gICAgICBjcmVhdGVkQXQ6IHVzZXIuY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZEF0OiB1c2VyLnVwZGF0ZWRBdFxuICAgIH07XG4gICAgXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdQcm9maWxlIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIHVzZXI6IHVzZXJSZXNwb25zZVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1Byb2ZpbGUgdXBkYXRlIGVycm9yOicsIGVycm9yKTtcbiAgICBcbiAgICAvLyBIYW5kbGUgdmFsaWRhdGlvbiBlcnJvcnNcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1ZhbGlkYXRpb25FcnJvcicpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gT2JqZWN0LnZhbHVlcyhlcnJvci5lcnJvcnMpLm1hcChlcnIgPT4gZXJyLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VzLmpvaW4oJywgJylcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgZHVwbGljYXRlIGtleSBlcnJvclxuICAgIGlmIChlcnJvci5jb2RlID09PSAxMTAwMCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cydcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3IgZHVyaW5nIHByb2ZpbGUgdXBkYXRlJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUFVUIC9hcGkvYXV0aC9wYXNzd29yZFxuLy8gQGRlc2MgICAgQ2hhbmdlIHVzZXIgcGFzc3dvcmRcbi8vIEBhY2Nlc3MgIFByaXZhdGVcbnJvdXRlci5wdXQoJy9wYXNzd29yZCcsIHByb3RlY3QsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgY3VycmVudFBhc3N3b3JkLCBuZXdQYXNzd29yZCB9ID0gcmVxLmJvZHk7XG4gICAgXG4gICAgaWYgKCFjdXJyZW50UGFzc3dvcmQgfHwgIW5ld1Bhc3N3b3JkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0N1cnJlbnQgcGFzc3dvcmQgYW5kIG5ldyBwYXNzd29yZCBhcmUgcmVxdWlyZWQnXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgaWYgKG5ld1Bhc3N3b3JkLmxlbmd0aCA8IDYpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnTmV3IHBhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgNiBjaGFyYWN0ZXJzIGxvbmcnXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gRmluZCB0aGUgY3VycmVudCB1c2VyIHdpdGggcGFzc3dvcmRcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEudXNlci5faWQpLnNlbGVjdCgnK3Bhc3N3b3JkJyk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGN1cnJlbnQgcGFzc3dvcmRcbiAgICBjb25zdCBpc01hdGNoID0gYXdhaXQgdXNlci5jb21wYXJlUGFzc3dvcmQoY3VycmVudFBhc3N3b3JkKTtcbiAgICBpZiAoIWlzTWF0Y2gpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQ3VycmVudCBwYXNzd29yZCBpcyBpbmNvcnJlY3QnXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gVXBkYXRlIHBhc3N3b3JkICh3aWxsIGJlIGhhc2hlZCBhdXRvbWF0aWNhbGx5IGJ5IHRoZSBVc2VyIG1vZGVsKVxuICAgIHVzZXIucGFzc3dvcmQgPSBuZXdQYXNzd29yZDtcbiAgICBhd2FpdCB1c2VyLnNhdmUoKTtcbiAgICBcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ1Bhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5J1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1Bhc3N3b3JkIHVwZGF0ZSBlcnJvcjonLCBlcnJvcik7XG4gICAgXG4gICAgLy8gSGFuZGxlIHZhbGlkYXRpb24gZXJyb3JzXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdWYWxpZGF0aW9uRXJyb3InKSB7XG4gICAgICBjb25zdCBtZXNzYWdlcyA9IE9iamVjdC52YWx1ZXMoZXJyb3IuZXJyb3JzKS5tYXAoZXJyID0+IGVyci5tZXNzYWdlKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBtZXNzYWdlcy5qb2luKCcsICcpXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIGR1cmluZyBwYXNzd29yZCB1cGRhdGUnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTUMsR0FBRyxHQUFHSCxPQUFPLENBQUMsY0FBYyxDQUFDO0FBQ25DLE1BQU1JLElBQUksR0FBR0osT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ3RDLE1BQU07RUFBRUs7QUFBUSxDQUFDLEdBQUdMLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQzs7QUFFakQ7QUFDQSxNQUFNTSxhQUFhLEdBQUlDLE1BQU0sSUFBSztFQUNoQyxPQUFPSixHQUFHLENBQUNLLElBQUksQ0FBQztJQUFFRDtFQUFPLENBQUMsRUFBRUUsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFVBQVUsSUFBSSxpQkFBaUIsRUFBRTtJQUN2RUMsU0FBUyxFQUFFSCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0csVUFBVSxJQUFJO0VBQ3ZDLENB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","map":{"version":3,"names":["express","require","router","Router","jwt","User","protect","generateToken","userId","sign","process","env","JWT_SECRET","expiresIn","JWT_EXPIRE","post","req","res","firstName","lastName","email","password","phone","role","body","existingUser","findOne","toLowerCase","trim","status","json","success","message","newUser","save","token","_id","userResponse","createdAt","user","error","console","name","messages","Object","values","errors","map","err","join","code","select","isActive","isMatch","comparePassword","loyaltyPoints","get","findById","put","address","preferences","$ne","updatedAt","currentPassword","newPassword","length","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["auth.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst jwt = require('jsonwebtoken');\nconst User = require('../models/User');\nconst { protect } = require('../middleware/auth');\n\n// Generate JWT Token\nconst generateToken = (userId) => {\n  return jwt.sign({ userId }, process.env.JWT_SECRET || 'fallback_secret', {\n    expiresIn: process.env.JWT_EXPIRE || '30d'\n  });\n};\n\n// @route   POST /api/auth/register\n// @desc    Register a new user\n// @access  Public\nrouter.post('/register', async (req, res) => {\n  try {\n    const { firstName, lastName, email, password, phone, role } = req.body;\n    \n    // Check if user already exists\n    const existingUser = await User.findOne({ email: email.toLowerCase().trim() });\n    if (existingUser) {\n      return res.status(400).json({\n        success: false,\n        message: 'User already exists with this email'\n      });\n    }\n    \n    // Create new user (password will be hashed automatically by the User model)\n    const newUser = new User({\n      firstName,\n      lastName,\n      email: email.toLowerCase().trim(),\n      password,\n      phone,\n      role: role || 'customer'\n    });\n    \n    await newUser.save();\n    \n    // Generate token\n    const token = generateToken(newUser._id);\n    \n    // Remove password from response\n    const userResponse = {\n      _id: newUser._id,\n      firstName: newUser.firstName,\n      lastName: newUser.lastName,\n      email: newUser.email,\n      phone: newUser.phone,\n      role: newUser.role,\n      createdAt: newUser.createdAt\n    };\n    \n    res.status(201).json({\n      success: true,\n      token,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Registration error:', error);\n    \n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n    \n    // Handle duplicate key error\n    if (error.code === 11000) {\n      return res.status(400).json({\n        success: false,\n        message: 'User already exists with this email'\n      });\n    }\n    \n    res.status(500).json({\n      success: false,\n      message: 'Server error during registration'\n    });\n  }\n});\n\n// @route   POST /api/auth/login\n// @desc    Login user\n// @access  Public\nrouter.post('/login', async (req, res) => {\n  try {\n    const { email, password } = req.body;\n    \n    // Find user by email (include password for comparison)\n    const user = await User.findOne({ email: email.toLowerCase().trim() }).select('+password');\n    if (!user) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid credentials'\n      });\n    }\n    \n    // Check if user is active\n    if (!user.isActive) {\n      return res.status(401).json({\n        success: false,\n        message: 'Account is deactivated'\n      });\n    }\n    \n    // Check password using the model method\n    const isMatch = await user.comparePassword(password);\n    if (!isMatch) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid credentials'\n      });\n    }\n    \n    // Generate token\n    const token = generateToken(user._id);\n    \n    // Remove password from response\n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      createdAt: user.createdAt\n    };\n    \n    res.json({\n      success: true,\n      token,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Login error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error during login'\n    });\n  }\n});\n\n// @route   GET /api/auth/me\n// @desc    Get current user\n// @access  Private\nrouter.get('/me', protect, async (req, res) => {\n  try {\n    // req.user is set by the auth middleware\n    const user = await User.findById(req.user._id);\n    \n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n    \n    // Check if user is active\n    if (!user.isActive) {\n      return res.status(401).json({\n        success: false,\n        message: 'Account is deactivated'\n      });\n    }\n    \n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      createdAt: user.createdAt\n    };\n    \n    res.json({\n      success: true,\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Get user error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   PUT /api/auth/profile\n// @desc    Update user profile\n// @access  Private\nrouter.put('/profile', protect, async (req, res) => {\n  try {\n    const { firstName, lastName, email, phone, address, preferences } = req.body;\n    \n    // Find the current user\n    const user = await User.findById(req.user._id);\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n    \n    // Check if email is being changed and if it already exists\n    if (email && email.toLowerCase().trim() !== user.email) {\n      const existingUser = await User.findOne({ \n        email: email.toLowerCase().trim(),\n        _id: { $ne: user._id }\n      });\n      if (existingUser) {\n        return res.status(400).json({\n          success: false,\n          message: 'Email already exists'\n        });\n      }\n    }\n    \n    // Update user fields\n    if (firstName) user.firstName = firstName;\n    if (lastName) user.lastName = lastName;\n    if (email) user.email = email.toLowerCase().trim();\n    if (phone) user.phone = phone;\n    if (address) {\n      user.address = {\n        ...user.address,\n        ...address\n      };\n    }\n    if (preferences) {\n      user.preferences = {\n        ...user.preferences,\n        ...preferences\n      };\n    }\n    \n    await user.save();\n    \n    const userResponse = {\n      _id: user._id,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      email: user.email,\n      phone: user.phone,\n      role: user.role,\n      isActive: user.isActive,\n      loyaltyPoints: user.loyaltyPoints,\n      address: user.address,\n      preferences: user.preferences,\n      createdAt: user.createdAt,\n      updatedAt: user.updatedAt\n    };\n    \n    res.json({\n      success: true,\n      message: 'Profile updated successfully',\n      user: userResponse\n    });\n  } catch (error) {\n    console.error('Profile update error:', error);\n    \n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n    \n    // Handle duplicate key error\n    if (error.code === 11000) {\n      return res.status(400).json({\n        success: false,\n        message: 'Email already exists'\n      });\n    }\n    \n    res.status(500).json({\n      success: false,\n      message: 'Server error during profile update'\n    });\n  }\n});\n\n// @route   PUT /api/auth/password\n// @desc    Change user password\n// @access  Private\nrouter.put('/password', protect, async (req, res) => {\n  try {\n    const { currentPassword, newPassword } = req.body;\n    \n    if (!currentPassword || !newPassword) {\n      return res.status(400).json({\n        success: false,\n        message: 'Current password and new password are required'\n      });\n    }\n    \n    if (newPassword.length < 6) {\n      return res.status(400).json({\n        success: false,\n        message: 'New password must be at least 6 characters long'\n      });\n    }\n    \n    // Find the current user with password\n    const user = await User.findById(req.user._id).select('+password');\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n    \n    // Check current password\n    const isMatch = await user.comparePassword(currentPassword);\n    if (!isMatch) {\n      return res.status(400).json({\n        success: false,\n        message: 'Current password is incorrect'\n      });\n    }\n    \n    // Update password (will be hashed automatically by the User model)\n    user.password = newPassword;\n    await user.save();\n    \n    res.json({\n      success: true,\n      message: 'Password updated successfully'\n    });\n  } catch (error) {\n    console.error('Password update error:', error);\n    \n    // Handle validation errors\n    if (error.name === 'ValidationError') {\n      const messages = Object.values(error.errors).map(err => err.message);\n      return res.status(400).json({\n        success: false,\n        message: messages.join(', ')\n      });\n    }\n    \n    res.status(500).json({\n      success: false,\n      message: 'Server error during password update'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1756225536247},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\User.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const mongoose = require('mongoose');\nconst bcrypt = require('bcryptjs');\nconst userSchema = new mongoose.Schema({\n  firstName: {\n    type: String,\n    required: [true, 'First name is required'],\n    trim: true,\n    maxlength: [50, 'First name cannot exceed 50 characters']\n  },\n  lastName: {\n    type: String,\n    required: [true, 'Last name is required'],\n    trim: true,\n    maxlength: [50, 'Last name cannot exceed 50 characters']\n  },\n  email: {\n    type: String,\n    required: [true, 'Email is required'],\n    unique: true,\n    lowercase: true,\n    trim: true,\n    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email']\n  },\n  password: {\n    type: String,\n    required: [true, 'Password is required'],\n    minlength: [6, 'Password must be at least 6 characters'],\n    select: false // Don't include password in queries by default\n  },\n  phone: {\n    type: String,\n    trim: true,\n    match: [/^\\d{10}$/, 'Please enter a valid phone number']\n  },\n  address: {\n    street: {\n      type: String,\n      trim: true\n    },\n    city: {\n      type: String,\n      trim: true\n    },\n    state: {\n      type: String,\n      trim: true\n    },\n    zipCode: {\n      type: String,\n      trim: true\n    },\n    country: {\n      type: String,\n      trim: true,\n      default: 'USA'\n    }\n  },\n  role: {\n    type: String,\n    enum: ['customer', 'admin'],\n    default: 'customer'\n  },\n  isActive: {\n    type: Boolean,\n    default: true\n  },\n  preferences: {\n    newsletter: {\n      type: Boolean,\n      default: false\n    },\n    notifications: {\n      type: Boolean,\n      default: true\n    }\n  },\n  loyaltyPoints: {\n    type: Number,\n    default: 0,\n    min: 0\n  }\n}, {\n  timestamps: true,\n  toJSON: {\n    virtuals: true\n  },\n  toObject: {\n    virtuals: true\n  }\n});\n\n// Virtual for full name\nuserSchema.virtual('name').get(function () {\n  return `${this.firstName} ${this.lastName}`;\n});\n\n// Index for better performance\nuserSchema.index({\n  email: 1\n});\nuserSchema.index({\n  role: 1\n});\n\n// Hash password before saving\nuserSchema.pre('save', async function (next) {\n  // Only hash the password if it has been modified (or is new)\n  if (!this.isModified('password')) return next();\n  try {\n    // Hash password with cost of 12\n    const hashedPassword = await bcrypt.hash(this.password, 12);\n    this.password = hashedPassword;\n    next();\n  } catch (error) {\n    next(error);\n  }\n});\n\n// Instance method to check password\nuserSchema.methods.comparePassword = async function (candidatePassword) {\n  return await bcrypt.compare(candidatePassword, this.password);\n};\n\n// Instance method to get full name\nuserSchema.methods.getFullName = function () {\n  return `${this.firstName} ${this.lastName}`;\n};\nmodule.exports = mongoose.model('User', userSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJiY3J5cHQiLCJ1c2VyU2NoZW1hIiwiU2NoZW1hIiwiZmlyc3ROYW1lIiwidHlwZSIsIlN0cmluZyIsInJlcXVpcmVkIiwidHJpbSIsIm1heGxlbmd0aCIsImxhc3ROYW1lIiwiZW1haWwiLCJ1bmlxdWUiLCJsb3dlcmNhc2UiLCJtYXRjaCIsInBhc3N3b3JkIiwibWlubGVuZ3RoIiwic2VsZWN0IiwicGhvbmUiLCJhZGRyZXNzIiwic3RyZWV0IiwiY2l0eSIsInN0YXRlIiwiemlwQ29kZSIsImNvdW50cnkiLCJkZWZhdWx0Iiwicm9sZSIsImVudW0iLCJpc0FjdGl2ZSIsIkJvb2xlYW4iLCJwcmVmZXJlbmNlcyIsIm5ld3NsZXR0ZXIiLCJub3RpZmljYXRpb25zIiwibG95YWx0eVBvaW50cyIsIk51bWJlciIsIm1pbiIsInRpbWVzdGFtcHMiLCJ0b0pTT04iLCJ2aXJ0dWFscyIsInRvT2JqZWN0IiwidmlydHVhbCIsImdldCIsImluZGV4IiwicHJlIiwibmV4dCIsImlzTW9kaWZpZWQiLCJoYXNoZWRQYXNzd29yZCIsImhhc2giLCJlcnJvciIsIm1ldGhvZHMiLCJjb21wYXJlUGFzc3dvcmQiLCJjYW5kaWRhdGVQYXNzd29yZCIsImNvbXBhcmUiLCJnZXRGdWxsTmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2RlbCJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXG1vZGVsc1xcIiwic291cmNlcyI6WyJVc2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJyk7XG5cbmNvbnN0IHVzZXJTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcbiAgZmlyc3ROYW1lOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnXSxcbiAgICB0cmltOiB0cnVlLFxuICAgIG1heGxlbmd0aDogWzUwLCAnRmlyc3QgbmFtZSBjYW5ub3QgZXhjZWVkIDUwIGNoYXJhY3RlcnMnXVxuICB9LFxuICBsYXN0TmFtZToge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICByZXF1aXJlZDogW3RydWUsICdMYXN0IG5hbWUgaXMgcmVxdWlyZWQnXSxcbiAgICB0cmltOiB0cnVlLFxuICAgIG1heGxlbmd0aDogWzUwLCAnTGFzdCBuYW1lIGNhbm5vdCBleGNlZWQgNTAgY2hhcmFjdGVycyddXG4gIH0sXG4gIGVtYWlsOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ0VtYWlsIGlzIHJlcXVpcmVkJ10sXG4gICAgdW5pcXVlOiB0cnVlLFxuICAgIGxvd2VyY2FzZTogdHJ1ZSxcbiAgICB0cmltOiB0cnVlLFxuICAgIG1hdGNoOiBbL15cXHcrKFtcXC4tXT9cXHcrKSpAXFx3KyhbXFwuLV0/XFx3KykqKFxcLlxcd3syLDN9KSskLywgJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsJ11cbiAgfSxcbiAgcGFzc3dvcmQ6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgcmVxdWlyZWQ6IFt0cnVlLCAnUGFzc3dvcmQgaXMgcmVxdWlyZWQnXSxcbiAgICBtaW5sZW5ndGg6IFs2LCAnUGFzc3dvcmQgbXVzdCBiZSBhdCBsZWFzdCA2IGNoYXJhY3RlcnMnXSxcbiAgICBzZWxlY3Q6IGZhbHNlIC8vIERvbid0IGluY2x1ZGUgcGFzc3dvcmQgaW4gcXVlcmllcyBieSBkZWZhdWx0XG4gIH0sXG4gIHBob25lOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHRyaW06IHRydWUsXG4gICAgbWF0Y2g6IFsvXlxcZHsxMH0kLywgJ1BsZWFzZSBlbnRlciBhIHZhbGlkIHBob25lIG51bWJlciddXG4gIH0sXG4gIGFkZHJlc3M6IHtcbiAgICBzdHJlZXQ6IHsgdHlwZTogU3RyaW5nLCB0cmltOiB0cnVlIH0sXG4gICAgY2l0eTogeyB0eXBlOiBTdHJpbmcsIHRyaW06IHRydWUgfSxcbiAgICBzdGF0ZTogeyB0eXBlOiBTdHJpbmcsIHRyaW06IHRydWUgfSxcbiAgICB6aXBDb2RlOiB7IHR5cGU6IFN0cmluZywgdHJpbTogdHJ1ZSB9LFxuICAgIGNvdW50cnk6IHsgdHlwZTogU3RyaW5nLCB0cmltOiB0cnVlLCBkZWZhdWx0OiAnVVNBJyB9XG4gIH0sXG4gIHJvbGU6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgZW51bTogWydjdXN0b21lcicsICdhZG1pbiddLFxuICAgIGRlZmF1bHQ6ICdjdXN0b21lcidcbiAgfSxcbiAgaXNBY3RpdmU6IHtcbiAgICB0eXBlOiBCb29sZWFuLFxuICAgIGRlZmF1bHQ6IHRydWVcbiAgfSxcbiAgcHJlZmVyZW5jZXM6IHtcbiAgICBuZXdzbGV0dGVyOiB7IHR5cGU6IEJvb2xlYW4sIGRlZmF1bHQ6IGZhbHNlIH0sXG4gICAgbm90aWZpY2F0aW9uczogeyB0eXBlOiBCb29sZWFuLCBkZWZhdWx0OiB0cnVlIH1cbiAgfSxcbiAgbG95YWx0eVBvaW50czoge1xuICAgIHR5cGU6IE51bWJlcixcbiAgICBkZWZhdWx0OiAwLFxuICAgIG1pbjogMFxuICB9XG59LCB7XG4gIHRpbWVzdGFtcHM6IHRydWUsXG4gIHRvSlNPTjogeyB2aXJ0dWFsczogdHJ1ZSB9LFxuICB0b09iamVjdDogeyB2aXJ0dWFsczogdHJ1ZSB9XG59KTtcblxuLy8gVmlydHVhbCBmb3IgZnVsbCBuYW1lXG51c2VyU2NoZW1hLnZpcnR1YWwoJ25hbWUnKS5nZXQoZnVuY3Rpb24oKSB7XG4gIHJldHVybiBgJHt0aGlzLmZpcnN0TmFtZX0gJHt0aGlzLmxhc3ROYW1lfWA7XG59KTtcblxuLy8gSW5kZXggZm9yIGJldHRlciBwZXJmb3JtYW5jZVxudXNlclNjaGVtYS5pbmRleCh7IGVtYWlsOiAxIH0pO1xudXNlclNjaGVtYS5pbmRleCh7IHJvbGU6IDEgfSk7XG5cbi8vIEhhc2ggcGFzc3dvcmQgYmVmb3JlIHNhdmluZ1xudXNlclNjaGVtYS5wcmUoJ3NhdmUnLCBhc3luYyBmdW5jdGlvbihuZXh0KSB7XG4gIC8vIE9ubHkgaGFzaCB0aGUgcGFzc3dvcmQgaWYgaXQgaGFzIGJlZW4gbW9kaWZpZWQgKG9yIGlzIG5ldylcbiAgaWYgKCF0aGlzLmlzTW9kaWZpZWQoJ3Bhc3N3b3JkJykpIHJldHVybiBuZXh0KCk7XG4gIFxuICB0cnkge1xuICAgIC8vIEhhc2ggcGFzc3dvcmQgd2l0aCBjb3N0IG9mIDEyXG4gICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaCh0aGlzLnBhc3N3b3JkLCAxMik7XG4gICAgdGhpcy5wYXNzd29yZCA9IGhhc2hlZFBhc3N3b3JkO1xuICAgIG5leHQoKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBuZXh0KGVycm9yKTtcbiAgfVxufSk7XG5cbi8vIEluc3RhbmNlIG1ldGhvZCB0byBjaGVjayBwYXNzd29yZFxudXNlclNjaGVtYS5tZXRob2RzLmNvbXBhcmVQYXNzd29yZCA9IGFzeW5jIGZ1bmN0aW9uKGNhbmRpZGF0ZVBhc3N3b3JkKSB7XG4gIHJldHVybiBhd2FpdCBiY3J5cHQuY29tcGFyZShjYW5kaWRhdGVQYXNzd29yZCwgdGhpcy5wYXNzd29yZCk7XG59O1xuXG4vLyBJbnN0YW5jZSBtZXRob2QgdG8gZ2V0IGZ1bGwgbmFtZVxudXNlclNjaGVtYS5tZXRob2RzLmdldEZ1bGxOYW1lID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiBgJHt0aGlzLmZpcnN0TmFtZX0gJHt0aGlzLmxhc3ROYW1lfWA7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IG1vbmdvb3NlLm1vZGVsKCdVc2VyJywgdXNlclNjaGVtYSk7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFDcEMsTUFBTUMsTUFBTSxHQUFHRCxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRWxDLE1BQU1FLFVBQVUsR0FBRyxJQUFJSCxRQUFRLENBQUNJLE1BQU0sQ0FBQztFQUNyQ0MsU0FBUyxFQUFFO0lBQ1RDLElBQUksRUFBRUMsTUFBTTtJQUNaQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsd0JBQXdCLENBQUM7SUFDMUNDLElBQUksRUFBRSxJQUFJO0lBQ1ZDLFNBQVMsRUFBRSxDQUFDLEVBQUUsRUFBRSx3Q0FBd0M7RUFDMUQsQ0FBQztFQUNEQyxRQUFRLEVBQUU7SUFDUkwsSUFBSSxFQUFFQyxNQUFNO0lBQ1pDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSx1QkFBdUIsQ0FBQztJQUN6Q0MsSUFBSSxFQUFFLElBQUk7SUFDVkMsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFLHVDQUF1QztFQUN6RCxDQUFDO0VBQ0RFLEtBQUssRUFBRTtJQUNMTixJQUFJLEVBQUVDLE1BQU07SUFDWkMsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLG1CQUFtQixDQUFDO0lBQ3JDSyxNQUFNLEVBQUUsSUFBSTtJQUNaQyxTQUFTLEVBQUUsSUFBSTtJQUNmTCxJQUFJLEVBQUUsSUFBSTtJQUNWTSxLQUFLLEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSw0QkFBNEI7RUFDdkYsQ0FBQztFQUNEQyxRQUFRLEVBQUU7SUFDUlYsSUFBSSxFQUFFQyxNQUFNO0lBQ1pDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxzQkFBc0IsQ0FBQztJQUN4Q1MsU0FBUyxFQUFFLENBQUMsQ0FBQyxFQUFFLHdDQUF3QyxDQUFDO0lBQ3hEQyxNQUFNLEVBQUUsS0FBSyxDQUFDO0VBQ2hCLENBQUM7RUFDREMsS0FBSyxFQUFFO0lBQ0xiLElBQUksRUFBRUMsTUFBTTtJQUNaRSxJQUFJLEVBQUUsSUFBSTtJQUNWTSxLQUFLLEVBQUUsQ0FBQyxVQUFVLEVBQUUsbUNBQW1DO0VBQ3pELENBQUM7RUFDREssT0FBTyxFQUFFO0lBQ1BDLE1BQU0sRUFBRTtNQUFFZixJQUFJLEVBQUVDLE1BQU07TUFBRUUsSUFBSSxFQUFFO0lBQUssQ0FBQztJQUNwQ2EsSUFBSSxFQUFFO01BQUVoQixJQUFJLEVBQUVDLE1BQU07TUFBRUUsSUFBSSxFQUFFO0lBQUssQ0FBQztJQUNsQ2MsS0FBSyxFQUFFO01BQUVqQixJQUFJLEVBQUVDLE1BQU07TUFBRUUsSUFBSSxFQUFFO0lBQUssQ0FBQztJQUNuQ2UsT0FBTyxFQUFFO01BQUVsQixJQUFJLEVBQUVDLE1BQU07TUFBRUUsSUFBSSxFQUFFO0lBQUssQ0FBQztJQUNyQ2dCLE9BQU8sRUFBRTtNQUFFbkIsSUFBSSxFQUFFQyxNQUFNO01BQUVFLElBQUksRUFBRSxJQUFJO01BQUVpQixPQUFPLEVBQUU7SUFBTTtFQUN0RCxDQUFDO0VBQ0RDLElBQUksRUFBRTtJQUNKckIsSUFBSSxFQUFFQyxNQUFNO0lBQ1pxQixJQUFJLEVBQUUsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDO0lBQzNCRixPQUFPLEVBQUU7RUFDWCxDQUFDO0VBQ0RHLFFBQVEsRUFBRTtJQUNSdkIsSUFBSSxFQUFFd0IsT0FBTztJQUNiSixPQUFPLEVBQUU7RUFDWCxDQUFDO0VBQ0RLLFdBQVcsRUFBRTtJQUNYQyxVQUFVLEVBQUU7TUFBRTFCLElBQUksRUFBRXdCLE9BQU87TUFBRUosT0FBTyxFQUFFO0lBQU0sQ0FBQztJQUM3Q08sYUFBYSxFQUFFO01BQUUzQixJQUFJLEVBQUV3QixPQUFPO01BQUVKLE9BQU8sRUFBRTtJQUFLO0VBQ2hELENBQUM7RUFDRFEsYUFBYSxFQUFFO0lBQ2I1QixJQUFJLEVBQUU2QixNQUFNO0lBQ1pULE9BQU8sRUFBRSxDQUFDO0lBQ1ZVLEdBQUcsRUFBRTtFQUNQO0FBQ0YsQ0FBQyxFQUFFO0VBQ0RDLFVBQVUsRUFBRSxJQUFJO0VBQ2hCQyxNQUFNLEVBQUU7SUFBRUMsUUFBUSxFQUFFO0VBQUssQ0FBQztFQUMxQkMsUUFBUSxFQUFFO0lBQUVELFFBQVEsRUFBRTtFQUFLO0FBQzdCLENBQUMsQ0FBQzs7QUFFRjtBQUNBcEMsVUFBVSxDQUFDc0MsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDQyxHQUFHLENBQUMsWUFBVztFQUN4QyxPQUFPLEdBQUcsSUFBSSxDQUFDckMsU0FBUyxJQUFJLElBQUksQ0FBQ00sUUFBUSxFQUFFO0FBQzdDLENBQUMsQ0FBQzs7QUFFRjtBQUNBUixVQUFVLENBQUN3QyxLQUFLLENBQUM7RUFBRS9CLEtBQUssRUFBRTtBQUFFLENBQUMsQ0FBQztBQUM5QlQsVUFBVSxDQUFDd0MsS0FBSyxDQUFDO0VBQUVoQixJQUFJLEVBQUU7QUFBRSxDQUFDLENBQUM7O0FBRTdCO0FBQ0F4QixVQUFVLENBQUN5QyxHQUFHLENBQUMsTUFBTSxFQUFFLGdCQUFlQyxJQUFJLEVBQUU7RUFDMUM7RUFDQSxJQUFJLENBQUMsSUFBSSxDQUFDQyxVQUFVLENBQUMsVUFBVSxDQUFDLEVBQUUsT0FBT0QsSUFBSSxDQUFDLENBQUM7RUFFL0MsSUFBSTtJQUNGO0lBQ0EsTUFBTUUsY0FBYyxHQUFHLE1BQU03QyxNQUFNLENBQUM4QyxJQUFJLENBQUMsSUFBSSxDQUFDaEMsUUFBUSxFQUFFLEVBQUUsQ0FBQztJQUMzRCxJQUFJLENBQUNBLFFBQVEsR0FBRytCLGNBQWM7SUFDOUJGLElBQUksQ0FBQyxDQUFDO0VBQ1IsQ0FBQyxDQUFDLE9BQU9JLEtBQUssRUFBRTtJQUNkSixJQUFJLENBQUNJLEtBQUssQ0FBQztFQUNiO0FBQ0YsQ0FBQyxDQUFDOztBQUVGO0FBQ0E5QyxVQUFVLENBQUMrQyxPQUFPLENBQUNDLGVBQWUsR0FBRyxnQkFBZUMsaUJBQWlCLEVBQUU7RUFDckUsT0FBTyxNQUFNbEQsTUFBTSxDQUFDbUQsT0FBTyxDQUFDRCxpQkFBaUIsRUFBRSxJQUFJLENBQUNwQyxRQUFRLENBQUM7QUFDL0QsQ0FBQzs7QUFFRDtBQUNBYixVQUFVLENBQUMrQyxPQUFPLENBQUNJLFdBQVcsR0FBRyxZQUFXO0VBQzFDLE9BQU8sR0FBRyxJQUFJLENBQUNqRCxTQUFTLElBQUksSUFBSSxDQUFDTSxRQUFRLEVBQUU7QUFDN0MsQ0FBQztBQUVENEMsTUFBTSxDQUFDQyxPQUFPLEdBQUd4RCxRQUFRLENBQUN5RCxLQUFLLENBQUMsTUFBTSxFQUFFdEQsVUFBVSxDQUFDIiwiaWdub3JlTGlzdCI6W119","map":{"version":3,"names":["mongoose","require","bcrypt","userSchema","Schema","firstName","type","String","required","trim","maxlength","lastName","email","unique","lowercase","match","password","minlength","select","phone","address","street","city","state","zipCode","country","default","role","enum","isActive","Boolean","preferences","newsletter","notifications","loyaltyPoints","Number","min","timestamps","toJSON","virtuals","toObject","virtual","get","index","pre","next","isModified","hashedPassword","hash","error","methods","comparePassword","candidatePassword","compare","getFullName","module","exports","model"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\models\\","sources":["User.js"],"sourcesContent":["const mongoose = require('mongoose');\nconst bcrypt = require('bcryptjs');\n\nconst userSchema = new mongoose.Schema({\n  firstName: {\n    type: String,\n    required: [true, 'First name is required'],\n    trim: true,\n    maxlength: [50, 'First name cannot exceed 50 characters']\n  },\n  lastName: {\n    type: String,\n    required: [true, 'Last name is required'],\n    trim: true,\n    maxlength: [50, 'Last name cannot exceed 50 characters']\n  },\n  email: {\n    type: String,\n    required: [true, 'Email is required'],\n    unique: true,\n    lowercase: true,\n    trim: true,\n    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email']\n  },\n  password: {\n    type: String,\n    required: [true, 'Password is required'],\n    minlength: [6, 'Password must be at least 6 characters'],\n    select: false // Don't include password in queries by default\n  },\n  phone: {\n    type: String,\n    trim: true,\n    match: [/^\\d{10}$/, 'Please enter a valid phone number']\n  },\n  address: {\n    street: { type: String, trim: true },\n    city: { type: String, trim: true },\n    state: { type: String, trim: true },\n    zipCode: { type: String, trim: true },\n    country: { type: String, trim: true, default: 'USA' }\n  },\n  role: {\n    type: String,\n    enum: ['customer', 'admin'],\n    default: 'customer'\n  },\n  isActive: {\n    type: Boolean,\n    default: true\n  },\n  preferences: {\n    newsletter: { type: Boolean, default: false },\n    notifications: { type: Boolean, default: true }\n  },\n  loyaltyPoints: {\n    type: Number,\n    default: 0,\n    min: 0\n  }\n}, {\n  timestamps: true,\n  toJSON: { virtuals: true },\n  toObject: { virtuals: true }\n});\n\n// Virtual for full name\nuserSchema.virtual('name').get(function() {\n  return `${this.firstName} ${this.lastName}`;\n});\n\n// Index for better performance\nuserSchema.index({ email: 1 });\nuserSchema.index({ role: 1 });\n\n// Hash password before saving\nuserSchema.pre('save', async function(next) {\n  // Only hash the password if it has been modified (or is new)\n  if (!this.isModified('password')) return next();\n  \n  try {\n    // Hash password with cost of 12\n    const hashedPassword = await bcrypt.hash(this.password, 12);\n    this.password = hashedPassword;\n    next();\n  } catch (error) {\n    next(error);\n  }\n});\n\n// Instance method to check password\nuserSchema.methods.comparePassword = async function(candidatePassword) {\n  return await bcrypt.compare(candidatePassword, this.password);\n};\n\n// Instance method to get full name\nuserSchema.methods.getFullName = function() {\n  return `${this.firstName} ${this.lastName}`;\n};\n\nmodule.exports = mongoose.model('User', userSchema);"],"mappings":"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","ignoreList":[]}},"mtime":1757523841233},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\middleware\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\middleware\\\\auth.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const jwt = require('jsonwebtoken');\nconst User = require('../models/User');\n\n// Middleware to protect routes\nconst protect = async (req, res, next) => {\n  try {\n    let token;\n\n    // Check for token in Authorization header\n    if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {\n      token = req.headers.authorization.split(' ')[1];\n    }\n\n    // Make sure token exists\n    if (!token) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n    try {\n      // Verify token\n      const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n      // Get user from token\n      const user = await User.findById(decoded.userId);\n      if (!user) {\n        return res.status(401).json({\n          success: false,\n          message: 'User not found'\n        });\n      }\n      if (!user.isActive) {\n        return res.status(401).json({\n          success: false,\n          message: 'User account is deactivated'\n        });\n      }\n      req.user = user;\n      next();\n    } catch (error) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n  } catch (error) {\n    console.error('Auth middleware error:', error);\n    return res.status(500).json({\n      success: false,\n      message: 'Server error in authentication'\n    });\n  }\n};\n\n// Middleware to check if user is admin\nconst authorize = (...roles) => {\n  return (req, res, next) => {\n    if (!req.user) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n    if (!roles.includes(req.user.role)) {\n      return res.status(403).json({\n        success: false,\n        message: `User role ${req.user.role} is not authorized to access this route`\n      });\n    }\n    next();\n  };\n};\n\n// Middleware to check if user owns the resource or is admin\nconst authorizeOwnerOrAdmin = (req, res, next) => {\n  if (!req.user) {\n    return res.status(401).json({\n      success: false,\n      message: 'Not authorized to access this route'\n    });\n  }\n\n  // Allow if user is admin or owns the resource\n  if (req.user.role === 'admin' || req.user._id.toString() === req.params.userId) {\n    next();\n  } else {\n    return res.status(403).json({\n      success: false,\n      message: 'Not authorized to access this resource'\n    });\n  }\n};\nmodule.exports = {\n  protect,\n  authorize,\n  authorizeOwnerOrAdmin\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwiVXNlciIsInByb3RlY3QiLCJyZXEiLCJyZXMiLCJuZXh0IiwidG9rZW4iLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInN0YXJ0c1dpdGgiLCJzcGxpdCIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwibWVzc2FnZSIsImRlY29kZWQiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsInVzZXIiLCJmaW5kQnlJZCIsInVzZXJJZCIsImlzQWN0aXZlIiwiZXJyb3IiLCJjb25zb2xlIiwiYXV0aG9yaXplIiwicm9sZXMiLCJpbmNsdWRlcyIsInJvbGUiLCJhdXRob3JpemVPd25lck9yQWRtaW4iLCJfaWQiLCJ0b1N0cmluZyIsInBhcmFtcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkQ6XFxjb2RlXFxXZWJDYWZmZVxcYmFja2VuZFxcc3JjXFxtaWRkbGV3YXJlXFwiLCJzb3VyY2VzIjpbImF1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XG5jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1VzZXInKTtcblxuLy8gTWlkZGxld2FyZSB0byBwcm90ZWN0IHJvdXRlc1xuY29uc3QgcHJvdGVjdCA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGxldCB0b2tlbjtcblxuICAgIC8vIENoZWNrIGZvciB0b2tlbiBpbiBBdXRob3JpemF0aW9uIGhlYWRlclxuICAgIGlmIChyZXEuaGVhZGVycy5hdXRob3JpemF0aW9uICYmIHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24uc3RhcnRzV2l0aCgnQmVhcmVyJykpIHtcbiAgICAgIHRva2VuID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbi5zcGxpdCgnICcpWzFdO1xuICAgIH1cblxuICAgIC8vIE1ha2Ugc3VyZSB0b2tlbiBleGlzdHNcbiAgICBpZiAoIXRva2VuKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ05vdCBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGlzIHJvdXRlJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFZlcmlmeSB0b2tlblxuICAgICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xuICAgICAgXG4gICAgICAvLyBHZXQgdXNlciBmcm9tIHRva2VuXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChkZWNvZGVkLnVzZXJJZCk7XG4gICAgICBcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCdcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdXNlci5pc0FjdGl2ZSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIGFjY291bnQgaXMgZGVhY3RpdmF0ZWQnXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXEudXNlciA9IHVzZXI7XG4gICAgICBuZXh0KCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnTm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgcm91dGUnXG4gICAgICB9KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQXV0aCBtaWRkbGV3YXJlIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIGluIGF1dGhlbnRpY2F0aW9uJ1xuICAgIH0pO1xuICB9XG59O1xuXG4vLyBNaWRkbGV3YXJlIHRvIGNoZWNrIGlmIHVzZXIgaXMgYWRtaW5cbmNvbnN0IGF1dGhvcml6ZSA9ICguLi5yb2xlcykgPT4ge1xuICByZXR1cm4gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgaWYgKCFyZXEudXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byBhY2Nlc3MgdGhpcyByb3V0ZSdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICghcm9sZXMuaW5jbHVkZXMocmVxLnVzZXIucm9sZSkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBgVXNlciByb2xlICR7cmVxLnVzZXIucm9sZX0gaXMgbm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgcm91dGVgXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBuZXh0KCk7XG4gIH07XG59O1xuXG4vLyBNaWRkbGV3YXJlIHRvIGNoZWNrIGlmIHVzZXIgb3ducyB0aGUgcmVzb3VyY2Ugb3IgaXMgYWRtaW5cbmNvbnN0IGF1dGhvcml6ZU93bmVyT3JBZG1pbiA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICBpZiAoIXJlcS51c2VyKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ05vdCBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGlzIHJvdXRlJ1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQWxsb3cgaWYgdXNlciBpcyBhZG1pbiBvciBvd25zIHRoZSByZXNvdXJjZVxuICBpZiAocmVxLnVzZXIucm9sZSA9PT0gJ2FkbWluJyB8fCByZXEudXNlci5faWQudG9TdHJpbmcoKSA9PT0gcmVxLnBhcmFtcy51c2VySWQpIHtcbiAgICBuZXh0KCk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ05vdCBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGlzIHJlc291cmNlJ1xuICAgIH0pO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgcHJvdGVjdCxcbiAgYXV0aG9yaXplLFxuICBhdXRob3JpemVPd25lck9yQWRtaW5cbn07Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxHQUFHLEdBQUdDLE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDbkMsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsZ0JBQWdCLENBQUM7O0FBRXRDO0FBQ0EsTUFBTUUsT0FBTyxHQUFHLE1BQUFBLENBQU9DLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDeEMsSUFBSTtJQUNGLElBQUlDLEtBQUs7O0lBRVQ7SUFDQSxJQUFJSCxHQUFHLENBQUNJLE9BQU8sQ0FBQ0MsYUFBYSxJQUFJTCxHQUFHLENBQUNJLE9BQU8sQ0FBQ0MsYUFBYSxDQUFDQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUU7TUFDL0VILEtBQUssR0FBR0gsR0FBRyxDQUFDSSxPQUFPLENBQUNDLGFBQWEsQ0FBQ0UsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNqRDs7SUFFQTtJQUNBLElBQUksQ0FBQ0osS0FBSyxFQUFFO01BQ1YsT0FBT0YsR0FBRyxDQUFDTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztR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","map":{"version":3,"names":["jwt","require","User","protect","req","res","next","token","headers","authorization","startsWith","split","status","json","success","message","decoded","verify","process","env","JWT_SECRET","user","findById","userId","isActive","error","console","authorize","roles","includes","role","authorizeOwnerOrAdmin","_id","toString","params","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\middleware\\","sources":["auth.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\nconst User = require('../models/User');\n\n// Middleware to protect routes\nconst protect = async (req, res, next) => {\n  try {\n    let token;\n\n    // Check for token in Authorization header\n    if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {\n      token = req.headers.authorization.split(' ')[1];\n    }\n\n    // Make sure token exists\n    if (!token) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n\n    try {\n      // Verify token\n      const decoded = jwt.verify(token, process.env.JWT_SECRET);\n      \n      // Get user from token\n      const user = await User.findById(decoded.userId);\n      \n      if (!user) {\n        return res.status(401).json({\n          success: false,\n          message: 'User not found'\n        });\n      }\n\n      if (!user.isActive) {\n        return res.status(401).json({\n          success: false,\n          message: 'User account is deactivated'\n        });\n      }\n\n      req.user = user;\n      next();\n    } catch (error) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n  } catch (error) {\n    console.error('Auth middleware error:', error);\n    return res.status(500).json({\n      success: false,\n      message: 'Server error in authentication'\n    });\n  }\n};\n\n// Middleware to check if user is admin\nconst authorize = (...roles) => {\n  return (req, res, next) => {\n    if (!req.user) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n\n    if (!roles.includes(req.user.role)) {\n      return res.status(403).json({\n        success: false,\n        message: `User role ${req.user.role} is not authorized to access this route`\n      });\n    }\n\n    next();\n  };\n};\n\n// Middleware to check if user owns the resource or is admin\nconst authorizeOwnerOrAdmin = (req, res, next) => {\n  if (!req.user) {\n    return res.status(401).json({\n      success: false,\n      message: 'Not authorized to access this route'\n    });\n  }\n\n  // Allow if user is admin or owns the resource\n  if (req.user.role === 'admin' || req.user._id.toString() === req.params.userId) {\n    next();\n  } else {\n    return res.status(403).json({\n      success: false,\n      message: 'Not authorized to access this resource'\n    });\n  }\n};\n\nmodule.exports = {\n  protect,\n  authorize,\n  authorizeOwnerOrAdmin\n};"],"mappings":"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","ignoreList":[]}},"mtime":1756225535435},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\orders.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst Order = require('../models/Order');\nconst Product = require('../models/Product');\nconst {\n  protect: auth\n} = require('../middleware/auth');\n\n// @route   GET /api/orders\n// @desc    Get all orders for authenticated user\n// @access  Private\nrouter.get('/', auth, async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const skip = (page - 1) * limit;\n    const status = req.query.status;\n\n    // Build query\n    const query = {\n      customer: req.user.id\n    };\n    if (status && status !== 'all') {\n      query.status = status;\n    }\n\n    // Get orders with pagination\n    const orders = await Order.find(query).populate('items.product', 'name category image').sort({\n      createdAt: -1\n    }).skip(skip).limit(limit);\n\n    // Get total count for pagination\n    const total = await Order.countDocuments(query);\n    res.json({\n      success: true,\n      data: orders,\n      pagination: {\n        current: page,\n        pages: Math.ceil(total / limit),\n        total\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching orders'\n    });\n  }\n});\n\n// @route   GET /api/orders/:id\n// @desc    Get single order by ID\n// @access  Private\nrouter.get('/:id', auth, async (req, res) => {\n  try {\n    const order = await Order.findOne({\n      _id: req.params.id,\n      customer: req.user.id\n    }).populate('items.product', 'name category image description');\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: order\n    });\n  } catch (error) {\n    console.error('Error fetching order:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order'\n    });\n  }\n});\n\n// @route   POST /api/orders\n// @desc    Create new order\n// @access  Private\nrouter.post('/', auth, async (req, res) => {\n  try {\n    const {\n      items,\n      orderType,\n      paymentMethod,\n      deliveryAddress,\n      notes\n    } = req.body;\n\n    // Validate required fields\n    if (!items || !Array.isArray(items) || items.length === 0) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order must contain at least one item'\n      });\n    }\n    if (!orderType || !['pickup', 'delivery', 'dine-in'].includes(orderType)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid order type is required'\n      });\n    }\n    if (!paymentMethod || !['cash', 'card', 'digital_wallet', 'momo', 'vnpay'].includes(paymentMethod)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid payment method is required'\n      });\n    }\n\n    // Validate delivery address for delivery orders\n    if (orderType === 'delivery') {\n      if (!deliveryAddress || !deliveryAddress.street || !deliveryAddress.city) {\n        return res.status(400).json({\n          success: false,\n          message: 'Delivery address is required for delivery orders'\n        });\n      }\n    }\n\n    // Validate and calculate order totals\n    let subtotal = 0;\n    const validatedItems = [];\n    for (const item of items) {\n      // Validate product exists\n      const product = await Product.findById(item.product);\n      if (!product) {\n        return res.status(400).json({\n          success: false,\n          message: `Product with ID ${item.product} not found`\n        });\n      }\n\n      // Validate quantity\n      if (!item.quantity || item.quantity < 1) {\n        return res.status(400).json({\n          success: false,\n          message: 'Item quantity must be at least 1'\n        });\n      }\n\n      // Calculate item price (base price or size-specific price)\n      let itemPrice = product.price;\n      if (item.size && product.sizes && product.sizes.length > 0) {\n        const sizeOption = product.sizes.find(s => s.name === item.size);\n        if (sizeOption) {\n          itemPrice = sizeOption.price;\n        }\n      }\n      const itemTotal = itemPrice * item.quantity;\n      subtotal += itemTotal;\n      validatedItems.push({\n        product: product._id,\n        name: product.name,\n        price: itemPrice,\n        quantity: item.quantity,\n        size: item.size || 'Regular',\n        customizations: item.customizations || []\n      });\n    }\n\n    // Calculate tax (8% for example)\n    const tax = subtotal * 0.08;\n    const total = subtotal + tax;\n\n    // Generate unique order number\n    const orderNumber = `ORD-${Date.now()}-${Math.random().toString(36).substr(2, 4).toUpperCase()}`;\n\n    // Create order\n    const order = new Order({\n      orderNumber,\n      customer: req.user.id,\n      items: validatedItems,\n      subtotal,\n      tax,\n      total,\n      orderType,\n      paymentMethod,\n      deliveryAddress: orderType === 'delivery' ? deliveryAddress : undefined,\n      notes: notes || '',\n      loyaltyPointsEarned: Math.floor(total * 0.1) // 10% of total as points\n    });\n    await order.save();\n\n    // Populate the order before sending response\n    await order.populate('items.product', 'name category image');\n    res.status(201).json({\n      success: true,\n      data: order,\n      message: 'Order created successfully'\n    });\n  } catch (error) {\n    console.error('Error creating order:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating order'\n    });\n  }\n});\n\n// @route   PUT /api/orders/:id/status\n// @desc    Update order status (for admin use)\n// @access  Private\nrouter.put('/:id/status', auth, async (req, res) => {\n  try {\n    const {\n      status\n    } = req.body;\n    const validStatuses = ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'];\n    if (!status || !validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid status is required'\n      });\n    }\n    const order = await Order.findById(req.params.id);\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if user owns the order or is admin (for now, allow user to cancel their own orders)\n    if (order.customer.toString() !== req.user.id && status !== 'cancelled') {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to update this order'\n      });\n    }\n\n    // Only allow cancellation if order is still pending or confirmed\n    if (status === 'cancelled' && !['pending', 'confirmed'].includes(order.status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order cannot be cancelled at this stage'\n      });\n    }\n    order.status = status;\n    if (status === 'completed') {\n      order.actualCompletionTime = new Date();\n    }\n    await order.save();\n    res.json({\n      success: true,\n      data: order,\n      message: 'Order status updated successfully'\n    });\n  } catch (error) {\n    console.error('Error updating order status:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating order status'\n    });\n  }\n});\n\n// @route   DELETE /api/orders/:id\n// @desc    Cancel/Delete order (only if pending)\n// @access  Private\nrouter.delete('/:id', auth, async (req, res) => {\n  try {\n    const order = await Order.findOne({\n      _id: req.params.id,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Only allow deletion if order is pending\n    if (order.status !== 'pending') {\n      return res.status(400).json({\n        success: false,\n        message: 'Only pending orders can be cancelled'\n      });\n    }\n    order.status = 'cancelled';\n    await order.save();\n    res.json({\n      success: true,\n      message: 'Order cancelled successfully'\n    });\n  } catch (error) {\n    console.error('Error cancelling order:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while cancelling order'\n    });\n  }\n});\n\n// @route   GET /api/orders/stats/summary\n// @desc    Get order statistics for user\n// @access  Private\nrouter.get('/stats/summary', auth, async (req, res) => {\n  try {\n    const userId = req.user.id;\n\n    // Get order counts by status\n    const statusCounts = await Order.aggregate([{\n      $match: {\n        customer: mongoose.Types.ObjectId(userId)\n      }\n    }, {\n      $group: {\n        _id: '$status',\n        count: {\n          $sum: 1\n        }\n      }\n    }]);\n\n    // Get total spent\n    const totalSpent = await Order.aggregate([{\n      $match: {\n        customer: mongoose.Types.ObjectId(userId),\n        status: {\n          $in: ['completed', 'ready']\n        }\n      }\n    }, {\n      $group: {\n        _id: null,\n        total: {\n          $sum: '$total'\n        }\n      }\n    }]);\n\n    // Get recent orders count (last 30 days)\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n    const recentOrdersCount = await Order.countDocuments({\n      customer: userId,\n      createdAt: {\n        $gte: thirtyDaysAgo\n      }\n    });\n\n    // Get loyalty points\n    const loyaltyPoints = await Order.aggregate([{\n      $match: {\n        customer: mongoose.Types.ObjectId(userId)\n      }\n    }, {\n      $group: {\n        _id: null,\n        earned: {\n          $sum: '$loyaltyPointsEarned'\n        },\n        used: {\n          $sum: '$loyaltyPointsUsed'\n        }\n      }\n    }]);\n    res.json({\n      success: true,\n      data: {\n        statusCounts: statusCounts.reduce((acc, item) => {\n          acc[item._id] = item.count;\n          return acc;\n        }, {}),\n        totalSpent: totalSpent[0]?.total || 0,\n        recentOrdersCount,\n        loyaltyPoints: {\n          earned: loyaltyPoints[0]?.earned || 0,\n          used: loyaltyPoints[0]?.used || 0,\n          available: (loyaltyPoints[0]?.earned || 0) - (loyaltyPoints[0]?.used || 0)\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching order statistics:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order statistics'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIk9yZGVyIiwiUHJvZHVjdCIsInByb3RlY3QiLCJhdXRoIiwiZ2V0IiwicmVxIiwicmVzIiwicGFnZSIsInBhcnNlSW50IiwicXVlcnkiLCJsaW1pdCIsInNraXAiLCJzdGF0dXMiLCJjdXN0b21lciIsInVzZXIiLCJpZCIsIm9yZGVycyIsImZpbmQiLCJwb3B1bGF0ZSIsInNvcnQiLCJjcmVhdGVkQXQiLCJ0b3RhbCIsImNvdW50RG9jdW1lbnRzIiwianNvbiIsInN1Y2Nlc3MiLCJkYXRhIiwicGFnaW5hdGlvbiIsImN1cnJlbnQiLCJwYWdlcyIsIk1hdGgiLCJjZWlsIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsIm9yZGVyIiwiZmluZE9uZSIsIl9pZCIsInBhcmFtcyIsIm5hbWUiLCJwb3N0IiwiaXRlbXMiLCJvcmRlclR5cGUiLCJwYXltZW50TWV0aG9kIiwiZGVsaXZlcnlBZGRyZXNzIiwibm90ZXMiLCJib2R5IiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiaW5jbHVkZXMiLCJzdHJlZXQiLCJjaXR5Iiwic3VidG90YWwiLCJ2YWxpZGF0ZWRJdGVtcyIsIml0ZW0iLCJwcm9kdWN0IiwiZmluZEJ5SWQiLCJxdWFudGl0eSIsIml0ZW1QcmljZSIsInByaWNlIiwic2l6ZSIsInNpemVzIiwic2l6ZU9wdGlvbiIsInMiLCJpdGVtVG90YWwiLCJwdXNoIiwiY3VzdG9taXphdGlvbnMiLCJ0YXgiLCJvcmRlck51bWJlciIsIkRhdGUiLCJub3ciLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsInRvVXBwZXJDYXNlIiwidW5kZWZpbmVkIiwibG95YWx0eVBvaW50c0Vhcm5lZCIsImZsb29yIiwic2F2ZSIsInB1dCIsInZhbGlkU3RhdHVzZXMiLCJhY3R1YWxDb21wbGV0aW9uVGltZSIsImRlbGV0ZSIsInVzZXJJZCIsInN0YXR1c0NvdW50cyIsImFnZ3JlZ2F0ZSIsIiRtYXRjaCIsIm1vbmdvb3NlIiwiVHlwZXMiLCJPYmplY3RJZCIsIiRncm91cCIsImNvdW50IiwiJHN1bSIsInRvdGFsU3BlbnQiLCIkaW4iLCJ0aGlydHlEYXlzQWdvIiwic2V0RGF0ZSIsImdldERhdGUiLCJyZWNlbnRPcmRlcnNDb3VudCIsIiRndGUiLCJsb3lhbHR5UG9pbnRzIiwiZWFybmVkIiwidXNlZCIsInJlZHVjZSIsImFjYyIsImF2YWlsYWJsZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkQ6XFxjb2RlXFxXZWJDYWZmZVxcYmFja2VuZFxcc3JjXFxyb3V0ZXNcXCIsInNvdXJjZXMiOlsib3JkZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuY29uc3QgT3JkZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvT3JkZXInKTtcbmNvbnN0IFByb2R1Y3QgPSByZXF1aXJlKCcuLi9tb2RlbHMvUHJvZHVjdCcpO1xuY29uc3QgeyBwcm90ZWN0OiBhdXRoIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvb3JkZXJzXG4vLyBAZGVzYyAgICBHZXQgYWxsIG9yZGVycyBmb3IgYXV0aGVudGljYXRlZCB1c2VyXG4vLyBAYWNjZXNzICBQcml2YXRlXG5yb3V0ZXIuZ2V0KCcvJywgYXV0aCwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFnZSA9IHBhcnNlSW50KHJlcS5xdWVyeS5wYWdlKSB8fCAxO1xuICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLnF1ZXJ5LmxpbWl0KSB8fCAxMDtcbiAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuICAgIGNvbnN0IHN0YXR1cyA9IHJlcS5xdWVyeS5zdGF0dXM7XG5cbiAgICAvLyBCdWlsZCBxdWVyeVxuICAgIGNvbnN0IHF1ZXJ5ID0geyBjdXN0b21lcjogcmVxLnVzZXIuaWQgfTtcbiAgICBpZiAoc3RhdHVzICYmIHN0YXR1cyAhPT0gJ2FsbCcpIHtcbiAgICAgIHF1ZXJ5LnN0YXR1cyA9IHN0YXR1cztcbiAgICB9XG5cbiAgICAvLyBHZXQgb3JkZXJzIHdpdGggcGFnaW5hdGlvblxuICAgIGNvbnN0IG9yZGVycyA9IGF3YWl0IE9yZGVyLmZpbmQocXVlcnkpXG4gICAgICAucG9wdWxhdGUoJ2l0ZW1zLnByb2R1Y3QnLCAnbmFtZSBjYXRlZ29yeSBpbWFnZScpXG4gICAgICAuc29ydCh7IGNyZWF0ZWRBdDogLTEgfSlcbiAgICAgIC5za2lwKHNraXApXG4gICAgICAubGltaXQobGltaXQpO1xuXG4gICAgLy8gR2V0IHRvdGFsIGNvdW50IGZvciBwYWdpbmF0aW9uXG4gICAgY29uc3QgdG90YWwgPSBhd2FpdCBPcmRlci5jb3VudERvY3VtZW50cyhxdWVyeSk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogb3JkZXJzLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBjdXJyZW50OiBwYWdlLFxuICAgICAgICBwYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gbGltaXQpLFxuICAgICAgICB0b3RhbFxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIG9yZGVyczonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIG9yZGVycydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL29yZGVycy86aWRcbi8vIEBkZXNjICAgIEdldCBzaW5nbGUgb3JkZXIgYnkgSURcbi8vIEBhY2Nlc3MgIFByaXZhdGVcbnJvdXRlci5nZXQoJy86aWQnLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoe1xuICAgICAgX2lkOiByZXEucGFyYW1zLmlkLFxuICAgICAgY3VzdG9tZXI6IHJlcS51c2VyLmlkXG4gICAgfSkucG9wdWxhdGUoJ2l0ZW1zLnByb2R1Y3QnLCAnbmFtZSBjYXRlZ29yeSBpbWFnZSBkZXNjcmlwdGlvbicpO1xuXG4gICAgaWYgKCFvcmRlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogb3JkZXJcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBvcmRlcjonLCBlcnJvcik7XG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdDYXN0RXJyb3InKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgb3JkZXIgSUQnXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIG9yZGVyJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL29yZGVyc1xuLy8gQGRlc2MgICAgQ3JlYXRlIG5ldyBvcmRlclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxucm91dGVyLnBvc3QoJy8nLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7XG4gICAgICBpdGVtcyxcbiAgICAgIG9yZGVyVHlwZSxcbiAgICAgIHBheW1lbnRNZXRob2QsXG4gICAgICBkZWxpdmVyeUFkZHJlc3MsXG4gICAgICBub3Rlc1xuICAgIH0gPSByZXEuYm9keTtcblxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgIGlmICghaXRlbXMgfHwgIUFycmF5LmlzQXJyYXkoaXRlbXMpIHx8IGl0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBtdXN0IGNvbnRhaW4gYXQgbGVhc3Qgb25lIGl0ZW0nXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoIW9yZGVyVHlwZSB8fCAhWydwaWNrdXAnLCAnZGVsaXZlcnknLCAnZGluZS1pbiddLmluY2x1ZGVzKG9yZGVyVHlwZSkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnVmFsaWQgb3JkZXIgdHlwZSBpcyByZXF1aXJlZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICghcGF5bWVudE1ldGhvZCB8fCAhWydjYXNoJywgJ2NhcmQnLCAnZGlnaXRhbF93YWxsZXQnLCAnbW9tbycsICd2bnBheSddLmluY2x1ZGVzKHBheW1lbnRNZXRob2QpKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ1ZhbGlkIHBheW1lbnQgbWV0aG9kIGlzIHJlcXVpcmVkJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgZGVsaXZlcnkgYWRkcmVzcyBmb3IgZGVsaXZlcnkgb3JkZXJzXG4gICAgaWYgKG9yZGVyVHlwZSA9PT0gJ2RlbGl2ZXJ5Jykge1xuICAgICAgaWYgKCFkZWxpdmVyeUFkZHJlc3MgfHwgIWRlbGl2ZXJ5QWRkcmVzcy5zdHJlZXQgfHwgIWRlbGl2ZXJ5QWRkcmVzcy5jaXR5KSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ0RlbGl2ZXJ5IGFkZHJlc3MgaXMgcmVxdWlyZWQgZm9yIGRlbGl2ZXJ5IG9yZGVycydcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgYW5kIGNhbGN1bGF0ZSBvcmRlciB0b3RhbHNcbiAgICBsZXQgc3VidG90YWwgPSAwO1xuICAgIGNvbnN0IHZhbGlkYXRlZEl0ZW1zID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgIC8vIFZhbGlkYXRlIHByb2R1Y3QgZXhpc3RzXG4gICAgICBjb25zdCBwcm9kdWN0ID0gYXdhaXQgUHJvZHVjdC5maW5kQnlJZChpdGVtLnByb2R1Y3QpO1xuICAgICAgaWYgKCFwcm9kdWN0KSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogYFByb2R1Y3Qgd2l0aCBJRCAke2l0ZW0ucHJvZHVjdH0gbm90IGZvdW5kYFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgcXVhbnRpdHlcbiAgICAgIGlmICghaXRlbS5xdWFudGl0eSB8fCBpdGVtLnF1YW50aXR5IDwgMSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdJdGVtIHF1YW50aXR5IG11c3QgYmUgYXQgbGVhc3QgMSdcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBpdGVtIHByaWNlIChiYXNlIHByaWNlIG9yIHNpemUtc3BlY2lmaWMgcHJpY2UpXG4gICAgICBsZXQgaXRlbVByaWNlID0gcHJvZHVjdC5wcmljZTtcbiAgICAgIGlmIChpdGVtLnNpemUgJiYgcHJvZHVjdC5zaXplcyAmJiBwcm9kdWN0LnNpemVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3Qgc2l6ZU9wdGlvbiA9IHByb2R1Y3Quc2l6ZXMuZmluZChzID0+IHMubmFtZSA9PT0gaXRlbS5zaXplKTtcbiAgICAgICAgaWYgKHNpemVPcHRpb24pIHtcbiAgICAgICAgICBpdGVtUHJpY2UgPSBzaXplT3B0aW9uLnByaWNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGl0ZW1Ub3RhbCA9IGl0ZW1QcmljZSAqIGl0ZW0ucXVhbnRpdHk7XG4gICAgICBzdWJ0b3RhbCArPSBpdGVtVG90YWw7XG5cbiAgICAgIHZhbGlkYXRlZEl0ZW1zLnB1c2goe1xuICAgICAgICBwcm9kdWN0OiBwcm9kdWN0Ll9pZCxcbiAgICAgICAgbmFtZTogcHJvZHVjdC5uYW1lLFxuICAgICAgICBwcmljZTogaXRlbVByaWNlLFxuICAgICAgICBxdWFudGl0eTogaXRlbS5xdWFudGl0eSxcbiAgICAgICAgc2l6ZTogaXRlbS5zaXplIHx8ICdSZWd1bGFyJyxcbiAgICAgICAgY3VzdG9taXphdGlvbnM6IGl0ZW0uY3VzdG9taXphdGlvbnMgfHwgW11cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSB0YXggKDglIGZvciBleGFtcGxlKVxuICAgIGNvbnN0IHRheCA9IHN1YnRvdGFsICogMC4wODtcbiAgICBjb25zdCB0b3RhbCA9IHN1YnRvdGFsICsgdGF4O1xuXG4gICAgLy8gR2VuZXJhdGUgdW5pcXVlIG9yZGVyIG51bWJlclxuICAgIGNvbnN0IG9yZGVyTnVtYmVyID0gYE9SRC0ke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDQpLnRvVXBwZXJDYXNlKCl9YDtcblxuICAgIC8vIENyZWF0ZSBvcmRlclxuICAgIGNvbnN0IG9yZGVyID0gbmV3IE9yZGVyKHtcbiAgICAgIG9yZGVyTnVtYmVyLFxuICAgICAgY3VzdG9tZXI6IHJlcS51c2VyLmlkLFxuICAgICAgaXRlbXM6IHZhbGlkYXRlZEl0ZW1zLFxuICAgICAgc3VidG90YWwsXG4gICAgICB0YXgsXG4gICAgICB0b3RhbCxcbiAgICAgIG9yZGVyVHlwZSxcbiAgICAgIHBheW1lbnRNZXRob2QsXG4gICAgICBkZWxpdmVyeUFkZHJlc3M6IG9yZGVyVHlwZSA9PT0gJ2RlbGl2ZXJ5JyA/IGRlbGl2ZXJ5QWRkcmVzcyA6IHVuZGVmaW5lZCxcbiAgICAgIG5vdGVzOiBub3RlcyB8fCAnJyxcbiAgICAgIGxveWFsdHlQb2ludHNFYXJuZWQ6IE1hdGguZmxvb3IodG90YWwgKiAwLjEpIC8vIDEwJSBvZiB0b3RhbCBhcyBwb2ludHNcbiAgICB9KTtcblxuICAgIGF3YWl0IG9yZGVyLnNhdmUoKTtcblxuICAgIC8vIFBvcHVsYXRlIHRoZSBvcmRlciBiZWZvcmUgc2VuZGluZyByZXNwb25zZVxuICAgIGF3YWl0IG9yZGVyLnBvcHVsYXRlKCdpdGVtcy5wcm9kdWN0JywgJ25hbWUgY2F0ZWdvcnkgaW1hZ2UnKTtcblxuICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBvcmRlcixcbiAgICAgIG1lc3NhZ2U6ICdPcmRlciBjcmVhdGVkIHN1Y2Nlc3NmdWxseSdcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBvcmRlcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGNyZWF0aW5nIG9yZGVyJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUFVUIC9hcGkvb3JkZXJzLzppZC9zdGF0dXNcbi8vIEBkZXNjICAgIFVwZGF0ZSBvcmRlciBzdGF0dXMgKGZvciBhZG1pbiB1c2UpXG4vLyBAYWNjZXNzICBQcml2YXRlXG5yb3V0ZXIucHV0KCcvOmlkL3N0YXR1cycsIGF1dGgsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgc3RhdHVzIH0gPSByZXEuYm9keTtcbiAgICBjb25zdCB2YWxpZFN0YXR1c2VzID0gWydwZW5kaW5nJywgJ2NvbmZpcm1lZCcsICdwcmVwYXJpbmcnLCAncmVhZHknLCAnY29tcGxldGVkJywgJ2NhbmNlbGxlZCddO1xuXG4gICAgaWYgKCFzdGF0dXMgfHwgIXZhbGlkU3RhdHVzZXMuaW5jbHVkZXMoc3RhdHVzKSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdWYWxpZCBzdGF0dXMgaXMgcmVxdWlyZWQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpO1xuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBvd25zIHRoZSBvcmRlciBvciBpcyBhZG1pbiAoZm9yIG5vdywgYWxsb3cgdXNlciB0byBjYW5jZWwgdGhlaXIgb3duIG9yZGVycylcbiAgICBpZiAob3JkZXIuY3VzdG9tZXIudG9TdHJpbmcoKSAhPT0gcmVxLnVzZXIuaWQgJiYgc3RhdHVzICE9PSAnY2FuY2VsbGVkJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byB1cGRhdGUgdGhpcyBvcmRlcidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE9ubHkgYWxsb3cgY2FuY2VsbGF0aW9uIGlmIG9yZGVyIGlzIHN0aWxsIHBlbmRpbmcgb3IgY29uZmlybWVkXG4gICAgaWYgKHN0YXR1cyA9PT0gJ2NhbmNlbGxlZCcgJiYgIVsncGVuZGluZycsICdjb25maXJtZWQnXS5pbmNsdWRlcyhvcmRlci5zdGF0dXMpKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIGNhbm5vdCBiZSBjYW5jZWxsZWQgYXQgdGhpcyBzdGFnZSdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIG9yZGVyLnN0YXR1cyA9IHN0YXR1cztcbiAgICBpZiAoc3RhdHVzID09PSAnY29tcGxldGVkJykge1xuICAgICAgb3JkZXIuYWN0dWFsQ29tcGxldGlvblRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgIH1cblxuICAgIGF3YWl0IG9yZGVyLnNhdmUoKTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBvcmRlcixcbiAgICAgIG1lc3NhZ2U6ICdPcmRlciBzdGF0dXMgdXBkYXRlZCBzdWNjZXNzZnVsbHknXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgb3JkZXIgc3RhdHVzOicsIGVycm9yKTtcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0Nhc3RFcnJvcicpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBvcmRlciBJRCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgdXBkYXRpbmcgb3JkZXIgc3RhdHVzJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgREVMRVRFIC9hcGkvb3JkZXJzLzppZFxuLy8gQGRlc2MgICAgQ2FuY2VsL0RlbGV0ZSBvcmRlciAob25seSBpZiBwZW5kaW5nKVxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxucm91dGVyLmRlbGV0ZSgnLzppZCcsIGF1dGgsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXIuZmluZE9uZSh7XG4gICAgICBfaWQ6IHJlcS5wYXJhbXMuaWQsXG4gICAgICBjdXN0b21lcjogcmVxLnVzZXIuaWRcbiAgICB9KTtcblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gT25seSBhbGxvdyBkZWxldGlvbiBpZiBvcmRlciBpcyBwZW5kaW5nXG4gICAgaWYgKG9yZGVyLnN0YXR1cyAhPT0gJ3BlbmRpbmcnKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09ubHkgcGVuZGluZyBvcmRlcnMgY2FuIGJlIGNhbmNlbGxlZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIG9yZGVyLnN0YXR1cyA9ICdjYW5jZWxsZWQnO1xuICAgIGF3YWl0IG9yZGVyLnNhdmUoKTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnT3JkZXIgY2FuY2VsbGVkIHN1Y2Nlc3NmdWxseSdcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjYW5jZWxsaW5nIG9yZGVyOicsIGVycm9yKTtcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0Nhc3RFcnJvcicpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBvcmRlciBJRCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgY2FuY2VsbGluZyBvcmRlcidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL29yZGVycy9zdGF0cy9zdW1tYXJ5XG4vLyBAZGVzYyAgICBHZXQgb3JkZXIgc3RhdGlzdGljcyBmb3IgdXNlclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxucm91dGVyLmdldCgnL3N0YXRzL3N1bW1hcnknLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlci5pZDtcblxuICAgIC8vIEdldCBvcmRlciBjb3VudHMgYnkgc3RhdHVzXG4gICAgY29uc3Qgc3RhdHVzQ291bnRzID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHsgJG1hdGNoOiB7IGN1c3RvbWVyOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCh1c2VySWQpIH0gfSxcbiAgICAgIHsgJGdyb3VwOiB7IF9pZDogJyRzdGF0dXMnLCBjb3VudDogeyAkc3VtOiAxIH0gfSB9XG4gICAgXSk7XG5cbiAgICAvLyBHZXQgdG90YWwgc3BlbnRcbiAgICBjb25zdCB0b3RhbFNwZW50ID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHsgXG4gICAgICAgICRtYXRjaDogeyBcbiAgICAgICAgICBjdXN0b21lcjogbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQodXNlcklkKSxcbiAgICAgICAgICBzdGF0dXM6IHsgJGluOiBbJ2NvbXBsZXRlZCcsICdyZWFkeSddIH1cbiAgICAgICAgfSBcbiAgICAgIH0sXG4gICAgICB7ICRncm91cDogeyBfaWQ6IG51bGwsIHRvdGFsOiB7ICRzdW06ICckdG90YWwnIH0gfSB9XG4gICAgXSk7XG5cbiAgICAvLyBHZXQgcmVjZW50IG9yZGVycyBjb3VudCAobGFzdCAzMCBkYXlzKVxuICAgIGNvbnN0IHRoaXJ0eURheXNBZ28gPSBuZXcgRGF0ZSgpO1xuICAgIHRoaXJ0eURheXNBZ28uc2V0RGF0ZSh0aGlydHlEYXlzQWdvLmdldERhdGUoKSAtIDMwKTtcbiAgICBcbiAgICBjb25zdCByZWNlbnRPcmRlcnNDb3VudCA9IGF3YWl0IE9yZGVyLmNvdW50RG9jdW1lbnRzKHtcbiAgICAgIGN1c3RvbWVyOiB1c2VySWQsXG4gICAgICBjcmVhdGVkQXQ6IHsgJGd0ZTogdGhpcnR5RGF5c0FnbyB9XG4gICAgfSk7XG5cbiAgICAvLyBHZXQgbG95YWx0eSBwb2ludHNcbiAgICBjb25zdCBsb3lhbHR5UG9pbnRzID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHsgJG1hdGNoOiB7IGN1c3RvbWVyOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCh1c2VySWQpIH0gfSxcbiAgICAgIHsgXG4gICAgICAgICRncm91cDogeyBcbiAgICAgICAgICBfaWQ6IG51bGwsIFxuICAgICAgICAgIGVhcm5lZDogeyAkc3VtOiAnJGxveWFsdHlQb2ludHNFYXJuZWQnIH0sXG4gICAgICAgICAgdXNlZDogeyAkc3VtOiAnJGxveWFsdHlQb2ludHNVc2VkJyB9XG4gICAgICAgIH0gXG4gICAgICB9XG4gICAgXSk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBzdGF0dXNDb3VudHM6IHN0YXR1c0NvdW50cy5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xuICAgICAgICAgIGFjY1tpdGVtLl9pZF0gPSBpdGVtLmNvdW50O1xuICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIHt9KSxcbiAgICAgICAgdG90YWxTcGVudDogdG90YWxTcGVudFswXT8udG90YWwgfHwgMCxcbiAgICAgICAgcmVjZW50T3JkZXJzQ291bnQsXG4gICAgICAgIGxveWFsdHlQb2ludHM6IHtcbiAgICAgICAgICBlYXJuZWQ6IGxveWFsdHlQb2ludHNbMF0/LmVhcm5lZCB8fCAwLFxuICAgICAgICAgIHVzZWQ6IGxveWFsdHlQb2ludHNbMF0/LnVzZWQgfHwgMCxcbiAgICAgICAgICBhdmFpbGFibGU6IChsb3lhbHR5UG9pbnRzWzBdPy5lYXJuZWQgfHwgMCkgLSAobG95YWx0eVBvaW50c1swXT8udXNlZCB8fCAwKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgb3JkZXIgc3RhdGlzdGljczonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIG9yZGVyIHN0YXRpc3RpY3MnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTUMsS0FBSyxHQUFHSCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDeEMsTUFBTUksT0FBTyxHQUFHSixPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDNUMsTUFBTTtF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","map":{"version":3,"names":["express","require","router","Router","Order","Product","protect","auth","get","req","res","page","parseInt","query","limit","skip","status","customer","user","id","orders","find","populate","sort","createdAt","total","countDocuments","json","success","data","pagination","current","pages","Math","ceil","error","console","message","order","findOne","_id","params","name","post","items","orderType","paymentMethod","deliveryAddress","notes","body","Array","isArray","length","includes","street","city","subtotal","validatedItems","item","product","findById","quantity","itemPrice","price","size","sizes","sizeOption","s","itemTotal","push","customizations","tax","orderNumber","Date","now","random","toString","substr","toUpperCase","undefined","loyaltyPointsEarned","floor","save","put","validStatuses","actualCompletionTime","delete","userId","statusCounts","aggregate","$match","mongoose","Types","ObjectId","$group","count","$sum","totalSpent","$in","thirtyDaysAgo","setDate","getDate","recentOrdersCount","$gte","loyaltyPoints","earned","used","reduce","acc","available","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["orders.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst Order = require('../models/Order');\nconst Product = require('../models/Product');\nconst { protect: auth } = require('../middleware/auth');\n\n// @route   GET /api/orders\n// @desc    Get all orders for authenticated user\n// @access  Private\nrouter.get('/', auth, async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const skip = (page - 1) * limit;\n    const status = req.query.status;\n\n    // Build query\n    const query = { customer: req.user.id };\n    if (status && status !== 'all') {\n      query.status = status;\n    }\n\n    // Get orders with pagination\n    const orders = await Order.find(query)\n      .populate('items.product', 'name category image')\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(limit);\n\n    // Get total count for pagination\n    const total = await Order.countDocuments(query);\n\n    res.json({\n      success: true,\n      data: orders,\n      pagination: {\n        current: page,\n        pages: Math.ceil(total / limit),\n        total\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching orders'\n    });\n  }\n});\n\n// @route   GET /api/orders/:id\n// @desc    Get single order by ID\n// @access  Private\nrouter.get('/:id', auth, async (req, res) => {\n  try {\n    const order = await Order.findOne({\n      _id: req.params.id,\n      customer: req.user.id\n    }).populate('items.product', 'name category image description');\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    res.json({\n      success: true,\n      data: order\n    });\n  } catch (error) {\n    console.error('Error fetching order:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order'\n    });\n  }\n});\n\n// @route   POST /api/orders\n// @desc    Create new order\n// @access  Private\nrouter.post('/', auth, async (req, res) => {\n  try {\n    const {\n      items,\n      orderType,\n      paymentMethod,\n      deliveryAddress,\n      notes\n    } = req.body;\n\n    // Validate required fields\n    if (!items || !Array.isArray(items) || items.length === 0) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order must contain at least one item'\n      });\n    }\n\n    if (!orderType || !['pickup', 'delivery', 'dine-in'].includes(orderType)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid order type is required'\n      });\n    }\n\n    if (!paymentMethod || !['cash', 'card', 'digital_wallet', 'momo', 'vnpay'].includes(paymentMethod)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid payment method is required'\n      });\n    }\n\n    // Validate delivery address for delivery orders\n    if (orderType === 'delivery') {\n      if (!deliveryAddress || !deliveryAddress.street || !deliveryAddress.city) {\n        return res.status(400).json({\n          success: false,\n          message: 'Delivery address is required for delivery orders'\n        });\n      }\n    }\n\n    // Validate and calculate order totals\n    let subtotal = 0;\n    const validatedItems = [];\n\n    for (const item of items) {\n      // Validate product exists\n      const product = await Product.findById(item.product);\n      if (!product) {\n        return res.status(400).json({\n          success: false,\n          message: `Product with ID ${item.product} not found`\n        });\n      }\n\n      // Validate quantity\n      if (!item.quantity || item.quantity < 1) {\n        return res.status(400).json({\n          success: false,\n          message: 'Item quantity must be at least 1'\n        });\n      }\n\n      // Calculate item price (base price or size-specific price)\n      let itemPrice = product.price;\n      if (item.size && product.sizes && product.sizes.length > 0) {\n        const sizeOption = product.sizes.find(s => s.name === item.size);\n        if (sizeOption) {\n          itemPrice = sizeOption.price;\n        }\n      }\n\n      const itemTotal = itemPrice * item.quantity;\n      subtotal += itemTotal;\n\n      validatedItems.push({\n        product: product._id,\n        name: product.name,\n        price: itemPrice,\n        quantity: item.quantity,\n        size: item.size || 'Regular',\n        customizations: item.customizations || []\n      });\n    }\n\n    // Calculate tax (8% for example)\n    const tax = subtotal * 0.08;\n    const total = subtotal + tax;\n\n    // Generate unique order number\n    const orderNumber = `ORD-${Date.now()}-${Math.random().toString(36).substr(2, 4).toUpperCase()}`;\n\n    // Create order\n    const order = new Order({\n      orderNumber,\n      customer: req.user.id,\n      items: validatedItems,\n      subtotal,\n      tax,\n      total,\n      orderType,\n      paymentMethod,\n      deliveryAddress: orderType === 'delivery' ? deliveryAddress : undefined,\n      notes: notes || '',\n      loyaltyPointsEarned: Math.floor(total * 0.1) // 10% of total as points\n    });\n\n    await order.save();\n\n    // Populate the order before sending response\n    await order.populate('items.product', 'name category image');\n\n    res.status(201).json({\n      success: true,\n      data: order,\n      message: 'Order created successfully'\n    });\n  } catch (error) {\n    console.error('Error creating order:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating order'\n    });\n  }\n});\n\n// @route   PUT /api/orders/:id/status\n// @desc    Update order status (for admin use)\n// @access  Private\nrouter.put('/:id/status', auth, async (req, res) => {\n  try {\n    const { status } = req.body;\n    const validStatuses = ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'];\n\n    if (!status || !validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Valid status is required'\n      });\n    }\n\n    const order = await Order.findById(req.params.id);\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if user owns the order or is admin (for now, allow user to cancel their own orders)\n    if (order.customer.toString() !== req.user.id && status !== 'cancelled') {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to update this order'\n      });\n    }\n\n    // Only allow cancellation if order is still pending or confirmed\n    if (status === 'cancelled' && !['pending', 'confirmed'].includes(order.status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order cannot be cancelled at this stage'\n      });\n    }\n\n    order.status = status;\n    if (status === 'completed') {\n      order.actualCompletionTime = new Date();\n    }\n\n    await order.save();\n\n    res.json({\n      success: true,\n      data: order,\n      message: 'Order status updated successfully'\n    });\n  } catch (error) {\n    console.error('Error updating order status:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating order status'\n    });\n  }\n});\n\n// @route   DELETE /api/orders/:id\n// @desc    Cancel/Delete order (only if pending)\n// @access  Private\nrouter.delete('/:id', auth, async (req, res) => {\n  try {\n    const order = await Order.findOne({\n      _id: req.params.id,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Only allow deletion if order is pending\n    if (order.status !== 'pending') {\n      return res.status(400).json({\n        success: false,\n        message: 'Only pending orders can be cancelled'\n      });\n    }\n\n    order.status = 'cancelled';\n    await order.save();\n\n    res.json({\n      success: true,\n      message: 'Order cancelled successfully'\n    });\n  } catch (error) {\n    console.error('Error cancelling order:', error);\n    if (error.name === 'CastError') {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order ID'\n      });\n    }\n    res.status(500).json({\n      success: false,\n      message: 'Server error while cancelling order'\n    });\n  }\n});\n\n// @route   GET /api/orders/stats/summary\n// @desc    Get order statistics for user\n// @access  Private\nrouter.get('/stats/summary', auth, async (req, res) => {\n  try {\n    const userId = req.user.id;\n\n    // Get order counts by status\n    const statusCounts = await Order.aggregate([\n      { $match: { customer: mongoose.Types.ObjectId(userId) } },\n      { $group: { _id: '$status', count: { $sum: 1 } } }\n    ]);\n\n    // Get total spent\n    const totalSpent = await Order.aggregate([\n      { \n        $match: { \n          customer: mongoose.Types.ObjectId(userId),\n          status: { $in: ['completed', 'ready'] }\n        } \n      },\n      { $group: { _id: null, total: { $sum: '$total' } } }\n    ]);\n\n    // Get recent orders count (last 30 days)\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n    \n    const recentOrdersCount = await Order.countDocuments({\n      customer: userId,\n      createdAt: { $gte: thirtyDaysAgo }\n    });\n\n    // Get loyalty points\n    const loyaltyPoints = await Order.aggregate([\n      { $match: { customer: mongoose.Types.ObjectId(userId) } },\n      { \n        $group: { \n          _id: null, \n          earned: { $sum: '$loyaltyPointsEarned' },\n          used: { $sum: '$loyaltyPointsUsed' }\n        } \n      }\n    ]);\n\n    res.json({\n      success: true,\n      data: {\n        statusCounts: statusCounts.reduce((acc, item) => {\n          acc[item._id] = item.count;\n          return acc;\n        }, {}),\n        totalSpent: totalSpent[0]?.total || 0,\n        recentOrdersCount,\n        loyaltyPoints: {\n          earned: loyaltyPoints[0]?.earned || 0,\n          used: loyaltyPoints[0]?.used || 0,\n          available: (loyaltyPoints[0]?.earned || 0) - (loyaltyPoints[0]?.used || 0)\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching order statistics:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order statistics'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1756971338295},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\Order.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const mongoose = require('mongoose');\nconst orderItemSchema = new mongoose.Schema({\n  product: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Product',\n    required: true\n  },\n  name: {\n    type: String,\n    required: true\n  },\n  price: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  quantity: {\n    type: Number,\n    required: true,\n    min: 1\n  },\n  size: {\n    type: String,\n    default: 'Regular'\n  },\n  customizations: [{\n    type: String,\n    trim: true\n  }]\n});\nconst orderSchema = new mongoose.Schema({\n  orderNumber: {\n    type: String,\n    unique: true,\n    required: true\n  },\n  customer: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'User',\n    required: true\n  },\n  items: [orderItemSchema],\n  subtotal: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  tax: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  total: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  status: {\n    type: String,\n    enum: ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'],\n    default: 'pending'\n  },\n  orderType: {\n    type: String,\n    enum: ['pickup', 'delivery', 'dine-in'],\n    required: true\n  },\n  paymentMethod: {\n    type: String,\n    enum: ['cash', 'card', 'digital_wallet', 'momo', 'vnpay'],\n    required: true\n  },\n  paymentStatus: {\n    type: String,\n    enum: ['pending', 'paid', 'failed', 'refunded'],\n    default: 'pending'\n  },\n  // MoMo payment transaction details\n  momoTransaction: {\n    requestId: String,\n    transId: String,\n    payUrl: String,\n    deeplink: String,\n    qrCodeUrl: String,\n    resultCode: Number,\n    message: String,\n    responseTime: String,\n    payType: String\n  },\n  deliveryAddress: {\n    street: String,\n    city: String,\n    state: String,\n    zipCode: String,\n    instructions: String\n  },\n  estimatedTime: {\n    type: Date\n  },\n  actualCompletionTime: {\n    type: Date\n  },\n  notes: {\n    type: String,\n    maxlength: 500\n  },\n  loyaltyPointsEarned: {\n    type: Number,\n    default: 0,\n    min: 0\n  },\n  loyaltyPointsUsed: {\n    type: Number,\n    default: 0,\n    min: 0\n  },\n  // Promotional code information\n  promoCode: {\n    code: String,\n    type: String,\n    value: Number,\n    description: String\n  },\n  discount: {\n    type: Number,\n    default: 0,\n    min: 0\n  }\n}, {\n  timestamps: true\n});\n\n// Index for better performance\norderSchema.index({\n  customer: 1\n});\norderSchema.index({\n  orderNumber: 1\n});\norderSchema.index({\n  status: 1\n});\norderSchema.index({\n  createdAt: -1\n});\n\n// Generate order number before saving\norderSchema.pre('save', async function (next) {\n  if (this.isNew) {\n    const date = new Date();\n    const dateStr = date.toISOString().slice(0, 10).replace(/-/g, '');\n    const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');\n    this.orderNumber = `WC${dateStr}${randomNum}`;\n  }\n  next();\n});\n\n// Calculate estimated completion time\norderSchema.methods.calculateEstimatedTime = function () {\n  const baseTime = 15; // 15 minutes base time\n  const itemTime = this.items.reduce((total, item) => total + item.quantity * 2, 0);\n  const estimatedMinutes = baseTime + itemTime;\n  this.estimatedTime = new Date(Date.now() + estimatedMinutes * 60000);\n  return this.estimatedTime;\n};\nmodule.exports = mongoose.model('Order', orderSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJvcmRlckl0ZW1TY2hlbWEiLCJTY2hlbWEiLCJwcm9kdWN0IiwidHlwZSIsIlR5cGVzIiwiT2JqZWN0SWQiLCJyZWYiLCJyZXF1aXJlZCIsIm5hbWUiLCJTdHJpbmciLCJwcmljZSIsIk51bWJlciIsIm1pbiIsInF1YW50aXR5Iiwic2l6ZSIsImRlZmF1bHQiLCJjdXN0b21pemF0aW9ucyIsInRyaW0iLCJvcmRlclNjaGVtYSIsIm9yZGVyTnVtYmVyIiwidW5pcXVlIiwiY3VzdG9tZXIiLCJpdGVtcyIsInN1YnRvdGFsIiwidGF4IiwidG90YWwiLCJzdGF0dXMiLCJlbnVtIiwib3JkZXJUeXBlIiwicGF5bWVudE1ldGhvZCIsInBheW1lbnRTdGF0dXMiLCJtb21vVHJhbnNhY3Rpb24iLCJyZXF1ZXN0SWQiLCJ0cmFuc0lkIiwicGF5VXJsIiwiZGVlcGxpbmsiLCJxckNvZGVVcmwiLCJyZXN1bHRDb2RlIiwibWVzc2FnZSIsInJlc3BvbnNlVGltZSIsInBheVR5cGUiLCJkZWxpdmVyeUFkZHJlc3MiLCJzdHJlZXQiLCJjaXR5Iiwic3RhdGUiLCJ6aXBDb2RlIiwiaW5zdHJ1Y3Rpb25zIiwiZXN0aW1hdGVkVGltZSIsIkRhdGUiLCJhY3R1YWxDb21wbGV0aW9uVGltZSIsIm5vdGVzIiwibWF4bGVuZ3RoIiwibG95YWx0eVBvaW50c0Vhcm5lZCIsImxveWFsdHlQb2ludHNVc2VkIiwicHJvbW9Db2RlIiwiY29kZSIsInZhbHVlIiwiZGVzY3JpcHRpb24iLCJkaXNjb3VudCIsInRpbWVzdGFtcHMiLCJpbmRleCIsImNyZWF0ZWRBdCIsInByZSIsIm5leHQiLCJpc05ldyIsImRhdGUiLCJkYXRlU3RyIiwidG9JU09TdHJpbmciLCJzbGljZSIsInJlcGxhY2UiLCJyYW5kb21OdW0iLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJ0b1N0cmluZyIsInBhZFN0YXJ0IiwibWV0aG9kcyIsImNhbGN1bGF0ZUVzdGltYXRlZFRpbWUiLCJiYXNlVGltZSIsIml0ZW1UaW1lIiwicmVkdWNlIiwiaXRlbSIsImVzdGltYXRlZE1pbnV0ZXMiLCJub3ciLCJtb2R1bGUiLCJleHBvcnRzIiwibW9kZWwiXSwic291cmNlUm9vdCI6IkQ6XFxjb2RlXFxXZWJDYWZmZVxcYmFja2VuZFxcc3JjXFxtb2RlbHNcXCIsInNvdXJjZXMiOlsiT3JkZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuXG5jb25zdCBvcmRlckl0ZW1TY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcbiAgcHJvZHVjdDoge1xuICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcbiAgICByZWY6ICdQcm9kdWN0JyxcbiAgICByZXF1aXJlZDogdHJ1ZVxuICB9LFxuICBuYW1lOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiB0cnVlXG4gIH0sXG4gIHByaWNlOiB7XG4gICAgdHlwZTogTnVtYmVyLFxuICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgIG1pbjogMFxuICB9LFxuICBxdWFudGl0eToge1xuICAgIHR5cGU6IE51bWJlcixcbiAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICBtaW46IDFcbiAgfSxcbiAgc2l6ZToge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICBkZWZhdWx0OiAnUmVndWxhcidcbiAgfSxcbiAgY3VzdG9taXphdGlvbnM6IFt7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHRyaW06IHRydWVcbiAgfV1cbn0pO1xuXG5jb25zdCBvcmRlclNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICBvcmRlck51bWJlcjoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICB1bmlxdWU6IHRydWUsXG4gICAgcmVxdWlyZWQ6IHRydWVcbiAgfSxcbiAgY3VzdG9tZXI6IHtcbiAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXG4gICAgcmVmOiAnVXNlcicsXG4gICAgcmVxdWlyZWQ6IHRydWVcbiAgfSxcbiAgaXRlbXM6IFtvcmRlckl0ZW1TY2hlbWFdLFxuICBzdWJ0b3RhbDoge1xuICAgIHR5cGU6IE51bWJlcixcbiAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICBtaW46IDBcbiAgfSxcbiAgdGF4OiB7XG4gICAgdHlwZTogTnVtYmVyLFxuICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgIG1pbjogMFxuICB9LFxuICB0b3RhbDoge1xuICAgIHR5cGU6IE51bWJlcixcbiAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICBtaW46IDBcbiAgfSxcbiAgc3RhdHVzOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIGVudW06IFsncGVuZGluZycsICdjb25maXJtZWQnLCAncHJlcGFyaW5nJywgJ3JlYWR5JywgJ2NvbXBsZXRlZCcsICdjYW5jZWxsZWQnXSxcbiAgICBkZWZhdWx0OiAncGVuZGluZydcbiAgfSxcbiAgb3JkZXJUeXBlOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIGVudW06IFsncGlja3VwJywgJ2RlbGl2ZXJ5JywgJ2RpbmUtaW4nXSxcbiAgICByZXF1aXJlZDogdHJ1ZVxuICB9LFxuICBwYXltZW50TWV0aG9kOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIGVudW06IFsnY2FzaCcsICdjYXJkJywgJ2RpZ2l0YWxfd2FsbGV0JywgJ21vbW8nLCAndm5wYXknXSxcbiAgICByZXF1aXJlZDogdHJ1ZVxuICB9LFxuICBwYXltZW50U3RhdHVzOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIGVudW06IFsncGVuZGluZycsICdwYWlkJywgJ2ZhaWxlZCcsICdyZWZ1bmRlZCddLFxuICAgIGRlZmF1bHQ6ICdwZW5kaW5nJ1xuICB9LFxuICAvLyBNb01vIHBheW1lbnQgdHJhbnNhY3Rpb24gZGV0YWlsc1xuICBtb21vVHJhbnNhY3Rpb246IHtcbiAgICByZXF1ZXN0SWQ6IFN0cmluZyxcbiAgICB0cmFuc0lkOiBTdHJpbmcsXG4gICAgcGF5VXJsOiBTdHJpbmcsXG4gICAgZGVlcGxpbms6IFN0cmluZyxcbiAgICBxckNvZGVVcmw6IFN0cmluZyxcbiAgICByZXN1bHRDb2RlOiBOdW1iZXIsXG4gICAgbWVzc2FnZTogU3RyaW5nLFxuICAgIHJlc3BvbnNlVGltZTogU3RyaW5nLFxuICAgIHBheVR5cGU6IFN0cmluZ1xuICB9LFxuICBkZWxpdmVyeUFkZHJlc3M6IHtcbiAgICBzdHJlZXQ6IFN0cmluZyxcbiAgICBjaXR5OiBTdHJpbmcsXG4gICAgc3RhdGU6IFN0cmluZyxcbiAgICB6aXBDb2RlOiBTdHJpbmcsXG4gICAgaW5zdHJ1Y3Rpb25zOiBTdHJpbmdcbiAgfSxcbiAgZXN0aW1hdGVkVGltZToge1xuICAgIHR5cGU6IERhdGVcbiAgfSxcbiAgYWN0dWFsQ29tcGxldGlvblRpbWU6IHtcbiAgICB0eXBlOiBEYXRlXG4gIH0sXG4gIG5vdGVzOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIG1heGxlbmd0aDogNTAwXG4gIH0sXG4gIGxveWFsdHlQb2ludHNFYXJuZWQ6IHtcbiAgICB0eXBlOiBOdW1iZXIsXG4gICAgZGVmYXVsdDogMCxcbiAgICBtaW46IDBcbiAgfSxcbiAgbG95YWx0eVBvaW50c1VzZWQ6IHtcbiAgICB0eXBlOiBOdW1iZXIsXG4gICAgZGVmYXVsdDogMCxcbiAgICBtaW46IDBcbiAgfSxcbiAgLy8gUHJvbW90aW9uYWwgY29kZSBpbmZvcm1hdGlvblxuICBwcm9tb0NvZGU6IHtcbiAgICBjb2RlOiBTdHJpbmcsXG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHZhbHVlOiBOdW1iZXIsXG4gICAgZGVzY3JpcHRpb246IFN0cmluZ1xuICB9LFxuICBkaXNjb3VudDoge1xuICAgIHR5cGU6IE51bWJlcixcbiAgICBkZWZhdWx0OiAwLFxuICAgIG1pbjogMFxuICB9XG59LCB7XG4gIHRpbWVzdGFtcHM6IHRydWVcbn0pO1xuXG4vLyBJbmRleCBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG5vcmRlclNjaGVtYS5pbmRleCh7IGN1c3RvbWVyOiAxIH0pO1xub3JkZXJTY2hlbWEuaW5kZXgoeyBvcmRlck51bWJlcjogMSB9KTtcbm9yZGVyU2NoZW1hLmluZGV4KHsgc3RhdHVzOiAxIH0pO1xub3JkZXJTY2hlbWEuaW5kZXgoeyBjcmVhdGVkQXQ6IC0xIH0pO1xuXG4vLyBHZW5lcmF0ZSBvcmRlciBudW1iZXIgYmVmb3JlIHNhdmluZ1xub3JkZXJTY2hlbWEucHJlKCdzYXZlJywgYXN5bmMgZnVuY3Rpb24obmV4dCkge1xuICBpZiAodGhpcy5pc05ldykge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGRhdGVTdHIgPSBkYXRlLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwgMTApLnJlcGxhY2UoLy0vZywgJycpO1xuICAgIGNvbnN0IHJhbmRvbU51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDApLnRvU3RyaW5nKCkucGFkU3RhcnQoMywgJzAnKTtcbiAgICB0aGlzLm9yZGVyTnVtYmVyID0gYFdDJHtkYXRlU3RyfSR7cmFuZG9tTnVtfWA7XG4gIH1cbiAgbmV4dCgpO1xufSk7XG5cbi8vIENhbGN1bGF0ZSBlc3RpbWF0ZWQgY29tcGxldGlvbiB0aW1lXG5vcmRlclNjaGVtYS5tZXRob2RzLmNhbGN1bGF0ZUVzdGltYXRlZFRpbWUgPSBmdW5jdGlvbigpIHtcbiAgY29uc3QgYmFzZVRpbWUgPSAxNTsgLy8gMTUgbWludXRlcyBiYXNlIHRpbWVcbiAgY29uc3QgaXRlbVRpbWUgPSB0aGlzLml0ZW1zLnJlZHVjZSgodG90YWwsIGl0ZW0pID0+IHRvdGFsICsgKGl0ZW0ucXVhbnRpdHkgKiAyKSwgMCk7XG4gIGNvbnN0IGVzdGltYXRlZE1pbnV0ZXMgPSBiYXNlVGltZSArIGl0ZW1UaW1lO1xuICBcbiAgdGhpcy5lc3RpbWF0ZWRUaW1lID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIGVzdGltYXRlZE1pbnV0ZXMgKiA2MDAwMCk7XG4gIHJldHVybiB0aGlzLmVzdGltYXRlZFRpbWU7XG59O1xuXG5tb2R1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","map":{"version":3,"names":["mongoose","require","orderItemSchema","Schema","product","type","Types","ObjectId","ref","required","name","String","price","Number","min","quantity","size","default","customizations","trim","orderSchema","orderNumber","unique","customer","items","subtotal","tax","total","status","enum","orderType","paymentMethod","paymentStatus","momoTransaction","requestId","transId","payUrl","deeplink","qrCodeUrl","resultCode","message","responseTime","payType","deliveryAddress","street","city","state","zipCode","instructions","estimatedTime","Date","actualCompletionTime","notes","maxlength","loyaltyPointsEarned","loyaltyPointsUsed","promoCode","code","value","description","discount","timestamps","index","createdAt","pre","next","isNew","date","dateStr","toISOString","slice","replace","randomNum","Math","floor","random","toString","padStart","methods","calculateEstimatedTime","baseTime","itemTime","reduce","item","estimatedMinutes","now","module","exports","model"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\models\\","sources":["Order.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst orderItemSchema = new mongoose.Schema({\n  product: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Product',\n    required: true\n  },\n  name: {\n    type: String,\n    required: true\n  },\n  price: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  quantity: {\n    type: Number,\n    required: true,\n    min: 1\n  },\n  size: {\n    type: String,\n    default: 'Regular'\n  },\n  customizations: [{\n    type: String,\n    trim: true\n  }]\n});\n\nconst orderSchema = new mongoose.Schema({\n  orderNumber: {\n    type: String,\n    unique: true,\n    required: true\n  },\n  customer: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'User',\n    required: true\n  },\n  items: [orderItemSchema],\n  subtotal: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  tax: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  total: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  status: {\n    type: String,\n    enum: ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'],\n    default: 'pending'\n  },\n  orderType: {\n    type: String,\n    enum: ['pickup', 'delivery', 'dine-in'],\n    required: true\n  },\n  paymentMethod: {\n    type: String,\n    enum: ['cash', 'card', 'digital_wallet', 'momo', 'vnpay'],\n    required: true\n  },\n  paymentStatus: {\n    type: String,\n    enum: ['pending', 'paid', 'failed', 'refunded'],\n    default: 'pending'\n  },\n  // MoMo payment transaction details\n  momoTransaction: {\n    requestId: String,\n    transId: String,\n    payUrl: String,\n    deeplink: String,\n    qrCodeUrl: String,\n    resultCode: Number,\n    message: String,\n    responseTime: String,\n    payType: String\n  },\n  deliveryAddress: {\n    street: String,\n    city: String,\n    state: String,\n    zipCode: String,\n    instructions: String\n  },\n  estimatedTime: {\n    type: Date\n  },\n  actualCompletionTime: {\n    type: Date\n  },\n  notes: {\n    type: String,\n    maxlength: 500\n  },\n  loyaltyPointsEarned: {\n    type: Number,\n    default: 0,\n    min: 0\n  },\n  loyaltyPointsUsed: {\n    type: Number,\n    default: 0,\n    min: 0\n  },\n  // Promotional code information\n  promoCode: {\n    code: String,\n    type: String,\n    value: Number,\n    description: String\n  },\n  discount: {\n    type: Number,\n    default: 0,\n    min: 0\n  }\n}, {\n  timestamps: true\n});\n\n// Index for better performance\norderSchema.index({ customer: 1 });\norderSchema.index({ orderNumber: 1 });\norderSchema.index({ status: 1 });\norderSchema.index({ createdAt: -1 });\n\n// Generate order number before saving\norderSchema.pre('save', async function(next) {\n  if (this.isNew) {\n    const date = new Date();\n    const dateStr = date.toISOString().slice(0, 10).replace(/-/g, '');\n    const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');\n    this.orderNumber = `WC${dateStr}${randomNum}`;\n  }\n  next();\n});\n\n// Calculate estimated completion time\norderSchema.methods.calculateEstimatedTime = function() {\n  const baseTime = 15; // 15 minutes base time\n  const itemTime = this.items.reduce((total, item) => total + (item.quantity * 2), 0);\n  const estimatedMinutes = baseTime + itemTime;\n  \n  this.estimatedTime = new Date(Date.now() + estimatedMinutes * 60000);\n  return this.estimatedTime;\n};\n\nmodule.exports = mongoose.model('Order', orderSchema);"],"mappings":"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","ignoreList":[]}},"mtime":1756971338293},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\payments.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst Order = require('../models/Order');\nconst momoService = require('../services/momoService');\nconst vnpayConfig = require('../config/vnpay');\nconst {\n  protect: auth\n} = require('../middleware/auth');\n\n// @route   POST /api/payments/momo/create\n// @desc    Create MoMo payment request\n// @access  Private\nrouter.post('/momo/create', auth, async (req, res) => {\n  try {\n    const {\n      orderId,\n      amount,\n      orderInfo\n    } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Validate amount\n    if (amount <= 0 || amount > 50000000) {\n      // MoMo limit is 50M VND\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid payment amount'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // Create MoMo payment request\n    const paymentResult = await momoService.createPayment({\n      orderId,\n      amount: Math.round(amount),\n      // Ensure amount is integer\n      orderInfo: orderInfo || `Payment for DREAM COFFEE order ${orderId}`,\n      extraData: JSON.stringify({\n        userId: req.user.id,\n        orderNumber: orderId\n      })\n    });\n    if (!paymentResult.success) {\n      return res.status(500).json({\n        success: false,\n        message: 'Failed to create MoMo payment',\n        error: paymentResult.error\n      });\n    }\n\n    // Update order with MoMo transaction details\n    order.momoTransaction = {\n      requestId: paymentResult.requestId,\n      payUrl: paymentResult.data.payUrl,\n      deeplink: paymentResult.data.deeplink,\n      qrCodeUrl: paymentResult.data.qrCodeUrl,\n      resultCode: paymentResult.data.resultCode,\n      message: paymentResult.data.message\n    };\n    await order.save();\n    res.json({\n      success: true,\n      data: {\n        payUrl: paymentResult.data.payUrl,\n        deeplink: paymentResult.data.deeplink,\n        qrCodeUrl: paymentResult.data.qrCodeUrl,\n        requestId: paymentResult.requestId,\n        orderId: orderId,\n        amount: amount\n      },\n      message: 'MoMo payment created successfully'\n    });\n  } catch (error) {\n    console.error('MoMo payment creation error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating MoMo payment'\n    });\n  }\n});\n\n// @route   POST /api/payments/momo/callback\n// @desc    Handle MoMo payment callback (IPN)\n// @access  Public\nrouter.post('/momo/callback', async (req, res) => {\n  try {\n    console.log('MoMo callback received:', req.body);\n    const {\n      partnerCode,\n      orderId,\n      requestId,\n      amount,\n      orderInfo,\n      orderType,\n      transId,\n      resultCode,\n      message,\n      payType,\n      responseTime,\n      extraData,\n      signature\n    } = req.body;\n\n    // Verify callback signature\n    const isValidSignature = momoService.verifyCallback(req.body);\n    if (!isValidSignature) {\n      console.error('Invalid MoMo callback signature');\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid signature'\n      });\n    }\n\n    // Find the order\n    const order = await Order.findOne({\n      orderNumber: orderId\n    });\n    if (!order) {\n      console.error(`Order not found for MoMo callback: ${orderId}`);\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Update order with transaction details\n    order.momoTransaction = {\n      ...order.momoTransaction,\n      transId,\n      resultCode: parseInt(resultCode),\n      message,\n      responseTime,\n      payType\n    };\n\n    // Update payment status based on result code\n    if (resultCode === '0') {\n      // Payment successful\n      order.paymentStatus = 'paid';\n      order.status = 'confirmed';\n      console.log(`MoMo payment successful for order: ${orderId}`);\n    } else {\n      // Payment failed\n      order.paymentStatus = 'failed';\n      console.log(`MoMo payment failed for order: ${orderId}, code: ${resultCode}`);\n    }\n    await order.save();\n\n    // Respond to MoMo\n    res.json({\n      success: true,\n      message: 'Callback processed successfully'\n    });\n  } catch (error) {\n    console.error('MoMo callback processing error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while processing callback'\n    });\n  }\n});\n\n// @route   GET /api/payments/momo/status/:orderId\n// @desc    Check MoMo payment status\n// @access  Private\nrouter.get('/momo/status/:orderId', auth, async (req, res) => {\n  try {\n    const {\n      orderId\n    } = req.params;\n\n    // Find the order\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Return payment status\n    res.json({\n      success: true,\n      data: {\n        orderId: order.orderNumber,\n        paymentStatus: order.paymentStatus,\n        orderStatus: order.status,\n        momoTransaction: order.momoTransaction,\n        amount: order.total\n      }\n    });\n  } catch (error) {\n    console.error('Payment status check error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while checking payment status'\n    });\n  }\n});\n\n// @route   POST /api/payments/momo/return\n// @desc    Handle MoMo payment return URL\n// @access  Public\nrouter.get('/momo/return', async (req, res) => {\n  try {\n    const {\n      partnerCode,\n      orderId,\n      requestId,\n      amount,\n      orderInfo,\n      orderType,\n      transId,\n      resultCode,\n      message,\n      payType,\n      responseTime,\n      extraData,\n      signature\n    } = req.query;\n    console.log('MoMo return URL accessed:', req.query);\n\n    // Verify signature\n    const isValidSignature = momoService.verifyCallback(req.query);\n    if (!isValidSignature) {\n      return res.redirect(`${process.env.FRONTEND_URL}/payment/error?message=Invalid signature`);\n    }\n\n    // Redirect based on payment result\n    if (resultCode === '0') {\n      // Payment successful\n      res.redirect(`${process.env.FRONTEND_URL}/payment/success?orderId=${orderId}&transId=${transId}`);\n    } else {\n      // Payment failed\n      res.redirect(`${process.env.FRONTEND_URL}/payment/error?orderId=${orderId}&message=${encodeURIComponent(message)}`);\n    }\n  } catch (error) {\n    console.error('MoMo return URL error:', error);\n    res.redirect(`${process.env.FRONTEND_URL}/payment/error?message=Processing error`);\n  }\n});\n\n// @route   POST /api/payments/vnpay/create\n// @desc    Create VNPay payment request\n// @access  Private\nrouter.post('/vnpay/create', auth, async (req, res) => {\n  try {\n    const {\n      orderId,\n      amount,\n      orderInfo,\n      bankCode\n    } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Validate amount\n    if (amount <= 0 || amount > 500000000) {\n      // VNPay limit is 500M VND\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid payment amount'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // Get client IP address\n    const ipAddr = req.headers['x-forwarded-for'] || req.connection.remoteAddress || req.socket.remoteAddress || (req.connection.socket ? req.connection.socket.remoteAddress : null) || '127.0.0.1';\n\n    // Debug: Log the parameters being sent to VNPay\n    console.log('VNPay Payment Parameters:', {\n      orderId,\n      amount,\n      orderInfo: orderInfo || `Thanh toan don hang ${orderId}`,\n      ipAddr,\n      bankCode\n    });\n\n    // Create payment URL\n    try {\n      const paymentUrl = vnpayConfig.createPaymentUrl(orderId, amount, orderInfo || `Thanh toan don hang ${orderId}`, ipAddr, bankCode);\n      console.log('Generated VNPay URL:', paymentUrl);\n\n      // Update order with payment method\n      await Order.findByIdAndUpdate(order._id, {\n        paymentMethod: 'vnpay',\n        paymentStatus: 'pending'\n      });\n      res.json({\n        success: true,\n        message: 'VNPay payment URL created successfully',\n        data: {\n          paymentUrl,\n          orderId,\n          amount\n        }\n      });\n    } catch (vnpayError) {\n      console.error('VNPay URL creation error:', vnpayError.message);\n      return res.status(400).json({\n        success: false,\n        message: 'Failed to create payment URL: ' + vnpayError.message\n      });\n    }\n  } catch (error) {\n    console.error('VNPay create payment error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Internal server error',\n      error: process.env.NODE_ENV === 'development' ? error.message : undefined\n    });\n  }\n});\n\n// @route   GET /api/payments/vnpay/return\n// @desc    Handle VNPay return URL\n// @access  Public\nrouter.get('/vnpay/return', async (req, res) => {\n  try {\n    const vnp_Params = req.query;\n    const orderId = vnp_Params.vnp_TxnRef;\n    const responseCode = vnp_Params.vnp_ResponseCode;\n    const transactionNo = vnp_Params.vnp_TransactionNo;\n    const amount = vnp_Params.vnp_Amount / 100; // Convert from VND cents\n\n    // Verify the return URL\n    const isValidSignature = vnpayConfig.verifyReturnUrl(vnp_Params);\n    if (!isValidSignature) {\n      return res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Invalid signature`);\n    }\n\n    // Find the order\n    const order = await Order.findOne({\n      orderNumber: orderId\n    });\n    if (!order) {\n      return res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Order not found`);\n    }\n    let paymentStatus = 'failed';\n    let message = vnpayConfig.getPaymentStatus(responseCode);\n    if (responseCode === '00') {\n      paymentStatus = 'paid';\n      // Update order status\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'paid',\n        status: 'confirmed',\n        paymentDetails: {\n          method: 'vnpay',\n          transactionId: transactionNo,\n          amount: amount,\n          responseCode: responseCode,\n          paidAt: new Date()\n        }\n      });\n    } else {\n      // Update order with failed payment\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'failed',\n        paymentDetails: {\n          method: 'vnpay',\n          responseCode: responseCode,\n          failedAt: new Date(),\n          failureReason: message\n        }\n      });\n    }\n\n    // Redirect to frontend with result\n    const redirectUrl = `${process.env.FRONTEND_URL}/checkout/result?status=${paymentStatus}&orderId=${orderId}&message=${encodeURIComponent(message)}`;\n    res.redirect(redirectUrl);\n  } catch (error) {\n    console.error('VNPay return URL error:', error);\n    res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Payment processing error`);\n  }\n});\n\n// @route   POST /api/payments/vnpay/ipn\n// @desc    Handle VNPay IPN (Instant Payment Notification)\n// @access  Public\nrouter.post('/vnpay/ipn', async (req, res) => {\n  try {\n    const vnp_Params = req.query;\n    const orderId = vnp_Params.vnp_TxnRef;\n    const responseCode = vnp_Params.vnp_ResponseCode;\n    const transactionNo = vnp_Params.vnp_TransactionNo;\n    const amount = vnp_Params.vnp_Amount / 100;\n\n    // Verify the IPN\n    const isValidSignature = vnpayConfig.verifyReturnUrl(vnp_Params);\n    if (!isValidSignature) {\n      return res.status(400).json({\n        RspCode: '97',\n        Message: 'Invalid signature'\n      });\n    }\n\n    // Find the order\n    const order = await Order.findOne({\n      orderNumber: orderId\n    });\n    if (!order) {\n      return res.status(400).json({\n        RspCode: '01',\n        Message: 'Order not found'\n      });\n    }\n\n    // Check if order amount matches\n    if (Math.abs(order.total - amount) > 1) {\n      // Allow 1 VND difference for rounding\n      return res.status(400).json({\n        RspCode: '04',\n        Message: 'Invalid amount'\n      });\n    }\n    if (responseCode === '00') {\n      // Payment successful\n      if (order.paymentStatus !== 'paid') {\n        await Order.findByIdAndUpdate(order._id, {\n          paymentStatus: 'paid',\n          status: 'confirmed',\n          paymentDetails: {\n            method: 'vnpay',\n            transactionId: transactionNo,\n            amount: amount,\n            responseCode: responseCode,\n            paidAt: new Date()\n          }\n        });\n      }\n      return res.status(200).json({\n        RspCode: '00',\n        Message: 'Success'\n      });\n    } else {\n      // Payment failed\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'failed',\n        paymentDetails: {\n          method: 'vnpay',\n          responseCode: responseCode,\n          failedAt: new Date(),\n          failureReason: vnpayConfig.getPaymentStatus(responseCode)\n        }\n      });\n      return res.status(200).json({\n        RspCode: '00',\n        Message: 'Success'\n      });\n    }\n  } catch (error) {\n    console.error('VNPay IPN error:', error);\n    res.status(500).json({\n      RspCode: '99',\n      Message: 'Internal server error'\n    });\n  }\n});\n\n// @route   GET /api/payments/vnpay/status/:orderId\n// @desc    Get VNPay payment status\n// @access  Private\nrouter.get('/vnpay/status/:orderId', auth, async (req, res) => {\n  try {\n    const {\n      orderId\n    } = req.params;\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: {\n        orderId: order.orderNumber,\n        paymentStatus: order.paymentStatus,\n        paymentMethod: order.paymentMethod,\n        paymentDetails: order.paymentDetails,\n        totalAmount: order.total\n      }\n    });\n  } catch (error) {\n    console.error('Get VNPay status error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Internal server error'\n    });\n  }\n});\n\n// @route   POST /api/payments/card/process\n// @desc    Process card payment\n// @access  Private\nrouter.post('/card/process', auth, async (req, res) => {\n  try {\n    const {\n      orderId,\n      amount,\n      cardData\n    } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // In a real implementation, you would:\n    // 1. Validate card details with a payment processor (Stripe, Square, etc.)\n    // 2. Process the actual payment\n    // 3. Handle payment success/failure\n\n    // For demo purposes, we'll simulate a successful payment\n    // In production, NEVER store full card details in your database\n\n    // Simulate payment processing delay\n    await new Promise(resolve => setTimeout(resolve, 1000));\n\n    // Update order with payment details\n    order.paymentStatus = 'paid';\n    order.status = 'confirmed';\n    order.paymentDetails = {\n      method: 'card',\n      lastFour: cardData.lastFour,\n      cardholderName: cardData.cardholderName,\n      paidAt: new Date(),\n      transactionId: `card_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n    };\n    await order.save();\n    res.json({\n      success: true,\n      message: 'Card payment processed successfully',\n      data: {\n        orderId: order.orderNumber,\n        transactionId: order.paymentDetails.transactionId,\n        amount: amount\n      }\n    });\n  } catch (error) {\n    console.error('Card payment processing error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while processing card payment'\n    });\n  }\n});\n\n// @route   POST /api/payments/cash/confirm\n// @desc    Confirm cash payment order\n// @access  Private\nrouter.post('/cash/confirm', auth, async (req, res) => {\n  try {\n    const {\n      orderId,\n      amount\n    } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already confirmed\n    if (order.status === 'confirmed' || order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already confirmed'\n      });\n    }\n\n    // Update order status for cash payment\n    // Cash orders are confirmed but payment status remains pending until actual payment\n    order.status = 'confirmed';\n    order.paymentDetails = {\n      method: 'cash',\n      confirmedAt: new Date(),\n      orderType: order.orderType // delivery or pickup\n    };\n    await order.save();\n    res.json({\n      success: true,\n      message: 'Cash payment order confirmed successfully',\n      data: {\n        orderId: order.orderNumber,\n        status: order.status,\n        paymentMethod: 'cash',\n        orderType: order.orderType\n      }\n    });\n  } catch (error) {\n    console.error('Cash payment confirmation error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while confirming cash payment'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIk9yZGVyIiwibW9tb1NlcnZpY2UiLCJ2bnBheUNvbmZpZyIsInByb3RlY3QiLCJhdXRoIiwicG9zdCIsInJlcSIsInJlcyIsIm9yZGVySWQiLCJhbW91bnQiLCJvcmRlckluZm8iLCJib2R5Iiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwib3JkZXIiLCJmaW5kT25lIiwib3JkZXJOdW1iZXIiLCJjdXN0b21lciIsInVzZXIiLCJpZCIsInBheW1lbnRTdGF0dXMiLCJwYXltZW50UmVzdWx0IiwiY3JlYXRlUGF5bWVudCIsIk1hdGgiLCJyb3VuZCIsImV4dHJhRGF0YSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1c2VySWQiLCJlcnJvciIsIm1vbW9UcmFuc2FjdGlvbiIsInJlcXVlc3RJZCIsInBheVVybCIsImRhdGEiLCJkZWVwbGluayIsInFyQ29kZVVybCIsInJlc3VsdENvZGUiLCJzYXZlIiwiY29uc29sZSIsImxvZyIsInBhcnRuZXJDb2RlIiwib3JkZXJUeXBlIiwidHJhbnNJZCIsInBheVR5cGUiLCJyZXNwb25zZVRpbWUiLCJzaWduYXR1cmUiLCJpc1ZhbGlkU2lnbmF0dXJlIiwidmVyaWZ5Q2FsbGJhY2siLCJwYXJzZUludCIsImdldCIsInBhcmFtcyIsIm9yZGVyU3RhdHVzIiwidG90YWwiLCJxdWVyeSIsInJlZGlyZWN0IiwicHJvY2VzcyIsImVudiIsIkZST05URU5EX1VSTCIsImVuY29kZVVSSUNvbXBvbmVudCIsImJhbmtDb2RlIiwiaXBBZGRyIiwiaGVhZGVycyIsImNvbm5lY3Rpb24iLCJyZW1vdGVBZGRyZXNzIiwic29ja2V0IiwicGF5bWVudFVybCIsImNyZWF0ZVBheW1lbnRVcmwiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIl9pZCIsInBheW1lbnRNZXRob2QiLCJ2bnBheUVycm9yIiwiTk9ERV9FTlYiLCJ1bmRlZmluZWQiLCJ2bnBfUGFyYW1zIiwidm5wX1R4blJlZiIsInJlc3BvbnNlQ29kZSIsInZucF9SZXNwb25zZUNvZGUiLCJ0cmFuc2FjdGlvbk5vIiwidm5wX1RyYW5zYWN0aW9uTm8iLCJ2bnBfQW1vdW50IiwidmVyaWZ5UmV0dXJuVXJsIiwiZ2V0UGF5bWVudFN0YXR1cyIsInBheW1lbnREZXRhaWxzIiwibWV0aG9kIiwidHJhbnNhY3Rpb25JZCIsInBhaWRBdCIsIkRhdGUiLCJmYWlsZWRBdCIsImZhaWx1cmVSZWFzb24iLCJyZWRpcmVjdFVybCIsIlJzcENvZGUiLCJNZXNzYWdlIiwiYWJzIiwidG90YWxBbW91bnQiLCJjYXJkRGF0YSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImxhc3RGb3VyIiwiY2FyZGhvbGRlck5hbWUiLCJub3ciLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsImNvbmZpcm1lZEF0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXHJvdXRlc1xcIiwic291cmNlcyI6WyJwYXltZW50cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcbmNvbnN0IE9yZGVyID0gcmVxdWlyZSgnLi4vbW9kZWxzL09yZGVyJyk7XG5jb25zdCBtb21vU2VydmljZSA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL21vbW9TZXJ2aWNlJyk7XG5jb25zdCB2bnBheUNvbmZpZyA9IHJlcXVpcmUoJy4uL2NvbmZpZy92bnBheScpO1xuY29uc3QgeyBwcm90ZWN0OiBhdXRoIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcblxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3BheW1lbnRzL21vbW8vY3JlYXRlXG4vLyBAZGVzYyAgICBDcmVhdGUgTW9NbyBwYXltZW50IHJlcXVlc3Rcbi8vIEBhY2Nlc3MgIFByaXZhdGVcbnJvdXRlci5wb3N0KCcvbW9tby9jcmVhdGUnLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IG9yZGVySWQsIGFtb3VudCwgb3JkZXJJbmZvIH0gPSByZXEuYm9keTtcblxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgIGlmICghb3JkZXJJZCB8fCAhYW1vdW50KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIElEIGFuZCBhbW91bnQgYXJlIHJlcXVpcmVkJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgYW1vdW50XG4gICAgaWYgKGFtb3VudCA8PSAwIHx8IGFtb3VudCA+IDUwMDAwMDAwKSB7IC8vIE1vTW8gbGltaXQgaXMgNTBNIFZORFxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHBheW1lbnQgYW1vdW50J1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRmluZCB0aGUgb3JkZXIgdG8gdmVyaWZ5IGl0IGJlbG9uZ3MgdG8gdGhlIHVzZXJcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoe1xuICAgICAgb3JkZXJOdW1iZXI6IG9yZGVySWQsXG4gICAgICBjdXN0b21lcjogcmVxLnVzZXIuaWRcbiAgICB9KTtcblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgb3JkZXIgaXMgYWxyZWFkeSBwYWlkXG4gICAgaWYgKG9yZGVyLnBheW1lbnRTdGF0dXMgPT09ICdwYWlkJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBpcyBhbHJlYWR5IHBhaWQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgTW9NbyBwYXltZW50IHJlcXVlc3RcbiAgICBjb25zdCBwYXltZW50UmVzdWx0ID0gYXdhaXQgbW9tb1NlcnZpY2UuY3JlYXRlUGF5bWVudCh7XG4gICAgICBvcmRlcklkLFxuICAgICAgYW1vdW50OiBNYXRoLnJvdW5kKGFtb3VudCksIC8vIEVuc3VyZSBhbW91bnQgaXMgaW50ZWdlclxuICAgICAgb3JkZXJJbmZvOiBvcmRlckluZm8gfHwgYFBheW1lbnQgZm9yIERSRUFNIENPRkZFRSBvcmRlciAke29yZGVySWR9YCxcbiAgICAgIGV4dHJhRGF0YTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICB1c2VySWQ6IHJlcS51c2VyLmlkLFxuICAgICAgICBvcmRlck51bWJlcjogb3JkZXJJZFxuICAgICAgfSlcbiAgICB9KTtcblxuICAgIGlmICghcGF5bWVudFJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgTW9NbyBwYXltZW50JyxcbiAgICAgICAgZXJyb3I6IHBheW1lbnRSZXN1bHQuZXJyb3JcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBvcmRlciB3aXRoIE1vTW8gdHJhbnNhY3Rpb24gZGV0YWlsc1xuICAgIG9yZGVyLm1vbW9UcmFuc2FjdGlvbiA9IHtcbiAgICAgIHJlcXVlc3RJZDogcGF5bWVudFJlc3VsdC5yZXF1ZXN0SWQsXG4gICAgICBwYXlVcmw6IHBheW1lbnRSZXN1bHQuZGF0YS5wYXlVcmwsXG4gICAgICBkZWVwbGluazogcGF5bWVudFJlc3VsdC5kYXRhLmRlZXBsaW5rLFxuICAgICAgcXJDb2RlVXJsOiBwYXltZW50UmVzdWx0LmRhdGEucXJDb2RlVXJsLFxuICAgICAgcmVzdWx0Q29kZTogcGF5bWVudFJlc3VsdC5kYXRhLnJlc3VsdENvZGUsXG4gICAgICBtZXNzYWdlOiBwYXltZW50UmVzdWx0LmRhdGEubWVzc2FnZVxuICAgIH07XG4gICAgXG4gICAgYXdhaXQgb3JkZXIuc2F2ZSgpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgcGF5VXJsOiBwYXltZW50UmVzdWx0LmRhdGEucGF5VXJsLFxuICAgICAgICBkZWVwbGluazogcGF5bWVudFJlc3VsdC5kYXRhLmRlZXBsaW5rLFxuICAgICAgICBxckNvZGVVcmw6IHBheW1lbnRSZXN1bHQuZGF0YS5xckNvZGVVcmwsXG4gICAgICAgIHJlcXVlc3RJZDogcGF5bWVudFJlc3VsdC5yZXF1ZXN0SWQsXG4gICAgICAgIG9yZGVySWQ6IG9yZGVySWQsXG4gICAgICAgIGFtb3VudDogYW1vdW50XG4gICAgICB9LFxuICAgICAgbWVzc2FnZTogJ01vTW8gcGF5bWVudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseSdcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdNb01vIHBheW1lbnQgY3JlYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBjcmVhdGluZyBNb01vIHBheW1lbnQnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvcGF5bWVudHMvbW9tby9jYWxsYmFja1xuLy8gQGRlc2MgICAgSGFuZGxlIE1vTW8gcGF5bWVudCBjYWxsYmFjayAoSVBOKVxuLy8gQGFjY2VzcyAgUHVibGljXG5yb3V0ZXIucG9zdCgnL21vbW8vY2FsbGJhY2snLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnTW9NbyBjYWxsYmFjayByZWNlaXZlZDonLCByZXEuYm9keSk7XG5cbiAgICBjb25zdCB7XG4gICAgICBwYXJ0bmVyQ29kZSxcbiAgICAgIG9yZGVySWQsXG4gICAgICByZXF1ZXN0SWQsXG4gICAgICBhbW91bnQsXG4gICAgICBvcmRlckluZm8sXG4gICAgICBvcmRlclR5cGUsXG4gICAgICB0cmFuc0lkLFxuICAgICAgcmVzdWx0Q29kZSxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBwYXlUeXBlLFxuICAgICAgcmVzcG9uc2VUaW1lLFxuICAgICAgZXh0cmFEYXRhLFxuICAgICAgc2lnbmF0dXJlXG4gICAgfSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gVmVyaWZ5IGNhbGxiYWNrIHNpZ25hdHVyZVxuICAgIGNvbnN0IGlzVmFsaWRTaWduYXR1cmUgPSBtb21vU2VydmljZS52ZXJpZnlDYWxsYmFjayhyZXEuYm9keSk7XG4gICAgXG4gICAgaWYgKCFpc1ZhbGlkU2lnbmF0dXJlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIE1vTW8gY2FsbGJhY2sgc2lnbmF0dXJlJyk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgc2lnbmF0dXJlJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRmluZCB0aGUgb3JkZXJcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoeyBvcmRlck51bWJlcjogb3JkZXJJZCB9KTtcbiAgICBcbiAgICBpZiAoIW9yZGVyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBPcmRlciBub3QgZm91bmQgZm9yIE1vTW8gY2FsbGJhY2s6ICR7b3JkZXJJZH1gKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIG9yZGVyIHdpdGggdHJhbnNhY3Rpb24gZGV0YWlsc1xuICAgIG9yZGVyLm1vbW9UcmFuc2FjdGlvbiA9IHtcbiAgICAgIC4uLm9yZGVyLm1vbW9UcmFuc2FjdGlvbixcbiAgICAgIHRyYW5zSWQsXG4gICAgICByZXN1bHRDb2RlOiBwYXJzZUludChyZXN1bHRDb2RlKSxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICByZXNwb25zZVRpbWUsXG4gICAgICBwYXlUeXBlXG4gICAgfTtcblxuICAgIC8vIFVwZGF0ZSBwYXltZW50IHN0YXR1cyBiYXNlZCBvbiByZXN1bHQgY29kZVxuICAgIGlmIChyZXN1bHRDb2RlID09PSAnMCcpIHtcbiAgICAgIC8vIFBheW1lbnQgc3VjY2Vzc2Z1bFxuICAgICAgb3JkZXIucGF5bWVudFN0YXR1cyA9ICdwYWlkJztcbiAgICAgIG9yZGVyLnN0YXR1cyA9ICdjb25maXJtZWQnO1xuICAgICAgY29uc29sZS5sb2coYE1vTW8gcGF5bWVudCBzdWNjZXNzZnVsIGZvciBvcmRlcjogJHtvcmRlcklkfWApO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBQYXltZW50IGZhaWxlZFxuICAgICAgb3JkZXIucGF5bWVudFN0YXR1cyA9ICdmYWlsZWQnO1xuICAgICAgY29uc29sZS5sb2coYE1vTW8gcGF5bWVudCBmYWlsZWQgZm9yIG9yZGVyOiAke29yZGVySWR9LCBjb2RlOiAke3Jlc3VsdENvZGV9YCk7XG4gICAgfVxuXG4gICAgYXdhaXQgb3JkZXIuc2F2ZSgpO1xuXG4gICAgLy8gUmVzcG9uZCB0byBNb01vXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdDYWxsYmFjayBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5J1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ01vTW8gY2FsbGJhY2sgcHJvY2Vzc2luZyBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIHByb2Nlc3NpbmcgY2FsbGJhY2snXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9wYXltZW50cy9tb21vL3N0YXR1cy86b3JkZXJJZFxuLy8gQGRlc2MgICAgQ2hlY2sgTW9NbyBwYXltZW50IHN0YXR1c1xuLy8gQGFjY2VzcyAgUHJpdmF0ZVxucm91dGVyLmdldCgnL21vbW8vc3RhdHVzLzpvcmRlcklkJywgYXV0aCwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBvcmRlcklkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgLy8gRmluZCB0aGUgb3JkZXJcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoe1xuICAgICAgb3JkZXJOdW1iZXI6IG9yZGVySWQsXG4gICAgICBjdXN0b21lcjogcmVxLnVzZXIuaWRcbiAgICB9KTtcblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIHBheW1lbnQgc3RhdHVzXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgb3JkZXJJZDogb3JkZXIub3JkZXJOdW1iZXIsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IG9yZGVyLnBheW1lbnRTdGF0dXMsXG4gICAgICAgIG9yZGVyU3RhdHVzOiBvcmRlci5zdGF0dXMsXG4gICAgICAgIG1vbW9UcmFuc2FjdGlvbjogb3JkZXIubW9tb1RyYW5zYWN0aW9uLFxuICAgICAgICBhbW91bnQ6IG9yZGVyLnRvdGFsXG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignUGF5bWVudCBzdGF0dXMgY2hlY2sgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBjaGVja2luZyBwYXltZW50IHN0YXR1cydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9wYXltZW50cy9tb21vL3JldHVyblxuLy8gQGRlc2MgICAgSGFuZGxlIE1vTW8gcGF5bWVudCByZXR1cm4gVVJMXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5nZXQoJy9tb21vL3JldHVybicsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHtcbiAgICAgIHBhcnRuZXJDb2RlLFxuICAgICAgb3JkZXJJZCxcbiAgICAgIHJlcXVlc3RJZCxcbiAgICAgIGFtb3VudCxcbiAgICAgIG9yZGVySW5mbyxcbiAgICAgIG9yZGVyVHlwZSxcbiAgICAgIHRyYW5zSWQsXG4gICAgICByZXN1bHRDb2RlLFxuICAgICAgbWVzc2FnZSxcbiAgICAgIHBheVR5cGUsXG4gICAgICByZXNwb25zZVRpbWUsXG4gICAgICBleHRyYURhdGEsXG4gICAgICBzaWduYXR1cmVcbiAgICB9ID0gcmVxLnF1ZXJ5O1xuXG4gICAgY29uc29sZS5sb2coJ01vTW8gcmV0dXJuIFVSTCBhY2Nlc3NlZDonLCByZXEucXVlcnkpO1xuXG4gICAgLy8gVmVyaWZ5IHNpZ25hdHVyZVxuICAgIGNvbnN0IGlzVmFsaWRTaWduYXR1cmUgPSBtb21vU2VydmljZS52ZXJpZnlDYWxsYmFjayhyZXEucXVlcnkpO1xuICAgIFxuICAgIGlmICghaXNWYWxpZFNpZ25hdHVyZSkge1xuICAgICAgcmV0dXJuIHJlcy5yZWRpcmVjdChgJHtwcm9jZXNzLmVudi5GUk9OVEVORF9VUkx9L3BheW1lbnQvZXJyb3I/bWVzc2FnZT1JbnZhbGlkIHNpZ25hdHVyZWApO1xuICAgIH1cblxuICAgIC8vIFJlZGlyZWN0IGJhc2VkIG9uIHBheW1lbnQgcmVzdWx0XG4gICAgaWYgKHJlc3VsdENvZGUgPT09ICcwJykge1xuICAgICAgLy8gUGF5bWVudCBzdWNjZXNzZnVsXG4gICAgICByZXMucmVkaXJlY3QoYCR7cHJvY2Vzcy5lbnYuRlJPTlRFTkRfVVJMfS9wYXltZW50L3N1Y2Nlc3M/b3JkZXJJZD0ke29yZGVySWR9JnRyYW5zSWQ9JHt0cmFuc0lkfWApO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBQYXltZW50IGZhaWxlZFxuICAgICAgcmVzLnJlZGlyZWN0KGAke3Byb2Nlc3MuZW52LkZST05URU5EX1VSTH0vcGF5bWVudC9lcnJvcj9vcmRlcklkPSR7b3JkZXJJZH0mbWVzc2FnZT0ke2VuY29kZVVSSUNvbXBvbmVudChtZXNzYWdlKX1gKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignTW9NbyByZXR1cm4gVVJMIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMucmVkaXJlY3QoYCR7cHJvY2Vzcy5lbnYuRlJPTlRFTkRfVVJMfS9wYXltZW50L2Vycm9yP21lc3NhZ2U9UHJvY2Vzc2luZyBlcnJvcmApO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3BheW1lbnRzL3ZucGF5L2NyZWF0ZVxuLy8gQGRlc2MgICAgQ3JlYXRlIFZOUGF5IHBheW1lbnQgcmVxdWVzdFxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxucm91dGVyLnBvc3QoJy92bnBheS9jcmVhdGUnLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IG9yZGVySWQsIGFtb3VudCwgb3JkZXJJbmZvLCBiYW5rQ29kZSB9ID0gcmVxLmJvZHk7XG5cbiAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHNcbiAgICBpZiAoIW9yZGVySWQgfHwgIWFtb3VudCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBJRCBhbmQgYW1vdW50IGFyZSByZXF1aXJlZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGFtb3VudFxuICAgIGlmIChhbW91bnQgPD0gMCB8fCBhbW91bnQgPiA1MDAwMDAwMDApIHsgLy8gVk5QYXkgbGltaXQgaXMgNTAwTSBWTkRcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBwYXltZW50IGFtb3VudCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEZpbmQgdGhlIG9yZGVyIHRvIHZlcmlmeSBpdCBiZWxvbmdzIHRvIHRoZSB1c2VyXG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBPcmRlci5maW5kT25lKHtcbiAgICAgIG9yZGVyTnVtYmVyOiBvcmRlcklkLFxuICAgICAgY3VzdG9tZXI6IHJlcS51c2VyLmlkXG4gICAgfSk7XG5cbiAgICBpZiAoIW9yZGVyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIG9yZGVyIGlzIGFscmVhZHkgcGFpZFxuICAgIGlmIChvcmRlci5wYXltZW50U3RhdHVzID09PSAncGFpZCcpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgaXMgYWxyZWFkeSBwYWlkJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gR2V0IGNsaWVudCBJUCBhZGRyZXNzXG4gICAgY29uc3QgaXBBZGRyID0gcmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLWZvciddIHx8XG4gICAgICAgICAgICAgICAgICAgcmVxLmNvbm5lY3Rpb24ucmVtb3RlQWRkcmVzcyB8fFxuICAgICAgICAgICAgICAgICAgIHJlcS5zb2NrZXQucmVtb3RlQWRkcmVzcyB8fFxuICAgICAgICAgICAgICAgICAgIChyZXEuY29ubmVjdGlvbi5zb2NrZXQgPyByZXEuY29ubmVjdGlvbi5zb2NrZXQucmVtb3RlQWRkcmVzcyA6IG51bGwpIHx8XG4gICAgICAgICAgICAgICAgICAgJzEyNy4wLjAuMSc7XG5cbiAgICAvLyBEZWJ1ZzogTG9nIHRoZSBwYXJhbWV0ZXJzIGJlaW5nIHNlbnQgdG8gVk5QYXlcbiAgICBjb25zb2xlLmxvZygnVk5QYXkgUGF5bWVudCBQYXJhbWV0ZXJzOicsIHtcbiAgICAgIG9yZGVySWQsXG4gICAgICBhbW91bnQsXG4gICAgICBvcmRlckluZm86IG9yZGVySW5mbyB8fCBgVGhhbmggdG9hbiBkb24gaGFuZyAke29yZGVySWR9YCxcbiAgICAgIGlwQWRkcixcbiAgICAgIGJhbmtDb2RlXG4gICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgcGF5bWVudCBVUkxcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGF5bWVudFVybCA9IHZucGF5Q29uZmlnLmNyZWF0ZVBheW1lbnRVcmwoXG4gICAgICAgIG9yZGVySWQsXG4gICAgICAgIGFtb3VudCxcbiAgICAgICAgb3JkZXJJbmZvIHx8IGBUaGFuaCB0b2FuIGRvbiBoYW5nICR7b3JkZXJJZH1gLFxuICAgICAgICBpcEFkZHIsXG4gICAgICAgIGJhbmtDb2RlXG4gICAgICApO1xuXG4gICAgICBjb25zb2xlLmxvZygnR2VuZXJhdGVkIFZOUGF5IFVSTDonLCBwYXltZW50VXJsKTtcblxuICAgICAgLy8gVXBkYXRlIG9yZGVyIHdpdGggcGF5bWVudCBtZXRob2RcbiAgICAgIGF3YWl0IE9yZGVyLmZpbmRCeUlkQW5kVXBkYXRlKG9yZGVyLl9pZCwge1xuICAgICAgICBwYXltZW50TWV0aG9kOiAndm5wYXknLFxuICAgICAgICBwYXltZW50U3RhdHVzOiAncGVuZGluZydcbiAgICAgIH0pO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdWTlBheSBwYXltZW50IFVSTCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBwYXltZW50VXJsLFxuICAgICAgICAgIG9yZGVySWQsXG4gICAgICAgICAgYW1vdW50XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKHZucGF5RXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1ZOUGF5IFVSTCBjcmVhdGlvbiBlcnJvcjonLCB2bnBheUVycm9yLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIHBheW1lbnQgVVJMOiAnICsgdm5wYXlFcnJvci5tZXNzYWdlXG4gICAgICB9KTtcbiAgICB9XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdWTlBheSBjcmVhdGUgcGF5bWVudCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgIGVycm9yOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IGVycm9yLm1lc3NhZ2UgOiB1bmRlZmluZWRcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3BheW1lbnRzL3ZucGF5L3JldHVyblxuLy8gQGRlc2MgICAgSGFuZGxlIFZOUGF5IHJldHVybiBVUkxcbi8vIEBhY2Nlc3MgIFB1YmxpY1xucm91dGVyLmdldCgnL3ZucGF5L3JldHVybicsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHZucF9QYXJhbXMgPSByZXEucXVlcnk7XG4gICAgY29uc3Qgb3JkZXJJZCA9IHZucF9QYXJhbXMudm5wX1R4blJlZjtcbiAgICBjb25zdCByZXNwb25zZUNvZGUgPSB2bnBfUGFyYW1zLnZucF9SZXNwb25zZUNvZGU7XG4gICAgY29uc3QgdHJhbnNhY3Rpb25ObyA9IHZucF9QYXJhbXMudm5wX1RyYW5zYWN0aW9uTm87XG4gICAgY29uc3QgYW1vdW50ID0gdm5wX1BhcmFtcy52bnBfQW1vdW50IC8gMTAwOyAvLyBDb252ZXJ0IGZyb20gVk5EIGNlbnRzXG5cbiAgICAvLyBWZXJpZnkgdGhlIHJldHVybiBVUkxcbiAgICBjb25zdCBpc1ZhbGlkU2lnbmF0dXJlID0gdm5wYXlDb25maWcudmVyaWZ5UmV0dXJuVXJsKHZucF9QYXJhbXMpO1xuXG4gICAgaWYgKCFpc1ZhbGlkU2lnbmF0dXJlKSB7XG4gICAgICByZXR1cm4gcmVzLnJlZGlyZWN0KGAke3Byb2Nlc3MuZW52LkZST05URU5EX1VSTH0vY2hlY2tvdXQvcmVzdWx0P3N0YXR1cz1lcnJvciZtZXNzYWdlPUludmFsaWQgc2lnbmF0dXJlYCk7XG4gICAgfVxuXG4gICAgLy8gRmluZCB0aGUgb3JkZXJcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoeyBvcmRlck51bWJlcjogb3JkZXJJZCB9KTtcbiAgICBpZiAoIW9yZGVyKSB7XG4gICAgICByZXR1cm4gcmVzLnJlZGlyZWN0KGAke3Byb2Nlc3MuZW52LkZST05URU5EX1VSTH0vY2hlY2tvdXQvcmVzdWx0P3N0YXR1cz1lcnJvciZtZXNzYWdlPU9yZGVyIG5vdCBmb3VuZGApO1xuICAgIH1cblxuICAgIGxldCBwYXltZW50U3RhdHVzID0gJ2ZhaWxlZCc7XG4gICAgbGV0IG1lc3NhZ2UgPSB2bnBheUNvbmZpZy5nZXRQYXltZW50U3RhdHVzKHJlc3BvbnNlQ29kZSk7XG5cbiAgICBpZiAocmVzcG9uc2VDb2RlID09PSAnMDAnKSB7XG4gICAgICBwYXltZW50U3RhdHVzID0gJ3BhaWQnO1xuICAgICAgLy8gVXBkYXRlIG9yZGVyIHN0YXR1c1xuICAgICAgYXdhaXQgT3JkZXIuZmluZEJ5SWRBbmRVcGRhdGUob3JkZXIuX2lkLCB7XG4gICAgICAgIHBheW1lbnRTdGF0dXM6ICdwYWlkJyxcbiAgICAgICAgc3RhdHVzOiAnY29uZmlybWVkJyxcbiAgICAgICAgcGF5bWVudERldGFpbHM6IHtcbiAgICAgICAgICBtZXRob2Q6ICd2bnBheScsXG4gICAgICAgICAgdHJhbnNhY3Rpb25JZDogdHJhbnNhY3Rpb25ObyxcbiAgICAgICAgICBhbW91bnQ6IGFtb3VudCxcbiAgICAgICAgICByZXNwb25zZUNvZGU6IHJlc3BvbnNlQ29kZSxcbiAgICAgICAgICBwYWlkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFVwZGF0ZSBvcmRlciB3aXRoIGZhaWxlZCBwYXltZW50XG4gICAgICBhd2FpdCBPcmRlci5maW5kQnlJZEFuZFVwZGF0ZShvcmRlci5faWQsIHtcbiAgICAgICAgcGF5bWVudFN0YXR1czogJ2ZhaWxlZCcsXG4gICAgICAgIHBheW1lbnREZXRhaWxzOiB7XG4gICAgICAgICAgbWV0aG9kOiAndm5wYXknLFxuICAgICAgICAgIHJlc3BvbnNlQ29kZTogcmVzcG9uc2VDb2RlLFxuICAgICAgICAgIGZhaWxlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGZhaWx1cmVSZWFzb246IG1lc3NhZ2VcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmVkaXJlY3QgdG8gZnJvbnRlbmQgd2l0aCByZXN1bHRcbiAgICBjb25zdCByZWRpcmVjdFVybCA9IGAke3Byb2Nlc3MuZW52LkZST05URU5EX1VSTH0vY2hlY2tvdXQvcmVzdWx0P3N0YXR1cz0ke3BheW1lbnRTdGF0dXN9Jm9yZGVySWQ9JHtvcmRlcklkfSZtZXNzYWdlPSR7ZW5jb2RlVVJJQ29tcG9uZW50KG1lc3NhZ2UpfWA7XG4gICAgcmVzLnJlZGlyZWN0KHJlZGlyZWN0VXJsKTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1ZOUGF5IHJldHVybiBVUkwgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5yZWRpcmVjdChgJHtwcm9jZXNzLmVudi5GUk9OVEVORF9VUkx9L2NoZWNrb3V0L3Jlc3VsdD9zdGF0dXM9ZXJyb3ImbWVzc2FnZT1QYXltZW50IHByb2Nlc3NpbmcgZXJyb3JgKTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9wYXltZW50cy92bnBheS9pcG5cbi8vIEBkZXNjICAgIEhhbmRsZSBWTlBheSBJUE4gKEluc3RhbnQgUGF5bWVudCBOb3RpZmljYXRpb24pXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5wb3N0KCcvdm5wYXkvaXBuJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgdm5wX1BhcmFtcyA9IHJlcS5xdWVyeTtcbiAgICBjb25zdCBvcmRlcklkID0gdm5wX1BhcmFtcy52bnBfVHhuUmVmO1xuICAgIGNvbnN0IHJlc3BvbnNlQ29kZSA9IHZucF9QYXJhbXMudm5wX1Jlc3BvbnNlQ29kZTtcbiAgICBjb25zdCB0cmFuc2FjdGlvbk5vID0gdm5wX1BhcmFtcy52bnBfVHJhbnNhY3Rpb25ObztcbiAgICBjb25zdCBhbW91bnQgPSB2bnBfUGFyYW1zLnZucF9BbW91bnQgLyAxMDA7XG5cbiAgICAvLyBWZXJpZnkgdGhlIElQTlxuICAgIGNvbnN0IGlzVmFsaWRTaWduYXR1cmUgPSB2bnBheUNvbmZpZy52ZXJpZnlSZXR1cm5Vcmwodm5wX1BhcmFtcyk7XG5cbiAgICBpZiAoIWlzVmFsaWRTaWduYXR1cmUpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IFJzcENvZGU6ICc5NycsIE1lc3NhZ2U6ICdJbnZhbGlkIHNpZ25hdHVyZScgfSk7XG4gICAgfVxuXG4gICAgLy8gRmluZCB0aGUgb3JkZXJcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoeyBvcmRlck51bWJlcjogb3JkZXJJZCB9KTtcbiAgICBpZiAoIW9yZGVyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBSc3BDb2RlOiAnMDEnLCBNZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJyB9KTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBvcmRlciBhbW91bnQgbWF0Y2hlc1xuICAgIGlmIChNYXRoLmFicyhvcmRlci50b3RhbCAtIGFtb3VudCkgPiAxKSB7IC8vIEFsbG93IDEgVk5EIGRpZmZlcmVuY2UgZm9yIHJvdW5kaW5nXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBSc3BDb2RlOiAnMDQnLCBNZXNzYWdlOiAnSW52YWxpZCBhbW91bnQnIH0pO1xuICAgIH1cblxuICAgIGlmIChyZXNwb25zZUNvZGUgPT09ICcwMCcpIHtcbiAgICAgIC8vIFBheW1lbnQgc3VjY2Vzc2Z1bFxuICAgICAgaWYgKG9yZGVyLnBheW1lbnRTdGF0dXMgIT09ICdwYWlkJykge1xuICAgICAgICBhd2FpdCBPcmRlci5maW5kQnlJZEFuZFVwZGF0ZShvcmRlci5faWQsIHtcbiAgICAgICAgICBwYXltZW50U3RhdHVzOiAncGFpZCcsXG4gICAgICAgICAgc3RhdHVzOiAnY29uZmlybWVkJyxcbiAgICAgICAgICBwYXltZW50RGV0YWlsczoge1xuICAgICAgICAgICAgbWV0aG9kOiAndm5wYXknLFxuICAgICAgICAgICAgdHJhbnNhY3Rpb25JZDogdHJhbnNhY3Rpb25ObyxcbiAgICAgICAgICAgIGFtb3VudDogYW1vdW50LFxuICAgICAgICAgICAgcmVzcG9uc2VDb2RlOiByZXNwb25zZUNvZGUsXG4gICAgICAgICAgICBwYWlkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgUnNwQ29kZTogJzAwJywgTWVzc2FnZTogJ1N1Y2Nlc3MnIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBQYXltZW50IGZhaWxlZFxuICAgICAgYXdhaXQgT3JkZXIuZmluZEJ5SWRBbmRVcGRhdGUob3JkZXIuX2lkLCB7XG4gICAgICAgIHBheW1lbnRTdGF0dXM6ICdmYWlsZWQnLFxuICAgICAgICBwYXltZW50RGV0YWlsczoge1xuICAgICAgICAgIG1ldGhvZDogJ3ZucGF5JyxcbiAgICAgICAgICByZXNwb25zZUNvZGU6IHJlc3BvbnNlQ29kZSxcbiAgICAgICAgICBmYWlsZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICBmYWlsdXJlUmVhc29uOiB2bnBheUNvbmZpZy5nZXRQYXltZW50U3RhdHVzKHJlc3BvbnNlQ29kZSlcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBSc3BDb2RlOiAnMDAnLCBNZXNzYWdlOiAnU3VjY2VzcycgfSk7XG4gICAgfVxuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignVk5QYXkgSVBOIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IFJzcENvZGU6ICc5OScsIE1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvcGF5bWVudHMvdm5wYXkvc3RhdHVzLzpvcmRlcklkXG4vLyBAZGVzYyAgICBHZXQgVk5QYXkgcGF5bWVudCBzdGF0dXNcbi8vIEBhY2Nlc3MgIFByaXZhdGVcbnJvdXRlci5nZXQoJy92bnBheS9zdGF0dXMvOm9yZGVySWQnLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IG9yZGVySWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoe1xuICAgICAgb3JkZXJOdW1iZXI6IG9yZGVySWQsXG4gICAgICBjdXN0b21lcjogcmVxLnVzZXIuaWRcbiAgICB9KTtcblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgb3JkZXJJZDogb3JkZXIub3JkZXJOdW1iZXIsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IG9yZGVyLnBheW1lbnRTdGF0dXMsXG4gICAgICAgIHBheW1lbnRNZXRob2Q6IG9yZGVyLnBheW1lbnRNZXRob2QsXG4gICAgICAgIHBheW1lbnREZXRhaWxzOiBvcmRlci5wYXltZW50RGV0YWlscyxcbiAgICAgICAgdG90YWxBbW91bnQ6IG9yZGVyLnRvdGFsXG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdHZXQgVk5QYXkgc3RhdHVzIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvcGF5bWVudHMvY2FyZC9wcm9jZXNzXG4vLyBAZGVzYyAgICBQcm9jZXNzIGNhcmQgcGF5bWVudFxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxucm91dGVyLnBvc3QoJy9jYXJkL3Byb2Nlc3MnLCBhdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IG9yZGVySWQsIGFtb3VudCwgY2FyZERhdGEgfSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzXG4gICAgaWYgKCFvcmRlcklkIHx8ICFhbW91bnQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgSUQgYW5kIGFtb3VudCBhcmUgcmVxdWlyZWQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBGaW5kIHRoZSBvcmRlciB0byB2ZXJpZnkgaXQgYmVsb25ncyB0byB0aGUgdXNlclxuICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXIuZmluZE9uZSh7XG4gICAgICBvcmRlck51bWJlcjogb3JkZXJJZCxcbiAgICAgIGN1c3RvbWVyOiByZXEudXNlci5pZFxuICAgIH0pO1xuXG4gICAgaWYgKCFvcmRlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBvcmRlciBpcyBhbHJlYWR5IHBhaWRcbiAgICBpZiAob3JkZXIucGF5bWVudFN0YXR1cyA9PT0gJ3BhaWQnKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIGlzIGFscmVhZHkgcGFpZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgeW91IHdvdWxkOlxuICAgIC8vIDEuIFZhbGlkYXRlIGNhcmQgZGV0YWlscyB3aXRoIGEgcGF5bWVudCBwcm9jZXNzb3IgKFN0cmlwZSwgU3F1YXJlLCBldGMuKVxuICAgIC8vIDIuIFByb2Nlc3MgdGhlIGFjdHVhbCBwYXltZW50XG4gICAgLy8gMy4gSGFuZGxlIHBheW1lbnQgc3VjY2Vzcy9mYWlsdXJlXG4gICAgXG4gICAgLy8gRm9yIGRlbW8gcHVycG9zZXMsIHdlJ2xsIHNpbXVsYXRlIGEgc3VjY2Vzc2Z1bCBwYXltZW50XG4gICAgLy8gSW4gcHJvZHVjdGlvbiwgTkVWRVIgc3RvcmUgZnVsbCBjYXJkIGRldGFpbHMgaW4geW91ciBkYXRhYmFzZVxuICAgIFxuICAgIC8vIFNpbXVsYXRlIHBheW1lbnQgcHJvY2Vzc2luZyBkZWxheVxuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XG4gICAgXG4gICAgLy8gVXBkYXRlIG9yZGVyIHdpdGggcGF5bWVudCBkZXRhaWxzXG4gICAgb3JkZXIucGF5bWVudFN0YXR1cyA9ICdwYWlkJztcbiAgICBvcmRlci5zdGF0dXMgPSAnY29uZmlybWVkJztcbiAgICBvcmRlci5wYXltZW50RGV0YWlscyA9IHtcbiAgICAgIG1ldGhvZDogJ2NhcmQnLFxuICAgICAgbGFzdEZvdXI6IGNhcmREYXRhLmxhc3RGb3VyLFxuICAgICAgY2FyZGhvbGRlck5hbWU6IGNhcmREYXRhLmNhcmRob2xkZXJOYW1lLFxuICAgICAgcGFpZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgdHJhbnNhY3Rpb25JZDogYGNhcmRfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gXG4gICAgfTtcbiAgICBcbiAgICBhd2FpdCBvcmRlci5zYXZlKCk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ0NhcmQgcGF5bWVudCBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgb3JkZXJJZDogb3JkZXIub3JkZXJOdW1iZXIsXG4gICAgICAgIHRyYW5zYWN0aW9uSWQ6IG9yZGVyLnBheW1lbnREZXRhaWxzLnRyYW5zYWN0aW9uSWQsXG4gICAgICAgIGFtb3VudDogYW1vdW50XG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQ2FyZCBwYXltZW50IHByb2Nlc3NpbmcgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBwcm9jZXNzaW5nIGNhcmQgcGF5bWVudCdcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9wYXltZW50cy9jYXNoL2NvbmZpcm1cbi8vIEBkZXNjICAgIENvbmZpcm0gY2FzaCBwYXltZW50IG9yZGVyXG4vLyBAYWNjZXNzICBQcml2YXRlXG5yb3V0ZXIucG9zdCgnL2Nhc2gvY29uZmlybScsIGF1dGgsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgb3JkZXJJZCwgYW1vdW50IH0gPSByZXEuYm9keTtcblxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgIGlmICghb3JkZXJJZCB8fCAhYW1vdW50KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ09yZGVyIElEIGFuZCBhbW91bnQgYXJlIHJlcXVpcmVkJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRmluZCB0aGUgb3JkZXIgdG8gdmVyaWZ5IGl0IGJlbG9uZ3MgdG8gdGhlIHVzZXJcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoe1xuICAgICAgb3JkZXJOdW1iZXI6IG9yZGVySWQsXG4gICAgICBjdXN0b21lcjogcmVxLnVzZXIuaWRcbiAgICB9KTtcblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgb3JkZXIgaXMgYWxyZWFkeSBjb25maXJtZWRcbiAgICBpZiAob3JkZXIuc3RhdHVzID09PSAnY29uZmlybWVkJyB8fCBvcmRlci5wYXltZW50U3RhdHVzID09PSAncGFpZCcpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgaXMgYWxyZWFkeSBjb25maXJtZWQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgb3JkZXIgc3RhdHVzIGZvciBjYXNoIHBheW1lbnRcbiAgICAvLyBDYXNoIG9yZGVycyBhcmUgY29uZmlybWVkIGJ1dCBwYXltZW50IHN0YXR1cyByZW1haW5zIHBlbmRpbmcgdW50aWwgYWN0dWFsIHBheW1lbnRcbiAgICBvcmRlci5zdGF0dXMgPSAnY29uZmlybWVkJztcbiAgICBvcmRlci5wYXltZW50RGV0YWlscyA9IHtcbiAgICAgIG1ldGhvZDogJ2Nhc2gnLFxuICAgICAgY29uZmlybWVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICBvcmRlclR5cGU6IG9yZGVyLm9yZGVyVHlwZSAvLyBkZWxpdmVyeSBvciBwaWNrdXBcbiAgICB9O1xuICAgIFxuICAgIGF3YWl0IG9yZGVyLnNhdmUoKTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnQ2FzaCBwYXltZW50IG9yZGVyIGNvbmZpcm1lZCBzdWNjZXNzZnVsbHknLFxuICAgICAgZGF0YToge1xuICAgICAgICBvcmRlcklkOiBvcmRlci5vcmRlck51bWJlcixcbiAgICAgICAgc3RhdHVzOiBvcmRlci5zdGF0dXMsXG4gICAgICAgIHBheW1lbnRNZXRob2Q6ICdjYXNoJyxcbiAgICAgICAgb3JkZXJUeXBlOiBvcmRlci5vcmRlclR5cGVcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdDYXNoIHBheW1lbnQgY29uZmlybWF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgY29uZmlybWluZyBjYXNoIHBheW1lbnQnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTUMsS0FBSyxHQUFHSCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDeEMsTUFBTUksV0FBVyxHQUFHSixPQUFPLENBQUMseUJBQXlCLENBQUM7QUFDdEQsTUFBTUssV0FBVyxHQUFHTCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDOUMsTUFBTTtFQUFFTSxPQUFPLEVBQUVDO0FBQUssQ0FBQyxHQUFHUCxPQUFPLENBQUMsb0JBQW9CLENBQUM7O0FBRXZEO0FBQ0E7QUFDQTtBQUNBQyxNQUFNLENBQUNPLElBQUksQ0FBQyxjQUFjLEVBQUVELElBQUksRUFBRSxPQUFPRSxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUNwRCxJQUFJO0lBQ0YsTUFBTTtNQUFFQyxPQUFPO01BQUVDLE1BQU07TUFBRUM7SUFBVSxDQUFDLEdBQUdKLEdBQUcsQ0FBQ0ssSUFBSTs7SUFF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","map":{"version":3,"names":["express","require","router","Router","Order","momoService","vnpayConfig","protect","auth","post","req","res","orderId","amount","orderInfo","body","status","json","success","message","order","findOne","orderNumber","customer","user","id","paymentStatus","paymentResult","createPayment","Math","round","extraData","JSON","stringify","userId","error","momoTransaction","requestId","payUrl","data","deeplink","qrCodeUrl","resultCode","save","console","log","partnerCode","orderType","transId","payType","responseTime","signature","isValidSignature","verifyCallback","parseInt","get","params","orderStatus","total","query","redirect","process","env","FRONTEND_URL","encodeURIComponent","bankCode","ipAddr","headers","connection","remoteAddress","socket","paymentUrl","createPaymentUrl","findByIdAndUpdate","_id","paymentMethod","vnpayError","NODE_ENV","undefined","vnp_Params","vnp_TxnRef","responseCode","vnp_ResponseCode","transactionNo","vnp_TransactionNo","vnp_Amount","verifyReturnUrl","getPaymentStatus","paymentDetails","method","transactionId","paidAt","Date","failedAt","failureReason","redirectUrl","RspCode","Message","abs","totalAmount","cardData","Promise","resolve","setTimeout","lastFour","cardholderName","now","random","toString","substr","confirmedAt","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["payments.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst Order = require('../models/Order');\nconst momoService = require('../services/momoService');\nconst vnpayConfig = require('../config/vnpay');\nconst { protect: auth } = require('../middleware/auth');\n\n// @route   POST /api/payments/momo/create\n// @desc    Create MoMo payment request\n// @access  Private\nrouter.post('/momo/create', auth, async (req, res) => {\n  try {\n    const { orderId, amount, orderInfo } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Validate amount\n    if (amount <= 0 || amount > 50000000) { // MoMo limit is 50M VND\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid payment amount'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // Create MoMo payment request\n    const paymentResult = await momoService.createPayment({\n      orderId,\n      amount: Math.round(amount), // Ensure amount is integer\n      orderInfo: orderInfo || `Payment for DREAM COFFEE order ${orderId}`,\n      extraData: JSON.stringify({\n        userId: req.user.id,\n        orderNumber: orderId\n      })\n    });\n\n    if (!paymentResult.success) {\n      return res.status(500).json({\n        success: false,\n        message: 'Failed to create MoMo payment',\n        error: paymentResult.error\n      });\n    }\n\n    // Update order with MoMo transaction details\n    order.momoTransaction = {\n      requestId: paymentResult.requestId,\n      payUrl: paymentResult.data.payUrl,\n      deeplink: paymentResult.data.deeplink,\n      qrCodeUrl: paymentResult.data.qrCodeUrl,\n      resultCode: paymentResult.data.resultCode,\n      message: paymentResult.data.message\n    };\n    \n    await order.save();\n\n    res.json({\n      success: true,\n      data: {\n        payUrl: paymentResult.data.payUrl,\n        deeplink: paymentResult.data.deeplink,\n        qrCodeUrl: paymentResult.data.qrCodeUrl,\n        requestId: paymentResult.requestId,\n        orderId: orderId,\n        amount: amount\n      },\n      message: 'MoMo payment created successfully'\n    });\n  } catch (error) {\n    console.error('MoMo payment creation error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while creating MoMo payment'\n    });\n  }\n});\n\n// @route   POST /api/payments/momo/callback\n// @desc    Handle MoMo payment callback (IPN)\n// @access  Public\nrouter.post('/momo/callback', async (req, res) => {\n  try {\n    console.log('MoMo callback received:', req.body);\n\n    const {\n      partnerCode,\n      orderId,\n      requestId,\n      amount,\n      orderInfo,\n      orderType,\n      transId,\n      resultCode,\n      message,\n      payType,\n      responseTime,\n      extraData,\n      signature\n    } = req.body;\n\n    // Verify callback signature\n    const isValidSignature = momoService.verifyCallback(req.body);\n    \n    if (!isValidSignature) {\n      console.error('Invalid MoMo callback signature');\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid signature'\n      });\n    }\n\n    // Find the order\n    const order = await Order.findOne({ orderNumber: orderId });\n    \n    if (!order) {\n      console.error(`Order not found for MoMo callback: ${orderId}`);\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Update order with transaction details\n    order.momoTransaction = {\n      ...order.momoTransaction,\n      transId,\n      resultCode: parseInt(resultCode),\n      message,\n      responseTime,\n      payType\n    };\n\n    // Update payment status based on result code\n    if (resultCode === '0') {\n      // Payment successful\n      order.paymentStatus = 'paid';\n      order.status = 'confirmed';\n      console.log(`MoMo payment successful for order: ${orderId}`);\n    } else {\n      // Payment failed\n      order.paymentStatus = 'failed';\n      console.log(`MoMo payment failed for order: ${orderId}, code: ${resultCode}`);\n    }\n\n    await order.save();\n\n    // Respond to MoMo\n    res.json({\n      success: true,\n      message: 'Callback processed successfully'\n    });\n  } catch (error) {\n    console.error('MoMo callback processing error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while processing callback'\n    });\n  }\n});\n\n// @route   GET /api/payments/momo/status/:orderId\n// @desc    Check MoMo payment status\n// @access  Private\nrouter.get('/momo/status/:orderId', auth, async (req, res) => {\n  try {\n    const { orderId } = req.params;\n\n    // Find the order\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Return payment status\n    res.json({\n      success: true,\n      data: {\n        orderId: order.orderNumber,\n        paymentStatus: order.paymentStatus,\n        orderStatus: order.status,\n        momoTransaction: order.momoTransaction,\n        amount: order.total\n      }\n    });\n  } catch (error) {\n    console.error('Payment status check error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while checking payment status'\n    });\n  }\n});\n\n// @route   POST /api/payments/momo/return\n// @desc    Handle MoMo payment return URL\n// @access  Public\nrouter.get('/momo/return', async (req, res) => {\n  try {\n    const {\n      partnerCode,\n      orderId,\n      requestId,\n      amount,\n      orderInfo,\n      orderType,\n      transId,\n      resultCode,\n      message,\n      payType,\n      responseTime,\n      extraData,\n      signature\n    } = req.query;\n\n    console.log('MoMo return URL accessed:', req.query);\n\n    // Verify signature\n    const isValidSignature = momoService.verifyCallback(req.query);\n    \n    if (!isValidSignature) {\n      return res.redirect(`${process.env.FRONTEND_URL}/payment/error?message=Invalid signature`);\n    }\n\n    // Redirect based on payment result\n    if (resultCode === '0') {\n      // Payment successful\n      res.redirect(`${process.env.FRONTEND_URL}/payment/success?orderId=${orderId}&transId=${transId}`);\n    } else {\n      // Payment failed\n      res.redirect(`${process.env.FRONTEND_URL}/payment/error?orderId=${orderId}&message=${encodeURIComponent(message)}`);\n    }\n  } catch (error) {\n    console.error('MoMo return URL error:', error);\n    res.redirect(`${process.env.FRONTEND_URL}/payment/error?message=Processing error`);\n  }\n});\n\n// @route   POST /api/payments/vnpay/create\n// @desc    Create VNPay payment request\n// @access  Private\nrouter.post('/vnpay/create', auth, async (req, res) => {\n  try {\n    const { orderId, amount, orderInfo, bankCode } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Validate amount\n    if (amount <= 0 || amount > 500000000) { // VNPay limit is 500M VND\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid payment amount'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // Get client IP address\n    const ipAddr = req.headers['x-forwarded-for'] ||\n                   req.connection.remoteAddress ||\n                   req.socket.remoteAddress ||\n                   (req.connection.socket ? req.connection.socket.remoteAddress : null) ||\n                   '127.0.0.1';\n\n    // Debug: Log the parameters being sent to VNPay\n    console.log('VNPay Payment Parameters:', {\n      orderId,\n      amount,\n      orderInfo: orderInfo || `Thanh toan don hang ${orderId}`,\n      ipAddr,\n      bankCode\n    });\n\n    // Create payment URL\n    try {\n      const paymentUrl = vnpayConfig.createPaymentUrl(\n        orderId,\n        amount,\n        orderInfo || `Thanh toan don hang ${orderId}`,\n        ipAddr,\n        bankCode\n      );\n\n      console.log('Generated VNPay URL:', paymentUrl);\n\n      // Update order with payment method\n      await Order.findByIdAndUpdate(order._id, {\n        paymentMethod: 'vnpay',\n        paymentStatus: 'pending'\n      });\n\n      res.json({\n        success: true,\n        message: 'VNPay payment URL created successfully',\n        data: {\n          paymentUrl,\n          orderId,\n          amount\n        }\n      });\n    } catch (vnpayError) {\n      console.error('VNPay URL creation error:', vnpayError.message);\n      return res.status(400).json({\n        success: false,\n        message: 'Failed to create payment URL: ' + vnpayError.message\n      });\n    }\n\n  } catch (error) {\n    console.error('VNPay create payment error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Internal server error',\n      error: process.env.NODE_ENV === 'development' ? error.message : undefined\n    });\n  }\n});\n\n// @route   GET /api/payments/vnpay/return\n// @desc    Handle VNPay return URL\n// @access  Public\nrouter.get('/vnpay/return', async (req, res) => {\n  try {\n    const vnp_Params = req.query;\n    const orderId = vnp_Params.vnp_TxnRef;\n    const responseCode = vnp_Params.vnp_ResponseCode;\n    const transactionNo = vnp_Params.vnp_TransactionNo;\n    const amount = vnp_Params.vnp_Amount / 100; // Convert from VND cents\n\n    // Verify the return URL\n    const isValidSignature = vnpayConfig.verifyReturnUrl(vnp_Params);\n\n    if (!isValidSignature) {\n      return res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Invalid signature`);\n    }\n\n    // Find the order\n    const order = await Order.findOne({ orderNumber: orderId });\n    if (!order) {\n      return res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Order not found`);\n    }\n\n    let paymentStatus = 'failed';\n    let message = vnpayConfig.getPaymentStatus(responseCode);\n\n    if (responseCode === '00') {\n      paymentStatus = 'paid';\n      // Update order status\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'paid',\n        status: 'confirmed',\n        paymentDetails: {\n          method: 'vnpay',\n          transactionId: transactionNo,\n          amount: amount,\n          responseCode: responseCode,\n          paidAt: new Date()\n        }\n      });\n    } else {\n      // Update order with failed payment\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'failed',\n        paymentDetails: {\n          method: 'vnpay',\n          responseCode: responseCode,\n          failedAt: new Date(),\n          failureReason: message\n        }\n      });\n    }\n\n    // Redirect to frontend with result\n    const redirectUrl = `${process.env.FRONTEND_URL}/checkout/result?status=${paymentStatus}&orderId=${orderId}&message=${encodeURIComponent(message)}`;\n    res.redirect(redirectUrl);\n\n  } catch (error) {\n    console.error('VNPay return URL error:', error);\n    res.redirect(`${process.env.FRONTEND_URL}/checkout/result?status=error&message=Payment processing error`);\n  }\n});\n\n// @route   POST /api/payments/vnpay/ipn\n// @desc    Handle VNPay IPN (Instant Payment Notification)\n// @access  Public\nrouter.post('/vnpay/ipn', async (req, res) => {\n  try {\n    const vnp_Params = req.query;\n    const orderId = vnp_Params.vnp_TxnRef;\n    const responseCode = vnp_Params.vnp_ResponseCode;\n    const transactionNo = vnp_Params.vnp_TransactionNo;\n    const amount = vnp_Params.vnp_Amount / 100;\n\n    // Verify the IPN\n    const isValidSignature = vnpayConfig.verifyReturnUrl(vnp_Params);\n\n    if (!isValidSignature) {\n      return res.status(400).json({ RspCode: '97', Message: 'Invalid signature' });\n    }\n\n    // Find the order\n    const order = await Order.findOne({ orderNumber: orderId });\n    if (!order) {\n      return res.status(400).json({ RspCode: '01', Message: 'Order not found' });\n    }\n\n    // Check if order amount matches\n    if (Math.abs(order.total - amount) > 1) { // Allow 1 VND difference for rounding\n      return res.status(400).json({ RspCode: '04', Message: 'Invalid amount' });\n    }\n\n    if (responseCode === '00') {\n      // Payment successful\n      if (order.paymentStatus !== 'paid') {\n        await Order.findByIdAndUpdate(order._id, {\n          paymentStatus: 'paid',\n          status: 'confirmed',\n          paymentDetails: {\n            method: 'vnpay',\n            transactionId: transactionNo,\n            amount: amount,\n            responseCode: responseCode,\n            paidAt: new Date()\n          }\n        });\n      }\n      return res.status(200).json({ RspCode: '00', Message: 'Success' });\n    } else {\n      // Payment failed\n      await Order.findByIdAndUpdate(order._id, {\n        paymentStatus: 'failed',\n        paymentDetails: {\n          method: 'vnpay',\n          responseCode: responseCode,\n          failedAt: new Date(),\n          failureReason: vnpayConfig.getPaymentStatus(responseCode)\n        }\n      });\n      return res.status(200).json({ RspCode: '00', Message: 'Success' });\n    }\n\n  } catch (error) {\n    console.error('VNPay IPN error:', error);\n    res.status(500).json({ RspCode: '99', Message: 'Internal server error' });\n  }\n});\n\n// @route   GET /api/payments/vnpay/status/:orderId\n// @desc    Get VNPay payment status\n// @access  Private\nrouter.get('/vnpay/status/:orderId', auth, async (req, res) => {\n  try {\n    const { orderId } = req.params;\n\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    res.json({\n      success: true,\n      data: {\n        orderId: order.orderNumber,\n        paymentStatus: order.paymentStatus,\n        paymentMethod: order.paymentMethod,\n        paymentDetails: order.paymentDetails,\n        totalAmount: order.total\n      }\n    });\n\n  } catch (error) {\n    console.error('Get VNPay status error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Internal server error'\n    });\n  }\n});\n\n// @route   POST /api/payments/card/process\n// @desc    Process card payment\n// @access  Private\nrouter.post('/card/process', auth, async (req, res) => {\n  try {\n    const { orderId, amount, cardData } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already paid\n    if (order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already paid'\n      });\n    }\n\n    // In a real implementation, you would:\n    // 1. Validate card details with a payment processor (Stripe, Square, etc.)\n    // 2. Process the actual payment\n    // 3. Handle payment success/failure\n    \n    // For demo purposes, we'll simulate a successful payment\n    // In production, NEVER store full card details in your database\n    \n    // Simulate payment processing delay\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    \n    // Update order with payment details\n    order.paymentStatus = 'paid';\n    order.status = 'confirmed';\n    order.paymentDetails = {\n      method: 'card',\n      lastFour: cardData.lastFour,\n      cardholderName: cardData.cardholderName,\n      paidAt: new Date(),\n      transactionId: `card_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n    };\n    \n    await order.save();\n\n    res.json({\n      success: true,\n      message: 'Card payment processed successfully',\n      data: {\n        orderId: order.orderNumber,\n        transactionId: order.paymentDetails.transactionId,\n        amount: amount\n      }\n    });\n  } catch (error) {\n    console.error('Card payment processing error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while processing card payment'\n    });\n  }\n});\n\n// @route   POST /api/payments/cash/confirm\n// @desc    Confirm cash payment order\n// @access  Private\nrouter.post('/cash/confirm', auth, async (req, res) => {\n  try {\n    const { orderId, amount } = req.body;\n\n    // Validate required fields\n    if (!orderId || !amount) {\n      return res.status(400).json({\n        success: false,\n        message: 'Order ID and amount are required'\n      });\n    }\n\n    // Find the order to verify it belongs to the user\n    const order = await Order.findOne({\n      orderNumber: orderId,\n      customer: req.user.id\n    });\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    // Check if order is already confirmed\n    if (order.status === 'confirmed' || order.paymentStatus === 'paid') {\n      return res.status(400).json({\n        success: false,\n        message: 'Order is already confirmed'\n      });\n    }\n\n    // Update order status for cash payment\n    // Cash orders are confirmed but payment status remains pending until actual payment\n    order.status = 'confirmed';\n    order.paymentDetails = {\n      method: 'cash',\n      confirmedAt: new Date(),\n      orderType: order.orderType // delivery or pickup\n    };\n    \n    await order.save();\n\n    res.json({\n      success: true,\n      message: 'Cash payment order confirmed successfully',\n      data: {\n        orderId: order.orderNumber,\n        status: order.status,\n        paymentMethod: 'cash',\n        orderType: order.orderType\n      }\n    });\n  } catch (error) {\n    console.error('Cash payment confirmation error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while confirming cash payment'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1757007726437},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\services\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\services\\\\momoService.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const crypto = require('crypto');\nconst https = require('https');\nclass MoMoService {\n  constructor() {\n    // MoMo API configuration - these should be moved to environment variables in production\n    this.config = {\n      accessKey: process.env.MOMO_ACCESS_KEY || 'F8BBA842ECF85',\n      secretKey: process.env.MOMO_SECRET_KEY || 'K951B6PE1waDMi640xX08PD3vg6EkVlz',\n      partnerCode: process.env.MOMO_PARTNER_CODE || 'MOMO',\n      redirectUrl: process.env.MOMO_REDIRECT_URL || 'http://localhost:5173/momo/return',\n      ipnUrl: process.env.MOMO_IPN_URL || 'http://localhost:5003/api/payments/momo/callback',\n      requestType: 'payWithMethod',\n      autoCapture: true,\n      lang: 'vi',\n      endpoint: process.env.MOMO_ENDPOINT || 'https://test-payment.momo.vn/v2/gateway/api/create'\n    };\n  }\n\n  /**\n   * Generate HMAC SHA256 signature for MoMo API\n   * @param {string} rawSignature - Raw signature string\n   * @returns {string} - Generated signature\n   */\n  generateSignature(rawSignature) {\n    return crypto.createHmac('sha256', this.config.secretKey).update(rawSignature).digest('hex');\n  }\n\n  /**\n   * Create MoMo payment request\n   * @param {Object} paymentData - Payment information\n   * @param {string} paymentData.orderId - Order ID\n   * @param {number} paymentData.amount - Payment amount\n   * @param {string} paymentData.orderInfo - Order description\n   * @param {string} paymentData.extraData - Additional data (optional)\n   * @returns {Promise<Object>} - MoMo payment response\n   */\n  async createPayment(paymentData) {\n    try {\n      const {\n        orderId,\n        amount,\n        orderInfo = 'Payment for DREAM COFFEE order',\n        extraData = ''\n      } = paymentData;\n\n      // Generate unique request ID\n      const requestId = `${this.config.partnerCode}${Date.now()}`;\n\n      // Create raw signature string\n      const rawSignature = [`accessKey=${this.config.accessKey}`, `amount=${amount}`, `extraData=${extraData}`, `ipnUrl=${this.config.ipnUrl}`, `orderId=${orderId}`, `orderInfo=${orderInfo}`, `partnerCode=${this.config.partnerCode}`, `redirectUrl=${this.config.redirectUrl}`, `requestId=${requestId}`, `requestType=${this.config.requestType}`].join('&');\n\n      // Generate signature\n      const signature = this.generateSignature(rawSignature);\n\n      // Prepare request body\n      const requestBody = {\n        partnerCode: this.config.partnerCode,\n        partnerName: 'DREAM COFFEE',\n        storeId: 'DreamCoffeeStore',\n        requestId,\n        amount: amount.toString(),\n        orderId,\n        orderInfo,\n        redirectUrl: this.config.redirectUrl,\n        ipnUrl: this.config.ipnUrl,\n        lang: this.config.lang,\n        requestType: this.config.requestType,\n        autoCapture: this.config.autoCapture,\n        extraData,\n        signature\n      };\n      console.log('MoMo Payment Request:', {\n        orderId,\n        amount,\n        requestId,\n        rawSignature\n      });\n\n      // Make request to MoMo API\n      const response = await this.makeHttpsRequest(requestBody);\n      return {\n        success: true,\n        data: response,\n        requestId,\n        orderId\n      };\n    } catch (error) {\n      console.error('MoMo payment creation failed:', error);\n      return {\n        success: false,\n        error: error.message,\n        code: error.code || 'MOMO_ERROR'\n      };\n    }\n  }\n\n  /**\n   * Make HTTPS request to MoMo API\n   * @param {Object} requestBody - Request payload\n   * @returns {Promise<Object>} - API response\n   */\n  makeHttpsRequest(requestBody) {\n    return new Promise((resolve, reject) => {\n      const postData = JSON.stringify(requestBody);\n      const options = {\n        hostname: 'test-payment.momo.vn',\n        port: 443,\n        path: '/v2/gateway/api/create',\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Content-Length': Buffer.byteLength(postData)\n        }\n      };\n      const req = https.request(options, res => {\n        let data = '';\n        res.on('data', chunk => {\n          data += chunk;\n        });\n        res.on('end', () => {\n          try {\n            const response = JSON.parse(data);\n            console.log('MoMo API Response:', {\n              status: res.statusCode,\n              resultCode: response.resultCode,\n              message: response.message\n            });\n            if (res.statusCode === 200) {\n              resolve(response);\n            } else {\n              reject(new Error(`HTTP ${res.statusCode}: ${response.message || 'Unknown error'}`));\n            }\n          } catch (parseError) {\n            reject(new Error(`Failed to parse MoMo response: ${parseError.message}`));\n          }\n        });\n      });\n      req.on('error', error => {\n        console.error('MoMo HTTPS request error:', error);\n        reject(new Error(`Network error: ${error.message}`));\n      });\n      req.on('timeout', () => {\n        req.destroy();\n        reject(new Error('Request timeout'));\n      });\n\n      // Set timeout\n      req.setTimeout(30000); // 30 seconds\n\n      // Send request\n      req.write(postData);\n      req.end();\n    });\n  }\n\n  /**\n   * Verify MoMo callback signature\n   * @param {Object} callbackData - Callback data from MoMo\n   * @returns {boolean} - Signature verification result\n   */\n  verifyCallback(callbackData) {\n    try {\n      const {\n        partnerCode,\n        orderId,\n        requestId,\n        amount,\n        orderInfo,\n        orderType,\n        transId,\n        resultCode,\n        message,\n        payType,\n        responseTime,\n        extraData,\n        signature\n      } = callbackData;\n\n      // Create raw signature for verification\n      const rawSignature = [`accessKey=${this.config.accessKey}`, `amount=${amount}`, `extraData=${extraData}`, `message=${message}`, `orderId=${orderId}`, `orderInfo=${orderInfo}`, `orderType=${orderType}`, `partnerCode=${partnerCode}`, `payType=${payType}`, `requestId=${requestId}`, `responseTime=${responseTime}`, `resultCode=${resultCode}`, `transId=${transId}`].join('&');\n      const expectedSignature = this.generateSignature(rawSignature);\n      return signature === expectedSignature;\n    } catch (error) {\n      console.error('MoMo callback verification failed:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Check payment status\n   * @param {string} orderId - Order ID\n   * @param {string} requestId - Request ID\n   * @returns {Promise<Object>} - Payment status\n   */\n  async checkPaymentStatus(orderId, requestId) {\n    try {\n      // This would typically call MoMo's query API\n      // For now, we'll return a placeholder response\n      return {\n        success: true,\n        resultCode: 0,\n        message: 'Payment status check not implemented yet'\n      };\n    } catch (error) {\n      console.error('Payment status check failed:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n}\nmodule.exports = new MoMoService();\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcnlwdG8iLCJyZXF1aXJlIiwiaHR0cHMiLCJNb01vU2VydmljZSIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiYWNjZXNzS2V5IiwicHJvY2VzcyIsImVudiIsIk1PTU9fQUNDRVNTX0tFWSIsInNlY3JldEtleSIsIk1PTU9fU0VDUkVUX0tFWSIsInBhcnRuZXJDb2RlIiwiTU9NT19QQVJUTkVSX0NPREUiLCJyZWRpcmVjdFVybCIsIk1PTU9fUkVESVJFQ1RfVVJMIiwiaXBuVXJsIiwiTU9NT19JUE5fVVJMIiwicmVxdWVzdFR5cGUiLCJhdXRvQ2FwdHVyZSIsImxhbmciLCJlbmRwb2ludCIsIk1PTU9fRU5EUE9JTlQiLCJnZW5lcmF0ZVNpZ25hdHVyZSIsInJhd1NpZ25hdHVyZSIsImNyZWF0ZUhtYWMiLCJ1cGRhdGUiLCJkaWdlc3QiLCJjcmVhdGVQYXltZW50IiwicGF5bWVudERhdGEiLCJvcmRlcklkIiwiYW1vdW50Iiwib3JkZXJJbmZvIiwiZXh0cmFEYXRhIiwicmVxdWVzdElkIiwiRGF0ZSIsIm5vdyIsImpvaW4iLCJzaWduYXR1cmUiLCJyZXF1ZXN0Qm9keSIsInBhcnRuZXJOYW1lIiwic3RvcmVJZCIsInRvU3RyaW5nIiwiY29uc29sZSIsImxvZyIsInJlc3BvbnNlIiwibWFrZUh0dHBzUmVxdWVzdCIsInN1Y2Nlc3MiLCJkYXRhIiwiZXJyb3IiLCJtZXNzYWdlIiwiY29kZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwicG9zdERhdGEiLCJKU09OIiwic3RyaW5naWZ5Iiwib3B0aW9ucyIsImhvc3RuYW1lIiwicG9ydCIsInBhdGgiLCJtZXRob2QiLCJoZWFkZXJzIiwiQnVmZmVyIiwiYnl0ZUxlbmd0aCIsInJlcSIsInJlcXVlc3QiLCJyZXMiLCJvbiIsImNodW5rIiwicGFyc2UiLCJzdGF0dXMiLCJzdGF0dXNDb2RlIiwicmVzdWx0Q29kZSIsIkVycm9yIiwicGFyc2VFcnJvciIsImRlc3Ryb3kiLCJzZXRUaW1lb3V0Iiwid3JpdGUiLCJlbmQiLCJ2ZXJpZnlDYWxsYmFjayIsImNhbGxiYWNrRGF0YSIsIm9yZGVyVHlwZSIsInRyYW5zSWQiLCJwYXlUeXBlIiwicmVzcG9uc2VUaW1lIiwiZXhwZWN0ZWRTaWduYXR1cmUiLCJjaGVja1BheW1lbnRTdGF0dXMiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xcc2VydmljZXNcXCIsInNvdXJjZXMiOlsibW9tb1NlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7XG5jb25zdCBodHRwcyA9IHJlcXVpcmUoJ2h0dHBzJyk7XG5cbmNsYXNzIE1vTW9TZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLy8gTW9NbyBBUEkgY29uZmlndXJhdGlvbiAtIHRoZXNlIHNob3VsZCBiZSBtb3ZlZCB0byBlbnZpcm9ubWVudCB2YXJpYWJsZXMgaW4gcHJvZHVjdGlvblxuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgYWNjZXNzS2V5OiBwcm9jZXNzLmVudi5NT01PX0FDQ0VTU19LRVkgfHwgJ0Y4QkJBODQyRUNGODUnLFxuICAgICAgc2VjcmV0S2V5OiBwcm9jZXNzLmVudi5NT01PX1NFQ1JFVF9LRVkgfHwgJ0s5NTFCNlBFMXdhRE1pNjQweFgwOFBEM3ZnNkVrVmx6JyxcbiAgICAgIHBhcnRuZXJDb2RlOiBwcm9jZXNzLmVudi5NT01PX1BBUlRORVJfQ09ERSB8fCAnTU9NTycsXG4gICAgICByZWRpcmVjdFVybDogcHJvY2Vzcy5lbnYuTU9NT19SRURJUkVDVF9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6NTE3My9tb21vL3JldHVybicsXG4gICAgICBpcG5Vcmw6IHByb2Nlc3MuZW52Lk1PTU9fSVBOX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDo1MDAzL2FwaS9wYXltZW50cy9tb21vL2NhbGxiYWNrJyxcbiAgICAgIHJlcXVlc3RUeXBlOiAncGF5V2l0aE1ldGhvZCcsXG4gICAgICBhdXRvQ2FwdHVyZTogdHJ1ZSxcbiAgICAgIGxhbmc6ICd2aScsXG4gICAgICBlbmRwb2ludDogcHJvY2Vzcy5lbnYuTU9NT19FTkRQT0lOVCB8fCAnaHR0cHM6Ly90ZXN0LXBheW1lbnQubW9tby52bi92Mi9nYXRld2F5L2FwaS9jcmVhdGUnXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBITUFDIFNIQTI1NiBzaWduYXR1cmUgZm9yIE1vTW8gQVBJXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByYXdTaWduYXR1cmUgLSBSYXcgc2lnbmF0dXJlIHN0cmluZ1xuICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIEdlbmVyYXRlZCBzaWduYXR1cmVcbiAgICovXG4gIGdlbmVyYXRlU2lnbmF0dXJlKHJhd1NpZ25hdHVyZSkge1xuICAgIHJldHVybiBjcnlwdG9cbiAgICAgIC5jcmVhdGVIbWFjKCdzaGEyNTYnLCB0aGlzLmNvbmZpZy5zZWNyZXRLZXkpXG4gICAgICAudXBkYXRlKHJhd1NpZ25hdHVyZSlcbiAgICAgIC5kaWdlc3QoJ2hleCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBNb01vIHBheW1lbnQgcmVxdWVzdFxuICAgKiBAcGFyYW0ge09iamVjdH0gcGF5bWVudERhdGEgLSBQYXltZW50IGluZm9ybWF0aW9uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXltZW50RGF0YS5vcmRlcklkIC0gT3JkZXIgSURcbiAgICogQHBhcmFtIHtudW1iZXJ9IHBheW1lbnREYXRhLmFtb3VudCAtIFBheW1lbnQgYW1vdW50XG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXltZW50RGF0YS5vcmRlckluZm8gLSBPcmRlciBkZXNjcmlwdGlvblxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF5bWVudERhdGEuZXh0cmFEYXRhIC0gQWRkaXRpb25hbCBkYXRhIChvcHRpb25hbClcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gLSBNb01vIHBheW1lbnQgcmVzcG9uc2VcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVBheW1lbnQocGF5bWVudERhdGEpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBvcmRlcklkLFxuICAgICAgICBhbW91bnQsXG4gICAgICAgIG9yZGVySW5mbyA9ICdQYXltZW50IGZvciBEUkVBTSBDT0ZGRUUgb3JkZXInLFxuICAgICAgICBleHRyYURhdGEgPSAnJ1xuICAgICAgfSA9IHBheW1lbnREYXRhO1xuXG4gICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgcmVxdWVzdCBJRFxuICAgICAgY29uc3QgcmVxdWVzdElkID0gYCR7dGhpcy5jb25maWcucGFydG5lckNvZGV9JHtEYXRlLm5vdygpfWA7XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSByYXcgc2lnbmF0dXJlIHN0cmluZ1xuICAgICAgY29uc3QgcmF3U2lnbmF0dXJlID0gW1xuICAgICAgICBgYWNjZXNzS2V5PSR7dGhpcy5jb25maWcuYWNjZXNzS2V5fWAsXG4gICAgICAgIGBhbW91bnQ9JHthbW91bnR9YCxcbiAgICAgICAgYGV4dHJhRGF0YT0ke2V4dHJhRGF0YX1gLFxuICAgICAgICBgaXBuVXJsPSR7dGhpcy5jb25maWcuaXBuVXJsfWAsXG4gICAgICAgIGBvcmRlcklkPSR7b3JkZXJJZH1gLFxuICAgICAgICBgb3JkZXJJbmZvPSR7b3JkZXJJbmZvfWAsXG4gICAgICAgIGBwYXJ0bmVyQ29kZT0ke3RoaXMuY29uZmlnLnBhcnRuZXJDb2RlfWAsXG4gICAgICAgIGByZWRpcmVjdFVybD0ke3RoaXMuY29uZmlnLnJlZGlyZWN0VXJsfWAsXG4gICAgICAgIGByZXF1ZXN0SWQ9JHtyZXF1ZXN0SWR9YCxcbiAgICAgICAgYHJlcXVlc3RUeXBlPSR7dGhpcy5jb25maWcucmVxdWVzdFR5cGV9YFxuICAgICAgXS5qb2luKCcmJyk7XG5cbiAgICAgIC8vIEdlbmVyYXRlIHNpZ25hdHVyZVxuICAgICAgY29uc3Qgc2lnbmF0dXJlID0gdGhpcy5nZW5lcmF0ZVNpZ25hdHVyZShyYXdTaWduYXR1cmUpO1xuXG4gICAgICAvLyBQcmVwYXJlIHJlcXVlc3QgYm9keVxuICAgICAgY29uc3QgcmVxdWVzdEJvZHkgPSB7XG4gICAgICAgIHBhcnRuZXJDb2RlOiB0aGlzLmNvbmZpZy5wYXJ0bmVyQ29kZSxcbiAgICAgICAgcGFydG5lck5hbWU6ICdEUkVBTSBDT0ZGRUUnLFxuICAgICAgICBzdG9yZUlkOiAnRHJlYW1Db2ZmZWVTdG9yZScsXG4gICAgICAgIHJlcXVlc3RJZCxcbiAgICAgICAgYW1vdW50OiBhbW91bnQudG9TdHJpbmcoKSxcbiAgICAgICAgb3JkZXJJZCxcbiAgICAgICAgb3JkZXJJbmZvLFxuICAgICAgICByZWRpcmVjdFVybDogdGhpcy5jb25maWcucmVkaXJlY3RVcmwsXG4gICAgICAgIGlwblVybDogdGhpcy5jb25maWcuaXBuVXJsLFxuICAgICAgICBsYW5nOiB0aGlzLmNvbmZpZy5sYW5nLFxuICAgICAgICByZXF1ZXN0VHlwZTogdGhpcy5jb25maWcucmVxdWVzdFR5cGUsXG4gICAgICAgIGF1dG9DYXB0dXJlOiB0aGlzLmNvbmZpZy5hdXRvQ2FwdHVyZSxcbiAgICAgICAgZXh0cmFEYXRhLFxuICAgICAgICBzaWduYXR1cmVcbiAgICAgIH07XG5cbiAgICAgIGNvbnNvbGUubG9nKCdNb01vIFBheW1lbnQgUmVxdWVzdDonLCB7XG4gICAgICAgIG9yZGVySWQsXG4gICAgICAgIGFtb3VudCxcbiAgICAgICAgcmVxdWVzdElkLFxuICAgICAgICByYXdTaWduYXR1cmVcbiAgICAgIH0pO1xuXG4gICAgICAvLyBNYWtlIHJlcXVlc3QgdG8gTW9NbyBBUElcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlSHR0cHNSZXF1ZXN0KHJlcXVlc3RCb2R5KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzcG9uc2UsXG4gICAgICAgIHJlcXVlc3RJZCxcbiAgICAgICAgb3JkZXJJZFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignTW9NbyBwYXltZW50IGNyZWF0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIGNvZGU6IGVycm9yLmNvZGUgfHwgJ01PTU9fRVJST1InXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNYWtlIEhUVFBTIHJlcXVlc3QgdG8gTW9NbyBBUElcbiAgICogQHBhcmFtIHtPYmplY3R9IHJlcXVlc3RCb2R5IC0gUmVxdWVzdCBwYXlsb2FkXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IC0gQVBJIHJlc3BvbnNlXG4gICAqL1xuICBtYWtlSHR0cHNSZXF1ZXN0KHJlcXVlc3RCb2R5KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IHBvc3REYXRhID0gSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpO1xuICAgICAgXG4gICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICBob3N0bmFtZTogJ3Rlc3QtcGF5bWVudC5tb21vLnZuJyxcbiAgICAgICAgcG9ydDogNDQzLFxuICAgICAgICBwYXRoOiAnL3YyL2dhdGV3YXkvYXBpL2NyZWF0ZScsXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAnQ29udGVudC1MZW5ndGgnOiBCdWZmZXIuYnl0ZUxlbmd0aChwb3N0RGF0YSlcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVxID0gaHR0cHMucmVxdWVzdChvcHRpb25zLCAocmVzKSA9PiB7XG4gICAgICAgIGxldCBkYXRhID0gJyc7XG4gICAgICAgIFxuICAgICAgICByZXMub24oJ2RhdGEnLCAoY2h1bmspID0+IHtcbiAgICAgICAgICBkYXRhICs9IGNodW5rO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHJlcy5vbignZW5kJywgKCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTW9NbyBBUEkgUmVzcG9uc2U6Jywge1xuICAgICAgICAgICAgICBzdGF0dXM6IHJlcy5zdGF0dXNDb2RlLFxuICAgICAgICAgICAgICByZXN1bHRDb2RlOiByZXNwb25zZS5yZXN1bHRDb2RlLFxuICAgICAgICAgICAgICBtZXNzYWdlOiByZXNwb25zZS5tZXNzYWdlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXNDb2RlID09PSAyMDApIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKGBIVFRQICR7cmVzLnN0YXR1c0NvZGV9OiAke3Jlc3BvbnNlLm1lc3NhZ2UgfHwgJ1Vua25vd24gZXJyb3InfWApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKGBGYWlsZWQgdG8gcGFyc2UgTW9NbyByZXNwb25zZTogJHtwYXJzZUVycm9yLm1lc3NhZ2V9YCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgcmVxLm9uKCdlcnJvcicsIChlcnJvcikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdNb01vIEhUVFBTIHJlcXVlc3QgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICByZWplY3QobmV3IEVycm9yKGBOZXR3b3JrIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCkpO1xuICAgICAgfSk7XG5cbiAgICAgIHJlcS5vbigndGltZW91dCcsICgpID0+IHtcbiAgICAgICAgcmVxLmRlc3Ryb3koKTtcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignUmVxdWVzdCB0aW1lb3V0JykpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNldCB0aW1lb3V0XG4gICAgICByZXEuc2V0VGltZW91dCgzMDAwMCk7IC8vIDMwIHNlY29uZHNcbiAgICAgIFxuICAgICAgLy8gU2VuZCByZXF1ZXN0XG4gICAgICByZXEud3JpdGUocG9zdERhdGEpO1xuICAgICAgcmVxLmVuZCgpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmeSBNb01vIGNhbGxiYWNrIHNpZ25hdHVyZVxuICAgKiBAcGFyYW0ge09iamVjdH0gY2FsbGJhY2tEYXRhIC0gQ2FsbGJhY2sgZGF0YSBmcm9tIE1vTW9cbiAgICogQHJldHVybnMge2Jvb2xlYW59IC0gU2lnbmF0dXJlIHZlcmlmaWNhdGlvbiByZXN1bHRcbiAgICovXG4gIHZlcmlmeUNhbGxiYWNrKGNhbGxiYWNrRGF0YSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIHBhcnRuZXJDb2RlLFxuICAgICAgICBvcmRlcklkLFxuICAgICAgICByZXF1ZXN0SWQsXG4gICAgICAgIGFtb3VudCxcbiAgICAgICAgb3JkZXJJbmZvLFxuICAgICAgICBvcmRlclR5cGUsXG4gICAgICAgIHRyYW5zSWQsXG4gICAgICAgIHJlc3VsdENvZGUsXG4gICAgICAgIG1lc3NhZ2UsXG4gICAgICAgIHBheVR5cGUsXG4gICAgICAgIHJlc3BvbnNlVGltZSxcbiAgICAgICAgZXh0cmFEYXRhLFxuICAgICAgICBzaWduYXR1cmVcbiAgICAgIH0gPSBjYWxsYmFja0RhdGE7XG5cbiAgICAgIC8vIENyZWF0ZSByYXcgc2lnbmF0dXJlIGZvciB2ZXJpZmljYXRpb25cbiAgICAgIGNvbnN0IHJhd1NpZ25hdHVyZSA9IFtcbiAgICAgICAgYGFjY2Vzc0tleT0ke3RoaXMuY29uZmlnLmFjY2Vzc0tleX1gLFxuICAgICAgICBgYW1vdW50PSR7YW1vdW50fWAsXG4gICAgICAgIGBleHRyYURhdGE9JHtleHRyYURhdGF9YCxcbiAgICAgICAgYG1lc3NhZ2U9JHttZXNzYWdlfWAsXG4gICAgICAgIGBvcmRlcklkPSR7b3JkZXJJZH1gLFxuICAgICAgICBgb3JkZXJJbmZvPSR7b3JkZXJJbmZvfWAsXG4gICAgICAgIGBvcmRlclR5cGU9JHtvcmRlclR5cGV9YCxcbiAgICAgICAgYHBhcnRuZXJDb2RlPSR7cGFydG5lckNvZGV9YCxcbiAgICAgICAgYHBheVR5cGU9JHtwYXlUeXBlfWAsXG4gICAgICAgIGByZXF1ZXN0SWQ9JHtyZXF1ZXN0SWR9YCxcbiAgICAgICAgYHJlc3BvbnNlVGltZT0ke3Jlc3BvbnNlVGltZX1gLFxuICAgICAgICBgcmVzdWx0Q29kZT0ke3Jlc3VsdENvZGV9YCxcbiAgICAgICAgYHRyYW5zSWQ9JHt0cmFuc0lkfWBcbiAgICAgIF0uam9pbignJicpO1xuXG4gICAgICBjb25zdCBleHBlY3RlZFNpZ25hdHVyZSA9IHRoaXMuZ2VuZXJhdGVTaWduYXR1cmUocmF3U2lnbmF0dXJlKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHNpZ25hdHVyZSA9PT0gZXhwZWN0ZWRTaWduYXR1cmU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ01vTW8gY2FsbGJhY2sgdmVyaWZpY2F0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHBheW1lbnQgc3RhdHVzXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBvcmRlcklkIC0gT3JkZXIgSURcbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlcXVlc3RJZCAtIFJlcXVlc3QgSURcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gLSBQYXltZW50IHN0YXR1c1xuICAgKi9cbiAgYXN5bmMgY2hlY2tQYXltZW50U3RhdHVzKG9yZGVySWQsIHJlcXVlc3RJZCkge1xuICAgIHRyeSB7XG4gICAgICAvLyBUaGlzIHdvdWxkIHR5cGljYWxseSBjYWxsIE1vTW8ncyBxdWVyeSBBUElcbiAgICAgIC8vIEZvciBub3csIHdlJ2xsIHJldHVybiBhIHBsYWNlaG9sZGVyIHJlc3BvbnNlXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICByZXN1bHRDb2RlOiAwLFxuICAgICAgICBtZXNzYWdlOiAnUGF5bWVudCBzdGF0dXMgY2hlY2sgbm90IGltcGxlbWVudGVkIHlldCdcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1BheW1lbnQgc3RhdHVzIGNoZWNrIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICAgIH07XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IE1vTW9TZXJ2aWNlKCk7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDaEMsTUFBTUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsT0FBTyxDQUFDO0FBRTlCLE1BQU1FLFdBQVcsQ0FBQztFQUNoQkMsV0FBV0EsQ0FBQSxFQUFHO0lBQ1o7SUFDQSxJQUFJLENBQUNDLE1BQU0sR0FBRztNQUNaQyxTQUFTLEVBQUVDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxlQUFlLElBQUksZUFBZTtNQUN6REMsU0FBUyxFQUFFSCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0csZUFBZSxJQUFJLGtDQUFrQztNQUM1RUMsV0FBVyxFQUFFTCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0ssaUJBQWlCLElBQUksTUFBTTtNQUNw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","map":{"version":3,"names":["crypto","require","https","MoMoService","constructor","config","accessKey","process","env","MOMO_ACCESS_KEY","secretKey","MOMO_SECRET_KEY","partnerCode","MOMO_PARTNER_CODE","redirectUrl","MOMO_REDIRECT_URL","ipnUrl","MOMO_IPN_URL","requestType","autoCapture","lang","endpoint","MOMO_ENDPOINT","generateSignature","rawSignature","createHmac","update","digest","createPayment","paymentData","orderId","amount","orderInfo","extraData","requestId","Date","now","join","signature","requestBody","partnerName","storeId","toString","console","log","response","makeHttpsRequest","success","data","error","message","code","Promise","resolve","reject","postData","JSON","stringify","options","hostname","port","path","method","headers","Buffer","byteLength","req","request","res","on","chunk","parse","status","statusCode","resultCode","Error","parseError","destroy","setTimeout","write","end","verifyCallback","callbackData","orderType","transId","payType","responseTime","expectedSignature","checkPaymentStatus","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\services\\","sources":["momoService.js"],"sourcesContent":["const crypto = require('crypto');\nconst https = require('https');\n\nclass MoMoService {\n  constructor() {\n    // MoMo API configuration - these should be moved to environment variables in production\n    this.config = {\n      accessKey: process.env.MOMO_ACCESS_KEY || 'F8BBA842ECF85',\n      secretKey: process.env.MOMO_SECRET_KEY || 'K951B6PE1waDMi640xX08PD3vg6EkVlz',\n      partnerCode: process.env.MOMO_PARTNER_CODE || 'MOMO',\n      redirectUrl: process.env.MOMO_REDIRECT_URL || 'http://localhost:5173/momo/return',\n      ipnUrl: process.env.MOMO_IPN_URL || 'http://localhost:5003/api/payments/momo/callback',\n      requestType: 'payWithMethod',\n      autoCapture: true,\n      lang: 'vi',\n      endpoint: process.env.MOMO_ENDPOINT || 'https://test-payment.momo.vn/v2/gateway/api/create'\n    };\n  }\n\n  /**\n   * Generate HMAC SHA256 signature for MoMo API\n   * @param {string} rawSignature - Raw signature string\n   * @returns {string} - Generated signature\n   */\n  generateSignature(rawSignature) {\n    return crypto\n      .createHmac('sha256', this.config.secretKey)\n      .update(rawSignature)\n      .digest('hex');\n  }\n\n  /**\n   * Create MoMo payment request\n   * @param {Object} paymentData - Payment information\n   * @param {string} paymentData.orderId - Order ID\n   * @param {number} paymentData.amount - Payment amount\n   * @param {string} paymentData.orderInfo - Order description\n   * @param {string} paymentData.extraData - Additional data (optional)\n   * @returns {Promise<Object>} - MoMo payment response\n   */\n  async createPayment(paymentData) {\n    try {\n      const {\n        orderId,\n        amount,\n        orderInfo = 'Payment for DREAM COFFEE order',\n        extraData = ''\n      } = paymentData;\n\n      // Generate unique request ID\n      const requestId = `${this.config.partnerCode}${Date.now()}`;\n      \n      // Create raw signature string\n      const rawSignature = [\n        `accessKey=${this.config.accessKey}`,\n        `amount=${amount}`,\n        `extraData=${extraData}`,\n        `ipnUrl=${this.config.ipnUrl}`,\n        `orderId=${orderId}`,\n        `orderInfo=${orderInfo}`,\n        `partnerCode=${this.config.partnerCode}`,\n        `redirectUrl=${this.config.redirectUrl}`,\n        `requestId=${requestId}`,\n        `requestType=${this.config.requestType}`\n      ].join('&');\n\n      // Generate signature\n      const signature = this.generateSignature(rawSignature);\n\n      // Prepare request body\n      const requestBody = {\n        partnerCode: this.config.partnerCode,\n        partnerName: 'DREAM COFFEE',\n        storeId: 'DreamCoffeeStore',\n        requestId,\n        amount: amount.toString(),\n        orderId,\n        orderInfo,\n        redirectUrl: this.config.redirectUrl,\n        ipnUrl: this.config.ipnUrl,\n        lang: this.config.lang,\n        requestType: this.config.requestType,\n        autoCapture: this.config.autoCapture,\n        extraData,\n        signature\n      };\n\n      console.log('MoMo Payment Request:', {\n        orderId,\n        amount,\n        requestId,\n        rawSignature\n      });\n\n      // Make request to MoMo API\n      const response = await this.makeHttpsRequest(requestBody);\n      \n      return {\n        success: true,\n        data: response,\n        requestId,\n        orderId\n      };\n    } catch (error) {\n      console.error('MoMo payment creation failed:', error);\n      return {\n        success: false,\n        error: error.message,\n        code: error.code || 'MOMO_ERROR'\n      };\n    }\n  }\n\n  /**\n   * Make HTTPS request to MoMo API\n   * @param {Object} requestBody - Request payload\n   * @returns {Promise<Object>} - API response\n   */\n  makeHttpsRequest(requestBody) {\n    return new Promise((resolve, reject) => {\n      const postData = JSON.stringify(requestBody);\n      \n      const options = {\n        hostname: 'test-payment.momo.vn',\n        port: 443,\n        path: '/v2/gateway/api/create',\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Content-Length': Buffer.byteLength(postData)\n        }\n      };\n\n      const req = https.request(options, (res) => {\n        let data = '';\n        \n        res.on('data', (chunk) => {\n          data += chunk;\n        });\n        \n        res.on('end', () => {\n          try {\n            const response = JSON.parse(data);\n            console.log('MoMo API Response:', {\n              status: res.statusCode,\n              resultCode: response.resultCode,\n              message: response.message\n            });\n            \n            if (res.statusCode === 200) {\n              resolve(response);\n            } else {\n              reject(new Error(`HTTP ${res.statusCode}: ${response.message || 'Unknown error'}`));\n            }\n          } catch (parseError) {\n            reject(new Error(`Failed to parse MoMo response: ${parseError.message}`));\n          }\n        });\n      });\n\n      req.on('error', (error) => {\n        console.error('MoMo HTTPS request error:', error);\n        reject(new Error(`Network error: ${error.message}`));\n      });\n\n      req.on('timeout', () => {\n        req.destroy();\n        reject(new Error('Request timeout'));\n      });\n\n      // Set timeout\n      req.setTimeout(30000); // 30 seconds\n      \n      // Send request\n      req.write(postData);\n      req.end();\n    });\n  }\n\n  /**\n   * Verify MoMo callback signature\n   * @param {Object} callbackData - Callback data from MoMo\n   * @returns {boolean} - Signature verification result\n   */\n  verifyCallback(callbackData) {\n    try {\n      const {\n        partnerCode,\n        orderId,\n        requestId,\n        amount,\n        orderInfo,\n        orderType,\n        transId,\n        resultCode,\n        message,\n        payType,\n        responseTime,\n        extraData,\n        signature\n      } = callbackData;\n\n      // Create raw signature for verification\n      const rawSignature = [\n        `accessKey=${this.config.accessKey}`,\n        `amount=${amount}`,\n        `extraData=${extraData}`,\n        `message=${message}`,\n        `orderId=${orderId}`,\n        `orderInfo=${orderInfo}`,\n        `orderType=${orderType}`,\n        `partnerCode=${partnerCode}`,\n        `payType=${payType}`,\n        `requestId=${requestId}`,\n        `responseTime=${responseTime}`,\n        `resultCode=${resultCode}`,\n        `transId=${transId}`\n      ].join('&');\n\n      const expectedSignature = this.generateSignature(rawSignature);\n      \n      return signature === expectedSignature;\n    } catch (error) {\n      console.error('MoMo callback verification failed:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Check payment status\n   * @param {string} orderId - Order ID\n   * @param {string} requestId - Request ID\n   * @returns {Promise<Object>} - Payment status\n   */\n  async checkPaymentStatus(orderId, requestId) {\n    try {\n      // This would typically call MoMo's query API\n      // For now, we'll return a placeholder response\n      return {\n        success: true,\n        resultCode: 0,\n        message: 'Payment status check not implemented yet'\n      };\n    } catch (error) {\n      console.error('Payment status check failed:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n}\n\nmodule.exports = new MoMoService();"],"mappings":"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","ignoreList":[]}},"mtime":1757007727186},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\config\\\\vnpay.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const crypto = require('crypto');\nclass VNPayConfig {\n  constructor() {\n    this.vnp_TmnCode = process.env.VNP_TMNCODE;\n    this.vnp_HashSecret = process.env.VNP_HASHSECRET;\n    this.vnp_Url = 'https://sandbox.vnpayment.vn/paymentv2/vpcpay.html';\n    this.vnp_ReturnUrl = process.env.VNP_RETURN_URL;\n    this.vnp_IpnUrl = process.env.VNP_IPN_URL || `${process.env.VNP_RETURN_URL}/ipn`;\n    this.vnp_Version = '2.1.0';\n    this.vnp_Command = 'pay';\n    this.vnp_CurrCode = 'VND';\n    this.vnp_Locale = 'vn';\n  }\n\n  // Sort object by key\n  sortObject(obj) {\n    let sorted = {};\n    let str = [];\n    let key;\n    for (key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        str.push(encodeURIComponent(key));\n      }\n    }\n    str.sort();\n    for (key = 0; key < str.length; key++) {\n      sorted[str[key]] = encodeURIComponent(obj[str[key]]).replace(/%20/g, \"+\");\n    }\n    return sorted;\n  }\n\n  // Create payment URL\n  createPaymentUrl(orderId, amount, orderInfo, ipAddr, bankCode = '') {\n    // Validate required parameters\n    if (!orderId || !amount || !orderInfo || !ipAddr) {\n      throw new Error('Missing required parameters for VNPay payment');\n    }\n\n    // Validate amount (must be positive integer)\n    const amountInt = parseInt(amount);\n    if (isNaN(amountInt) || amountInt <= 0) {\n      throw new Error('Invalid amount for VNPay payment');\n    }\n\n    // Validate orderId format (alphanumeric only, max 100 chars)\n    if (!/^[a-zA-Z0-9]+$/.test(orderId) || orderId.length > 100) {\n      throw new Error('Invalid orderId format for VNPay payment');\n    }\n    const date = new Date();\n    const createDate = this.formatDate(date);\n    const expireDate = this.formatDate(new Date(date.getTime() + 15 * 60 * 1000)); // 15 minutes\n\n    // Clean orderInfo to remove special characters and limit length\n    const cleanOrderInfo = orderInfo.replace(/[^a-zA-Z0-9\\s]/g, '').trim().substring(0, 255);\n    let vnp_Params = {\n      vnp_Version: this.vnp_Version,\n      vnp_Command: this.vnp_Command,\n      vnp_TmnCode: this.vnp_TmnCode,\n      vnp_Locale: this.vnp_Locale,\n      vnp_CurrCode: this.vnp_CurrCode,\n      vnp_TxnRef: orderId,\n      vnp_OrderInfo: cleanOrderInfo,\n      vnp_OrderType: 'other',\n      vnp_Amount: amountInt * 100,\n      // VNPay requires amount in VND cents\n      vnp_ReturnUrl: this.vnp_ReturnUrl,\n      vnp_IpAddr: ipAddr,\n      vnp_CreateDate: createDate,\n      vnp_ExpireDate: expireDate\n    };\n    if (bankCode) {\n      vnp_Params.vnp_BankCode = bankCode;\n    }\n    vnp_Params = this.sortObject(vnp_Params);\n    const qs = require('qs');\n    const signData = qs.stringify(vnp_Params, {\n      encode: false\n    });\n    const hmac = crypto.createHmac('sha512', this.vnp_HashSecret);\n    const signed = hmac.update(Buffer.from(signData, 'utf-8')).digest('hex');\n    vnp_Params.vnp_SecureHash = signed;\n    return this.vnp_Url + '?' + qs.stringify(vnp_Params, {\n      encode: false\n    });\n  }\n\n  // Verify return URL\n  verifyReturnUrl(vnp_Params) {\n    const secureHash = vnp_Params.vnp_SecureHash;\n    delete vnp_Params.vnp_SecureHash;\n    delete vnp_Params.vnp_SecureHashType;\n    const sortedParams = this.sortObject(vnp_Params);\n    const qs = require('qs');\n    const signData = qs.stringify(sortedParams, {\n      encode: false\n    });\n    const hmac = crypto.createHmac('sha512', this.vnp_HashSecret);\n    const signed = hmac.update(Buffer.from(signData, 'utf-8')).digest('hex');\n    return secureHash === signed;\n  }\n\n  // Format date for VNPay\n  formatDate(date) {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    const hours = String(date.getHours()).padStart(2, '0');\n    const minutes = String(date.getMinutes()).padStart(2, '0');\n    const seconds = String(date.getSeconds()).padStart(2, '0');\n    return `${year}${month}${day}${hours}${minutes}${seconds}`;\n  }\n\n  // Get payment status message\n  getPaymentStatus(responseCode) {\n    const statusMap = {\n      '00': 'Giao dịch thành công',\n      '07': 'Trừ tiền thành công. Giao dịch bị nghi ngờ (liên quan tới lừa đảo, giao dịch bất thường).',\n      '09': 'Giao dịch không thành công do: Thẻ/Tài khoản của khách hàng chưa đăng ký dịch vụ InternetBanking tại ngân hàng.',\n      '10': 'Giao dịch không thành công do: Khách hàng xác thực thông tin thẻ/tài khoản không đúng quá 3 lần',\n      '11': 'Giao dịch không thành công do: Đã hết hạn chờ thanh toán. Xin quý khách vui lòng thực hiện lại giao dịch.',\n      '12': 'Giao dịch không thành công do: Thẻ/Tài khoản của khách hàng bị khóa.',\n      '13': 'Giao dịch không thành công do Quý khách nhập sai mật khẩu xác thực giao dịch (OTP). Xin quý khách vui lòng thực hiện lại giao dịch.',\n      '24': 'Giao dịch không thành công do: Khách hàng hủy giao dịch',\n      '51': 'Giao dịch không thành công do: Tài khoản của quý khách không đủ số dư để thực hiện giao dịch.',\n      '65': 'Giao dịch không thành công do: Tài khoản của Quý khách đã vượt quá hạn mức giao dịch trong ngày.',\n      '75': 'Ngân hàng thanh toán đang bảo trì.',\n      '79': 'Giao dịch không thành công do: KH nhập sai mật khẩu thanh toán quá số lần quy định. Xin quý khách vui lòng thực hiện lại giao dịch',\n      '99': 'Các lỗi khác (lỗi còn lại, không có trong danh sách mã lỗi đã liệt kê)'\n    };\n    return statusMap[responseCode] || 'Lỗi không xác định';\n  }\n}\nmodule.exports = new VNPayConfig();\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcnlwdG8iLCJyZXF1aXJlIiwiVk5QYXlDb25maWciLCJjb25zdHJ1Y3RvciIsInZucF9UbW5Db2RlIiwicHJvY2VzcyIsImVudiIsIlZOUF9UTU5DT0RFIiwidm5wX0hhc2hTZWNyZXQiLCJWTlBfSEFTSFNFQ1JFVCIsInZucF9VcmwiLCJ2bnBfUmV0dXJuVXJsIiwiVk5QX1JFVFVSTl9VUkwiLCJ2bnBfSXBuVXJsIiwiVk5QX0lQTl9VUkwiLCJ2bnBfVmVyc2lvbiIsInZucF9Db21tYW5kIiwidm5wX0N1cnJDb2RlIiwidm5wX0xvY2FsZSIsInNvcnRPYmplY3QiLCJvYmoiLCJzb3J0ZWQiLCJzdHIiLCJrZXkiLCJoYXNPd25Qcm9wZXJ0eSIsInB1c2giLCJlbmNvZGVVUklDb21wb25lbnQiLCJzb3J0IiwibGVuZ3RoIiwicmVwbGFjZSIsImNyZWF0ZVBheW1lbnRVcmwiLCJvcmRlcklkIiwiYW1vdW50Iiwib3JkZXJJbmZvIiwiaXBBZGRyIiwiYmFua0NvZGUiLCJFcnJvciIsImFtb3VudEludCIsInBhcnNlSW50IiwiaXNOYU4iLCJ0ZXN0IiwiZGF0ZSIsIkRhdGUiLCJjcmVhdGVEYXRlIiwiZm9ybWF0RGF0ZSIsImV4cGlyZURhdGUiLCJnZXRUaW1lIiwiY2xlYW5PcmRlckluZm8iLCJ0cmltIiwic3Vic3RyaW5nIiwidm5wX1BhcmFtcyIsInZucF9UeG5SZWYiLCJ2bnBfT3JkZXJJbmZvIiwidm5wX09yZGVyVHlwZSIsInZucF9BbW91bnQiLCJ2bnBfSXBBZGRyIiwidm5wX0NyZWF0ZURhdGUiLCJ2bnBfRXhwaXJlRGF0ZSIsInZucF9CYW5rQ29kZSIsInFzIiwic2lnbkRhdGEiLCJzdHJpbmdpZnkiLCJlbmNvZGUiLCJobWFjIiwiY3JlYXRlSG1hYyIsInNpZ25lZCIsInVwZGF0ZSIsIkJ1ZmZlciIsImZyb20iLCJkaWdlc3QiLCJ2bnBfU2VjdXJlSGFzaCIsInZlcmlmeVJldHVyblVybCIsInNlY3VyZUhhc2giLCJ2bnBfU2VjdXJlSGFzaFR5cGUiLCJzb3J0ZWRQYXJhbXMiLCJ5ZWFyIiwiZ2V0RnVsbFllYXIiLCJtb250aCIsIlN0cmluZyIsImdldE1vbnRoIiwicGFkU3RhcnQiLCJkYXkiLCJnZXREYXRlIiwiaG91cnMiLCJnZXRIb3VycyIsIm1pbnV0ZXMiLCJnZXRNaW51dGVzIiwic2Vjb25kcyIsImdldFNlY29uZHMiLCJnZXRQYXltZW50U3RhdHVzIiwicmVzcG9uc2VDb2RlIiwic3RhdHVzTWFwIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXGNvbmZpZ1xcIiwic291cmNlcyI6WyJ2bnBheS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcblxuY2xhc3MgVk5QYXlDb25maWcge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnZucF9UbW5Db2RlID0gcHJvY2Vzcy5lbnYuVk5QX1RNTkNPREU7XG4gICAgdGhpcy52bnBfSGFzaFNlY3JldCA9IHByb2Nlc3MuZW52LlZOUF9IQVNIU0VDUkVUO1xuICAgIHRoaXMudm5wX1VybCA9ICdodHRwczovL3NhbmRib3gudm5wYXltZW50LnZuL3BheW1lbnR2Mi92cGNwYXkuaHRtbCc7XG4gICAgdGhpcy52bnBfUmV0dXJuVXJsID0gcHJvY2Vzcy5lbnYuVk5QX1JFVFVSTl9VUkw7XG4gICAgdGhpcy52bnBfSXBuVXJsID0gcHJvY2Vzcy5lbnYuVk5QX0lQTl9VUkwgfHwgYCR7cHJvY2Vzcy5lbnYuVk5QX1JFVFVSTl9VUkx9L2lwbmA7XG4gICAgdGhpcy52bnBfVmVyc2lvbiA9ICcyLjEuMCc7XG4gICAgdGhpcy52bnBfQ29tbWFuZCA9ICdwYXknO1xuICAgIHRoaXMudm5wX0N1cnJDb2RlID0gJ1ZORCc7XG4gICAgdGhpcy52bnBfTG9jYWxlID0gJ3ZuJztcbiAgfVxuXG4gIC8vIFNvcnQgb2JqZWN0IGJ5IGtleVxuICBzb3J0T2JqZWN0KG9iaikge1xuICAgIGxldCBzb3J0ZWQgPSB7fTtcbiAgICBsZXQgc3RyID0gW107XG4gICAgbGV0IGtleTtcbiAgICBmb3IgKGtleSBpbiBvYmopIHtcbiAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICBzdHIucHVzaChlbmNvZGVVUklDb21wb25lbnQoa2V5KSk7XG4gICAgICB9XG4gICAgfVxuICAgIHN0ci5zb3J0KCk7XG4gICAgZm9yIChrZXkgPSAwOyBrZXkgPCBzdHIubGVuZ3RoOyBrZXkrKykge1xuICAgICAgc29ydGVkW3N0cltrZXldXSA9IGVuY29kZVVSSUNvbXBvbmVudChvYmpbc3RyW2tleV1dKS5yZXBsYWNlKC8lMjAvZywgXCIrXCIpO1xuICAgIH1cbiAgICByZXR1cm4gc29ydGVkO1xuICB9XG5cbiAgLy8gQ3JlYXRlIHBheW1lbnQgVVJMXG4gIGNyZWF0ZVBheW1lbnRVcmwob3JkZXJJZCwgYW1vdW50LCBvcmRlckluZm8sIGlwQWRkciwgYmFua0NvZGUgPSAnJykge1xuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIHBhcmFtZXRlcnNcbiAgICBpZiAoIW9yZGVySWQgfHwgIWFtb3VudCB8fCAhb3JkZXJJbmZvIHx8ICFpcEFkZHIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyByZXF1aXJlZCBwYXJhbWV0ZXJzIGZvciBWTlBheSBwYXltZW50Jyk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgYW1vdW50IChtdXN0IGJlIHBvc2l0aXZlIGludGVnZXIpXG4gICAgY29uc3QgYW1vdW50SW50ID0gcGFyc2VJbnQoYW1vdW50KTtcbiAgICBpZiAoaXNOYU4oYW1vdW50SW50KSB8fCBhbW91bnRJbnQgPD0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGFtb3VudCBmb3IgVk5QYXkgcGF5bWVudCcpO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIG9yZGVySWQgZm9ybWF0IChhbHBoYW51bWVyaWMgb25seSwgbWF4IDEwMCBjaGFycylcbiAgICBpZiAoIS9eW2EtekEtWjAtOV0rJC8udGVzdChvcmRlcklkKSB8fCBvcmRlcklkLmxlbmd0aCA+IDEwMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIG9yZGVySWQgZm9ybWF0IGZvciBWTlBheSBwYXltZW50Jyk7XG4gICAgfVxuXG4gICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgY3JlYXRlRGF0ZSA9IHRoaXMuZm9ybWF0RGF0ZShkYXRlKTtcbiAgICBjb25zdCBleHBpcmVEYXRlID0gdGhpcy5mb3JtYXREYXRlKG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpICsgMTUgKiA2MCAqIDEwMDApKTsgLy8gMTUgbWludXRlc1xuXG4gICAgLy8gQ2xlYW4gb3JkZXJJbmZvIHRvIHJlbW92ZSBzcGVjaWFsIGNoYXJhY3RlcnMgYW5kIGxpbWl0IGxlbmd0aFxuICAgIGNvbnN0IGNsZWFuT3JkZXJJbmZvID0gb3JkZXJJbmZvLnJlcGxhY2UoL1teYS16QS1aMC05XFxzXS9nLCAnJykudHJpbSgpLnN1YnN0cmluZygwLCAyNTUpO1xuXG4gICAgbGV0IHZucF9QYXJhbXMgPSB7XG4gICAgICB2bnBfVmVyc2lvbjogdGhpcy52bnBfVmVyc2lvbixcbiAgICAgIHZucF9Db21tYW5kOiB0aGlzLnZucF9Db21tYW5kLFxuICAgICAgdm5wX1RtbkNvZGU6IHRoaXMudm5wX1RtbkNvZGUsXG4gICAgICB2bnBfTG9jYWxlOiB0aGlzLnZucF9Mb2NhbGUsXG4gICAgICB2bnBfQ3VyckNvZGU6IHRoaXMudm5wX0N1cnJDb2RlLFxuICAgICAgdm5wX1R4blJlZjogb3JkZXJJZCxcbiAgICAgIHZucF9PcmRlckluZm86IGNsZWFuT3JkZXJJbmZvLFxuICAgICAgdm5wX09yZGVyVHlwZTogJ290aGVyJyxcbiAgICAgIHZucF9BbW91bnQ6IGFtb3VudEludCAqIDEwMCwgLy8gVk5QYXkgcmVxdWlyZXMgYW1vdW50IGluIFZORCBjZW50c1xuICAgICAgdm5wX1JldHVyblVybDogdGhpcy52bnBfUmV0dXJuVXJsLFxuICAgICAgdm5wX0lwQWRkcjogaXBBZGRyLFxuICAgICAgdm5wX0NyZWF0ZURhdGU6IGNyZWF0ZURhdGUsXG4gICAgICB2bnBfRXhwaXJlRGF0ZTogZXhwaXJlRGF0ZVxuICAgIH07XG5cbiAgICBpZiAoYmFua0NvZGUpIHtcbiAgICAgIHZucF9QYXJhbXMudm5wX0JhbmtDb2RlID0gYmFua0NvZGU7XG4gICAgfVxuXG4gICAgdm5wX1BhcmFtcyA9IHRoaXMuc29ydE9iamVjdCh2bnBfUGFyYW1zKTtcblxuICAgIGNvbnN0IHFzID0gcmVxdWlyZSgncXMnKTtcbiAgICBjb25zdCBzaWduRGF0YSA9IHFzLnN0cmluZ2lmeSh2bnBfUGFyYW1zLCB7IGVuY29kZTogZmFsc2UgfSk7XG4gICAgY29uc3QgaG1hYyA9IGNyeXB0by5jcmVhdGVIbWFjKCdzaGE1MTInLCB0aGlzLnZucF9IYXNoU2VjcmV0KTtcbiAgICBjb25zdCBzaWduZWQgPSBobWFjLnVwZGF0ZShCdWZmZXIuZnJvbShzaWduRGF0YSwgJ3V0Zi04JykpLmRpZ2VzdCgnaGV4Jyk7XG4gICAgdm5wX1BhcmFtcy52bnBfU2VjdXJlSGFzaCA9IHNpZ25lZDtcblxuICAgIHJldHVybiB0aGlzLnZucF9VcmwgKyAnPycgKyBxcy5zdHJpbmdpZnkodm5wX1BhcmFtcywgeyBlbmNvZGU6IGZhbHNlIH0pO1xuICB9XG5cbiAgLy8gVmVyaWZ5IHJldHVybiBVUkxcbiAgdmVyaWZ5UmV0dXJuVXJsKHZucF9QYXJhbXMpIHtcbiAgICBjb25zdCBzZWN1cmVIYXNoID0gdm5wX1BhcmFtcy52bnBfU2VjdXJlSGFzaDtcbiAgICBkZWxldGUgdm5wX1BhcmFtcy52bnBfU2VjdXJlSGFzaDtcbiAgICBkZWxldGUgdm5wX1BhcmFtcy52bnBfU2VjdXJlSGFzaFR5cGU7XG5cbiAgICBjb25zdCBzb3J0ZWRQYXJhbXMgPSB0aGlzLnNvcnRPYmplY3Qodm5wX1BhcmFtcyk7XG4gICAgXG4gICAgY29uc3QgcXMgPSByZXF1aXJlKCdxcycpO1xuICAgIGNvbnN0IHNpZ25EYXRhID0gcXMuc3RyaW5naWZ5KHNvcnRlZFBhcmFtcywgeyBlbmNvZGU6IGZhbHNlIH0pO1xuICAgIGNvbnN0IGhtYWMgPSBjcnlwdG8uY3JlYXRlSG1hYygnc2hhNTEyJywgdGhpcy52bnBfSGFzaFNlY3JldCk7XG4gICAgY29uc3Qgc2lnbmVkID0gaG1hYy51cGRhdGUoQnVmZmVyLmZyb20oc2lnbkRhdGEsICd1dGYtOCcpKS5kaWdlc3QoJ2hleCcpO1xuXG4gICAgcmV0dXJuIHNlY3VyZUhhc2ggPT09IHNpZ25lZDtcbiAgfVxuXG4gIC8vIEZvcm1hdCBkYXRlIGZvciBWTlBheVxuICBmb3JtYXREYXRlKGRhdGUpIHtcbiAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgIGNvbnN0IG1vbnRoID0gU3RyaW5nKGRhdGUuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsICcwJyk7XG4gICAgY29uc3QgZGF5ID0gU3RyaW5nKGRhdGUuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgIGNvbnN0IGhvdXJzID0gU3RyaW5nKGRhdGUuZ2V0SG91cnMoKSkucGFkU3RhcnQoMiwgJzAnKTtcbiAgICBjb25zdCBtaW51dGVzID0gU3RyaW5nKGRhdGUuZ2V0TWludXRlcygpKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgIGNvbnN0IHNlY29uZHMgPSBTdHJpbmcoZGF0ZS5nZXRTZWNvbmRzKCkpLnBhZFN0YXJ0KDIsICcwJyk7XG4gICAgcmV0dXJuIGAke3llYXJ9JHttb250aH0ke2RheX0ke2hvdXJzfSR7bWludXRlc30ke3NlY29uZHN9YDtcbiAgfVxuXG4gIC8vIEdldCBwYXltZW50IHN0YXR1cyBtZXNzYWdlXG4gIGdldFBheW1lbnRTdGF0dXMocmVzcG9uc2VDb2RlKSB7XG4gICAgY29uc3Qgc3RhdHVzTWFwID0ge1xuICAgICAgJzAwJzogJ0dpYW8gZOG7i2NoIHRow6BuaCBjw7RuZycsXG4gICAgICAnMDcnOiAnVHLhu6sgdGnhu4FuIHRow6BuaCBjw7RuZy4gR2lhbyBk4buLY2ggYuG7iyBuZ2hpIG5n4budIChsacOqbiBxdWFuIHThu5tpIGzhu6thIMSR4bqjbywgZ2lhbyBk4buLY2ggYuG6pXQgdGjGsOG7nW5nKS4nLFxuICAgICAgJzA5JzogJ0dpYW8gZOG7i2NoIGtow7RuZyB0aMOgbmggY8O0bmcgZG86IFRo4bq7L1TDoGkga2hv4bqjbiBj4bunYSBraMOhY2ggaMOgbmcgY2jGsGEgxJHEg25nIGvDvSBk4buLY2ggduG7pSBJbnRlcm5ldEJhbmtpbmcgdOG6oWkgbmfDom4gaMOgbmcuJyxcbiAgICAgICcxMCc6ICdHaWFvIGThu4tjaCBraMO0bmcgdGjDoG5oIGPDtG5nIGRvOiBLaMOhY2ggaMOgbmcgeMOhYyB0aOG7sWMgdGjDtG5nIHRpbiB0aOG6uy90w6BpIGtob+G6o24ga2jDtG5nIMSRw7puZyBxdcOhIDMgbOG6p24nLFxuICAgICAgJzExJzogJ0dpYW8gZOG7i2NoIGtow7RuZyB0aMOgbmggY8O0bmcgZG86IMSQw6MgaOG6v3QgaOG6oW4gY2jhu50gdGhhbmggdG/DoW4uIFhpbiBxdcO9IGtow6FjaCB2dWkgbMOybmcgdGjhu7FjIGhp4buHbiBs4bqhaSBnaWFvIGThu4tjaC4nLFxuICAgICAgJzEyJzogJ0dpYW8gZOG7i2NoIGtow7RuZyB0aMOgbmggY8O0bmcgZG86IFRo4bq7L1TDoGkga2hv4bqjbiBj4bunYSBraMOhY2ggaMOgbmcgYuG7iyBraMOzYS4nLFxuICAgICAgJzEzJzogJ0dpYW8gZOG7i2NoIGtow7RuZyB0aMOgbmggY8O0bmcgZG8gUXXDvSBraMOhY2ggbmjhuq1wIHNhaSBt4bqtdCBraOG6qXUgeMOhYyB0aOG7sWMgZ2lhbyBk4buLY2ggKE9UUCkuIFhpbiBxdcO9IGtow6FjaCB2dWkgbMOybmcgdGjhu7FjIGhp4buHbiBs4bqhaSBnaWFvIGThu4tjaC4nLFxuICAgICAgJzI0JzogJ0dpYW8gZOG7i2NoIGtow7RuZyB0aMOgbmggY8O0bmcgZG86IEtow6FjaCBow6BuZyBo4buneSBnaWFvIGThu4tjaCcsXG4gICAgICAnNTEnOiAnR2lhbyBk4buLY2gga2jDtG5nIHRow6BuaCBjw7RuZyBkbzogVMOgaSBraG/huqNuIGPhu6dhIHF1w70ga2jDoWNoIGtow7RuZyDEkeG7pyBz4buRIGTGsCDEkeG7gyB0aOG7sWMgaGnhu4duIGdpYW8gZOG7i2NoLicsXG4gICAgICAnNjUnOiAnR2lhbyBk4buLY2gga2jDtG5nIHRow6BuaCBjw7RuZyBkbzogVMOgaSBraG/huqNuIGPhu6dhIFF1w70ga2jDoWNoIMSRw6Mgdsaw4bujdCBxdcOhIGjhuqFuIG3hu6ljIGdpYW8gZOG7i2NoIHRyb25nIG5nw6B5LicsXG4gICAgICAnNzUnOiAnTmfDom4gaMOgbmcgdGhhbmggdG/DoW4gxJFhbmcgYuG6o28gdHLDrC4nLFxuICAgICAgJzc5JzogJ0dpYW8gZOG7i2NoIGtow7RuZyB0aMOgbmggY8O0bmcgZG86IEtIIG5o4bqtcCBzYWkgbeG6rXQga2jhuql1IHRoYW5oIHRvw6FuIHF1w6Egc+G7kSBs4bqnbiBxdXkgxJHhu4tuaC4gWGluIHF1w70ga2jDoWNoIHZ1aSBsw7JuZyB0aOG7sWMgaGnhu4duIGzhuqFpIGdpYW8gZOG7i2NoJyxcbiAgICAgICc5OSc6ICdDw6FjIGzhu5dpIGtow6FjIChs4buXaSBjw7JuIGzhuqFpLCBraMO0bmcgY8OzIHRyb25nIGRhbmggc8OhY2ggbcOjIGzhu5dpIMSRw6MgbGnhu4d0IGvDqiknXG4gICAgfTtcbiAgICByZXR1cm4gc3RhdHVzTWFwW3Jlc3BvbnNlQ29kZV0gfHwgJ0zhu5dpIGtow7RuZyB4w6FjIMSR4buLbmgnO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IFZOUGF5Q29uZmlnKCk7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFFaEMsTUFBTUMsV0FBVyxDQUFDO0VBQ2hCQyxXQUFXQSxDQUFBLEVBQUc7SUFDWixJQUFJLENBQUNDLFdBQVcsR0FBR0MsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFdBQVc7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","map":{"version":3,"names":["crypto","require","VNPayConfig","constructor","vnp_TmnCode","process","env","VNP_TMNCODE","vnp_HashSecret","VNP_HASHSECRET","vnp_Url","vnp_ReturnUrl","VNP_RETURN_URL","vnp_IpnUrl","VNP_IPN_URL","vnp_Version","vnp_Command","vnp_CurrCode","vnp_Locale","sortObject","obj","sorted","str","key","hasOwnProperty","push","encodeURIComponent","sort","length","replace","createPaymentUrl","orderId","amount","orderInfo","ipAddr","bankCode","Error","amountInt","parseInt","isNaN","test","date","Date","createDate","formatDate","expireDate","getTime","cleanOrderInfo","trim","substring","vnp_Params","vnp_TxnRef","vnp_OrderInfo","vnp_OrderType","vnp_Amount","vnp_IpAddr","vnp_CreateDate","vnp_ExpireDate","vnp_BankCode","qs","signData","stringify","encode","hmac","createHmac","signed","update","Buffer","from","digest","vnp_SecureHash","verifyReturnUrl","secureHash","vnp_SecureHashType","sortedParams","year","getFullYear","month","String","getMonth","padStart","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","getPaymentStatus","responseCode","statusMap","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\config\\","sources":["vnpay.js"],"sourcesContent":["const crypto = require('crypto');\n\nclass VNPayConfig {\n  constructor() {\n    this.vnp_TmnCode = process.env.VNP_TMNCODE;\n    this.vnp_HashSecret = process.env.VNP_HASHSECRET;\n    this.vnp_Url = 'https://sandbox.vnpayment.vn/paymentv2/vpcpay.html';\n    this.vnp_ReturnUrl = process.env.VNP_RETURN_URL;\n    this.vnp_IpnUrl = process.env.VNP_IPN_URL || `${process.env.VNP_RETURN_URL}/ipn`;\n    this.vnp_Version = '2.1.0';\n    this.vnp_Command = 'pay';\n    this.vnp_CurrCode = 'VND';\n    this.vnp_Locale = 'vn';\n  }\n\n  // Sort object by key\n  sortObject(obj) {\n    let sorted = {};\n    let str = [];\n    let key;\n    for (key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        str.push(encodeURIComponent(key));\n      }\n    }\n    str.sort();\n    for (key = 0; key < str.length; key++) {\n      sorted[str[key]] = encodeURIComponent(obj[str[key]]).replace(/%20/g, \"+\");\n    }\n    return sorted;\n  }\n\n  // Create payment URL\n  createPaymentUrl(orderId, amount, orderInfo, ipAddr, bankCode = '') {\n    // Validate required parameters\n    if (!orderId || !amount || !orderInfo || !ipAddr) {\n      throw new Error('Missing required parameters for VNPay payment');\n    }\n\n    // Validate amount (must be positive integer)\n    const amountInt = parseInt(amount);\n    if (isNaN(amountInt) || amountInt <= 0) {\n      throw new Error('Invalid amount for VNPay payment');\n    }\n\n    // Validate orderId format (alphanumeric only, max 100 chars)\n    if (!/^[a-zA-Z0-9]+$/.test(orderId) || orderId.length > 100) {\n      throw new Error('Invalid orderId format for VNPay payment');\n    }\n\n    const date = new Date();\n    const createDate = this.formatDate(date);\n    const expireDate = this.formatDate(new Date(date.getTime() + 15 * 60 * 1000)); // 15 minutes\n\n    // Clean orderInfo to remove special characters and limit length\n    const cleanOrderInfo = orderInfo.replace(/[^a-zA-Z0-9\\s]/g, '').trim().substring(0, 255);\n\n    let vnp_Params = {\n      vnp_Version: this.vnp_Version,\n      vnp_Command: this.vnp_Command,\n      vnp_TmnCode: this.vnp_TmnCode,\n      vnp_Locale: this.vnp_Locale,\n      vnp_CurrCode: this.vnp_CurrCode,\n      vnp_TxnRef: orderId,\n      vnp_OrderInfo: cleanOrderInfo,\n      vnp_OrderType: 'other',\n      vnp_Amount: amountInt * 100, // VNPay requires amount in VND cents\n      vnp_ReturnUrl: this.vnp_ReturnUrl,\n      vnp_IpAddr: ipAddr,\n      vnp_CreateDate: createDate,\n      vnp_ExpireDate: expireDate\n    };\n\n    if (bankCode) {\n      vnp_Params.vnp_BankCode = bankCode;\n    }\n\n    vnp_Params = this.sortObject(vnp_Params);\n\n    const qs = require('qs');\n    const signData = qs.stringify(vnp_Params, { encode: false });\n    const hmac = crypto.createHmac('sha512', this.vnp_HashSecret);\n    const signed = hmac.update(Buffer.from(signData, 'utf-8')).digest('hex');\n    vnp_Params.vnp_SecureHash = signed;\n\n    return this.vnp_Url + '?' + qs.stringify(vnp_Params, { encode: false });\n  }\n\n  // Verify return URL\n  verifyReturnUrl(vnp_Params) {\n    const secureHash = vnp_Params.vnp_SecureHash;\n    delete vnp_Params.vnp_SecureHash;\n    delete vnp_Params.vnp_SecureHashType;\n\n    const sortedParams = this.sortObject(vnp_Params);\n    \n    const qs = require('qs');\n    const signData = qs.stringify(sortedParams, { encode: false });\n    const hmac = crypto.createHmac('sha512', this.vnp_HashSecret);\n    const signed = hmac.update(Buffer.from(signData, 'utf-8')).digest('hex');\n\n    return secureHash === signed;\n  }\n\n  // Format date for VNPay\n  formatDate(date) {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    const hours = String(date.getHours()).padStart(2, '0');\n    const minutes = String(date.getMinutes()).padStart(2, '0');\n    const seconds = String(date.getSeconds()).padStart(2, '0');\n    return `${year}${month}${day}${hours}${minutes}${seconds}`;\n  }\n\n  // Get payment status message\n  getPaymentStatus(responseCode) {\n    const statusMap = {\n      '00': 'Giao dịch thành công',\n      '07': 'Trừ tiền thành công. Giao dịch bị nghi ngờ (liên quan tới lừa đảo, giao dịch bất thường).',\n      '09': 'Giao dịch không thành công do: Thẻ/Tài khoản của khách hàng chưa đăng ký dịch vụ InternetBanking tại ngân hàng.',\n      '10': 'Giao dịch không thành công do: Khách hàng xác thực thông tin thẻ/tài khoản không đúng quá 3 lần',\n      '11': 'Giao dịch không thành công do: Đã hết hạn chờ thanh toán. Xin quý khách vui lòng thực hiện lại giao dịch.',\n      '12': 'Giao dịch không thành công do: Thẻ/Tài khoản của khách hàng bị khóa.',\n      '13': 'Giao dịch không thành công do Quý khách nhập sai mật khẩu xác thực giao dịch (OTP). Xin quý khách vui lòng thực hiện lại giao dịch.',\n      '24': 'Giao dịch không thành công do: Khách hàng hủy giao dịch',\n      '51': 'Giao dịch không thành công do: Tài khoản của quý khách không đủ số dư để thực hiện giao dịch.',\n      '65': 'Giao dịch không thành công do: Tài khoản của Quý khách đã vượt quá hạn mức giao dịch trong ngày.',\n      '75': 'Ngân hàng thanh toán đang bảo trì.',\n      '79': 'Giao dịch không thành công do: KH nhập sai mật khẩu thanh toán quá số lần quy định. Xin quý khách vui lòng thực hiện lại giao dịch',\n      '99': 'Các lỗi khác (lỗi còn lại, không có trong danh sách mã lỗi đã liệt kê)'\n    };\n    return statusMap[responseCode] || 'Lỗi không xác định';\n  }\n}\n\nmodule.exports = new VNPayConfig();"],"mappings":"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","ignoreList":[]}},"mtime":1757525399697},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\upload.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst multer = require('multer');\nconst {\n  uploadToCloudinary\n} = require('../config/cloudinary');\nconst router = express.Router();\n\n// Configure multer for memory storage\nconst storage = multer.memoryStorage();\n\n// File filter for images only\nconst fileFilter = (req, file, cb) => {\n  if (file.mimetype.startsWith('image/')) {\n    cb(null, true);\n  } else {\n    cb(new Error('Only image files are allowed!'), false);\n  }\n};\n\n// Configure multer\nconst upload = multer({\n  storage: storage,\n  fileFilter: fileFilter,\n  limits: {\n    fileSize: 5 * 1024 * 1024 // 5MB limit\n  }\n});\n\n// @route   POST /api/upload/image\n// @desc    Upload image to Cloudinary\n// @access  Public (can be made private later)\nrouter.post('/image', upload.single('image'), async (req, res) => {\n  try {\n    if (!req.file) {\n      return res.status(400).json({\n        success: false,\n        message: 'No image file provided'\n      });\n    }\n\n    // Upload to Cloudinary\n    const result = await uploadToCloudinary(req.file.buffer, {\n      folder: 'webcaffe/products',\n      transformation: [{\n        width: 800,\n        height: 600,\n        crop: 'fill',\n        quality: 'auto'\n      }, {\n        format: 'webp'\n      }]\n    });\n    res.json({\n      success: true,\n      data: {\n        imageUrl: result.url,\n        imagePublicId: result.publicId,\n        width: result.width,\n        height: result.height,\n        format: result.format\n      },\n      message: 'Image uploaded successfully'\n    });\n  } catch (error) {\n    console.error('Error uploading image:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Failed to upload image',\n      error: error.message\n    });\n  }\n});\n\n// @route   DELETE /api/upload/image/:publicId\n// @desc    Delete uploaded image from Cloudinary\n// @access  Private/Admin\nrouter.delete('/image/:publicId', async (req, res) => {\n  try {\n    const {\n      deleteFromCloudinary\n    } = require('../config/cloudinary');\n    const publicId = req.params.publicId;\n\n    // Delete from Cloudinary\n    const result = await deleteFromCloudinary(publicId);\n    if (result.result === 'ok') {\n      res.json({\n        success: true,\n        message: 'Image deleted successfully'\n      });\n    } else {\n      res.status(404).json({\n        success: false,\n        message: 'Image not found or already deleted'\n      });\n    }\n  } catch (error) {\n    console.error('Error deleting image:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while deleting image'\n    });\n  }\n});\n\n// Error handling middleware for multer\nrouter.use((error, req, res, next) => {\n  if (error instanceof multer.MulterError) {\n    if (error.code === 'LIMIT_FILE_SIZE') {\n      return res.status(400).json({\n        success: false,\n        message: 'File too large. Maximum size is 5MB.'\n      });\n    }\n  }\n  if (error.message) {\n    return res.status(400).json({\n      success: false,\n      message: error.message\n    });\n  }\n  next(error);\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsIm11bHRlciIsInVwbG9hZFRvQ2xvdWRpbmFyeSIsInJvdXRlciIsIlJvdXRlciIsInN0b3JhZ2UiLCJtZW1vcnlTdG9yYWdlIiwiZmlsZUZpbHRlciIsInJlcSIsImZpbGUiLCJjYiIsIm1pbWV0eXBlIiwic3RhcnRzV2l0aCIsIkVycm9yIiwidXBsb2FkIiwibGltaXRzIiwiZmlsZVNpemUiLCJwb3N0Iiwic2luZ2xlIiwicmVzIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwicmVzdWx0IiwiYnVmZmVyIiwiZm9sZGVyIiwidHJhbnNmb3JtYXRpb24iLCJ3aWR0aCIsImhlaWdodCIsImNyb3AiLCJxdWFsaXR5IiwiZm9ybWF0IiwiZGF0YSIsImltYWdlVXJsIiwidXJsIiwiaW1hZ2VQdWJsaWNJZCIsInB1YmxpY0lkIiwiZXJyb3IiLCJjb25zb2xlIiwiZGVsZXRlIiwiZGVsZXRlRnJvbUNsb3VkaW5hcnkiLCJwYXJhbXMiLCJ1c2UiLCJuZXh0IiwiTXVsdGVyRXJyb3IiLCJjb2RlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXHJvdXRlc1xcIiwic291cmNlcyI6WyJ1cGxvYWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IG11bHRlciA9IHJlcXVpcmUoJ211bHRlcicpO1xuY29uc3QgeyB1cGxvYWRUb0Nsb3VkaW5hcnkgfSA9IHJlcXVpcmUoJy4uL2NvbmZpZy9jbG91ZGluYXJ5Jyk7XG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4vLyBDb25maWd1cmUgbXVsdGVyIGZvciBtZW1vcnkgc3RvcmFnZVxuY29uc3Qgc3RvcmFnZSA9IG11bHRlci5tZW1vcnlTdG9yYWdlKCk7XG5cbi8vIEZpbGUgZmlsdGVyIGZvciBpbWFnZXMgb25seVxuY29uc3QgZmlsZUZpbHRlciA9IChyZXEsIGZpbGUsIGNiKSA9PiB7XG4gIGlmIChmaWxlLm1pbWV0eXBlLnN0YXJ0c1dpdGgoJ2ltYWdlLycpKSB7XG4gICAgY2IobnVsbCwgdHJ1ZSk7XG4gIH0gZWxzZSB7XG4gICAgY2IobmV3IEVycm9yKCdPbmx5IGltYWdlIGZpbGVzIGFyZSBhbGxvd2VkIScpLCBmYWxzZSk7XG4gIH1cbn07XG5cbi8vIENvbmZpZ3VyZSBtdWx0ZXJcbmNvbnN0IHVwbG9hZCA9IG11bHRlcih7XG4gIHN0b3JhZ2U6IHN0b3JhZ2UsXG4gIGZpbGVGaWx0ZXI6IGZpbGVGaWx0ZXIsXG4gIGxpbWl0czoge1xuICAgIGZpbGVTaXplOiA1ICogMTAyNCAqIDEwMjQsIC8vIDVNQiBsaW1pdFxuICB9LFxufSk7XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS91cGxvYWQvaW1hZ2Vcbi8vIEBkZXNjICAgIFVwbG9hZCBpbWFnZSB0byBDbG91ZGluYXJ5XG4vLyBAYWNjZXNzICBQdWJsaWMgKGNhbiBiZSBtYWRlIHByaXZhdGUgbGF0ZXIpXG5yb3V0ZXIucG9zdCgnL2ltYWdlJywgdXBsb2FkLnNpbmdsZSgnaW1hZ2UnKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgaWYgKCFyZXEuZmlsZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdObyBpbWFnZSBmaWxlIHByb3ZpZGVkJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVXBsb2FkIHRvIENsb3VkaW5hcnlcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGxvYWRUb0Nsb3VkaW5hcnkocmVxLmZpbGUuYnVmZmVyLCB7XG4gICAgICBmb2xkZXI6ICd3ZWJjYWZmZS9wcm9kdWN0cycsXG4gICAgICB0cmFuc2Zvcm1hdGlvbjogW1xuICAgICAgICB7IHdpZHRoOiA4MDAsIGhlaWdodDogNjAwLCBjcm9wOiAnZmlsbCcsIHF1YWxpdHk6ICdhdXRvJyB9LFxuICAgICAgICB7IGZvcm1hdDogJ3dlYnAnIH1cbiAgICAgIF1cbiAgICB9KTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGltYWdlVXJsOiByZXN1bHQudXJsLFxuICAgICAgICBpbWFnZVB1YmxpY0lkOiByZXN1bHQucHVibGljSWQsXG4gICAgICAgIHdpZHRoOiByZXN1bHQud2lkdGgsXG4gICAgICAgIGhlaWdodDogcmVzdWx0LmhlaWdodCxcbiAgICAgICAgZm9ybWF0OiByZXN1bHQuZm9ybWF0XG4gICAgICB9LFxuICAgICAgbWVzc2FnZTogJ0ltYWdlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseSdcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGxvYWRpbmcgaW1hZ2U6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGxvYWQgaW1hZ2UnLFxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIERFTEVURSAvYXBpL3VwbG9hZC9pbWFnZS86cHVibGljSWRcbi8vIEBkZXNjICAgIERlbGV0ZSB1cGxvYWRlZCBpbWFnZSBmcm9tIENsb3VkaW5hcnlcbi8vIEBhY2Nlc3MgIFByaXZhdGUvQWRtaW5cbnJvdXRlci5kZWxldGUoJy9pbWFnZS86cHVibGljSWQnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRlbGV0ZUZyb21DbG91ZGluYXJ5IH0gPSByZXF1aXJlKCcuLi9jb25maWcvY2xvdWRpbmFyeScpO1xuICAgIGNvbnN0IHB1YmxpY0lkID0gcmVxLnBhcmFtcy5wdWJsaWNJZDtcblxuICAgIC8vIERlbGV0ZSBmcm9tIENsb3VkaW5hcnlcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkZWxldGVGcm9tQ2xvdWRpbmFyeShwdWJsaWNJZCk7XG5cbiAgICBpZiAocmVzdWx0LnJlc3VsdCA9PT0gJ29rJykge1xuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnSW1hZ2UgZGVsZXRlZCBzdWNjZXNzZnVsbHknXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ltYWdlIG5vdCBmb3VuZCBvciBhbHJlYWR5IGRlbGV0ZWQnXG4gICAgICB9KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgaW1hZ2U6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBkZWxldGluZyBpbWFnZSdcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEVycm9yIGhhbmRsaW5nIG1pZGRsZXdhcmUgZm9yIG11bHRlclxucm91dGVyLnVzZSgoZXJyb3IsIHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIG11bHRlci5NdWx0ZXJFcnJvcikge1xuICAgIGlmIChlcnJvci5jb2RlID09PSAnTElNSVRfRklMRV9TSVpFJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdGaWxlIHRvbyBsYXJnZS4gTWF4aW11bSBzaXplIGlzIDVNQi4nXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgXG4gIGlmIChlcnJvci5tZXNzYWdlKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZVxuICAgIH0pO1xuICB9XG4gIFxuICBuZXh0KGVycm9yKTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdELE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDaEMsTUFBTTtFQUFFRTtBQUFtQixDQUFDLEdBQUdGLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQztBQUM5RCxNQUFNRyxNQUFNLEdBQUdKLE9BQU8sQ0FBQ0ssTUFBTSxDQUFDLENBQUM7O0FBRS9CO0FBQ0EsTUFBTUMsT0FBTyxHQUFHSixNQUFNLENBQUNLLGFBQWEsQ0FBQyxDQUFDOztBQUV0QztBQUNBLE1BQU1DLFVBQVUsR0FBR0EsQ0FBQ0MsR0FBRyxFQUFFQyxJQUFJLEVBQUVDLEVBQUUsS0FBSztFQUNwQyxJQUFJRCxJQUFJLENBQUNFLFFBQVEsQ0FBQ0MsVUFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFO0lBQ3RDRixFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztFQUNoQixDQUFDLE1BQU07SUFDTEEsRUFBRSxDQUFDLElBQUlHLEtBQUssQ0FBQywrQkFBK0IsQ0FBQyxFQUFFLEtBQUssQ0FBQztFQUN2RDtBQUNGLENBQUM7O0FBRUQ7QUFDQSxNQUFNQyxNQUFNLEdBQUdiLE1BQU0sQ0FBQztFQUNwQkksT0FBTyxFQUFFQSxPQUFPO0VBQ2hCRSxVQUFVLEVBQUVBLFVBQVU7RUFDdEJRLE1BQU0sRUFBRTtJQUNOQyxRQUFRLEVBQUUsQ0FBQyxHQUFHLElBQUksR0FBRyxJQUFJLENBQUU7RUFDN0I7QUFDRixDQUFDLENBQUM7O0FBRUY7QUFDQTtBQUNBO0FBQ0FiLE1BQU0sQ0FBQ2MsSUFBSSxDQUFDLFFBQVEsRUFBRUgsTUFBTSxDQUFDSSxNQUFN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","map":{"version":3,"names":["express","require","multer","uploadToCloudinary","router","Router","storage","memoryStorage","fileFilter","req","file","cb","mimetype","startsWith","Error","upload","limits","fileSize","post","single","res","status","json","success","message","result","buffer","folder","transformation","width","height","crop","quality","format","data","imageUrl","url","imagePublicId","publicId","error","console","delete","deleteFromCloudinary","params","use","next","MulterError","code","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["upload.js"],"sourcesContent":["const express = require('express');\nconst multer = require('multer');\nconst { uploadToCloudinary } = require('../config/cloudinary');\nconst router = express.Router();\n\n// Configure multer for memory storage\nconst storage = multer.memoryStorage();\n\n// File filter for images only\nconst fileFilter = (req, file, cb) => {\n  if (file.mimetype.startsWith('image/')) {\n    cb(null, true);\n  } else {\n    cb(new Error('Only image files are allowed!'), false);\n  }\n};\n\n// Configure multer\nconst upload = multer({\n  storage: storage,\n  fileFilter: fileFilter,\n  limits: {\n    fileSize: 5 * 1024 * 1024, // 5MB limit\n  },\n});\n\n// @route   POST /api/upload/image\n// @desc    Upload image to Cloudinary\n// @access  Public (can be made private later)\nrouter.post('/image', upload.single('image'), async (req, res) => {\n  try {\n    if (!req.file) {\n      return res.status(400).json({\n        success: false,\n        message: 'No image file provided'\n      });\n    }\n\n    // Upload to Cloudinary\n    const result = await uploadToCloudinary(req.file.buffer, {\n      folder: 'webcaffe/products',\n      transformation: [\n        { width: 800, height: 600, crop: 'fill', quality: 'auto' },\n        { format: 'webp' }\n      ]\n    });\n\n    res.json({\n      success: true,\n      data: {\n        imageUrl: result.url,\n        imagePublicId: result.publicId,\n        width: result.width,\n        height: result.height,\n        format: result.format\n      },\n      message: 'Image uploaded successfully'\n    });\n  } catch (error) {\n    console.error('Error uploading image:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Failed to upload image',\n      error: error.message\n    });\n  }\n});\n\n// @route   DELETE /api/upload/image/:publicId\n// @desc    Delete uploaded image from Cloudinary\n// @access  Private/Admin\nrouter.delete('/image/:publicId', async (req, res) => {\n  try {\n    const { deleteFromCloudinary } = require('../config/cloudinary');\n    const publicId = req.params.publicId;\n\n    // Delete from Cloudinary\n    const result = await deleteFromCloudinary(publicId);\n\n    if (result.result === 'ok') {\n      res.json({\n        success: true,\n        message: 'Image deleted successfully'\n      });\n    } else {\n      res.status(404).json({\n        success: false,\n        message: 'Image not found or already deleted'\n      });\n    }\n  } catch (error) {\n    console.error('Error deleting image:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while deleting image'\n    });\n  }\n});\n\n// Error handling middleware for multer\nrouter.use((error, req, res, next) => {\n  if (error instanceof multer.MulterError) {\n    if (error.code === 'LIMIT_FILE_SIZE') {\n      return res.status(400).json({\n        success: false,\n        message: 'File too large. Maximum size is 5MB.'\n      });\n    }\n  }\n  \n  if (error.message) {\n    return res.status(400).json({\n      success: false,\n      message: error.message\n    });\n  }\n  \n  next(error);\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1757433504901},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\config\\\\cloudinary.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const cloudinary = require('cloudinary').v2;\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET\n});\n\n// Upload image to Cloudinary\nconst uploadToCloudinary = (buffer, options = {}) => {\n  return new Promise((resolve, reject) => {\n    const uploadOptions = {\n      resource_type: 'image',\n      folder: 'webcaffe/products',\n      transformation: [{\n        width: 800,\n        height: 600,\n        crop: 'fill',\n        quality: 'auto'\n      }, {\n        format: 'webp'\n      }],\n      ...options\n    };\n    cloudinary.uploader.upload_stream(uploadOptions, (error, result) => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve({\n          url: result.secure_url,\n          publicId: result.public_id,\n          width: result.width,\n          height: result.height,\n          format: result.format\n        });\n      }\n    }).end(buffer);\n  });\n};\n\n// Delete image from Cloudinary\nconst deleteFromCloudinary = async publicId => {\n  try {\n    const result = await cloudinary.uploader.destroy(publicId);\n    return result;\n  } catch (error) {\n    console.error('Error deleting image from Cloudinary:', error);\n    throw error;\n  }\n};\nmodule.exports = {\n  cloudinary,\n  uploadToCloudinary,\n  deleteFromCloudinary\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjbG91ZGluYXJ5IiwicmVxdWlyZSIsInYyIiwiY29uZmlnIiwiY2xvdWRfbmFtZSIsInByb2Nlc3MiLCJlbnYiLCJDTE9VRElOQVJZX0NMT1VEX05BTUUiLCJhcGlfa2V5IiwiQ0xPVURJTkFSWV9BUElfS0VZIiwiYXBpX3NlY3JldCIsIkNMT1VESU5BUllfQVBJX1NFQ1JFVCIsInVwbG9hZFRvQ2xvdWRpbmFyeSIsImJ1ZmZlciIsIm9wdGlvbnMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInVwbG9hZE9wdGlvbnMiLCJyZXNvdXJjZV90eXBlIiwiZm9sZGVyIiwidHJhbnNmb3JtYXRpb24iLCJ3aWR0aCIsImhlaWdodCIsImNyb3AiLCJxdWFsaXR5IiwiZm9ybWF0IiwidXBsb2FkZXIiLCJ1cGxvYWRfc3RyZWFtIiwiZXJyb3IiLCJyZXN1bHQiLCJ1cmwiLCJzZWN1cmVfdXJsIiwicHVibGljSWQiLCJwdWJsaWNfaWQiLCJlbmQiLCJkZWxldGVGcm9tQ2xvdWRpbmFyeSIsImRlc3Ryb3kiLCJjb25zb2xlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXGNvbmZpZ1xcIiwic291cmNlcyI6WyJjbG91ZGluYXJ5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNsb3VkaW5hcnkgPSByZXF1aXJlKCdjbG91ZGluYXJ5JykudjI7XG5cbi8vIENvbmZpZ3VyZSBDbG91ZGluYXJ5XG5jbG91ZGluYXJ5LmNvbmZpZyh7XG4gIGNsb3VkX25hbWU6IHByb2Nlc3MuZW52LkNMT1VESU5BUllfQ0xPVURfTkFNRSxcbiAgYXBpX2tleTogcHJvY2Vzcy5lbnYuQ0xPVURJTkFSWV9BUElfS0VZLFxuICBhcGlfc2VjcmV0OiBwcm9jZXNzLmVudi5DTE9VRElOQVJZX0FQSV9TRUNSRVQsXG59KTtcblxuLy8gVXBsb2FkIGltYWdlIHRvIENsb3VkaW5hcnlcbmNvbnN0IHVwbG9hZFRvQ2xvdWRpbmFyeSA9IChidWZmZXIsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IHVwbG9hZE9wdGlvbnMgPSB7XG4gICAgICByZXNvdXJjZV90eXBlOiAnaW1hZ2UnLFxuICAgICAgZm9sZGVyOiAnd2ViY2FmZmUvcHJvZHVjdHMnLFxuICAgICAgdHJhbnNmb3JtYXRpb246IFtcbiAgICAgICAgeyB3aWR0aDogODAwLCBoZWlnaHQ6IDYwMCwgY3JvcDogJ2ZpbGwnLCBxdWFsaXR5OiAnYXV0bycgfSxcbiAgICAgICAgeyBmb3JtYXQ6ICd3ZWJwJyB9XG4gICAgICBdLFxuICAgICAgLi4ub3B0aW9uc1xuICAgIH07XG5cbiAgICBjbG91ZGluYXJ5LnVwbG9hZGVyLnVwbG9hZF9zdHJlYW0oXG4gICAgICB1cGxvYWRPcHRpb25zLFxuICAgICAgKGVycm9yLCByZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgIHVybDogcmVzdWx0LnNlY3VyZV91cmwsXG4gICAgICAgICAgICBwdWJsaWNJZDogcmVzdWx0LnB1YmxpY19pZCxcbiAgICAgICAgICAgIHdpZHRoOiByZXN1bHQud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHJlc3VsdC5oZWlnaHQsXG4gICAgICAgICAgICBmb3JtYXQ6IHJlc3VsdC5mb3JtYXRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICkuZW5kKGJ1ZmZlcik7XG4gIH0pO1xufTtcblxuLy8gRGVsZXRlIGltYWdlIGZyb20gQ2xvdWRpbmFyeVxuY29uc3QgZGVsZXRlRnJvbUNsb3VkaW5hcnkgPSBhc3luYyAocHVibGljSWQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbG91ZGluYXJ5LnVwbG9hZGVyLmRlc3Ryb3kocHVibGljSWQpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgaW1hZ2UgZnJvbSBDbG91ZGluYXJ5OicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGNsb3VkaW5hcnksXG4gIHVwbG9hZFRvQ2xvdWRpbmFyeSxcbiAgZGVsZXRlRnJvbUNsb3VkaW5hcnlcbn07Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxVQUFVLEdBQUdDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQ0MsRUFBRTs7QUFFM0M7QUFDQUYsVUFBVSxDQUFDRyxNQUFNLENBQUM7RUFDaEJDLFVBQVUsRUFBRUMsT0FBTyxDQUFDQyxHQUFHLENBQUNDLHFCQUFxQjtFQUM3Q0MsT0FBTyxFQUFFSCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0csa0JBQWtCO0VBQ3ZDQyxVQUFVLEVBQUVMLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDSztBQUMxQixDQUFDLENBQUM7O0FBRUY7QUFDQSxNQUFNQyxrQkFBa0IsR0FBR0EsQ0FBQ0MsTUFBTSxFQUFFQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLEtBQUs7RUFDbkQsT0FBTyxJQUFJQyxPQUFPLENBQUMsQ0FBQ0MsT0FBTyxFQUFFQyxNQUFNLEtBQUs7SUFDdEMsTUFBTUMsYUFBYSxHQUFHO01BQ3BCQyxhQUFhLEVBQUUsT0FBTztNQUN0QkMsTUFBTSxFQUFFLG1CQUFtQjtNQUMzQkMsY0FBYyxFQUFFLENBQ2Q7UUFBRUMsS0FBSyxFQUFFLEdBQUc7UUFBRUMsTUFBTSxFQUFFLEdBQUc7UUFBRUMsSUFBSSxFQUFFLE1BQU07UUFBRUMsT0FBTyxFQUFFO01BQU8sQ0FBQyxFQUMxRDtRQUFFQyxNQUFNLEVBQUU7TUFBTyxDQUFDLENBQ25CO01BQ0QsR0FBR1o7SUFDTCxDQUFDO0lBRURkLFVBQVUsQ0FBQzJCLFFBQVEsQ0FBQ0MsYUFBYSxDQUMvQlYsYUFBYSxFQUNiLENBQUNXLEtBQUssRUFBRUMsTUFBTSxLQUFLO01BQ2pCLElBQUlELEtBQUssRUFBRTtRQUNUWixNQUFNLENBQUNZLEtBQUssQ0FBQztNQUNmLENBQUMsTUFBTTtRQUNMYixPQUFPLENBQUM7VUFDTmUsR0FBRyxFQUFFRCxNQUFNLENBQUNFLFVBQVU7VUFDdEJDLFFBQVEsRUFBRUgsTUFBTSxDQUFDSSxTQUFTO1VBQzFCWixLQUFLLEVBQUVRLE1BQU0sQ0FBQ1IsS0FBSztVQUNuQkMsTUFBTSxFQUFFTyxNQUFNLENBQUNQLE1BQU07VUFDckJHLE1BQU0sRUFBRUksTUFBTSxDQUFDSjtRQUNqQixDQUFDLENBQUM7TUFDSjtJQUNGLENBQ0YsQ0FBQyxDQUFDUyxHQUFHLENBQUN0QixNQUFNLENBQUM7RUFDZixDQUFDLENBQUM7QUFDSixDQUFDOztBQUVEO0FBQ0EsTUFBTXVCLG9CQUFvQixHQUFHLE1BQU9ILFFBQVEsSUFBSztFQUMvQyxJQUFJO0lBQ0YsTUFBTUgsTUFBTSxHQUFHLE1BQU05QixVQUFVLENBQUMyQixRQUFRLENBQUNVLE9BQU8sQ0FBQ0osUUFBUSxDQUFDO0lBQzFELE9BQU9ILE1BQU07RUFDZixDQUFDLENBQUMsT0FBT0QsS0FBSyxFQUFFO0lBQ2RTLE9BQU8sQ0FBQ1QsS0FBSyxDQUFDLHVDQUF1QyxFQUFFQSxLQUFLLENBQUM7SUFDN0QsTUFBTUEsS0FBSztFQUNiO0FBQ0YsQ0FBQztBQUVEVSxNQUFNLENBQUNDLE9BQU8sR0FBRztFQUNmeEMsVUFBVTtFQUNWWSxrQkFBa0I7RUFDbEJ3QjtBQUNGLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=","map":{"version":3,"names":["cloudinary","require","v2","config","cloud_name","process","env","CLOUDINARY_CLOUD_NAME","api_key","CLOUDINARY_API_KEY","api_secret","CLOUDINARY_API_SECRET","uploadToCloudinary","buffer","options","Promise","resolve","reject","uploadOptions","resource_type","folder","transformation","width","height","crop","quality","format","uploader","upload_stream","error","result","url","secure_url","publicId","public_id","end","deleteFromCloudinary","destroy","console","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\config\\","sources":["cloudinary.js"],"sourcesContent":["const cloudinary = require('cloudinary').v2;\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\n// Upload image to Cloudinary\nconst uploadToCloudinary = (buffer, options = {}) => {\n  return new Promise((resolve, reject) => {\n    const uploadOptions = {\n      resource_type: 'image',\n      folder: 'webcaffe/products',\n      transformation: [\n        { width: 800, height: 600, crop: 'fill', quality: 'auto' },\n        { format: 'webp' }\n      ],\n      ...options\n    };\n\n    cloudinary.uploader.upload_stream(\n      uploadOptions,\n      (error, result) => {\n        if (error) {\n          reject(error);\n        } else {\n          resolve({\n            url: result.secure_url,\n            publicId: result.public_id,\n            width: result.width,\n            height: result.height,\n            format: result.format\n          });\n        }\n      }\n    ).end(buffer);\n  });\n};\n\n// Delete image from Cloudinary\nconst deleteFromCloudinary = async (publicId) => {\n  try {\n    const result = await cloudinary.uploader.destroy(publicId);\n    return result;\n  } catch (error) {\n    console.error('Error deleting image from Cloudinary:', error);\n    throw error;\n  }\n};\n\nmodule.exports = {\n  cloudinary,\n  uploadToCloudinary,\n  deleteFromCloudinary\n};"],"mappings":"AAAA,MAAMA,UAAU,GAAGC,OAAO,CAAC,YAAY,CAAC,CAACC,EAAE;;AAE3C;AACAF,UAAU,CAACG,MAAM,CAAC;EAChBC,UAAU,EAAEC,OAAO,CAACC,GAAG,CAACC,qBAAqB;EAC7CC,OAAO,EAAEH,OAAO,CAACC,GAAG,CAACG,kBAAkB;EACvCC,UAAU,EAAEL,OAAO,CAACC,GAAG,CAACK;AAC1B,CAAC,CAAC;;AAEF;AACA,MAAMC,kBAAkB,GAAGA,CAACC,MAAM,EAAEC,OAAO,GAAG,CAAC,CAAC,KAAK;EACnD,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACtC,MAAMC,aAAa,GAAG;MACpBC,aAAa,EAAE,OAAO;MACtBC,MAAM,EAAE,mBAAmB;MAC3BC,cAAc,EAAE,CACd;QAAEC,KAAK,EAAE,GAAG;QAAEC,MAAM,EAAE,GAAG;QAAEC,IAAI,EAAE,MAAM;QAAEC,OAAO,EAAE;MAAO,CAAC,EAC1D;QAAEC,MAAM,EAAE;MAAO,CAAC,CACnB;MACD,GAAGZ;IACL,CAAC;IAEDd,UAAU,CAAC2B,QAAQ,CAACC,aAAa,CAC/BV,aAAa,EACb,CAACW,KAAK,EAAEC,MAAM,KAAK;MACjB,IAAID,KAAK,EAAE;QACTZ,MAAM,CAACY,KAAK,CAAC;MACf,CAAC,MAAM;QACLb,OAAO,CAAC;UACNe,GAAG,EAAED,MAAM,CAACE,UAAU;UACtBC,QAAQ,EAAEH,MAAM,CAACI,SAAS;UAC1BZ,KAAK,EAAEQ,MAAM,CAACR,KAAK;UACnBC,MAAM,EAAEO,MAAM,CAACP,MAAM;UACrBG,MAAM,EAAEI,MAAM,CAACJ;QACjB,CAAC,CAAC;MACJ;IACF,CACF,CAAC,CAACS,GAAG,CAACtB,MAAM,CAAC;EACf,CAAC,CAAC;AACJ,CAAC;;AAED;AACA,MAAMuB,oBAAoB,GAAG,MAAOH,QAAQ,IAAK;EAC/C,IAAI;IACF,MAAMH,MAAM,GAAG,MAAM9B,UAAU,CAAC2B,QAAQ,CAACU,OAAO,CAACJ,QAAQ,CAAC;IAC1D,OAAOH,MAAM;EACf,CAAC,CAAC,OAAOD,KAAK,EAAE;IACdS,OAAO,CAACT,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;IAC7D,MAAMA,KAAK;EACb;AACF,CAAC;AAEDU,MAAM,CAACC,OAAO,GAAG;EACfxC,UAAU;EACVY,kBAAkB;EAClBwB;AACF,CAAC","ignoreList":[]}},"mtime":1757349245117},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\admin.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect,\n  authorize\n} = require('../middleware/auth');\nconst User = require('../models/User');\nconst Product = require('../models/Product');\nconst Order = require('../models/Order');\nconst mongoose = require('mongoose');\n\n// Dashboard statistics\n// @route   GET /api/admin/dashboard/stats\n// @desc    Get dashboard statistics for admin\n// @access  Private (Admin only)\nrouter.get('/dashboard/stats', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get total products count\n    const totalProducts = await Product.countDocuments();\n\n    // Get total orders count\n    const totalOrders = await Order.countDocuments();\n\n    // Get total customers count (users with customer role)\n    const totalCustomers = await User.countDocuments({\n      role: 'customer'\n    });\n\n    // Get total revenue from paid orders (including confirmed, ready, and completed)\n    const revenueResult = await Order.aggregate([{\n      $match: {\n        status: {\n          $in: ['confirmed', 'completed', 'ready']\n        },\n        paymentStatus: 'paid'\n      }\n    }, {\n      $group: {\n        _id: null,\n        totalRevenue: {\n          $sum: '$total'\n        }\n      }\n    }]);\n    const totalRevenue = revenueResult.length > 0 ? revenueResult[0].totalRevenue : 0;\n    res.json({\n      success: true,\n      data: {\n        totalProducts,\n        totalOrders,\n        totalCustomers,\n        totalRevenue\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching dashboard stats:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching dashboard statistics'\n    });\n  }\n});\n\n// @route   GET /api/admin/revenue/total\n// @desc    Get detailed total revenue calculation from completed orders\n// @access  Private (Admin only)\nrouter.get('/revenue/total', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get detailed revenue breakdown from paid orders (including confirmed, ready, and completed)\n    const revenueBreakdown = await Order.aggregate([{\n      $match: {\n        status: {\n          $in: ['confirmed', 'completed', 'ready']\n        },\n        paymentStatus: 'paid'\n      }\n    }, {\n      $group: {\n        _id: null,\n        totalRevenue: {\n          $sum: '$total'\n        },\n        totalSubtotal: {\n          $sum: '$subtotal'\n        },\n        totalTax: {\n          $sum: '$tax'\n        },\n        totalDiscount: {\n          $sum: '$discount'\n        },\n        orderCount: {\n          $sum: 1\n        },\n        averageOrderValue: {\n          $avg: '$total'\n        }\n      }\n    }]);\n\n    // Get revenue by payment method\n    const revenueByPaymentMethod = await Order.aggregate([{\n      $match: {\n        status: {\n          $in: ['confirmed', 'completed', 'ready']\n        },\n        paymentStatus: 'paid'\n      }\n    }, {\n      $group: {\n        _id: '$paymentMethod',\n        revenue: {\n          $sum: '$total'\n        },\n        orderCount: {\n          $sum: 1\n        }\n      }\n    }, {\n      $sort: {\n        revenue: -1\n      }\n    }]);\n\n    // Get revenue by order type\n    const revenueByOrderType = await Order.aggregate([{\n      $match: {\n        status: {\n          $in: ['confirmed', 'completed', 'ready']\n        },\n        paymentStatus: 'paid'\n      }\n    }, {\n      $group: {\n        _id: '$orderType',\n        revenue: {\n          $sum: '$total'\n        },\n        orderCount: {\n          $sum: 1\n        }\n      }\n    }, {\n      $sort: {\n        revenue: -1\n      }\n    }]);\n\n    // Get all paid orders for verification\n    const completedOrders = await Order.find({\n      status: {\n        $in: ['confirmed', 'completed', 'ready']\n      },\n      paymentStatus: 'paid'\n    }).select('orderNumber total status paymentStatus createdAt paymentMethod orderType');\n    const breakdown = revenueBreakdown[0] || {\n      totalRevenue: 0,\n      totalSubtotal: 0,\n      totalTax: 0,\n      totalDiscount: 0,\n      orderCount: 0,\n      averageOrderValue: 0\n    };\n    res.json({\n      success: true,\n      data: {\n        summary: {\n          totalRevenue: breakdown.totalRevenue,\n          totalSubtotal: breakdown.totalSubtotal,\n          totalTax: breakdown.totalTax,\n          totalDiscount: breakdown.totalDiscount,\n          completedOrderCount: breakdown.orderCount,\n          averageOrderValue: breakdown.averageOrderValue\n        },\n        breakdown: {\n          byPaymentMethod: revenueByPaymentMethod,\n          byOrderType: revenueByOrderType\n        },\n        completedOrders: completedOrders.map(order => ({\n          orderNumber: order.orderNumber,\n          total: order.total,\n          status: order.status,\n          paymentStatus: order.paymentStatus,\n          paymentMethod: order.paymentMethod,\n          orderType: order.orderType,\n          createdAt: order.createdAt\n        }))\n      },\n      message: `Total revenue calculated from ${breakdown.orderCount} completed orders`\n    });\n  } catch (error) {\n    console.error('Error calculating total revenue:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while calculating total revenue'\n    });\n  }\n});\n\n// @route   GET /api/admin/dashboard/recent-orders\n// @desc    Get recent orders for admin dashboard\n// @access  Private (Admin only)\nrouter.get('/dashboard/recent-orders', protect, authorize('admin'), async (req, res) => {\n  try {\n    const limit = parseInt(req.query.limit) || 5;\n    const recentOrders = await Order.find().populate('customer', 'firstName lastName email phone address').sort({\n      createdAt: -1\n    }).limit(limit).select('orderNumber customer total status createdAt');\n\n    // Format the response\n    const formattedOrders = recentOrders.map(order => ({\n      _id: order._id,\n      orderNumber: order.orderNumber,\n      customer: order.customer,\n      customerName: order.customer ? `${order.customer.firstName} ${order.customer.lastName}` : 'Unknown Customer',\n      customerEmail: order.customer ? order.customer.email : '',\n      total: order.total,\n      status: order.status,\n      createdAt: order.createdAt\n    }));\n    res.json({\n      success: true,\n      data: formattedOrders\n    });\n  } catch (error) {\n    console.error('Error fetching recent orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching recent orders'\n    });\n  }\n});\n\n// @route   GET /api/admin/dashboard/analytics\n// @desc    Get detailed analytics for admin dashboard\n// @access  Private (Admin only)\nrouter.get('/dashboard/analytics', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get orders by status\n    const ordersByStatus = await Order.aggregate([{\n      $group: {\n        _id: '$status',\n        count: {\n          $sum: 1\n        }\n      }\n    }]);\n\n    // Get revenue by month (last 6 months)\n    const sixMonthsAgo = new Date();\n    sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\n    const revenueByMonth = await Order.aggregate([{\n      $match: {\n        createdAt: {\n          $gte: sixMonthsAgo\n        },\n        status: {\n          $in: ['confirmed', 'completed', 'ready']\n        },\n        paymentStatus: 'paid'\n      }\n    }, {\n      $group: {\n        _id: {\n          year: {\n            $year: '$createdAt'\n          },\n          month: {\n            $month: '$createdAt'\n          }\n        },\n        revenue: {\n          $sum: '$total'\n        },\n        orderCount: {\n          $sum: 1\n        }\n      }\n    }, {\n      $sort: {\n        '_id.year': 1,\n        '_id.month': 1\n      }\n    }]);\n\n    // Get top selling products\n    const topProducts = await Order.aggregate([{\n      $unwind: '$items'\n    }, {\n      $group: {\n        _id: '$items.product',\n        name: {\n          $first: '$items.name'\n        },\n        totalSold: {\n          $sum: '$items.quantity'\n        },\n        totalRevenue: {\n          $sum: {\n            $multiply: ['$items.price', '$items.quantity']\n          }\n        }\n      }\n    }, {\n      $sort: {\n        totalSold: -1\n      }\n    }, {\n      $limit: 5\n    }]);\n\n    // Get customer growth (new customers per month)\n    const customerGrowth = await User.aggregate([{\n      $match: {\n        role: 'customer',\n        createdAt: {\n          $gte: sixMonthsAgo\n        }\n      }\n    }, {\n      $group: {\n        _id: {\n          year: {\n            $year: '$createdAt'\n          },\n          month: {\n            $month: '$createdAt'\n          }\n        },\n        newCustomers: {\n          $sum: 1\n        }\n      }\n    }, {\n      $sort: {\n        '_id.year': 1,\n        '_id.month': 1\n      }\n    }]);\n    res.json({\n      success: true,\n      data: {\n        ordersByStatus: ordersByStatus.reduce((acc, item) => {\n          acc[item._id] = item.count;\n          return acc;\n        }, {}),\n        revenueByMonth,\n        topProducts,\n        customerGrowth\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching analytics:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching analytics'\n    });\n  }\n});\nrouter.get('/orders', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = {};\n    if (status && status !== 'all') {\n      filter.status = status;\n    }\n    if (search) {\n      filter.$or = [{\n        orderNumber: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        'customer.firstName': {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        'customer.lastName': {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        'customer.email': {\n          $regex: search,\n          $options: 'i'\n        }\n      }];\n    }\n    const skip = (page - 1) * limit;\n    const orders = await Order.find(filter).populate('customer', 'firstName lastName email phone address').sort({\n      [sortBy]: sortOrder\n    }).skip(skip).limit(limit);\n    const totalOrders = await Order.countDocuments(filter);\n    const totalPages = Math.ceil(totalOrders / limit);\n    res.json({\n      success: true,\n      data: {\n        orders,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalOrders,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching orders'\n    });\n  }\n});\n\n// @route   GET /api/admin/orders/:id\n// @desc    Get single order details\n// @access  Private (Admin only)\nrouter.get('/orders/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const order = await Order.findById(req.params.id).populate('customer', 'firstName lastName email phone address');\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: order\n    });\n  } catch (error) {\n    console.error('Error fetching order details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order details'\n    });\n  }\n});\n\n// @route   PUT /api/admin/orders/:id/status\n// @desc    Update order status\n// @access  Private (Admin only)\nrouter.put('/orders/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const {\n      status\n    } = req.body;\n    const validStatuses = ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'];\n    if (!validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order status'\n      });\n    }\n    const order = await Order.findById(req.params.id);\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n    order.status = status;\n    order.updatedAt = new Date();\n    await order.save();\n    res.json({\n      success: true,\n      message: 'Order status updated successfully',\n      data: order\n    });\n  } catch (error) {\n    console.error('Error updating order status:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating order status'\n    });\n  }\n});\n\n// Customer Management Routes\n\n// @route   GET /api/admin/customers\n// @desc    Get all customers with filtering and pagination\n// @access  Private (Admin only)\nrouter.get('/customers', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = {\n      role: 'customer'\n    };\n    if (search) {\n      filter.$or = [{\n        firstName: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        lastName: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        email: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        phone: {\n          $regex: search,\n          $options: 'i'\n        }\n      }];\n    }\n    const skip = (page - 1) * limit;\n    const customers = await User.find(filter).select('-password').sort({\n      [sortBy]: sortOrder\n    }).skip(skip).limit(limit);\n\n    // Get order statistics for each customer\n    const customersWithStats = await Promise.all(customers.map(async customer => {\n      const orderStats = await Order.aggregate([{\n        $match: {\n          customer: customer._id\n        }\n      }, {\n        $group: {\n          _id: null,\n          totalOrders: {\n            $sum: 1\n          },\n          totalSpent: {\n            $sum: '$total'\n          },\n          lastOrderDate: {\n            $max: '$createdAt'\n          }\n        }\n      }]);\n      return {\n        ...customer.toObject(),\n        orderStats: orderStats[0] || {\n          totalOrders: 0,\n          totalSpent: 0,\n          lastOrderDate: null\n        }\n      };\n    }));\n    const totalCustomers = await User.countDocuments(filter);\n    const totalPages = Math.ceil(totalCustomers / limit);\n    res.json({\n      success: true,\n      data: {\n        customers: customersWithStats,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalCustomers,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching customers:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching customers'\n    });\n  }\n});\n\n// @route   GET /api/admin/customers/:id\n// @desc    Get single customer details with order history\n// @access  Private (Admin only)\nrouter.get('/customers/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const customer = await User.findById(req.params.id).select('-password');\n    if (!customer || customer.role !== 'customer') {\n      return res.status(404).json({\n        success: false,\n        message: 'Customer not found'\n      });\n    }\n\n    // Get customer's order history\n    const orders = await Order.find({\n      customer: req.params.id\n    }).sort({\n      createdAt: -1\n    }).limit(10);\n\n    // Get customer statistics\n    const stats = await Order.aggregate([{\n      $match: {\n        customer: mongoose.Types.ObjectId(req.params.id)\n      }\n    }, {\n      $group: {\n        _id: null,\n        totalOrders: {\n          $sum: 1\n        },\n        totalSpent: {\n          $sum: '$total'\n        },\n        averageOrderValue: {\n          $avg: '$total'\n        },\n        lastOrderDate: {\n          $max: '$createdAt'\n        },\n        firstOrderDate: {\n          $min: '$createdAt'\n        }\n      }\n    }]);\n    res.json({\n      success: true,\n      data: {\n        customer,\n        orders,\n        stats: stats[0] || {\n          totalOrders: 0,\n          totalSpent: 0,\n          averageOrderValue: 0,\n          lastOrderDate: null,\n          firstOrderDate: null\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching customer details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching customer details'\n    });\n  }\n});\n\n// Contact Management Routes\n\n// @route   GET /api/admin/contacts\n// @desc    Get all contact messages with filtering and pagination\n// @access  Private (Admin only)\nrouter.get('/contacts', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = {};\n    if (status && status !== 'all') {\n      filter.status = status;\n    }\n    if (search) {\n      filter.$or = [{\n        name: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        email: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        subject: {\n          $regex: search,\n          $options: 'i'\n        }\n      }, {\n        ticketId: {\n          $regex: search,\n          $options: 'i'\n        }\n      }];\n    }\n    const skip = (page - 1) * limit;\n    const contacts = await Contact.find(filter).sort({\n      [sortBy]: sortOrder\n    }).skip(skip).limit(limit);\n    const totalContacts = await Contact.countDocuments(filter);\n    const totalPages = Math.ceil(totalContacts / limit);\n    res.json({\n      success: true,\n      data: {\n        contacts,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalContacts,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching contacts:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching contacts'\n    });\n  }\n});\n\n// @route   GET /api/admin/contacts/:id\n// @desc    Get single contact message details\n// @access  Private (Admin only)\nrouter.get('/contacts/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const contact = await Contact.findById(req.params.id);\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Error fetching contact details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching contact details'\n    });\n  }\n});\n\n// @route   PUT /api/admin/contacts/:id/status\n// @desc    Update contact message status\n// @access  Private (Admin only)\nrouter.put('/contacts/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const {\n      status\n    } = req.body;\n\n    // Validate status\n    const validStatuses = ['new', 'read', 'replied', 'closed'];\n    if (!validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid status. Must be one of: new, read, replied, closed'\n      });\n    }\n    const contact = await Contact.findByIdAndUpdate(req.params.id, {\n      status,\n      updatedAt: new Date()\n    }, {\n      new: true,\n      runValidators: true\n    });\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n    res.json({\n      success: true,\n      data: contact,\n      message: 'Contact status updated successfully'\n    });\n  } catch (error) {\n    console.error('Error updating contact status:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating contact status'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJhdXRob3JpemUiLCJVc2VyIiwiUHJvZHVjdCIsIk9yZGVyIiwibW9uZ29vc2UiLCJnZXQiLCJyZXEiLCJyZXMiLCJ0b3RhbFByb2R1Y3RzIiwiY291bnREb2N1bWVudHMiLCJ0b3RhbE9yZGVycyIsInRvdGFsQ3VzdG9tZXJzIiwicm9sZSIsInJldmVudWVSZXN1bHQiLCJhZ2dyZWdhdGUiLCIkbWF0Y2giLCJzdGF0dXMiLCIkaW4iLCJwYXltZW50U3RhdHVzIiwiJGdyb3VwIiwiX2lkIiwidG90YWxSZXZlbnVlIiwiJHN1bSIsImxlbmd0aCIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsImVycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJyZXZlbnVlQnJlYWtkb3duIiwidG90YWxTdWJ0b3RhbCIsInRvdGFsVGF4IiwidG90YWxEaXNjb3VudCIsIm9yZGVyQ291bnQiLCJhdmVyYWdlT3JkZXJWYWx1ZSIsIiRhdmciLCJyZXZlbnVlQnlQYXltZW50TWV0aG9kIiwicmV2ZW51ZSIsIiRzb3J0IiwicmV2ZW51ZUJ5T3JkZXJUeXBlIiwiY29tcGxldGVkT3JkZXJzIiwiZmluZCIsInNlbGVjdCIsImJyZWFrZG93biIsInN1bW1hcnkiLCJjb21wbGV0ZWRPcmRlckNvdW50IiwiYnlQYXltZW50TWV0aG9kIiwiYnlPcmRlclR5cGUiLCJtYXAiLCJvcmRlciIsIm9yZGVyTnVtYmVyIiwidG90YWwiLCJwYXltZW50TWV0aG9kIiwib3JkZXJUeXBlIiwiY3JlYXRlZEF0IiwibGltaXQiLCJwYXJzZUludCIsInF1ZXJ5IiwicmVjZW50T3JkZXJzIiwicG9wdWxhdGUiLCJzb3J0IiwiZm9ybWF0dGVkT3JkZXJzIiwiY3VzdG9tZXIiLCJjdXN0b21lck5hbWUiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsImN1c3RvbWVyRW1haWwiLCJlbWFpbCIsIm9yZGVyc0J5U3RhdHVzIiwiY291bnQiLCJzaXhNb250aHNBZ28iLCJEYXRlIiwic2V0TW9udGgiLCJnZXRNb250aCIsInJldmVudWVCeU1vbnRoIiwiJGd0ZSIsInllYXIiLCIkeWVhciIsIm1vbnRoIiwiJG1vbnRoIiwidG9wUHJvZHVjdHMiLCIkdW53aW5kIiwibmFtZSIsIiRmaXJzdCIsInRvdGFsU29sZCIsIiRtdWx0aXBseSIsIiRsaW1pdCIsImN1c3RvbWVyR3Jvd3RoIiwibmV3Q3VzdG9tZXJzIiwicmVkdWNlIiwiYWNjIiwiaXRlbSIsInBhZ2UiLCJzZWFyY2giLCJzb3J0QnkiLCJzb3J0T3JkZXIiLCJmaWx0ZXIiLCIkb3IiLCIkcmVnZXgiLCIkb3B0aW9ucyIsInNraXAiLCJvcmRlcnMiLCJ0b3RhbFBhZ2VzIiwiTWF0aCIsImNlaWwiLCJwYWdpbmF0aW9uIiwiY3VycmVudFBhZ2UiLCJoYXNOZXh0IiwiaGFzUHJldiIsImZpbmRCeUlkIiwicGFyYW1zIiwiaWQiLCJwdXQiLCJib2R5IiwidmFsaWRTdGF0dXNlcyIsImluY2x1ZGVzIiwidXBkYXRlZEF0Iiwic2F2ZSIsInBob25lIiwiY3VzdG9tZXJzIiwiY3VzdG9tZXJzV2l0aFN0YXRzIiwiUHJvbWlzZSIsImFsbCIsIm9yZGVyU3RhdHMiLCJ0b3RhbFNwZW50IiwibGFzdE9yZGVyRGF0ZSIsIiRtYXgiLCJ0b09iamVjdCIsInN0YXRzIiwiVHlwZXMiLCJPYmplY3RJZCIsImZpcnN0T3JkZXJEYXRlIiwiJG1pbiIsIkNvbnRhY3QiLCJzdWJqZWN0IiwidGlja2V0SWQiLCJjb250YWN0cyIsInRvdGFsQ29udGFjdHMiLCJjb250YWN0IiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJuZXciLCJydW5WYWxpZGF0b3JzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXHJvdXRlc1xcIiwic291cmNlcyI6WyJhZG1pbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcbmNvbnN0IHsgcHJvdGVjdCwgYXV0aG9yaXplIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xuY29uc3QgUHJvZHVjdCA9IHJlcXVpcmUoJy4uL21vZGVscy9Qcm9kdWN0Jyk7XG5jb25zdCBPcmRlciA9IHJlcXVpcmUoJy4uL21vZGVscy9PcmRlcicpO1xuY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuXG4vLyBEYXNoYm9hcmQgc3RhdGlzdGljc1xuLy8gQHJvdXRlICAgR0VUIC9hcGkvYWRtaW4vZGFzaGJvYXJkL3N0YXRzXG4vLyBAZGVzYyAgICBHZXQgZGFzaGJvYXJkIHN0YXRpc3RpY3MgZm9yIGFkbWluXG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbiBvbmx5KVxucm91dGVyLmdldCgnL2Rhc2hib2FyZC9zdGF0cycsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgLy8gR2V0IHRvdGFsIHByb2R1Y3RzIGNvdW50XG4gICAgY29uc3QgdG90YWxQcm9kdWN0cyA9IGF3YWl0IFByb2R1Y3QuY291bnREb2N1bWVudHMoKTtcblxuICAgIC8vIEdldCB0b3RhbCBvcmRlcnMgY291bnRcbiAgICBjb25zdCB0b3RhbE9yZGVycyA9IGF3YWl0IE9yZGVyLmNvdW50RG9jdW1lbnRzKCk7XG5cbiAgICAvLyBHZXQgdG90YWwgY3VzdG9tZXJzIGNvdW50ICh1c2VycyB3aXRoIGN1c3RvbWVyIHJvbGUpXG4gICAgY29uc3QgdG90YWxDdXN0b21lcnMgPSBhd2FpdCBVc2VyLmNvdW50RG9jdW1lbnRzKHsgcm9sZTogJ2N1c3RvbWVyJyB9KTtcblxuICAgIC8vIEdldCB0b3RhbCByZXZlbnVlIGZyb20gcGFpZCBvcmRlcnMgKGluY2x1ZGluZyBjb25maXJtZWQsIHJlYWR5LCBhbmQgY29tcGxldGVkKVxuICAgIGNvbnN0IHJldmVudWVSZXN1bHQgPSBhd2FpdCBPcmRlci5hZ2dyZWdhdGUoW1xuICAgICAge1xuICAgICAgICAkbWF0Y2g6IHtcbiAgICAgICAgICBzdGF0dXM6IHsgJGluOiBbJ2NvbmZpcm1lZCcsICdjb21wbGV0ZWQnLCAncmVhZHknXSB9LFxuICAgICAgICAgIHBheW1lbnRTdGF0dXM6ICdwYWlkJ1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkZ3JvdXA6IHtcbiAgICAgICAgICBfaWQ6IG51bGwsXG4gICAgICAgICAgdG90YWxSZXZlbnVlOiB7ICRzdW06ICckdG90YWwnIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIF0pO1xuXG4gICAgY29uc3QgdG90YWxSZXZlbnVlID0gcmV2ZW51ZVJlc3VsdC5sZW5ndGggPiAwID8gcmV2ZW51ZVJlc3VsdFswXS50b3RhbFJldmVudWUgOiAwO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdG90YWxQcm9kdWN0cyxcbiAgICAgICAgdG90YWxPcmRlcnMsXG4gICAgICAgIHRvdGFsQ3VzdG9tZXJzLFxuICAgICAgICB0b3RhbFJldmVudWVcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBkYXNoYm9hcmQgc3RhdHM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBkYXNoYm9hcmQgc3RhdGlzdGljcydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2FkbWluL3JldmVudWUvdG90YWxcbi8vIEBkZXNjICAgIEdldCBkZXRhaWxlZCB0b3RhbCByZXZlbnVlIGNhbGN1bGF0aW9uIGZyb20gY29tcGxldGVkIG9yZGVyc1xuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoQWRtaW4gb25seSlcbnJvdXRlci5nZXQoJy9yZXZlbnVlL3RvdGFsJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICAvLyBHZXQgZGV0YWlsZWQgcmV2ZW51ZSBicmVha2Rvd24gZnJvbSBwYWlkIG9yZGVycyAoaW5jbHVkaW5nIGNvbmZpcm1lZCwgcmVhZHksIGFuZCBjb21wbGV0ZWQpXG4gICAgY29uc3QgcmV2ZW51ZUJyZWFrZG93biA9IGF3YWl0IE9yZGVyLmFnZ3JlZ2F0ZShbXG4gICAgICB7XG4gICAgICAgICRtYXRjaDoge1xuICAgICAgICAgIHN0YXR1czogeyAkaW46IFsnY29uZmlybWVkJywgJ2NvbXBsZXRlZCcsICdyZWFkeSddIH0sXG4gICAgICAgICAgcGF5bWVudFN0YXR1czogJ3BhaWQnXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgICRncm91cDoge1xuICAgICAgICAgIF9pZDogbnVsbCxcbiAgICAgICAgICB0b3RhbFJldmVudWU6IHsgJHN1bTogJyR0b3RhbCcgfSxcbiAgICAgICAgICB0b3RhbFN1YnRvdGFsOiB7ICRzdW06ICckc3VidG90YWwnIH0sXG4gICAgICAgICAgdG90YWxUYXg6IHsgJHN1bTogJyR0YXgnIH0sXG4gICAgICAgICAgdG90YWxEaXNjb3VudDogeyAkc3VtOiAnJGRpc2NvdW50JyB9LFxuICAgICAgICAgIG9yZGVyQ291bnQ6IHsgJHN1bTogMSB9LFxuICAgICAgICAgIGF2ZXJhZ2VPcmRlclZhbHVlOiB7ICRhdmc6ICckdG90YWwnIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIF0pO1xuXG4gICAgLy8gR2V0IHJldmVudWUgYnkgcGF5bWVudCBtZXRob2RcbiAgICBjb25zdCByZXZlbnVlQnlQYXltZW50TWV0aG9kID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHtcbiAgICAgICAgJG1hdGNoOiB7XG4gICAgICAgICAgc3RhdHVzOiB7ICRpbjogWydjb25maXJtZWQnLCAnY29tcGxldGVkJywgJ3JlYWR5J10gfSxcbiAgICAgICAgICBwYXltZW50U3RhdHVzOiAncGFpZCdcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJGdyb3VwOiB7XG4gICAgICAgICAgX2lkOiAnJHBheW1lbnRNZXRob2QnLFxuICAgICAgICAgIHJldmVudWU6IHsgJHN1bTogJyR0b3RhbCcgfSxcbiAgICAgICAgICBvcmRlckNvdW50OiB7ICRzdW06IDEgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkc29ydDogeyByZXZlbnVlOiAtMSB9XG4gICAgICB9XG4gICAgXSk7XG5cbiAgICAvLyBHZXQgcmV2ZW51ZSBieSBvcmRlciB0eXBlXG4gICAgY29uc3QgcmV2ZW51ZUJ5T3JkZXJUeXBlID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHtcbiAgICAgICAgJG1hdGNoOiB7XG4gICAgICAgICAgc3RhdHVzOiB7ICRpbjogWydjb25maXJtZWQnLCAnY29tcGxldGVkJywgJ3JlYWR5J10gfSxcbiAgICAgICAgICBwYXltZW50U3RhdHVzOiAncGFpZCdcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJGdyb3VwOiB7XG4gICAgICAgICAgX2lkOiAnJG9yZGVyVHlwZScsXG4gICAgICAgICAgcmV2ZW51ZTogeyAkc3VtOiAnJHRvdGFsJyB9LFxuICAgICAgICAgIG9yZGVyQ291bnQ6IHsgJHN1bTogMSB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgICRzb3J0OiB7IHJldmVudWU6IC0xIH1cbiAgICAgIH1cbiAgICBdKTtcblxuICAgIC8vIEdldCBhbGwgcGFpZCBvcmRlcnMgZm9yIHZlcmlmaWNhdGlvblxuICAgIGNvbnN0IGNvbXBsZXRlZE9yZGVycyA9IGF3YWl0IE9yZGVyLmZpbmQoe1xuICAgICAgc3RhdHVzOiB7ICRpbjogWydjb25maXJtZWQnLCAnY29tcGxldGVkJywgJ3JlYWR5J10gfSxcbiAgICAgIHBheW1lbnRTdGF0dXM6ICdwYWlkJ1xuICAgIH0pLnNlbGVjdCgnb3JkZXJOdW1iZXIgdG90YWwgc3RhdHVzIHBheW1lbnRTdGF0dXMgY3JlYXRlZEF0IHBheW1lbnRNZXRob2Qgb3JkZXJUeXBlJyk7XG5cbiAgICBjb25zdCBicmVha2Rvd24gPSByZXZlbnVlQnJlYWtkb3duWzBdIHx8IHtcbiAgICAgIHRvdGFsUmV2ZW51ZTogMCxcbiAgICAgIHRvdGFsU3VidG90YWw6IDAsXG4gICAgICB0b3RhbFRheDogMCxcbiAgICAgIHRvdGFsRGlzY291bnQ6IDAsXG4gICAgICBvcmRlckNvdW50OiAwLFxuICAgICAgYXZlcmFnZU9yZGVyVmFsdWU6IDBcbiAgICB9O1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgc3VtbWFyeToge1xuICAgICAgICAgIHRvdGFsUmV2ZW51ZTogYnJlYWtkb3duLnRvdGFsUmV2ZW51ZSxcbiAgICAgICAgICB0b3RhbFN1YnRvdGFsOiBicmVha2Rvd24udG90YWxTdWJ0b3RhbCxcbiAgICAgICAgICB0b3RhbFRheDogYnJlYWtkb3duLnRvdGFsVGF4LFxuICAgICAgICAgIHRvdGFsRGlzY291bnQ6IGJyZWFrZG93bi50b3RhbERpc2NvdW50LFxuICAgICAgICAgIGNvbXBsZXRlZE9yZGVyQ291bnQ6IGJyZWFrZG93bi5vcmRlckNvdW50LFxuICAgICAgICAgIGF2ZXJhZ2VPcmRlclZhbHVlOiBicmVha2Rvd24uYXZlcmFnZU9yZGVyVmFsdWVcbiAgICAgICAgfSxcbiAgICAgICAgYnJlYWtkb3duOiB7XG4gICAgICAgICAgYnlQYXltZW50TWV0aG9kOiByZXZlbnVlQnlQYXltZW50TWV0aG9kLFxuICAgICAgICAgIGJ5T3JkZXJUeXBlOiByZXZlbnVlQnlPcmRlclR5cGVcbiAgICAgICAgfSxcbiAgICAgICAgY29tcGxldGVkT3JkZXJzOiBjb21wbGV0ZWRPcmRlcnMubWFwKG9yZGVyID0+ICh7XG4gICAgICAgICAgb3JkZXJOdW1iZXI6IG9yZGVyLm9yZGVyTnVtYmVyLFxuICAgICAgICAgIHRvdGFsOiBvcmRlci50b3RhbCxcbiAgICAgICAgICBzdGF0dXM6IG9yZGVyLnN0YXR1cyxcbiAgICAgICAgICBwYXltZW50U3RhdHVzOiBvcmRlci5wYXltZW50U3RhdHVzLFxuICAgICAgICAgIHBheW1lbnRNZXRob2Q6IG9yZGVyLnBheW1lbnRNZXRob2QsXG4gICAgICAgICAgb3JkZXJUeXBlOiBvcmRlci5vcmRlclR5cGUsXG4gICAgICAgICAgY3JlYXRlZEF0OiBvcmRlci5jcmVhdGVkQXRcbiAgICAgICAgfSkpXG4gICAgICB9LFxuICAgICAgbWVzc2FnZTogYFRvdGFsIHJldmVudWUgY2FsY3VsYXRlZCBmcm9tICR7YnJlYWtkb3duLm9yZGVyQ291bnR9IGNvbXBsZXRlZCBvcmRlcnNgXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2FsY3VsYXRpbmcgdG90YWwgcmV2ZW51ZTonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGNhbGN1bGF0aW5nIHRvdGFsIHJldmVudWUnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9hZG1pbi9kYXNoYm9hcmQvcmVjZW50LW9yZGVyc1xuLy8gQGRlc2MgICAgR2V0IHJlY2VudCBvcmRlcnMgZm9yIGFkbWluIGRhc2hib2FyZFxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoQWRtaW4gb25seSlcbnJvdXRlci5nZXQoJy9kYXNoYm9hcmQvcmVjZW50LW9yZGVycycsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgbGltaXQgPSBwYXJzZUludChyZXEucXVlcnkubGltaXQpIHx8IDU7XG5cbiAgICBjb25zdCByZWNlbnRPcmRlcnMgPSBhd2FpdCBPcmRlci5maW5kKClcbiAgICAgIC5wb3B1bGF0ZSgnY3VzdG9tZXInLCAnZmlyc3ROYW1lIGxhc3ROYW1lIGVtYWlsIHBob25lIGFkZHJlc3MnKVxuICAgICAgLnNvcnQoeyBjcmVhdGVkQXQ6IC0xIH0pXG4gICAgICAubGltaXQobGltaXQpXG4gICAgICAuc2VsZWN0KCdvcmRlck51bWJlciBjdXN0b21lciB0b3RhbCBzdGF0dXMgY3JlYXRlZEF0Jyk7XG5cbiAgICAvLyBGb3JtYXQgdGhlIHJlc3BvbnNlXG4gICAgY29uc3QgZm9ybWF0dGVkT3JkZXJzID0gcmVjZW50T3JkZXJzLm1hcChvcmRlciA9PiAoe1xuICAgICAgX2lkOiBvcmRlci5faWQsXG4gICAgICBvcmRlck51bWJlcjogb3JkZXIub3JkZXJOdW1iZXIsXG4gICAgICBjdXN0b21lcjogb3JkZXIuY3VzdG9tZXIsXG4gICAgICBjdXN0b21lck5hbWU6IG9yZGVyLmN1c3RvbWVyID8gYCR7b3JkZXIuY3VzdG9tZXIuZmlyc3ROYW1lfSAke29yZGVyLmN1c3RvbWVyLmxhc3ROYW1lfWAgOiAnVW5rbm93biBDdXN0b21lcicsXG4gICAgICBjdXN0b21lckVtYWlsOiBvcmRlci5jdXN0b21lciA/IG9yZGVyLmN1c3RvbWVyLmVtYWlsIDogJycsXG4gICAgICB0b3RhbDogb3JkZXIudG90YWwsXG4gICAgICBzdGF0dXM6IG9yZGVyLnN0YXR1cyxcbiAgICAgIGNyZWF0ZWRBdDogb3JkZXIuY3JlYXRlZEF0XG4gICAgfSkpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IGZvcm1hdHRlZE9yZGVyc1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHJlY2VudCBvcmRlcnM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyByZWNlbnQgb3JkZXJzJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvYWRtaW4vZGFzaGJvYXJkL2FuYWx5dGljc1xuLy8gQGRlc2MgICAgR2V0IGRldGFpbGVkIGFuYWx5dGljcyBmb3IgYWRtaW4gZGFzaGJvYXJkXG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbiBvbmx5KVxucm91dGVyLmdldCgnL2Rhc2hib2FyZC9hbmFseXRpY3MnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIC8vIEdldCBvcmRlcnMgYnkgc3RhdHVzXG4gICAgY29uc3Qgb3JkZXJzQnlTdGF0dXMgPSBhd2FpdCBPcmRlci5hZ2dyZWdhdGUoW1xuICAgICAge1xuICAgICAgICAkZ3JvdXA6IHtcbiAgICAgICAgICBfaWQ6ICckc3RhdHVzJyxcbiAgICAgICAgICBjb3VudDogeyAkc3VtOiAxIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIF0pO1xuXG4gICAgLy8gR2V0IHJldmVudWUgYnkgbW9udGggKGxhc3QgNiBtb250aHMpXG4gICAgY29uc3Qgc2l4TW9udGhzQWdvID0gbmV3IERhdGUoKTtcbiAgICBzaXhNb250aHNBZ28uc2V0TW9udGgoc2l4TW9udGhzQWdvLmdldE1vbnRoKCkgLSA2KTtcblxuICAgIGNvbnN0IHJldmVudWVCeU1vbnRoID0gYXdhaXQgT3JkZXIuYWdncmVnYXRlKFtcbiAgICAgIHtcbiAgICAgICAgJG1hdGNoOiB7XG4gICAgICAgICAgY3JlYXRlZEF0OiB7ICRndGU6IHNpeE1vbnRoc0FnbyB9LFxuICAgICAgICAgIHN0YXR1czogeyAkaW46IFsnY29uZmlybWVkJywgJ2NvbXBsZXRlZCcsICdyZWFkeSddIH0sXG4gICAgICAgICAgcGF5bWVudFN0YXR1czogJ3BhaWQnXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgICRncm91cDoge1xuICAgICAgICAgIF9pZDoge1xuICAgICAgICAgICAgeWVhcjogeyAkeWVhcjogJyRjcmVhdGVkQXQnIH0sXG4gICAgICAgICAgICBtb250aDogeyAkbW9udGg6ICckY3JlYXRlZEF0JyB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXZlbnVlOiB7ICRzdW06ICckdG90YWwnIH0sXG4gICAgICAgICAgb3JkZXJDb3VudDogeyAkc3VtOiAxIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJHNvcnQ6IHsgJ19pZC55ZWFyJzogMSwgJ19pZC5tb250aCc6IDEgfVxuICAgICAgfVxuICAgIF0pO1xuXG4gICAgLy8gR2V0IHRvcCBzZWxsaW5nIHByb2R1Y3RzXG4gICAgY29uc3QgdG9wUHJvZHVjdHMgPSBhd2FpdCBPcmRlci5hZ2dyZWdhdGUoW1xuICAgICAgeyAkdW53aW5kOiAnJGl0ZW1zJyB9LFxuICAgICAge1xuICAgICAgICAkZ3JvdXA6IHtcbiAgICAgICAgICBfaWQ6ICckaXRlbXMucHJvZHVjdCcsXG4gICAgICAgICAgbmFtZTogeyAkZmlyc3Q6ICckaXRlbXMubmFtZScgfSxcbiAgICAgICAgICB0b3RhbFNvbGQ6IHsgJHN1bTogJyRpdGVtcy5xdWFudGl0eScgfSxcbiAgICAgICAgICB0b3RhbFJldmVudWU6IHsgJHN1bTogeyAkbXVsdGlwbHk6IFsnJGl0ZW1zLnByaWNlJywgJyRpdGVtcy5xdWFudGl0eSddIH0gfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgeyAkc29ydDogeyB0b3RhbFNvbGQ6IC0xIH0gfSxcbiAgICAgIHsgJGxpbWl0OiA1IH1cbiAgICBdKTtcblxuICAgIC8vIEdldCBjdXN0b21lciBncm93dGggKG5ldyBjdXN0b21lcnMgcGVyIG1vbnRoKVxuICAgIGNvbnN0IGN1c3RvbWVyR3Jvd3RoID0gYXdhaXQgVXNlci5hZ2dyZWdhdGUoW1xuICAgICAge1xuICAgICAgICAkbWF0Y2g6IHtcbiAgICAgICAgICByb2xlOiAnY3VzdG9tZXInLFxuICAgICAgICAgIGNyZWF0ZWRBdDogeyAkZ3RlOiBzaXhNb250aHNBZ28gfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkZ3JvdXA6IHtcbiAgICAgICAgICBfaWQ6IHtcbiAgICAgICAgICAgIHllYXI6IHsgJHllYXI6ICckY3JlYXRlZEF0JyB9LFxuICAgICAgICAgICAgbW9udGg6IHsgJG1vbnRoOiAnJGNyZWF0ZWRBdCcgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbmV3Q3VzdG9tZXJzOiB7ICRzdW06IDEgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkc29ydDogeyAnX2lkLnllYXInOiAxLCAnX2lkLm1vbnRoJzogMSB9XG4gICAgICB9XG4gICAgXSk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBvcmRlcnNCeVN0YXR1czogb3JkZXJzQnlTdGF0dXMucmVkdWNlKChhY2MsIGl0ZW0pID0+IHtcbiAgICAgICAgICBhY2NbaXRlbS5faWRdID0gaXRlbS5jb3VudDtcbiAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICB9LCB7fSksXG4gICAgICAgIHJldmVudWVCeU1vbnRoLFxuICAgICAgICB0b3BQcm9kdWN0cyxcbiAgICAgICAgY3VzdG9tZXJHcm93dGhcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBhbmFseXRpY3M6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBhbmFseXRpY3MnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5cblxucm91dGVyLmdldCgnL29yZGVycycsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFnZSA9IHBhcnNlSW50KHJlcS5xdWVyeS5wYWdlKSB8fCAxO1xuICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLnF1ZXJ5LmxpbWl0KSB8fCAxMDtcbiAgICBjb25zdCBzdGF0dXMgPSByZXEucXVlcnkuc3RhdHVzO1xuICAgIGNvbnN0IHNlYXJjaCA9IHJlcS5xdWVyeS5zZWFyY2g7XG4gICAgY29uc3Qgc29ydEJ5ID0gcmVxLnF1ZXJ5LnNvcnRCeSB8fCAnY3JlYXRlZEF0JztcbiAgICBjb25zdCBzb3J0T3JkZXIgPSByZXEucXVlcnkuc29ydE9yZGVyID09PSAnYXNjJyA/IDEgOiAtMTtcblxuICAgIC8vIEJ1aWxkIGZpbHRlciBvYmplY3RcbiAgICBsZXQgZmlsdGVyID0ge307XG4gICAgaWYgKHN0YXR1cyAmJiBzdGF0dXMgIT09ICdhbGwnKSB7XG4gICAgICBmaWx0ZXIuc3RhdHVzID0gc3RhdHVzO1xuICAgIH1cbiAgICBpZiAoc2VhcmNoKSB7XG4gICAgICBmaWx0ZXIuJG9yID0gW1xuICAgICAgICB7IG9yZGVyTnVtYmVyOiB7ICRyZWdleDogc2VhcmNoLCAkb3B0aW9uczogJ2knIH0gfSxcbiAgICAgICAgeyAnY3VzdG9tZXIuZmlyc3ROYW1lJzogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH0sXG4gICAgICAgIHsgJ2N1c3RvbWVyLmxhc3ROYW1lJzogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH0sXG4gICAgICAgIHsgJ2N1c3RvbWVyLmVtYWlsJzogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH1cbiAgICAgIF07XG4gICAgfVxuXG4gICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcblxuICAgIGNvbnN0IG9yZGVycyA9IGF3YWl0IE9yZGVyLmZpbmQoZmlsdGVyKVxuICAgICAgLnBvcHVsYXRlKCdjdXN0b21lcicsICdmaXJzdE5hbWUgbGFzdE5hbWUgZW1haWwgcGhvbmUgYWRkcmVzcycpXG4gICAgICAuc29ydCh7IFtzb3J0QnldOiBzb3J0T3JkZXIgfSlcbiAgICAgIC5za2lwKHNraXApXG4gICAgICAubGltaXQobGltaXQpO1xuXG4gICAgY29uc3QgdG90YWxPcmRlcnMgPSBhd2FpdCBPcmRlci5jb3VudERvY3VtZW50cyhmaWx0ZXIpO1xuICAgIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwodG90YWxPcmRlcnMgLyBsaW1pdCk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBvcmRlcnMsXG4gICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICBjdXJyZW50UGFnZTogcGFnZSxcbiAgICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgICAgIHRvdGFsT3JkZXJzLFxuICAgICAgICAgIGhhc05leHQ6IHBhZ2UgPCB0b3RhbFBhZ2VzLFxuICAgICAgICAgIGhhc1ByZXY6IHBhZ2UgPiAxXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBvcmRlcnM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBvcmRlcnMnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9hZG1pbi9vcmRlcnMvOmlkXG4vLyBAZGVzYyAgICBHZXQgc2luZ2xlIG9yZGVyIGRldGFpbHNcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKEFkbWluIG9ubHkpXG5yb3V0ZXIuZ2V0KCcvb3JkZXJzLzppZCcsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBPcmRlci5maW5kQnlJZChyZXEucGFyYW1zLmlkKVxuICAgICAgLnBvcHVsYXRlKCdjdXN0b21lcicsICdmaXJzdE5hbWUgbGFzdE5hbWUgZW1haWwgcGhvbmUgYWRkcmVzcycpO1xuXG4gICAgaWYgKCFvcmRlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdPcmRlciBub3QgZm91bmQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogb3JkZXJcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBvcmRlciBkZXRhaWxzOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgb3JkZXIgZGV0YWlscydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIFBVVCAvYXBpL2FkbWluL29yZGVycy86aWQvc3RhdHVzXG4vLyBAZGVzYyAgICBVcGRhdGUgb3JkZXIgc3RhdHVzXG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbiBvbmx5KVxucm91dGVyLnB1dCgnL29yZGVycy86aWQvc3RhdHVzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHN0YXR1cyB9ID0gcmVxLmJvZHk7XG4gICAgY29uc3QgdmFsaWRTdGF0dXNlcyA9IFsncGVuZGluZycsICdjb25maXJtZWQnLCAncHJlcGFyaW5nJywgJ3JlYWR5JywgJ2NvbXBsZXRlZCcsICdjYW5jZWxsZWQnXTtcblxuICAgIGlmICghdmFsaWRTdGF0dXNlcy5pbmNsdWRlcyhzdGF0dXMpKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgb3JkZXIgc3RhdHVzJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBPcmRlci5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnT3JkZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgb3JkZXIuc3RhdHVzID0gc3RhdHVzO1xuICAgIG9yZGVyLnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG5cbiAgICBhd2FpdCBvcmRlci5zYXZlKCk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ09yZGVyIHN0YXR1cyB1cGRhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICBkYXRhOiBvcmRlclxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIG9yZGVyIHN0YXR1czonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIHVwZGF0aW5nIG9yZGVyIHN0YXR1cydcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEN1c3RvbWVyIE1hbmFnZW1lbnQgUm91dGVzXG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2FkbWluL2N1c3RvbWVyc1xuLy8gQGRlc2MgICAgR2V0IGFsbCBjdXN0b21lcnMgd2l0aCBmaWx0ZXJpbmcgYW5kIHBhZ2luYXRpb25cbi8vIEBhY2Nlc3MgIFByaXZhdGUgKEFkbWluIG9ubHkpXG5yb3V0ZXIuZ2V0KCcvY3VzdG9tZXJzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQocmVxLnF1ZXJ5LnBhZ2UpIHx8IDE7XG4gICAgY29uc3QgbGltaXQgPSBwYXJzZUludChyZXEucXVlcnkubGltaXQpIHx8IDEwO1xuICAgIGNvbnN0IHNlYXJjaCA9IHJlcS5xdWVyeS5zZWFyY2g7XG4gICAgY29uc3Qgc29ydEJ5ID0gcmVxLnF1ZXJ5LnNvcnRCeSB8fCAnY3JlYXRlZEF0JztcbiAgICBjb25zdCBzb3J0T3JkZXIgPSByZXEucXVlcnkuc29ydE9yZGVyID09PSAnYXNjJyA/IDEgOiAtMTtcblxuICAgIC8vIEJ1aWxkIGZpbHRlciBvYmplY3RcbiAgICBsZXQgZmlsdGVyID0geyByb2xlOiAnY3VzdG9tZXInIH07XG4gICAgaWYgKHNlYXJjaCkge1xuICAgICAgZmlsdGVyLiRvciA9IFtcbiAgICAgICAgeyBmaXJzdE5hbWU6IHsgJHJlZ2V4OiBzZWFyY2gsICRvcHRpb25zOiAnaScgfSB9LFxuICAgICAgICB7IGxhc3ROYW1lOiB7ICRyZWdleDogc2VhcmNoLCAkb3B0aW9uczogJ2knIH0gfSxcbiAgICAgICAgeyBlbWFpbDogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH0sXG4gICAgICAgIHsgcGhvbmU6IHsgJHJlZ2V4OiBzZWFyY2gsICRvcHRpb25zOiAnaScgfSB9XG4gICAgICBdO1xuICAgIH1cblxuICAgIGNvbnN0IHNraXAgPSAocGFnZSAtIDEpICogbGltaXQ7XG5cbiAgICBjb25zdCBjdXN0b21lcnMgPSBhd2FpdCBVc2VyLmZpbmQoZmlsdGVyKVxuICAgICAgLnNlbGVjdCgnLXBhc3N3b3JkJylcbiAgICAgIC5zb3J0KHsgW3NvcnRCeV06IHNvcnRPcmRlciB9KVxuICAgICAgLnNraXAoc2tpcClcbiAgICAgIC5saW1pdChsaW1pdCk7XG5cbiAgICAvLyBHZXQgb3JkZXIgc3RhdGlzdGljcyBmb3IgZWFjaCBjdXN0b21lclxuICAgIGNvbnN0IGN1c3RvbWVyc1dpdGhTdGF0cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgY3VzdG9tZXJzLm1hcChhc3luYyAoY3VzdG9tZXIpID0+IHtcbiAgICAgICAgY29uc3Qgb3JkZXJTdGF0cyA9IGF3YWl0IE9yZGVyLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgeyAkbWF0Y2g6IHsgY3VzdG9tZXI6IGN1c3RvbWVyLl9pZCB9IH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgJGdyb3VwOiB7XG4gICAgICAgICAgICAgIF9pZDogbnVsbCxcbiAgICAgICAgICAgICAgdG90YWxPcmRlcnM6IHsgJHN1bTogMSB9LFxuICAgICAgICAgICAgICB0b3RhbFNwZW50OiB7ICRzdW06ICckdG90YWwnIH0sXG4gICAgICAgICAgICAgIGxhc3RPcmRlckRhdGU6IHsgJG1heDogJyRjcmVhdGVkQXQnIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIF0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4uY3VzdG9tZXIudG9PYmplY3QoKSxcbiAgICAgICAgICBvcmRlclN0YXRzOiBvcmRlclN0YXRzWzBdIHx8IHtcbiAgICAgICAgICAgIHRvdGFsT3JkZXJzOiAwLFxuICAgICAgICAgICAgdG90YWxTcGVudDogMCxcbiAgICAgICAgICAgIGxhc3RPcmRlckRhdGU6IG51bGxcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KVxuICAgICk7XG5cbiAgICBjb25zdCB0b3RhbEN1c3RvbWVycyA9IGF3YWl0IFVzZXIuY291bnREb2N1bWVudHMoZmlsdGVyKTtcbiAgICBjb25zdCB0b3RhbFBhZ2VzID0gTWF0aC5jZWlsKHRvdGFsQ3VzdG9tZXJzIC8gbGltaXQpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgY3VzdG9tZXJzOiBjdXN0b21lcnNXaXRoU3RhdHMsXG4gICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICBjdXJyZW50UGFnZTogcGFnZSxcbiAgICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgICAgIHRvdGFsQ3VzdG9tZXJzLFxuICAgICAgICAgIGhhc05leHQ6IHBhZ2UgPCB0b3RhbFBhZ2VzLFxuICAgICAgICAgIGhhc1ByZXY6IHBhZ2UgPiAxXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBjdXN0b21lcnM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBjdXN0b21lcnMnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9hZG1pbi9jdXN0b21lcnMvOmlkXG4vLyBAZGVzYyAgICBHZXQgc2luZ2xlIGN1c3RvbWVyIGRldGFpbHMgd2l0aCBvcmRlciBoaXN0b3J5XG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbiBvbmx5KVxucm91dGVyLmdldCgnL2N1c3RvbWVycy86aWQnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGN1c3RvbWVyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEucGFyYW1zLmlkKVxuICAgICAgLnNlbGVjdCgnLXBhc3N3b3JkJyk7XG5cbiAgICBpZiAoIWN1c3RvbWVyIHx8IGN1c3RvbWVyLnJvbGUgIT09ICdjdXN0b21lcicpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQ3VzdG9tZXIgbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gR2V0IGN1c3RvbWVyJ3Mgb3JkZXIgaGlzdG9yeVxuICAgIGNvbnN0IG9yZGVycyA9IGF3YWl0IE9yZGVyLmZpbmQoeyBjdXN0b21lcjogcmVxLnBhcmFtcy5pZCB9KVxuICAgICAgLnNvcnQoeyBjcmVhdGVkQXQ6IC0xIH0pXG4gICAgICAubGltaXQoMTApO1xuXG4gICAgLy8gR2V0IGN1c3RvbWVyIHN0YXRpc3RpY3NcbiAgICBjb25zdCBzdGF0cyA9IGF3YWl0IE9yZGVyLmFnZ3JlZ2F0ZShbXG4gICAgICB7ICRtYXRjaDogeyBjdXN0b21lcjogbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQocmVxLnBhcmFtcy5pZCkgfSB9LFxuICAgICAge1xuICAgICAgICAkZ3JvdXA6IHtcbiAgICAgICAgICBfaWQ6IG51bGwsXG4gICAgICAgICAgdG90YWxPcmRlcnM6IHsgJHN1bTogMSB9LFxuICAgICAgICAgIHRvdGFsU3BlbnQ6IHsgJHN1bTogJyR0b3RhbCcgfSxcbiAgICAgICAgICBhdmVyYWdlT3JkZXJWYWx1ZTogeyAkYXZnOiAnJHRvdGFsJyB9LFxuICAgICAgICAgIGxhc3RPcmRlckRhdGU6IHsgJG1heDogJyRjcmVhdGVkQXQnIH0sXG4gICAgICAgICAgZmlyc3RPcmRlckRhdGU6IHsgJG1pbjogJyRjcmVhdGVkQXQnIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIF0pO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgY3VzdG9tZXIsXG4gICAgICAgIG9yZGVycyxcbiAgICAgICAgc3RhdHM6IHN0YXRzWzBdIHx8IHtcbiAgICAgICAgICB0b3RhbE9yZGVyczogMCxcbiAgICAgICAgICB0b3RhbFNwZW50OiAwLFxuICAgICAgICAgIGF2ZXJhZ2VPcmRlclZhbHVlOiAwLFxuICAgICAgICAgIGxhc3RPcmRlckRhdGU6IG51bGwsXG4gICAgICAgICAgZmlyc3RPcmRlckRhdGU6IG51bGxcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGN1c3RvbWVyIGRldGFpbHM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBjdXN0b21lciBkZXRhaWxzJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQ29udGFjdCBNYW5hZ2VtZW50IFJvdXRlc1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9hZG1pbi9jb250YWN0c1xuLy8gQGRlc2MgICAgR2V0IGFsbCBjb250YWN0IG1lc3NhZ2VzIHdpdGggZmlsdGVyaW5nIGFuZCBwYWdpbmF0aW9uXG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbiBvbmx5KVxucm91dGVyLmdldCgnL2NvbnRhY3RzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBDb250YWN0ID0gcmVxdWlyZSgnLi4vbW9kZWxzL0NvbnRhY3QnKTtcbiAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQocmVxLnF1ZXJ5LnBhZ2UpIHx8IDE7XG4gICAgY29uc3QgbGltaXQgPSBwYXJzZUludChyZXEucXVlcnkubGltaXQpIHx8IDEwO1xuICAgIGNvbnN0IHN0YXR1cyA9IHJlcS5xdWVyeS5zdGF0dXM7XG4gICAgY29uc3Qgc2VhcmNoID0gcmVxLnF1ZXJ5LnNlYXJjaDtcbiAgICBjb25zdCBzb3J0QnkgPSByZXEucXVlcnkuc29ydEJ5IHx8ICdjcmVhdGVkQXQnO1xuICAgIGNvbnN0IHNvcnRPcmRlciA9IHJlcS5xdWVyeS5zb3J0T3JkZXIgPT09ICdhc2MnID8gMSA6IC0xO1xuXG4gICAgLy8gQnVpbGQgZmlsdGVyIG9iamVjdFxuICAgIGxldCBmaWx0ZXIgPSB7fTtcbiAgICBpZiAoc3RhdHVzICYmIHN0YXR1cyAhPT0gJ2FsbCcpIHtcbiAgICAgIGZpbHRlci5zdGF0dXMgPSBzdGF0dXM7XG4gICAgfVxuICAgIGlmIChzZWFyY2gpIHtcbiAgICAgIGZpbHRlci4kb3IgPSBbXG4gICAgICAgIHsgbmFtZTogeyAkcmVnZXg6IHNlYXJjaCwgJG9wdGlvbnM6ICdpJyB9IH0sXG4gICAgICAgIHsgZW1haWw6IHsgJHJlZ2V4OiBzZWFyY2gsICRvcHRpb25zOiAnaScgfSB9LFxuICAgICAgICB7IHN1YmplY3Q6IHsgJHJlZ2V4OiBzZWFyY2gsICRvcHRpb25zOiAnaScgfSB9LFxuICAgICAgICB7IHRpY2tldElkOiB7ICRyZWdleDogc2VhcmNoLCAkb3B0aW9uczogJ2knIH0gfVxuICAgICAgXTtcbiAgICB9XG5cbiAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuXG4gICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBDb250YWN0LmZpbmQoZmlsdGVyKVxuICAgICAgLnNvcnQoeyBbc29ydEJ5XTogc29ydE9yZGVyIH0pXG4gICAgICAuc2tpcChza2lwKVxuICAgICAgLmxpbWl0KGxpbWl0KTtcblxuICAgIGNvbnN0IHRvdGFsQ29udGFjdHMgPSBhd2FpdCBDb250YWN0LmNvdW50RG9jdW1lbnRzKGZpbHRlcik7XG4gICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbENvbnRhY3RzIC8gbGltaXQpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgY29udGFjdHMsXG4gICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICBjdXJyZW50UGFnZTogcGFnZSxcbiAgICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgICAgIHRvdGFsQ29udGFjdHMsXG4gICAgICAgICAgaGFzTmV4dDogcGFnZSA8IHRvdGFsUGFnZXMsXG4gICAgICAgICAgaGFzUHJldjogcGFnZSA+IDFcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGNvbnRhY3RzOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgY29udGFjdHMnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9hZG1pbi9jb250YWN0cy86aWRcbi8vIEBkZXNjICAgIEdldCBzaW5nbGUgY29udGFjdCBtZXNzYWdlIGRldGFpbHNcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKEFkbWluIG9ubHkpXG5yb3V0ZXIuZ2V0KCcvY29udGFjdHMvOmlkJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBDb250YWN0ID0gcmVxdWlyZSgnLi4vbW9kZWxzL0NvbnRhY3QnKTtcbiAgICBjb25zdCBjb250YWN0ID0gYXdhaXQgQ29udGFjdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcblxuICAgIGlmICghY29udGFjdCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdDb250YWN0IG1lc3NhZ2Ugbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IGNvbnRhY3RcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBjb250YWN0IGRldGFpbHM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBjb250YWN0IGRldGFpbHMnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBQVVQgL2FwaS9hZG1pbi9jb250YWN0cy86aWQvc3RhdHVzXG4vLyBAZGVzYyAgICBVcGRhdGUgY29udGFjdCBtZXNzYWdlIHN0YXR1c1xuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoQWRtaW4gb25seSlcbnJvdXRlci5wdXQoJy9jb250YWN0cy86aWQvc3RhdHVzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBDb250YWN0ID0gcmVxdWlyZSgnLi4vbW9kZWxzL0NvbnRhY3QnKTtcbiAgICBjb25zdCB7IHN0YXR1cyB9ID0gcmVxLmJvZHk7XG5cbiAgICAvLyBWYWxpZGF0ZSBzdGF0dXNcbiAgICBjb25zdCB2YWxpZFN0YXR1c2VzID0gWyduZXcnLCAncmVhZCcsICdyZXBsaWVkJywgJ2Nsb3NlZCddO1xuICAgIGlmICghdmFsaWRTdGF0dXNlcy5pbmNsdWRlcyhzdGF0dXMpKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgc3RhdHVzLiBNdXN0IGJlIG9uZSBvZjogbmV3LCByZWFkLCByZXBsaWVkLCBjbG9zZWQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBjb250YWN0ID0gYXdhaXQgQ29udGFjdC5maW5kQnlJZEFuZFVwZGF0ZShcbiAgICAgIHJlcS5wYXJhbXMuaWQsXG4gICAgICB7IHN0YXR1cywgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0sXG4gICAgICB7IG5ldzogdHJ1ZSwgcnVuVmFsaWRhdG9yczogdHJ1ZSB9XG4gICAgKTtcblxuICAgIGlmICghY29udGFjdCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdDb250YWN0IG1lc3NhZ2Ugbm90IGZvdW5kJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IGNvbnRhY3QsXG4gICAgICBtZXNzYWdlOiAnQ29udGFjdCBzdGF0dXMgdXBkYXRlZCBzdWNjZXNzZnVsbHknXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgY29udGFjdCBzdGF0dXM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSB1cGRhdGluZyBjb250YWN0IHN0YXR1cydcbiAgICB9KTtcbiAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gcm91dGVyOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNO0VBQUVDLE9BQU87RUFBRUM7QUFBVSxDQUFDLEdBQUdKLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQztBQUM1RCxNQUFNSyxJQUFJLEdBQUdMLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUN0QyxNQUFNTSxPQUFPLEdBQUdOLE9BQU8sQ0FBQyxt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","map":{"version":3,"names":["express","require","router","Router","protect","authorize","User","Product","Order","mongoose","get","req","res","totalProducts","countDocuments","totalOrders","totalCustomers","role","revenueResult","aggregate","$match","status","$in","paymentStatus","$group","_id","totalRevenue","$sum","length","json","success","data","error","console","message","revenueBreakdown","totalSubtotal","totalTax","totalDiscount","orderCount","averageOrderValue","$avg","revenueByPaymentMethod","revenue","$sort","revenueByOrderType","completedOrders","find","select","breakdown","summary","completedOrderCount","byPaymentMethod","byOrderType","map","order","orderNumber","total","paymentMethod","orderType","createdAt","limit","parseInt","query","recentOrders","populate","sort","formattedOrders","customer","customerName","firstName","lastName","customerEmail","email","ordersByStatus","count","sixMonthsAgo","Date","setMonth","getMonth","revenueByMonth","$gte","year","$year","month","$month","topProducts","$unwind","name","$first","totalSold","$multiply","$limit","customerGrowth","newCustomers","reduce","acc","item","page","search","sortBy","sortOrder","filter","$or","$regex","$options","skip","orders","totalPages","Math","ceil","pagination","currentPage","hasNext","hasPrev","findById","params","id","put","body","validStatuses","includes","updatedAt","save","phone","customers","customersWithStats","Promise","all","orderStats","totalSpent","lastOrderDate","$max","toObject","stats","Types","ObjectId","firstOrderDate","$min","Contact","subject","ticketId","contacts","totalContacts","contact","findByIdAndUpdate","new","runValidators","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["admin.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst { protect, authorize } = require('../middleware/auth');\nconst User = require('../models/User');\nconst Product = require('../models/Product');\nconst Order = require('../models/Order');\nconst mongoose = require('mongoose');\n\n// Dashboard statistics\n// @route   GET /api/admin/dashboard/stats\n// @desc    Get dashboard statistics for admin\n// @access  Private (Admin only)\nrouter.get('/dashboard/stats', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get total products count\n    const totalProducts = await Product.countDocuments();\n\n    // Get total orders count\n    const totalOrders = await Order.countDocuments();\n\n    // Get total customers count (users with customer role)\n    const totalCustomers = await User.countDocuments({ role: 'customer' });\n\n    // Get total revenue from paid orders (including confirmed, ready, and completed)\n    const revenueResult = await Order.aggregate([\n      {\n        $match: {\n          status: { $in: ['confirmed', 'completed', 'ready'] },\n          paymentStatus: 'paid'\n        }\n      },\n      {\n        $group: {\n          _id: null,\n          totalRevenue: { $sum: '$total' }\n        }\n      }\n    ]);\n\n    const totalRevenue = revenueResult.length > 0 ? revenueResult[0].totalRevenue : 0;\n\n    res.json({\n      success: true,\n      data: {\n        totalProducts,\n        totalOrders,\n        totalCustomers,\n        totalRevenue\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching dashboard stats:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching dashboard statistics'\n    });\n  }\n});\n\n// @route   GET /api/admin/revenue/total\n// @desc    Get detailed total revenue calculation from completed orders\n// @access  Private (Admin only)\nrouter.get('/revenue/total', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get detailed revenue breakdown from paid orders (including confirmed, ready, and completed)\n    const revenueBreakdown = await Order.aggregate([\n      {\n        $match: {\n          status: { $in: ['confirmed', 'completed', 'ready'] },\n          paymentStatus: 'paid'\n        }\n      },\n      {\n        $group: {\n          _id: null,\n          totalRevenue: { $sum: '$total' },\n          totalSubtotal: { $sum: '$subtotal' },\n          totalTax: { $sum: '$tax' },\n          totalDiscount: { $sum: '$discount' },\n          orderCount: { $sum: 1 },\n          averageOrderValue: { $avg: '$total' }\n        }\n      }\n    ]);\n\n    // Get revenue by payment method\n    const revenueByPaymentMethod = await Order.aggregate([\n      {\n        $match: {\n          status: { $in: ['confirmed', 'completed', 'ready'] },\n          paymentStatus: 'paid'\n        }\n      },\n      {\n        $group: {\n          _id: '$paymentMethod',\n          revenue: { $sum: '$total' },\n          orderCount: { $sum: 1 }\n        }\n      },\n      {\n        $sort: { revenue: -1 }\n      }\n    ]);\n\n    // Get revenue by order type\n    const revenueByOrderType = await Order.aggregate([\n      {\n        $match: {\n          status: { $in: ['confirmed', 'completed', 'ready'] },\n          paymentStatus: 'paid'\n        }\n      },\n      {\n        $group: {\n          _id: '$orderType',\n          revenue: { $sum: '$total' },\n          orderCount: { $sum: 1 }\n        }\n      },\n      {\n        $sort: { revenue: -1 }\n      }\n    ]);\n\n    // Get all paid orders for verification\n    const completedOrders = await Order.find({\n      status: { $in: ['confirmed', 'completed', 'ready'] },\n      paymentStatus: 'paid'\n    }).select('orderNumber total status paymentStatus createdAt paymentMethod orderType');\n\n    const breakdown = revenueBreakdown[0] || {\n      totalRevenue: 0,\n      totalSubtotal: 0,\n      totalTax: 0,\n      totalDiscount: 0,\n      orderCount: 0,\n      averageOrderValue: 0\n    };\n\n    res.json({\n      success: true,\n      data: {\n        summary: {\n          totalRevenue: breakdown.totalRevenue,\n          totalSubtotal: breakdown.totalSubtotal,\n          totalTax: breakdown.totalTax,\n          totalDiscount: breakdown.totalDiscount,\n          completedOrderCount: breakdown.orderCount,\n          averageOrderValue: breakdown.averageOrderValue\n        },\n        breakdown: {\n          byPaymentMethod: revenueByPaymentMethod,\n          byOrderType: revenueByOrderType\n        },\n        completedOrders: completedOrders.map(order => ({\n          orderNumber: order.orderNumber,\n          total: order.total,\n          status: order.status,\n          paymentStatus: order.paymentStatus,\n          paymentMethod: order.paymentMethod,\n          orderType: order.orderType,\n          createdAt: order.createdAt\n        }))\n      },\n      message: `Total revenue calculated from ${breakdown.orderCount} completed orders`\n    });\n  } catch (error) {\n    console.error('Error calculating total revenue:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while calculating total revenue'\n    });\n  }\n});\n\n// @route   GET /api/admin/dashboard/recent-orders\n// @desc    Get recent orders for admin dashboard\n// @access  Private (Admin only)\nrouter.get('/dashboard/recent-orders', protect, authorize('admin'), async (req, res) => {\n  try {\n    const limit = parseInt(req.query.limit) || 5;\n\n    const recentOrders = await Order.find()\n      .populate('customer', 'firstName lastName email phone address')\n      .sort({ createdAt: -1 })\n      .limit(limit)\n      .select('orderNumber customer total status createdAt');\n\n    // Format the response\n    const formattedOrders = recentOrders.map(order => ({\n      _id: order._id,\n      orderNumber: order.orderNumber,\n      customer: order.customer,\n      customerName: order.customer ? `${order.customer.firstName} ${order.customer.lastName}` : 'Unknown Customer',\n      customerEmail: order.customer ? order.customer.email : '',\n      total: order.total,\n      status: order.status,\n      createdAt: order.createdAt\n    }));\n\n    res.json({\n      success: true,\n      data: formattedOrders\n    });\n  } catch (error) {\n    console.error('Error fetching recent orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching recent orders'\n    });\n  }\n});\n\n// @route   GET /api/admin/dashboard/analytics\n// @desc    Get detailed analytics for admin dashboard\n// @access  Private (Admin only)\nrouter.get('/dashboard/analytics', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get orders by status\n    const ordersByStatus = await Order.aggregate([\n      {\n        $group: {\n          _id: '$status',\n          count: { $sum: 1 }\n        }\n      }\n    ]);\n\n    // Get revenue by month (last 6 months)\n    const sixMonthsAgo = new Date();\n    sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\n\n    const revenueByMonth = await Order.aggregate([\n      {\n        $match: {\n          createdAt: { $gte: sixMonthsAgo },\n          status: { $in: ['confirmed', 'completed', 'ready'] },\n          paymentStatus: 'paid'\n        }\n      },\n      {\n        $group: {\n          _id: {\n            year: { $year: '$createdAt' },\n            month: { $month: '$createdAt' }\n          },\n          revenue: { $sum: '$total' },\n          orderCount: { $sum: 1 }\n        }\n      },\n      {\n        $sort: { '_id.year': 1, '_id.month': 1 }\n      }\n    ]);\n\n    // Get top selling products\n    const topProducts = await Order.aggregate([\n      { $unwind: '$items' },\n      {\n        $group: {\n          _id: '$items.product',\n          name: { $first: '$items.name' },\n          totalSold: { $sum: '$items.quantity' },\n          totalRevenue: { $sum: { $multiply: ['$items.price', '$items.quantity'] } }\n        }\n      },\n      { $sort: { totalSold: -1 } },\n      { $limit: 5 }\n    ]);\n\n    // Get customer growth (new customers per month)\n    const customerGrowth = await User.aggregate([\n      {\n        $match: {\n          role: 'customer',\n          createdAt: { $gte: sixMonthsAgo }\n        }\n      },\n      {\n        $group: {\n          _id: {\n            year: { $year: '$createdAt' },\n            month: { $month: '$createdAt' }\n          },\n          newCustomers: { $sum: 1 }\n        }\n      },\n      {\n        $sort: { '_id.year': 1, '_id.month': 1 }\n      }\n    ]);\n\n    res.json({\n      success: true,\n      data: {\n        ordersByStatus: ordersByStatus.reduce((acc, item) => {\n          acc[item._id] = item.count;\n          return acc;\n        }, {}),\n        revenueByMonth,\n        topProducts,\n        customerGrowth\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching analytics:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching analytics'\n    });\n  }\n});\n\n\n\nrouter.get('/orders', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = {};\n    if (status && status !== 'all') {\n      filter.status = status;\n    }\n    if (search) {\n      filter.$or = [\n        { orderNumber: { $regex: search, $options: 'i' } },\n        { 'customer.firstName': { $regex: search, $options: 'i' } },\n        { 'customer.lastName': { $regex: search, $options: 'i' } },\n        { 'customer.email': { $regex: search, $options: 'i' } }\n      ];\n    }\n\n    const skip = (page - 1) * limit;\n\n    const orders = await Order.find(filter)\n      .populate('customer', 'firstName lastName email phone address')\n      .sort({ [sortBy]: sortOrder })\n      .skip(skip)\n      .limit(limit);\n\n    const totalOrders = await Order.countDocuments(filter);\n    const totalPages = Math.ceil(totalOrders / limit);\n\n    res.json({\n      success: true,\n      data: {\n        orders,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalOrders,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching orders:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching orders'\n    });\n  }\n});\n\n// @route   GET /api/admin/orders/:id\n// @desc    Get single order details\n// @access  Private (Admin only)\nrouter.get('/orders/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const order = await Order.findById(req.params.id)\n      .populate('customer', 'firstName lastName email phone address');\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    res.json({\n      success: true,\n      data: order\n    });\n  } catch (error) {\n    console.error('Error fetching order details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching order details'\n    });\n  }\n});\n\n// @route   PUT /api/admin/orders/:id/status\n// @desc    Update order status\n// @access  Private (Admin only)\nrouter.put('/orders/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const { status } = req.body;\n    const validStatuses = ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'];\n\n    if (!validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid order status'\n      });\n    }\n\n    const order = await Order.findById(req.params.id);\n\n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        message: 'Order not found'\n      });\n    }\n\n    order.status = status;\n    order.updatedAt = new Date();\n\n    await order.save();\n\n    res.json({\n      success: true,\n      message: 'Order status updated successfully',\n      data: order\n    });\n  } catch (error) {\n    console.error('Error updating order status:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating order status'\n    });\n  }\n});\n\n// Customer Management Routes\n\n// @route   GET /api/admin/customers\n// @desc    Get all customers with filtering and pagination\n// @access  Private (Admin only)\nrouter.get('/customers', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = { role: 'customer' };\n    if (search) {\n      filter.$or = [\n        { firstName: { $regex: search, $options: 'i' } },\n        { lastName: { $regex: search, $options: 'i' } },\n        { email: { $regex: search, $options: 'i' } },\n        { phone: { $regex: search, $options: 'i' } }\n      ];\n    }\n\n    const skip = (page - 1) * limit;\n\n    const customers = await User.find(filter)\n      .select('-password')\n      .sort({ [sortBy]: sortOrder })\n      .skip(skip)\n      .limit(limit);\n\n    // Get order statistics for each customer\n    const customersWithStats = await Promise.all(\n      customers.map(async (customer) => {\n        const orderStats = await Order.aggregate([\n          { $match: { customer: customer._id } },\n          {\n            $group: {\n              _id: null,\n              totalOrders: { $sum: 1 },\n              totalSpent: { $sum: '$total' },\n              lastOrderDate: { $max: '$createdAt' }\n            }\n          }\n        ]);\n\n        return {\n          ...customer.toObject(),\n          orderStats: orderStats[0] || {\n            totalOrders: 0,\n            totalSpent: 0,\n            lastOrderDate: null\n          }\n        };\n      })\n    );\n\n    const totalCustomers = await User.countDocuments(filter);\n    const totalPages = Math.ceil(totalCustomers / limit);\n\n    res.json({\n      success: true,\n      data: {\n        customers: customersWithStats,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalCustomers,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching customers:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching customers'\n    });\n  }\n});\n\n// @route   GET /api/admin/customers/:id\n// @desc    Get single customer details with order history\n// @access  Private (Admin only)\nrouter.get('/customers/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const customer = await User.findById(req.params.id)\n      .select('-password');\n\n    if (!customer || customer.role !== 'customer') {\n      return res.status(404).json({\n        success: false,\n        message: 'Customer not found'\n      });\n    }\n\n    // Get customer's order history\n    const orders = await Order.find({ customer: req.params.id })\n      .sort({ createdAt: -1 })\n      .limit(10);\n\n    // Get customer statistics\n    const stats = await Order.aggregate([\n      { $match: { customer: mongoose.Types.ObjectId(req.params.id) } },\n      {\n        $group: {\n          _id: null,\n          totalOrders: { $sum: 1 },\n          totalSpent: { $sum: '$total' },\n          averageOrderValue: { $avg: '$total' },\n          lastOrderDate: { $max: '$createdAt' },\n          firstOrderDate: { $min: '$createdAt' }\n        }\n      }\n    ]);\n\n    res.json({\n      success: true,\n      data: {\n        customer,\n        orders,\n        stats: stats[0] || {\n          totalOrders: 0,\n          totalSpent: 0,\n          averageOrderValue: 0,\n          lastOrderDate: null,\n          firstOrderDate: null\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching customer details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching customer details'\n    });\n  }\n});\n\n// Contact Management Routes\n\n// @route   GET /api/admin/contacts\n// @desc    Get all contact messages with filtering and pagination\n// @access  Private (Admin only)\nrouter.get('/contacts', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const search = req.query.search;\n    const sortBy = req.query.sortBy || 'createdAt';\n    const sortOrder = req.query.sortOrder === 'asc' ? 1 : -1;\n\n    // Build filter object\n    let filter = {};\n    if (status && status !== 'all') {\n      filter.status = status;\n    }\n    if (search) {\n      filter.$or = [\n        { name: { $regex: search, $options: 'i' } },\n        { email: { $regex: search, $options: 'i' } },\n        { subject: { $regex: search, $options: 'i' } },\n        { ticketId: { $regex: search, $options: 'i' } }\n      ];\n    }\n\n    const skip = (page - 1) * limit;\n\n    const contacts = await Contact.find(filter)\n      .sort({ [sortBy]: sortOrder })\n      .skip(skip)\n      .limit(limit);\n\n    const totalContacts = await Contact.countDocuments(filter);\n    const totalPages = Math.ceil(totalContacts / limit);\n\n    res.json({\n      success: true,\n      data: {\n        contacts,\n        pagination: {\n          currentPage: page,\n          totalPages,\n          totalContacts,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching contacts:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching contacts'\n    });\n  }\n});\n\n// @route   GET /api/admin/contacts/:id\n// @desc    Get single contact message details\n// @access  Private (Admin only)\nrouter.get('/contacts/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const contact = await Contact.findById(req.params.id);\n\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Error fetching contact details:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching contact details'\n    });\n  }\n});\n\n// @route   PUT /api/admin/contacts/:id/status\n// @desc    Update contact message status\n// @access  Private (Admin only)\nrouter.put('/contacts/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const Contact = require('../models/Contact');\n    const { status } = req.body;\n\n    // Validate status\n    const validStatuses = ['new', 'read', 'replied', 'closed'];\n    if (!validStatuses.includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid status. Must be one of: new, read, replied, closed'\n      });\n    }\n\n    const contact = await Contact.findByIdAndUpdate(\n      req.params.id,\n      { status, updatedAt: new Date() },\n      { new: true, runValidators: true }\n    );\n\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    res.json({\n      success: true,\n      data: contact,\n      message: 'Contact status updated successfully'\n    });\n  } catch (error) {\n    console.error('Error updating contact status:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating contact status'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1757588893629},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\shop.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst ShopService = require('../services/shopService');\nconst {\n  protect,\n  authorize\n} = require('../middleware/auth');\n\n// @route   GET /api/shop/config\n// @desc    Get shop configuration\n// @access  Public\nrouter.get('/config', async (req, res) => {\n  try {\n    const result = await ShopService.getShopConfig();\n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in shop config route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching shop configuration'\n    });\n  }\n});\n\n// @route   GET /api/shop/complete\n// @desc    Get complete shop data including menu from database\n// @access  Public\nrouter.get('/complete', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in complete shop data route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching complete shop data'\n    });\n  }\n});\n\n// @route   GET /api/shop/status\n// @desc    Get shop status (open/closed)\n// @access  Public\nrouter.get('/status', async (req, res) => {\n  try {\n    const result = await ShopService.getShopStatus();\n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in shop status route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching shop status'\n    });\n  }\n});\n\n// @route   PUT /api/shop/config\n// @desc    Update shop configuration\n// @access  Private (Admin only)\nrouter.put('/config', protect, authorize('admin'), async (req, res) => {\n  try {\n    const result = await ShopService.updateShopConfig(req.body);\n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data,\n        message: result.message\n      });\n    } else {\n      res.status(400).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in update shop config route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating shop configuration'\n    });\n  }\n});\n\n// @route   POST /api/shop/initialize\n// @desc    Initialize default shop data\n// @access  Private (Admin only)\nrouter.post('/initialize', protect, authorize('admin'), async (req, res) => {\n  try {\n    const result = await ShopService.initializeShopData();\n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data,\n        message: result.message\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in initialize shop data route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while initializing shop data'\n    });\n  }\n});\n\n// @route   GET /api/shop/menu\n// @desc    Get menu data from products\n// @access  Public\nrouter.get('/menu', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    if (result.success) {\n      // Return only menu data\n      res.json({\n        success: true,\n        data: {\n          menu: result.data.menu,\n          businessName: result.data.businessName,\n          lastUpdated: result.data.lastUpdated\n        }\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in menu route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching menu data'\n    });\n  }\n});\n\n// @route   GET /api/shop/ai-context\n// @desc    Get shop data formatted for AI context\n// @access  Public\nrouter.get('/ai-context', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    if (result.success) {\n      // Format data specifically for AI context usage\n      const aiContext = {\n        business: result.data.business,\n        businessName: result.data.business.name,\n        storeName: result.data.business.name,\n        location: result.data.location,\n        contact: result.data.contact,\n        hours: result.data.hours,\n        menu: result.data.menu,\n        services: result.data.services,\n        amenities: result.data.amenities,\n        payment: result.data.payment,\n        policies: result.data.policies,\n        responseTemplates: result.data.responseTemplates,\n        lastUpdated: result.data.lastUpdated\n      };\n      res.json({\n        success: true,\n        data: aiContext\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in AI context route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching AI context data'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIlNob3BTZXJ2aWNlIiwicHJvdGVjdCIsImF1dGhvcml6ZSIsImdldCIsInJlcSIsInJlcyIsInJlc3VsdCIsImdldFNob3BDb25maWciLCJzdWNjZXNzIiwianNvbiIsImRhdGEiLCJzdGF0dXMiLCJtZXNzYWdlIiwiZXJyb3IiLCJjb25zb2xlIiwiZ2V0Q29tcGxldGVTaG9wRGF0YSIsImdldFNob3BTdGF0dXMiLCJwdXQiLCJ1cGRhdGVTaG9wQ29uZmlnIiwiYm9keSIsInBvc3QiLCJpbml0aWFsaXplU2hvcERhdGEiLCJtZW51IiwiYnVzaW5lc3NOYW1lIiwibGFzdFVwZGF0ZWQiLCJhaUNvbnRleHQiLCJidXNpbmVzcyIsIm5hbWUiLCJzdG9yZU5hbWUiLCJsb2NhdGlvbiIsImNvbnRhY3QiLCJob3VycyIsInNlcnZpY2VzIiwiYW1lbml0aWVzIiwicGF5bWVudCIsInBvbGljaWVzIiwicmVzcG9uc2VUZW1wbGF0ZXMiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xccm91dGVzXFwiLCJzb3VyY2VzIjpbInNob3AuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5jb25zdCBTaG9wU2VydmljZSA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL3Nob3BTZXJ2aWNlJyk7XG5jb25zdCB7IHByb3RlY3QsIGF1dGhvcml6ZSB9ID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZS9hdXRoJyk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3Nob3AvY29uZmlnXG4vLyBAZGVzYyAgICBHZXQgc2hvcCBjb25maWd1cmF0aW9uXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5nZXQoJy9jb25maWcnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBTaG9wU2VydmljZS5nZXRTaG9wQ29uZmlnKCk7XG4gICAgXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdC5kYXRhXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBzaG9wIGNvbmZpZyByb3V0ZTonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIGZldGNoaW5nIHNob3AgY29uZmlndXJhdGlvbidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3Nob3AvY29tcGxldGVcbi8vIEBkZXNjICAgIEdldCBjb21wbGV0ZSBzaG9wIGRhdGEgaW5jbHVkaW5nIG1lbnUgZnJvbSBkYXRhYmFzZVxuLy8gQGFjY2VzcyAgUHVibGljXG5yb3V0ZXIuZ2V0KCcvY29tcGxldGUnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBTaG9wU2VydmljZS5nZXRDb21wbGV0ZVNob3BEYXRhKCk7XG4gICAgXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdC5kYXRhXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBjb21wbGV0ZSBzaG9wIGRhdGEgcm91dGU6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBjb21wbGV0ZSBzaG9wIGRhdGEnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9zaG9wL3N0YXR1c1xuLy8gQGRlc2MgICAgR2V0IHNob3Agc3RhdHVzIChvcGVuL2Nsb3NlZClcbi8vIEBhY2Nlc3MgIFB1YmxpY1xucm91dGVyLmdldCgnL3N0YXR1cycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFNob3BTZXJ2aWNlLmdldFNob3BTdGF0dXMoKTtcbiAgICBcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0LmRhdGFcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiByZXN1bHQubWVzc2FnZVxuICAgICAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHNob3Agc3RhdHVzIHJvdXRlOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgc2hvcCBzdGF0dXMnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBQVVQgL2FwaS9zaG9wL2NvbmZpZ1xuLy8gQGRlc2MgICAgVXBkYXRlIHNob3AgY29uZmlndXJhdGlvblxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoQWRtaW4gb25seSlcbnJvdXRlci5wdXQoJy9jb25maWcnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFNob3BTZXJ2aWNlLnVwZGF0ZVNob3BDb25maWcocmVxLmJvZHkpO1xuICAgIFxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQuZGF0YSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiByZXN1bHQubWVzc2FnZVxuICAgICAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZSBzaG9wIGNvbmZpZyByb3V0ZTonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yIHdoaWxlIHVwZGF0aW5nIHNob3AgY29uZmlndXJhdGlvbidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9zaG9wL2luaXRpYWxpemVcbi8vIEBkZXNjICAgIEluaXRpYWxpemUgZGVmYXVsdCBzaG9wIGRhdGFcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKEFkbWluIG9ubHkpXG5yb3V0ZXIucG9zdCgnL2luaXRpYWxpemUnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFNob3BTZXJ2aWNlLmluaXRpYWxpemVTaG9wRGF0YSgpO1xuICAgIFxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQuZGF0YSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiByZXN1bHQubWVzc2FnZVxuICAgICAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGluaXRpYWxpemUgc2hvcCBkYXRhIHJvdXRlOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgaW5pdGlhbGl6aW5nIHNob3AgZGF0YSdcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3Nob3AvbWVudVxuLy8gQGRlc2MgICAgR2V0IG1lbnUgZGF0YSBmcm9tIHByb2R1Y3RzXG4vLyBAYWNjZXNzICBQdWJsaWNcbnJvdXRlci5nZXQoJy9tZW51JywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgU2hvcFNlcnZpY2UuZ2V0Q29tcGxldGVTaG9wRGF0YSgpO1xuICAgIFxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgLy8gUmV0dXJuIG9ubHkgbWVudSBkYXRhXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBtZW51OiByZXN1bHQuZGF0YS5tZW51LFxuICAgICAgICAgIGJ1c2luZXNzTmFtZTogcmVzdWx0LmRhdGEuYnVzaW5lc3NOYW1lLFxuICAgICAgICAgIGxhc3RVcGRhdGVkOiByZXN1bHQuZGF0YS5sYXN0VXBkYXRlZFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBtZW51IHJvdXRlOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgbWVudSBkYXRhJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvc2hvcC9haS1jb250ZXh0XG4vLyBAZGVzYyAgICBHZXQgc2hvcCBkYXRhIGZvcm1hdHRlZCBmb3IgQUkgY29udGV4dFxuLy8gQGFjY2VzcyAgUHVibGljXG5yb3V0ZXIuZ2V0KCcvYWktY29udGV4dCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFNob3BTZXJ2aWNlLmdldENvbXBsZXRlU2hvcERhdGEoKTtcbiAgICBcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIC8vIEZvcm1hdCBkYXRhIHNwZWNpZmljYWxseSBmb3IgQUkgY29udGV4dCB1c2FnZVxuICAgICAgY29uc3QgYWlDb250ZXh0ID0ge1xuICAgICAgICBidXNpbmVzczogcmVzdWx0LmRhdGEuYnVzaW5lc3MsXG4gICAgICAgIGJ1c2luZXNzTmFtZTogcmVzdWx0LmRhdGEuYnVzaW5lc3MubmFtZSxcbiAgICAgICAgc3RvcmVOYW1lOiByZXN1bHQuZGF0YS5idXNpbmVzcy5uYW1lLFxuICAgICAgICBsb2NhdGlvbjogcmVzdWx0LmRhdGEubG9jYXRpb24sXG4gICAgICAgIGNvbnRhY3Q6IHJlc3VsdC5kYXRhLmNvbnRhY3QsXG4gICAgICAgIGhvdXJzOiByZXN1bHQuZGF0YS5ob3VycyxcbiAgICAgICAgbWVudTogcmVzdWx0LmRhdGEubWVudSxcbiAgICAgICAgc2VydmljZXM6IHJlc3VsdC5kYXRhLnNlcnZpY2VzLFxuICAgICAgICBhbWVuaXRpZXM6IHJlc3VsdC5kYXRhLmFtZW5pdGllcyxcbiAgICAgICAgcGF5bWVudDogcmVzdWx0LmRhdGEucGF5bWVudCxcbiAgICAgICAgcG9saWNpZXM6IHJlc3VsdC5kYXRhLnBvbGljaWVzLFxuICAgICAgICByZXNwb25zZVRlbXBsYXRlczogcmVzdWx0LmRhdGEucmVzcG9uc2VUZW1wbGF0ZXMsXG4gICAgICAgIGxhc3RVcGRhdGVkOiByZXN1bHQuZGF0YS5sYXN0VXBkYXRlZFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBhaUNvbnRleHRcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiByZXN1bHQubWVzc2FnZVxuICAgICAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIEFJIGNvbnRleHQgcm91dGU6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvciB3aGlsZSBmZXRjaGluZyBBSSBjb250ZXh0IGRhdGEnXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTUMsV0FBVyxHQUFHSCxPQUFPLENBQUMseUJBQXlCLENBQUM7QUFDdEQsTUFBTTtFQUFFSSxPQUFPO0VBQUVDO0FBQVUsQ0FBQyxHQUFHTCxPQUFPLENBQUMsb0JBQW9CLENBQUM7O0FBRTVEO0FBQ0E7QUFDQTtBQUNBQyxNQUFNLENBQUNLLEdBQUcsQ0FBQyxTQUFTLEVBQUUsT0FBT0MsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDeEMsSUFBSTtJQUNGLE1BQU1DLE1BQU0sR0FBRyxNQUFNTixXQUFXLENBQUNPLGFBQWEsQ0FBQyxDQUFDO0lBRWhELElBQUlELE1BQU0sQ0FBQ0UsT0FBTyxFQUFFO01BQ2xCSCxHQUFHLENBQUNJLElBQUksQ0FBQztRQUNQRCxPQUFPLEVBQUUsSUFBSTtRQUNiRSxJQUFJLEVBQUVKLE1BQU0sQ0FBQ0k7TUFDZixDQUFDLENBQUM7SUFDSixDQUFDLE1BQU07TUFDTEwsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNGLElBQUksQ0FBQztRQUNuQkQsT0FBTyxFQUFFLEtBQUs7UUFDZEksT0FBTyxFQUFFTixNQUFNLENBQUNNO01BQ2xCLENBQUMsQ0FBQztJQUNKO0VBQ0YsQ0FBQyxDQUFDLE9BQU9DLEtBQUssRUFBRTtJQUNkQyxPQUFPLENBQUNELEtBQUssQ0FBQyw2QkFBNkIsRUFBRUEsS0FBSyxDQUFDO0lBQ25EUixHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0YsSUFBSSxDQUFDO01BQ25CRCxPQUFPLEVB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","map":{"version":3,"names":["express","require","router","Router","ShopService","protect","authorize","get","req","res","result","getShopConfig","success","json","data","status","message","error","console","getCompleteShopData","getShopStatus","put","updateShopConfig","body","post","initializeShopData","menu","businessName","lastUpdated","aiContext","business","name","storeName","location","contact","hours","services","amenities","payment","policies","responseTemplates","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["shop.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst ShopService = require('../services/shopService');\nconst { protect, authorize } = require('../middleware/auth');\n\n// @route   GET /api/shop/config\n// @desc    Get shop configuration\n// @access  Public\nrouter.get('/config', async (req, res) => {\n  try {\n    const result = await ShopService.getShopConfig();\n    \n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in shop config route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching shop configuration'\n    });\n  }\n});\n\n// @route   GET /api/shop/complete\n// @desc    Get complete shop data including menu from database\n// @access  Public\nrouter.get('/complete', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    \n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in complete shop data route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching complete shop data'\n    });\n  }\n});\n\n// @route   GET /api/shop/status\n// @desc    Get shop status (open/closed)\n// @access  Public\nrouter.get('/status', async (req, res) => {\n  try {\n    const result = await ShopService.getShopStatus();\n    \n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in shop status route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching shop status'\n    });\n  }\n});\n\n// @route   PUT /api/shop/config\n// @desc    Update shop configuration\n// @access  Private (Admin only)\nrouter.put('/config', protect, authorize('admin'), async (req, res) => {\n  try {\n    const result = await ShopService.updateShopConfig(req.body);\n    \n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data,\n        message: result.message\n      });\n    } else {\n      res.status(400).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in update shop config route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while updating shop configuration'\n    });\n  }\n});\n\n// @route   POST /api/shop/initialize\n// @desc    Initialize default shop data\n// @access  Private (Admin only)\nrouter.post('/initialize', protect, authorize('admin'), async (req, res) => {\n  try {\n    const result = await ShopService.initializeShopData();\n    \n    if (result.success) {\n      res.json({\n        success: true,\n        data: result.data,\n        message: result.message\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in initialize shop data route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while initializing shop data'\n    });\n  }\n});\n\n// @route   GET /api/shop/menu\n// @desc    Get menu data from products\n// @access  Public\nrouter.get('/menu', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    \n    if (result.success) {\n      // Return only menu data\n      res.json({\n        success: true,\n        data: {\n          menu: result.data.menu,\n          businessName: result.data.businessName,\n          lastUpdated: result.data.lastUpdated\n        }\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in menu route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching menu data'\n    });\n  }\n});\n\n// @route   GET /api/shop/ai-context\n// @desc    Get shop data formatted for AI context\n// @access  Public\nrouter.get('/ai-context', async (req, res) => {\n  try {\n    const result = await ShopService.getCompleteShopData();\n    \n    if (result.success) {\n      // Format data specifically for AI context usage\n      const aiContext = {\n        business: result.data.business,\n        businessName: result.data.business.name,\n        storeName: result.data.business.name,\n        location: result.data.location,\n        contact: result.data.contact,\n        hours: result.data.hours,\n        menu: result.data.menu,\n        services: result.data.services,\n        amenities: result.data.amenities,\n        payment: result.data.payment,\n        policies: result.data.policies,\n        responseTemplates: result.data.responseTemplates,\n        lastUpdated: result.data.lastUpdated\n      };\n      \n      res.json({\n        success: true,\n        data: aiContext\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: result.message\n      });\n    }\n  } catch (error) {\n    console.error('Error in AI context route:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error while fetching AI context data'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1757007726524},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\services\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\services\\\\shopService.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const Shop = require('../models/Shop');\nconst Product = require('../models/Product');\nclass ShopService {\n  /**\n   * Get the active shop configuration\n   * @returns {Promise<Object>} Shop configuration\n   */\n  static async getShopConfig() {\n    try {\n      const shop = await Shop.getActiveShop();\n      return {\n        success: true,\n        data: shop\n      };\n    } catch (error) {\n      console.error('Error fetching shop config:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch shop configuration',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get complete shop data including menu from products\n   * @returns {Promise<Object>} Complete shop data with menu\n   */\n  static async getCompleteShopData() {\n    try {\n      const shop = await Shop.getActiveShop();\n      const products = await Product.find({\n        inStock: true\n      }).sort({\n        category: 1,\n        name: 1\n      });\n\n      // Group products by category to create menu structure\n      const menuCategories = {};\n      products.forEach(product => {\n        if (!menuCategories[product.category]) {\n          menuCategories[product.category] = {\n            name: product.category,\n            vietnamese: this.getCategoryVietnameseName(product.category),\n            items: []\n          };\n        }\n\n        // Format product for menu\n        const menuItem = {\n          id: product._id,\n          name: product.name,\n          description: product.description,\n          price: this.formatPrice(product.price),\n          category: product.category,\n          image: product.image,\n          featured: product.featured,\n          ingredients: product.ingredients || [],\n          nutritionalInfo: product.nutritionalInfo || {},\n          sizes: product.sizes || []\n        };\n        menuCategories[product.category].items.push(menuItem);\n      });\n\n      // Convert to array format\n      const menu = {\n        categories: Object.values(menuCategories),\n        specialties: this.extractSpecialties(products)\n      };\n\n      // Combine shop data with dynamic menu\n      const completeData = {\n        ...shop.toObject(),\n        menu,\n        businessName: shop.business.name,\n        // For backward compatibility\n        storeName: shop.business.name,\n        // For backward compatibility\n        lastUpdated: new Date().toISOString()\n      };\n      return {\n        success: true,\n        data: completeData\n      };\n    } catch (error) {\n      console.error('Error fetching complete shop data:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch complete shop data',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Update shop configuration\n   * @param {Object} updateData - Data to update\n   * @returns {Promise<Object>} Updated shop configuration\n   */\n  static async updateShopConfig(updateData) {\n    try {\n      const shop = await Shop.getActiveShop();\n\n      // Update shop data\n      Object.keys(updateData).forEach(key => {\n        if (updateData[key] !== undefined) {\n          shop[key] = updateData[key];\n        }\n      });\n      await shop.save();\n      return {\n        success: true,\n        data: shop,\n        message: 'Shop configuration updated successfully'\n      };\n    } catch (error) {\n      console.error('Error updating shop config:', error);\n      return {\n        success: false,\n        message: 'Failed to update shop configuration',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get shop status (open/closed)\n   * @returns {Promise<Object>} Shop status information\n   */\n  static async getShopStatus() {\n    try {\n      const shop = await Shop.getActiveShop();\n      const isOpen = shop.isCurrentlyOpen();\n      const now = new Date();\n      const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n      const currentHours = isWeekend ? shop.hours.weekends : shop.hours.weekdays;\n      return {\n        success: true,\n        data: {\n          isOpen,\n          currentHours: currentHours.display,\n          nextChange: this.getNextStatusChange(shop, now),\n          timezone: shop.hours.timezone\n        }\n      };\n    } catch (error) {\n      console.error('Error fetching shop status:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch shop status',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get Vietnamese category name mapping\n   * @param {string} category - English category name\n   * @returns {string} Vietnamese category name\n   */\n  static getCategoryVietnameseName(category) {\n    const mapping = {\n      'Cà phê': 'Cà Phê',\n      'Coffee': 'Cà Phê',\n      'Thức uống đậm vị': 'Thức Uống Đậm Vị',\n      'Đồ uống tươi mát': 'Đồ Uống Tươi Mát',\n      'Bánh ngọt': 'Bánh Ngọt',\n      'Pastries': 'Bánh Ngọt',\n      'Light Meals': 'Món Ăn Nhẹ',\n      'Món ăn nhẹ': 'Món Ăn Nhẹ'\n    };\n    return mapping[category] || category;\n  }\n\n  /**\n   * Format price for display\n   * @param {number} price - Price in number format\n   * @returns {string} Formatted price string\n   */\n  static formatPrice(price) {\n    if (typeof price === 'number') {\n      return `${(price * 1000).toLocaleString('vi-VN')} VND`;\n    }\n    return price;\n  }\n\n  /**\n   * Extract specialties from products\n   * @param {Array} products - Array of products\n   * @returns {Array} Array of specialty items\n   */\n  static extractSpecialties(products) {\n    return products.filter(product => product.featured).map(product => product.name).slice(0, 4); // Limit to 4 specialties\n  }\n\n  /**\n   * Calculate next status change time\n   * @param {Object} shop - Shop configuration\n   * @param {Date} now - Current date\n   * @returns {string} Next status change description\n   */\n  static getNextStatusChange(shop, now) {\n    const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n    const currentHours = isWeekend ? shop.hours.weekends : shop.hours.weekdays;\n    const isOpen = shop.isCurrentlyOpen();\n    if (isOpen) {\n      return `Closes at ${currentHours.close}`;\n    } else {\n      return `Opens at ${currentHours.open}`;\n    }\n  }\n\n  /**\n   * Initialize default shop data if none exists\n   * @returns {Promise<Object>} Initialization result\n   */\n  static async initializeShopData() {\n    try {\n      const existingShop = await Shop.findOne({\n        isActive: true\n      });\n      if (!existingShop) {\n        const defaultShop = new Shop({});\n        await defaultShop.save();\n        return {\n          success: true,\n          message: 'Default shop data initialized',\n          data: defaultShop\n        };\n      }\n      return {\n        success: true,\n        message: 'Shop data already exists',\n        data: existingShop\n      };\n    } catch (error) {\n      console.error('Error initializing shop data:', error);\n      return {\n        success: false,\n        message: 'Failed to initialize shop data',\n        error: error.message\n      };\n    }\n  }\n}\nmodule.exports = ShopService;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaG9wIiwicmVxdWlyZSIsIlByb2R1Y3QiLCJTaG9wU2VydmljZSIsImdldFNob3BDb25maWciLCJzaG9wIiwiZ2V0QWN0aXZlU2hvcCIsInN1Y2Nlc3MiLCJkYXRhIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsImdldENvbXBsZXRlU2hvcERhdGEiLCJwcm9kdWN0cyIsImZpbmQiLCJpblN0b2NrIiwic29ydCIsImNhdGVnb3J5IiwibmFtZSIsIm1lbnVDYXRlZ29yaWVzIiwiZm9yRWFjaCIsInByb2R1Y3QiLCJ2aWV0bmFtZXNlIiwiZ2V0Q2F0ZWdvcnlWaWV0bmFtZXNlTmFtZSIsIml0ZW1zIiwibWVudUl0ZW0iLCJpZCIsIl9pZCIsImRlc2NyaXB0aW9uIiwicHJpY2UiLCJmb3JtYXRQcmljZSIsImltYWdlIiwiZmVhdHVyZWQiLCJpbmdyZWRpZW50cyIsIm51dHJpdGlvbmFsSW5mbyIsInNpemVzIiwicHVzaCIsIm1lbnUiLCJjYXRlZ29yaWVzIiwiT2JqZWN0IiwidmFsdWVzIiwic3BlY2lhbHRpZXMiLCJleHRyYWN0U3BlY2lhbHRpZXMiLCJjb21wbGV0ZURhdGEiLCJ0b09iamVjdCIsImJ1c2luZXNzTmFtZSIsImJ1c2luZXNzIiwic3RvcmVOYW1lIiwibGFzdFVwZGF0ZWQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJ1cGRhdGVTaG9wQ29uZmlnIiwidXBkYXRlRGF0YSIsImtleXMiLCJrZXkiLCJ1bmRlZmluZWQiLCJzYXZlIiwiZ2V0U2hvcFN0YXR1cyIsImlzT3BlbiIsImlzQ3VycmVudGx5T3BlbiIsIm5vdyIsImlzV2Vla2VuZCIsImdldERheSIsImN1cnJlbnRIb3VycyIsImhvdXJzIiwid2Vla2VuZHMiLCJ3ZWVrZGF5cyIsImRpc3BsYXkiLCJuZXh0Q2hhbmdlIiwiZ2V0TmV4dFN0YXR1c0NoYW5nZSIsInRpbWV6b25lIiwibWFwcGluZyIsInRvTG9jYWxlU3RyaW5nIiwiZmlsdGVyIiwibWFwIiwic2xpY2UiLCJjbG9zZSIsIm9wZW4iLCJpbml0aWFsaXplU2hvcERhdGEiLCJleGlzdGluZ1Nob3AiLCJmaW5kT25lIiwiaXNBY3RpdmUiLCJkZWZhdWx0U2hvcCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkQ6XFxjb2RlXFxXZWJDYWZmZVxcYmFja2VuZFxcc3JjXFxzZXJ2aWNlc1xcIiwic291cmNlcyI6WyJzaG9wU2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBTaG9wID0gcmVxdWlyZSgnLi4vbW9kZWxzL1Nob3AnKTtcbmNvbnN0IFByb2R1Y3QgPSByZXF1aXJlKCcuLi9tb2RlbHMvUHJvZHVjdCcpO1xuXG5jbGFzcyBTaG9wU2VydmljZSB7XG4gIC8qKlxuICAgKiBHZXQgdGhlIGFjdGl2ZSBzaG9wIGNvbmZpZ3VyYXRpb25cbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gU2hvcCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0U2hvcENvbmZpZygpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2hvcCA9IGF3YWl0IFNob3AuZ2V0QWN0aXZlU2hvcCgpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogc2hvcFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgc2hvcCBjb25maWc6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggc2hvcCBjb25maWd1cmF0aW9uJyxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb21wbGV0ZSBzaG9wIGRhdGEgaW5jbHVkaW5nIG1lbnUgZnJvbSBwcm9kdWN0c1xuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3Q+fSBDb21wbGV0ZSBzaG9wIGRhdGEgd2l0aCBtZW51XG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0Q29tcGxldGVTaG9wRGF0YSgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2hvcCA9IGF3YWl0IFNob3AuZ2V0QWN0aXZlU2hvcCgpO1xuICAgICAgY29uc3QgcHJvZHVjdHMgPSBhd2FpdCBQcm9kdWN0LmZpbmQoeyBpblN0b2NrOiB0cnVlIH0pLnNvcnQoeyBjYXRlZ29yeTogMSwgbmFtZTogMSB9KTtcbiAgICAgIFxuICAgICAgLy8gR3JvdXAgcHJvZHVjdHMgYnkgY2F0ZWdvcnkgdG8gY3JlYXRlIG1lbnUgc3RydWN0dXJlXG4gICAgICBjb25zdCBtZW51Q2F0ZWdvcmllcyA9IHt9O1xuICAgICAgXG4gICAgICBwcm9kdWN0cy5mb3JFYWNoKHByb2R1Y3QgPT4ge1xuICAgICAgICBpZiAoIW1lbnVDYXRlZ29yaWVzW3Byb2R1Y3QuY2F0ZWdvcnldKSB7XG4gICAgICAgICAgbWVudUNhdGVnb3JpZXNbcHJvZHVjdC5jYXRlZ29yeV0gPSB7XG4gICAgICAgICAgICBuYW1lOiBwcm9kdWN0LmNhdGVnb3J5LFxuICAgICAgICAgICAgdmlldG5hbWVzZTogdGhpcy5nZXRDYXRlZ29yeVZpZXRuYW1lc2VOYW1lKHByb2R1Y3QuY2F0ZWdvcnkpLFxuICAgICAgICAgICAgaXRlbXM6IFtdXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gRm9ybWF0IHByb2R1Y3QgZm9yIG1lbnVcbiAgICAgICAgY29uc3QgbWVudUl0ZW0gPSB7XG4gICAgICAgICAgaWQ6IHByb2R1Y3QuX2lkLFxuICAgICAgICAgIG5hbWU6IHByb2R1Y3QubmFtZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogcHJvZHVjdC5kZXNjcmlwdGlvbixcbiAgICAgICAgICBwcmljZTogdGhpcy5mb3JtYXRQcmljZShwcm9kdWN0LnByaWNlKSxcbiAgICAgICAgICBjYXRlZ29yeTogcHJvZHVjdC5jYXRlZ29yeSxcbiAgICAgICAgICBpbWFnZTogcHJvZHVjdC5pbWFnZSxcbiAgICAgICAgICBmZWF0dXJlZDogcHJvZHVjdC5mZWF0dXJlZCxcbiAgICAgICAgICBpbmdyZWRpZW50czogcHJvZHVjdC5pbmdyZWRpZW50cyB8fCBbXSxcbiAgICAgICAgICBudXRyaXRpb25hbEluZm86IHByb2R1Y3QubnV0cml0aW9uYWxJbmZvIHx8IHt9LFxuICAgICAgICAgIHNpemVzOiBwcm9kdWN0LnNpemVzIHx8IFtdXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBtZW51Q2F0ZWdvcmllc1twcm9kdWN0LmNhdGVnb3J5XS5pdGVtcy5wdXNoKG1lbnVJdGVtKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBDb252ZXJ0IHRvIGFycmF5IGZvcm1hdFxuICAgICAgY29uc3QgbWVudSA9IHtcbiAgICAgICAgY2F0ZWdvcmllczogT2JqZWN0LnZhbHVlcyhtZW51Q2F0ZWdvcmllcyksXG4gICAgICAgIHNwZWNpYWx0aWVzOiB0aGlzLmV4dHJhY3RTcGVjaWFsdGllcyhwcm9kdWN0cylcbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vIENvbWJpbmUgc2hvcCBkYXRhIHdpdGggZHluYW1pYyBtZW51XG4gICAgICBjb25zdCBjb21wbGV0ZURhdGEgPSB7XG4gICAgICAgIC4uLnNob3AudG9PYmplY3QoKSxcbiAgICAgICAgbWVudSxcbiAgICAgICAgYnVzaW5lc3NOYW1lOiBzaG9wLmJ1c2luZXNzLm5hbWUsIC8vIEZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gICAgICAgIHN0b3JlTmFtZTogc2hvcC5idXNpbmVzcy5uYW1lLCAgICAvLyBGb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9O1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjb21wbGV0ZURhdGFcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGNvbXBsZXRlIHNob3AgZGF0YTonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBjb21wbGV0ZSBzaG9wIGRhdGEnLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNob3AgY29uZmlndXJhdGlvblxuICAgKiBAcGFyYW0ge09iamVjdH0gdXBkYXRlRGF0YSAtIERhdGEgdG8gdXBkYXRlXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IFVwZGF0ZWQgc2hvcCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgdXBkYXRlU2hvcENvbmZpZyh1cGRhdGVEYXRhKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNob3AgPSBhd2FpdCBTaG9wLmdldEFjdGl2ZVNob3AoKTtcbiAgICAgIFxuICAgICAgLy8gVXBkYXRlIHNob3AgZGF0YVxuICAgICAgT2JqZWN0LmtleXModXBkYXRlRGF0YSkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICBpZiAodXBkYXRlRGF0YVtrZXldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBzaG9wW2tleV0gPSB1cGRhdGVEYXRhW2tleV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBzaG9wLnNhdmUoKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogc2hvcCxcbiAgICAgICAgbWVzc2FnZTogJ1Nob3AgY29uZmlndXJhdGlvbiB1cGRhdGVkIHN1Y2Nlc3NmdWxseSdcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHNob3AgY29uZmlnOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwZGF0ZSBzaG9wIGNvbmZpZ3VyYXRpb24nLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNob3Agc3RhdHVzIChvcGVuL2Nsb3NlZClcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gU2hvcCBzdGF0dXMgaW5mb3JtYXRpb25cbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRTaG9wU3RhdHVzKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzaG9wID0gYXdhaXQgU2hvcC5nZXRBY3RpdmVTaG9wKCk7XG4gICAgICBjb25zdCBpc09wZW4gPSBzaG9wLmlzQ3VycmVudGx5T3BlbigpO1xuICAgICAgXG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgaXNXZWVrZW5kID0gbm93LmdldERheSgpID09PSAwIHx8IG5vdy5nZXREYXkoKSA9PT0gNjtcbiAgICAgIGNvbnN0IGN1cnJlbnRIb3VycyA9IGlzV2Vla2VuZCA/IHNob3AuaG91cnMud2Vla2VuZHMgOiBzaG9wLmhvdXJzLndlZWtkYXlzO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaXNPcGVuLFxuICAgICAgICAgIGN1cnJlbnRIb3VyczogY3VycmVudEhvdXJzLmRpc3BsYXksXG4gICAgICAgICAgbmV4dENoYW5nZTogdGhpcy5nZXROZXh0U3RhdHVzQ2hhbmdlKHNob3AsIG5vdyksXG4gICAgICAgICAgdGltZXpvbmU6IHNob3AuaG91cnMudGltZXpvbmVcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgc2hvcCBzdGF0dXM6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggc2hvcCBzdGF0dXMnLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IFZpZXRuYW1lc2UgY2F0ZWdvcnkgbmFtZSBtYXBwaW5nXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjYXRlZ29yeSAtIEVuZ2xpc2ggY2F0ZWdvcnkgbmFtZVxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSBWaWV0bmFtZXNlIGNhdGVnb3J5IG5hbWVcbiAgICovXG4gIHN0YXRpYyBnZXRDYXRlZ29yeVZpZXRuYW1lc2VOYW1lKGNhdGVnb3J5KSB7XG4gICAgY29uc3QgbWFwcGluZyA9IHtcbiAgICAgICdDw6AgcGjDqic6ICdDw6AgUGjDqicsXG4gICAgICAnQ29mZmVlJzogJ0PDoCBQaMOqJyxcbiAgICAgICdUaOG7qWMgdeG7kW5nIMSR4bqtbSB24buLJzogJ1Ro4bupYyBV4buRbmcgxJDhuq1tIFbhu4snLFxuICAgICAgJ8SQ4buTIHXhu5FuZyB0xrDGoWkgbcOhdCc6ICfEkOG7kyBV4buRbmcgVMawxqFpIE3DoXQnLFxuICAgICAgJ0LDoW5oIG5n4buNdCc6ICdCw6FuaCBOZ+G7jXQnLFxuICAgICAgJ1Bhc3RyaWVzJzogJ0LDoW5oIE5n4buNdCcsXG4gICAgICAnTGlnaHQgTWVhbHMnOiAnTcOzbiDEgm4gTmjhurknLFxuICAgICAgJ03Ds24gxINuIG5o4bq5JzogJ03Ds24gxIJuIE5o4bq5J1xuICAgIH07XG4gICAgXG4gICAgcmV0dXJuIG1hcHBpbmdbY2F0ZWdvcnldIHx8IGNhdGVnb3J5O1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBwcmljZSBmb3IgZGlzcGxheVxuICAgKiBAcGFyYW0ge251bWJlcn0gcHJpY2UgLSBQcmljZSBpbiBudW1iZXIgZm9ybWF0XG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IEZvcm1hdHRlZCBwcmljZSBzdHJpbmdcbiAgICovXG4gIHN0YXRpYyBmb3JtYXRQcmljZShwcmljZSkge1xuICAgIGlmICh0eXBlb2YgcHJpY2UgPT09ICdudW1iZXInKSB7XG4gICAgICByZXR1cm4gYCR7KHByaWNlICogMTAwMCkudG9Mb2NhbGVTdHJpbmcoJ3ZpLVZOJyl9IFZORGA7XG4gICAgfVxuICAgIHJldHVybiBwcmljZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IHNwZWNpYWx0aWVzIGZyb20gcHJvZHVjdHNcbiAgICogQHBhcmFtIHtBcnJheX0gcHJvZHVjdHMgLSBBcnJheSBvZiBwcm9kdWN0c1xuICAgKiBAcmV0dXJucyB7QXJyYXl9IEFycmF5IG9mIHNwZWNpYWx0eSBpdGVtc1xuICAgKi9cbiAgc3RhdGljIGV4dHJhY3RTcGVjaWFsdGllcyhwcm9kdWN0cykge1xuICAgIHJldHVybiBwcm9kdWN0c1xuICAgICAgLmZpbHRlcihwcm9kdWN0ID0+IHByb2R1Y3QuZmVhdHVyZWQpXG4gICAgICAubWFwKHByb2R1Y3QgPT4gcHJvZHVjdC5uYW1lKVxuICAgICAgLnNsaWNlKDAsIDQpOyAvLyBMaW1pdCB0byA0IHNwZWNpYWx0aWVzXG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIG5leHQgc3RhdHVzIGNoYW5nZSB0aW1lXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBzaG9wIC0gU2hvcCBjb25maWd1cmF0aW9uXG4gICAqIEBwYXJhbSB7RGF0ZX0gbm93IC0gQ3VycmVudCBkYXRlXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IE5leHQgc3RhdHVzIGNoYW5nZSBkZXNjcmlwdGlvblxuICAgKi9cbiAgc3RhdGljIGdldE5leHRTdGF0dXNDaGFuZ2Uoc2hvcCwgbm93KSB7XG4gICAgY29uc3QgaXNXZWVrZW5kID0gbm93LmdldERheSgpID09PSAwIHx8IG5vdy5nZXREYXkoKSA9PT0gNjtcbiAgICBjb25zdCBjdXJyZW50SG91cnMgPSBpc1dlZWtlbmQgPyBzaG9wLmhvdXJzLndlZWtlbmRzIDogc2hvcC5ob3Vycy53ZWVrZGF5cztcbiAgICBjb25zdCBpc09wZW4gPSBzaG9wLmlzQ3VycmVudGx5T3BlbigpO1xuICAgIFxuICAgIGlmIChpc09wZW4pIHtcbiAgICAgIHJldHVybiBgQ2xvc2VzIGF0ICR7Y3VycmVudEhvdXJzLmNsb3NlfWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgT3BlbnMgYXQgJHtjdXJyZW50SG91cnMub3Blbn1gO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIGRlZmF1bHQgc2hvcCBkYXRhIGlmIG5vbmUgZXhpc3RzXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IEluaXRpYWxpemF0aW9uIHJlc3VsdFxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGluaXRpYWxpemVTaG9wRGF0YSgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZXhpc3RpbmdTaG9wID0gYXdhaXQgU2hvcC5maW5kT25lKHsgaXNBY3RpdmU6IHRydWUgfSk7XG4gICAgICBcbiAgICAgIGlmICghZXhpc3RpbmdTaG9wKSB7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRTaG9wID0gbmV3IFNob3Aoe30pO1xuICAgICAgICBhd2FpdCBkZWZhdWx0U2hvcC5zYXZlKCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogJ0RlZmF1bHQgc2hvcCBkYXRhIGluaXRpYWxpemVkJyxcbiAgICAgICAgICBkYXRhOiBkZWZhdWx0U2hvcFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnU2hvcCBkYXRhIGFscmVhZHkgZXhpc3RzJyxcbiAgICAgICAgZGF0YTogZXhpc3RpbmdTaG9wXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbml0aWFsaXppbmcgc2hvcCBkYXRhOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGluaXRpYWxpemUgc2hvcCBkYXRhJyxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICAgIH07XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gU2hvcFNlcnZpY2U7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUN0QyxNQUFNQyxPQUFPLEdBQUdELE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUU1QyxNQUFNRSxXQUFXLENBQUM7RUFDaEI7QUFDRjtBQUNBO0FBQ0E7RUFDRSxhQUFhQyxhQUFhQSxDQUFBLEVBQUc7SUFDM0IsSUFBSTtNQUNGLE1BQU1DLElBQUksR0FBRyxNQUFNTCxJQUFJLENBQUNNLGFBQWEsQ0FBQyxDQUFDO01BQ3ZDLE9BQU87UUFDTEMsT0FBTyxFQUFFLElBQUk7UUFDYkMsSUFBSSxFQUFFSDtNQUNSLENBQUM7SUFDSCxDQUFDLENBQUMsT0FBT0ksS0FBSyxFQUFFO01BQ2RDLE9BQU8sQ0FBQ0QsS0FBSyxDQUFDLDZCQUE2QixFQUFFQSxLQUFLLENBQUM7TUFDbkQsT0FBTztRQUNMRixPQUFPLEVBQUUsS0FBSztRQUNkSSxPQUFPLEVBQUUsb0NBQW9DO1FBQzdDRixLQUFLLEVBQUVBLEtBQUssQ0FBQ0U7TUFDZixDQUFDO0lBQ0g7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtFQUNFLGFBQWFDLG1CQUFtQkEsQ0FBQSxFQUFHO0lBQ2pDLElBQUk7TUFDRixNQUFNUCxJQUFJLEdBQUcsTUFB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","map":{"version":3,"names":["Shop","require","Product","ShopService","getShopConfig","shop","getActiveShop","success","data","error","console","message","getCompleteShopData","products","find","inStock","sort","category","name","menuCategories","forEach","product","vietnamese","getCategoryVietnameseName","items","menuItem","id","_id","description","price","formatPrice","image","featured","ingredients","nutritionalInfo","sizes","push","menu","categories","Object","values","specialties","extractSpecialties","completeData","toObject","businessName","business","storeName","lastUpdated","Date","toISOString","updateShopConfig","updateData","keys","key","undefined","save","getShopStatus","isOpen","isCurrentlyOpen","now","isWeekend","getDay","currentHours","hours","weekends","weekdays","display","nextChange","getNextStatusChange","timezone","mapping","toLocaleString","filter","map","slice","close","open","initializeShopData","existingShop","findOne","isActive","defaultShop","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\services\\","sources":["shopService.js"],"sourcesContent":["const Shop = require('../models/Shop');\nconst Product = require('../models/Product');\n\nclass ShopService {\n  /**\n   * Get the active shop configuration\n   * @returns {Promise<Object>} Shop configuration\n   */\n  static async getShopConfig() {\n    try {\n      const shop = await Shop.getActiveShop();\n      return {\n        success: true,\n        data: shop\n      };\n    } catch (error) {\n      console.error('Error fetching shop config:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch shop configuration',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get complete shop data including menu from products\n   * @returns {Promise<Object>} Complete shop data with menu\n   */\n  static async getCompleteShopData() {\n    try {\n      const shop = await Shop.getActiveShop();\n      const products = await Product.find({ inStock: true }).sort({ category: 1, name: 1 });\n      \n      // Group products by category to create menu structure\n      const menuCategories = {};\n      \n      products.forEach(product => {\n        if (!menuCategories[product.category]) {\n          menuCategories[product.category] = {\n            name: product.category,\n            vietnamese: this.getCategoryVietnameseName(product.category),\n            items: []\n          };\n        }\n        \n        // Format product for menu\n        const menuItem = {\n          id: product._id,\n          name: product.name,\n          description: product.description,\n          price: this.formatPrice(product.price),\n          category: product.category,\n          image: product.image,\n          featured: product.featured,\n          ingredients: product.ingredients || [],\n          nutritionalInfo: product.nutritionalInfo || {},\n          sizes: product.sizes || []\n        };\n        \n        menuCategories[product.category].items.push(menuItem);\n      });\n      \n      // Convert to array format\n      const menu = {\n        categories: Object.values(menuCategories),\n        specialties: this.extractSpecialties(products)\n      };\n      \n      // Combine shop data with dynamic menu\n      const completeData = {\n        ...shop.toObject(),\n        menu,\n        businessName: shop.business.name, // For backward compatibility\n        storeName: shop.business.name,    // For backward compatibility\n        lastUpdated: new Date().toISOString()\n      };\n      \n      return {\n        success: true,\n        data: completeData\n      };\n    } catch (error) {\n      console.error('Error fetching complete shop data:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch complete shop data',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Update shop configuration\n   * @param {Object} updateData - Data to update\n   * @returns {Promise<Object>} Updated shop configuration\n   */\n  static async updateShopConfig(updateData) {\n    try {\n      const shop = await Shop.getActiveShop();\n      \n      // Update shop data\n      Object.keys(updateData).forEach(key => {\n        if (updateData[key] !== undefined) {\n          shop[key] = updateData[key];\n        }\n      });\n      \n      await shop.save();\n      \n      return {\n        success: true,\n        data: shop,\n        message: 'Shop configuration updated successfully'\n      };\n    } catch (error) {\n      console.error('Error updating shop config:', error);\n      return {\n        success: false,\n        message: 'Failed to update shop configuration',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get shop status (open/closed)\n   * @returns {Promise<Object>} Shop status information\n   */\n  static async getShopStatus() {\n    try {\n      const shop = await Shop.getActiveShop();\n      const isOpen = shop.isCurrentlyOpen();\n      \n      const now = new Date();\n      const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n      const currentHours = isWeekend ? shop.hours.weekends : shop.hours.weekdays;\n      \n      return {\n        success: true,\n        data: {\n          isOpen,\n          currentHours: currentHours.display,\n          nextChange: this.getNextStatusChange(shop, now),\n          timezone: shop.hours.timezone\n        }\n      };\n    } catch (error) {\n      console.error('Error fetching shop status:', error);\n      return {\n        success: false,\n        message: 'Failed to fetch shop status',\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * Get Vietnamese category name mapping\n   * @param {string} category - English category name\n   * @returns {string} Vietnamese category name\n   */\n  static getCategoryVietnameseName(category) {\n    const mapping = {\n      'Cà phê': 'Cà Phê',\n      'Coffee': 'Cà Phê',\n      'Thức uống đậm vị': 'Thức Uống Đậm Vị',\n      'Đồ uống tươi mát': 'Đồ Uống Tươi Mát',\n      'Bánh ngọt': 'Bánh Ngọt',\n      'Pastries': 'Bánh Ngọt',\n      'Light Meals': 'Món Ăn Nhẹ',\n      'Món ăn nhẹ': 'Món Ăn Nhẹ'\n    };\n    \n    return mapping[category] || category;\n  }\n\n  /**\n   * Format price for display\n   * @param {number} price - Price in number format\n   * @returns {string} Formatted price string\n   */\n  static formatPrice(price) {\n    if (typeof price === 'number') {\n      return `${(price * 1000).toLocaleString('vi-VN')} VND`;\n    }\n    return price;\n  }\n\n  /**\n   * Extract specialties from products\n   * @param {Array} products - Array of products\n   * @returns {Array} Array of specialty items\n   */\n  static extractSpecialties(products) {\n    return products\n      .filter(product => product.featured)\n      .map(product => product.name)\n      .slice(0, 4); // Limit to 4 specialties\n  }\n\n  /**\n   * Calculate next status change time\n   * @param {Object} shop - Shop configuration\n   * @param {Date} now - Current date\n   * @returns {string} Next status change description\n   */\n  static getNextStatusChange(shop, now) {\n    const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n    const currentHours = isWeekend ? shop.hours.weekends : shop.hours.weekdays;\n    const isOpen = shop.isCurrentlyOpen();\n    \n    if (isOpen) {\n      return `Closes at ${currentHours.close}`;\n    } else {\n      return `Opens at ${currentHours.open}`;\n    }\n  }\n\n  /**\n   * Initialize default shop data if none exists\n   * @returns {Promise<Object>} Initialization result\n   */\n  static async initializeShopData() {\n    try {\n      const existingShop = await Shop.findOne({ isActive: true });\n      \n      if (!existingShop) {\n        const defaultShop = new Shop({});\n        await defaultShop.save();\n        \n        return {\n          success: true,\n          message: 'Default shop data initialized',\n          data: defaultShop\n        };\n      }\n      \n      return {\n        success: true,\n        message: 'Shop data already exists',\n        data: existingShop\n      };\n    } catch (error) {\n      console.error('Error initializing shop data:', error);\n      return {\n        success: false,\n        message: 'Failed to initialize shop data',\n        error: error.message\n      };\n    }\n  }\n}\n\nmodule.exports = ShopService;"],"mappings":"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","ignoreList":[]}},"mtime":1757007727401},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\Shop.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const mongoose = require('mongoose');\nconst shopSchema = new mongoose.Schema({\n  business: {\n    name: {\n      type: String,\n      required: [true, 'Business name is required'],\n      trim: true,\n      default: 'DREAM COFFEE'\n    },\n    type: {\n      type: String,\n      default: 'Premium Coffee Shop'\n    },\n    description: {\n      type: String,\n      default: 'A premium coffee shop in the heart of Ho Chi Minh City, offering exceptional coffee, pastries, and a welcoming atmosphere for work and relaxation.'\n    },\n    established: {\n      type: String,\n      default: '2020'\n    },\n    mission: {\n      type: String,\n      default: 'To provide the finest coffee experience while fostering community connections.'\n    }\n  },\n  location: {\n    address: {\n      type: String,\n      required: [true, 'Address is required'],\n      default: '123 Đường Cà Phê, Quận 1, Thành phố Hồ Chí Minh'\n    },\n    englishAddress: {\n      type: String,\n      default: '123 Coffee Street, District 1, Ho Chi Minh City'\n    },\n    city: {\n      type: String,\n      default: 'Ho Chi Minh City'\n    },\n    district: {\n      type: String,\n      default: 'District 1'\n    },\n    country: {\n      type: String,\n      default: 'Vietnam'\n    },\n    coordinates: {\n      lat: {\n        type: Number,\n        default: 10.7769\n      },\n      lng: {\n        type: Number,\n        default: 106.7009\n      }\n    },\n    landmarks: {\n      type: String,\n      default: 'Near Ben Thanh Market, walking distance from Nguyen Hue Walking Street'\n    }\n  },\n  contact: {\n    phone: {\n      type: String,\n      required: [true, 'Phone number is required'],\n      default: '+84 28 1234 5678'\n    },\n    hotline: {\n      type: String,\n      default: '+84 28 1234 5678'\n    },\n    email: {\n      type: String,\n      required: [true, 'Email is required'],\n      match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email'],\n      default: 'info@dreamcoffee.vn'\n    },\n    website: {\n      type: String,\n      default: 'https://dreamcoffee.vn'\n    },\n    socialMedia: {\n      facebook: {\n        type: String,\n        default: 'https://facebook.com/dreamcoffee'\n      },\n      instagram: {\n        type: String,\n        default: 'https://instagram.com/dreamcoffee'\n      },\n      twitter: {\n        type: String,\n        default: 'https://twitter.com/dreamcoffee'\n      }\n    }\n  },\n  hours: {\n    weekdays: {\n      open: {\n        type: String,\n        default: '06:00'\n      },\n      close: {\n        type: String,\n        default: '20:00'\n      },\n      display: {\n        type: String,\n        default: 'Thứ 2 - Thứ 6: 6:00 - 20:00 (GMT+7)'\n      }\n    },\n    weekends: {\n      open: {\n        type: String,\n        default: '07:00'\n      },\n      close: {\n        type: String,\n        default: '19:00'\n      },\n      display: {\n        type: String,\n        default: 'Thứ 7 - Chủ Nhật: 7:00 - 19:00 (GMT+7)'\n      }\n    },\n    timezone: {\n      type: String,\n      default: 'GMT+7 (ICT)'\n    },\n    notes: {\n      type: String,\n      default: 'Closed on major holidays'\n    },\n    kitchen: {\n      type: String,\n      default: 'Kitchen closes 30 minutes before closing time'\n    }\n  },\n  services: {\n    dineIn: {\n      type: Boolean,\n      default: true\n    },\n    takeaway: {\n      type: Boolean,\n      default: true\n    },\n    delivery: {\n      type: Boolean,\n      default: true\n    },\n    catering: {\n      type: Boolean,\n      default: true\n    },\n    events: {\n      available: {\n        type: Boolean,\n        default: true\n      },\n      notice: {\n        type: String,\n        default: 'Contact us at least 48 hours in advance for bookings'\n      },\n      types: [{\n        type: String,\n        default: ['Private events', 'Meetings', 'Celebrations']\n      }]\n    },\n    wholesale: {\n      available: {\n        type: Boolean,\n        default: true\n      },\n      contact: {\n        type: String,\n        default: 'wholesale@dreamcoffee.vn'\n      },\n      description: {\n        type: String,\n        default: 'Coffee beans and catering services for businesses'\n      }\n    }\n  },\n  amenities: [{\n    type: String,\n    default: ['Free WiFi', 'Air Conditioning', 'Outdoor Seating', 'Power Outlets', 'Free Parking (20 spots, including 2 accessible spaces)', 'Pet Friendly', 'Study Area', 'Meeting Rooms']\n  }],\n  payment: {\n    methods: [{\n      type: String,\n      default: ['Cash', 'Credit Card', 'Debit Card', 'Mobile Payment', 'Bank Transfer']\n    }],\n    currency: {\n      type: String,\n      default: 'VND (Vietnamese Dong)'\n    }\n  },\n  policies: {\n    wifi: {\n      type: String,\n      default: 'Free high-speed WiFi for all customers'\n    },\n    parking: {\n      type: String,\n      default: 'Free parking available - 20 spots including 2 accessible spaces'\n    },\n    pets: {\n      type: String,\n      default: 'Pet-friendly environment'\n    },\n    smoking: {\n      type: String,\n      default: 'Non-smoking establishment'\n    },\n    reservations: {\n      type: String,\n      default: 'Walk-ins welcome, reservations recommended for groups of 6+'\n    }\n  },\n  responseTemplates: {\n    greeting: {\n      type: String,\n      default: 'Xin chào! Tôi là trợ lý AI của DREAM COFFEE. Tôi có thể giúp bạn tìm hiểu về menu, giờ mở cửa, địa chỉ và các dịch vụ của chúng tôi. Bạn cần hỗ trợ gì?'\n    },\n    fallback: {\n      type: String,\n      default: 'Xin lỗi, tôi không hiểu câu hỏi của bạn. Bạn có thể hỏi về menu, giờ mở cửa, địa chỉ, hoặc các dịch vụ của DREAM COFFEE không?'\n    },\n    contact: {\n      type: String,\n      default: 'Bạn có thể liên hệ với chúng tôi qua:\\n📞 Điện thoại: +84 28 1234 5678\\n📧 Email: info@dreamcoffee.vn\\n📍 Địa chỉ: 123 Đường Cà Phê, Quận 1, TP.HCM'\n    }\n  },\n  // This will be true for the main shop configuration\n  isActive: {\n    type: Boolean,\n    default: true\n  }\n}, {\n  timestamps: true\n});\n\n// Index for better performance\nshopSchema.index({\n  isActive: 1\n});\n\n// Static method to get the active shop configuration\nshopSchema.statics.getActiveShop = async function () {\n  let shop = await this.findOne({\n    isActive: true\n  });\n\n  // If no shop exists, create default one\n  if (!shop) {\n    shop = new this({});\n    await shop.save();\n  }\n  return shop;\n};\n\n// Instance method to check if currently open\nshopSchema.methods.isCurrentlyOpen = function () {\n  const now = new Date();\n  const currentHour = now.getHours();\n  const currentMinute = now.getMinutes();\n  const currentTime = currentHour * 60 + currentMinute;\n  const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n  const hours = isWeekend ? this.hours.weekends : this.hours.weekdays;\n  const [openHour, openMinute] = hours.open.split(':').map(Number);\n  const [closeHour, closeMinute] = hours.close.split(':').map(Number);\n  const openTime = openHour * 60 + openMinute;\n  const closeTime = closeHour * 60 + closeMinute;\n  return currentTime >= openTime && currentTime <= closeTime;\n};\nmodule.exports = mongoose.model('Shop', shopSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJzaG9wU2NoZW1hIiwiU2NoZW1hIiwiYnVzaW5lc3MiLCJuYW1lIiwidHlwZSIsIlN0cmluZyIsInJlcXVpcmVkIiwidHJpbSIsImRlZmF1bHQiLCJkZXNjcmlwdGlvbiIsImVzdGFibGlzaGVkIiwibWlzc2lvbiIsImxvY2F0aW9uIiwiYWRkcmVzcyIsImVuZ2xpc2hBZGRyZXNzIiwiY2l0eSIsImRpc3RyaWN0IiwiY291bnRyeSIsImNvb3JkaW5hdGVzIiwibGF0IiwiTnVtYmVyIiwibG5nIiwibGFuZG1hcmtzIiwiY29udGFjdCIsInBob25lIiwiaG90bGluZSIsImVtYWlsIiwibWF0Y2giLCJ3ZWJzaXRlIiwic29jaWFsTWVkaWEiLCJmYWNlYm9vayIsImluc3RhZ3JhbSIsInR3aXR0ZXIiLCJob3VycyIsIndlZWtkYXlzIiwib3BlbiIsImNsb3NlIiwiZGlzcGxheSIsIndlZWtlbmRzIiwidGltZXpvbmUiLCJub3RlcyIsImtpdGNoZW4iLCJzZXJ2aWNlcyIsImRpbmVJbiIsIkJvb2xlYW4iLCJ0YWtlYXdheSIsImRlbGl2ZXJ5IiwiY2F0ZXJpbmciLCJldmVudHMiLCJhdmFpbGFibGUiLCJub3RpY2UiLCJ0eXBlcyIsIndob2xlc2FsZSIsImFtZW5pdGllcyIsInBheW1lbnQiLCJtZXRob2RzIiwiY3VycmVuY3kiLCJwb2xpY2llcyIsIndpZmkiLCJwYXJraW5nIiwicGV0cyIsInNtb2tpbmciLCJyZXNlcnZhdGlvbnMiLCJyZXNwb25zZVRlbXBsYXRlcyIsImdyZWV0aW5nIiwiZmFsbGJhY2siLCJpc0FjdGl2ZSIsInRpbWVzdGFtcHMiLCJpbmRleCIsInN0YXRpY3MiLCJnZXRBY3RpdmVTaG9wIiwic2hvcCIsImZpbmRPbmUiLCJzYXZlIiwiaXNDdXJyZW50bHlPcGVuIiwibm93IiwiRGF0ZSIsImN1cnJlbnRIb3VyIiwiZ2V0SG91cnMiLCJjdXJyZW50TWludXRlIiwiZ2V0TWludXRlcyIsImN1cnJlbnRUaW1lIiwiaXNXZWVrZW5kIiwiZ2V0RGF5Iiwib3BlbkhvdXIiLCJvcGVuTWludXRlIiwic3BsaXQiLCJtYXAiLCJjbG9zZUhvdXIiLCJjbG9zZU1pbnV0ZSIsIm9wZW5UaW1lIiwiY2xvc2VUaW1lIiwibW9kdWxlIiwiZXhwb3J0cyIsIm1vZGVsIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xcbW9kZWxzXFwiLCJzb3VyY2VzIjpbIlNob3AuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuXG5jb25zdCBzaG9wU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gIGJ1c2luZXNzOiB7XG4gICAgbmFtZToge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgcmVxdWlyZWQ6IFt0cnVlLCAnQnVzaW5lc3MgbmFtZSBpcyByZXF1aXJlZCddLFxuICAgICAgdHJpbTogdHJ1ZSxcbiAgICAgIGRlZmF1bHQ6ICdEUkVBTSBDT0ZGRUUnXG4gICAgfSxcbiAgICB0eXBlOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnUHJlbWl1bSBDb2ZmZWUgU2hvcCdcbiAgICB9LFxuICAgIGRlc2NyaXB0aW9uOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnQSBwcmVtaXVtIGNvZmZlZSBzaG9wIGluIHRoZSBoZWFydCBvZiBIbyBDaGkgTWluaCBDaXR5LCBvZmZlcmluZyBleGNlcHRpb25hbCBjb2ZmZWUsIHBhc3RyaWVzLCBhbmQgYSB3ZWxjb21pbmcgYXRtb3NwaGVyZSBmb3Igd29yayBhbmQgcmVsYXhhdGlvbi4nXG4gICAgfSxcbiAgICBlc3RhYmxpc2hlZDoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJzIwMjAnXG4gICAgfSxcbiAgICBtaXNzaW9uOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnVG8gcHJvdmlkZSB0aGUgZmluZXN0IGNvZmZlZSBleHBlcmllbmNlIHdoaWxlIGZvc3RlcmluZyBjb21tdW5pdHkgY29ubmVjdGlvbnMuJ1xuICAgIH1cbiAgfSxcblxuICBsb2NhdGlvbjoge1xuICAgIGFkZHJlc3M6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ0FkZHJlc3MgaXMgcmVxdWlyZWQnXSxcbiAgICAgIGRlZmF1bHQ6ICcxMjMgxJDGsOG7nW5nIEPDoCBQaMOqLCBRdeG6rW4gMSwgVGjDoG5oIHBo4buRIEjhu5MgQ2jDrSBNaW5oJ1xuICAgIH0sXG4gICAgZW5nbGlzaEFkZHJlc3M6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICcxMjMgQ29mZmVlIFN0cmVldCwgRGlzdHJpY3QgMSwgSG8gQ2hpIE1pbmggQ2l0eSdcbiAgICB9LFxuICAgIGNpdHk6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdIbyBDaGkgTWluaCBDaXR5J1xuICAgIH0sXG4gICAgZGlzdHJpY3Q6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdEaXN0cmljdCAxJ1xuICAgIH0sXG4gICAgY291bnRyeToge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ1ZpZXRuYW0nXG4gICAgfSxcbiAgICBjb29yZGluYXRlczoge1xuICAgICAgbGF0OiB7XG4gICAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgICAgZGVmYXVsdDogMTAuNzc2OVxuICAgICAgfSxcbiAgICAgIGxuZzoge1xuICAgICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICAgIGRlZmF1bHQ6IDEwNi43MDA5XG4gICAgICB9XG4gICAgfSxcbiAgICBsYW5kbWFya3M6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdOZWFyIEJlbiBUaGFuaCBNYXJrZXQsIHdhbGtpbmcgZGlzdGFuY2UgZnJvbSBOZ3V5ZW4gSHVlIFdhbGtpbmcgU3RyZWV0J1xuICAgIH1cbiAgfSxcblxuICBjb250YWN0OiB7XG4gICAgcGhvbmU6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ1Bob25lIG51bWJlciBpcyByZXF1aXJlZCddLFxuICAgICAgZGVmYXVsdDogJys4NCAyOCAxMjM0IDU2NzgnXG4gICAgfSxcbiAgICBob3RsaW5lOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnKzg0IDI4IDEyMzQgNTY3OCdcbiAgICB9LFxuICAgIGVtYWlsOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICByZXF1aXJlZDogW3RydWUsICdFbWFpbCBpcyByZXF1aXJlZCddLFxuICAgICAgbWF0Y2g6IFsvXlxcdysoW1xcLi1dP1xcdyspKkBcXHcrKFtcXC4tXT9cXHcrKSooXFwuXFx3ezIsM30pKyQvLCAnUGxlYXNlIGVudGVyIGEgdmFsaWQgZW1haWwnXSxcbiAgICAgIGRlZmF1bHQ6ICdpbmZvQGRyZWFtY29mZmVlLnZuJ1xuICAgIH0sXG4gICAgd2Vic2l0ZToge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ2h0dHBzOi8vZHJlYW1jb2ZmZWUudm4nXG4gICAgfSxcbiAgICBzb2NpYWxNZWRpYToge1xuICAgICAgZmFjZWJvb2s6IHtcbiAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICBkZWZhdWx0OiAnaHR0cHM6Ly9mYWNlYm9vay5jb20vZHJlYW1jb2ZmZWUnXG4gICAgICB9LFxuICAgICAgaW5zdGFncmFtOiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogJ2h0dHBzOi8vaW5zdGFncmFtLmNvbS9kcmVhbWNvZmZlZSdcbiAgICAgIH0sXG4gICAgICB0d2l0dGVyOiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogJ2h0dHBzOi8vdHdpdHRlci5jb20vZHJlYW1jb2ZmZWUnXG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIGhvdXJzOiB7XG4gICAgd2Vla2RheXM6IHtcbiAgICAgIG9wZW46IHtcbiAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICBkZWZhdWx0OiAnMDY6MDAnXG4gICAgICB9LFxuICAgICAgY2xvc2U6IHtcbiAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICBkZWZhdWx0OiAnMjA6MDAnXG4gICAgICB9LFxuICAgICAgZGlzcGxheToge1xuICAgICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICAgIGRlZmF1bHQ6ICdUaOG7qSAyIC0gVGjhu6kgNjogNjowMCAtIDIwOjAwIChHTVQrNyknXG4gICAgICB9XG4gICAgfSxcbiAgICB3ZWVrZW5kczoge1xuICAgICAgb3Blbjoge1xuICAgICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICAgIGRlZmF1bHQ6ICcwNzowMCdcbiAgICAgIH0sXG4gICAgICBjbG9zZToge1xuICAgICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICAgIGRlZmF1bHQ6ICcxOTowMCdcbiAgICAgIH0sXG4gICAgICBkaXNwbGF5OiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogJ1Ro4bupIDcgLSBDaOG7pyBOaOG6rXQ6IDc6MDAgLSAxOTowMCAoR01UKzcpJ1xuICAgICAgfVxuICAgIH0sXG4gICAgdGltZXpvbmU6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdHTVQrNyAoSUNUKSdcbiAgICB9LFxuICAgIG5vdGVzOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnQ2xvc2VkIG9uIG1ham9yIGhvbGlkYXlzJ1xuICAgIH0sXG4gICAga2l0Y2hlbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ0tpdGNoZW4gY2xvc2VzIDMwIG1pbnV0ZXMgYmVmb3JlIGNsb3NpbmcgdGltZSdcbiAgICB9XG4gIH0sXG5cbiAgc2VydmljZXM6IHtcbiAgICBkaW5lSW46IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiB0cnVlXG4gICAgfSxcbiAgICB0YWtlYXdheToge1xuICAgICAgdHlwZTogQm9vbGVhbixcbiAgICAgIGRlZmF1bHQ6IHRydWVcbiAgICB9LFxuICAgIGRlbGl2ZXJ5OiB7XG4gICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgZGVmYXVsdDogdHJ1ZVxuICAgIH0sXG4gICAgY2F0ZXJpbmc6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiB0cnVlXG4gICAgfSxcbiAgICBldmVudHM6IHtcbiAgICAgIGF2YWlsYWJsZToge1xuICAgICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgICBkZWZhdWx0OiB0cnVlXG4gICAgICB9LFxuICAgICAgbm90aWNlOiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogJ0NvbnRhY3QgdXMgYXQgbGVhc3QgNDggaG91cnMgaW4gYWR2YW5jZSBmb3IgYm9va2luZ3MnXG4gICAgICB9LFxuICAgICAgdHlwZXM6IFt7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogWydQcml2YXRlIGV2ZW50cycsICdNZWV0aW5ncycsICdDZWxlYnJhdGlvbnMnXVxuICAgICAgfV1cbiAgICB9LFxuICAgIHdob2xlc2FsZToge1xuICAgICAgYXZhaWxhYmxlOiB7XG4gICAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICAgIGRlZmF1bHQ6IHRydWVcbiAgICAgIH0sXG4gICAgICBjb250YWN0OiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogJ3dob2xlc2FsZUBkcmVhbWNvZmZlZS52bidcbiAgICAgIH0sXG4gICAgICBkZXNjcmlwdGlvbjoge1xuICAgICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICAgIGRlZmF1bHQ6ICdDb2ZmZWUgYmVhbnMgYW5kIGNhdGVyaW5nIHNlcnZpY2VzIGZvciBidXNpbmVzc2VzJ1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBhbWVuaXRpZXM6IFt7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIGRlZmF1bHQ6IFtcbiAgICAgICdGcmVlIFdpRmknLFxuICAgICAgJ0FpciBDb25kaXRpb25pbmcnLFxuICAgICAgJ091dGRvb3IgU2VhdGluZycsXG4gICAgICAnUG93ZXIgT3V0bGV0cycsXG4gICAgICAnRnJlZSBQYXJraW5nICgyMCBzcG90cywgaW5jbHVkaW5nIDIgYWNjZXNzaWJsZSBzcGFjZXMpJyxcbiAgICAgICdQZXQgRnJpZW5kbHknLFxuICAgICAgJ1N0dWR5IEFyZWEnLFxuICAgICAgJ01lZXRpbmcgUm9vbXMnXG4gICAgXVxuICB9XSxcblxuICBwYXltZW50OiB7XG4gICAgbWV0aG9kczogW3tcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6IFsnQ2FzaCcsICdDcmVkaXQgQ2FyZCcsICdEZWJpdCBDYXJkJywgJ01vYmlsZSBQYXltZW50JywgJ0JhbmsgVHJhbnNmZXInXVxuICAgIH1dLFxuICAgIGN1cnJlbmN5OiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnVk5EIChWaWV0bmFtZXNlIERvbmcpJ1xuICAgIH1cbiAgfSxcblxuICBwb2xpY2llczoge1xuICAgIHdpZmk6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdGcmVlIGhpZ2gtc3BlZWQgV2lGaSBmb3IgYWxsIGN1c3RvbWVycydcbiAgICB9LFxuICAgIHBhcmtpbmc6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdGcmVlIHBhcmtpbmcgYXZhaWxhYmxlIC0gMjAgc3BvdHMgaW5jbHVkaW5nIDIgYWNjZXNzaWJsZSBzcGFjZXMnXG4gICAgfSxcbiAgICBwZXRzOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnUGV0LWZyaWVuZGx5IGVudmlyb25tZW50J1xuICAgIH0sXG4gICAgc21va2luZzoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ05vbi1zbW9raW5nIGVzdGFibGlzaG1lbnQnXG4gICAgfSxcbiAgICByZXNlcnZhdGlvbnM6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdXYWxrLWlucyB3ZWxjb21lLCByZXNlcnZhdGlvbnMgcmVjb21tZW5kZWQgZm9yIGdyb3VwcyBvZiA2KydcbiAgICB9XG4gIH0sXG5cbiAgcmVzcG9uc2VUZW1wbGF0ZXM6IHtcbiAgICBncmVldGluZzoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ1hpbiBjaMOgbyEgVMO0aSBsw6AgdHLhu6MgbMO9IEFJIGPhu6dhIERSRUFNIENPRkZFRS4gVMO0aSBjw7MgdGjhu4MgZ2nDunAgYuG6oW4gdMOsbSBoaeG7g3UgduG7gSBtZW51LCBnaeG7nSBt4bufIGPhu61hLCDEkeG7i2EgY2jhu4kgdsOgIGPDoWMgZOG7i2NoIHbhu6UgY+G7p2EgY2jDum5nIHTDtGkuIELhuqFuIGPhuqduIGjhu5cgdHLhu6MgZ8OsPydcbiAgICB9LFxuICAgIGZhbGxiYWNrOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnWGluIGzhu5dpLCB0w7RpIGtow7RuZyBoaeG7g3UgY8OidSBo4buPaSBj4bunYSBi4bqhbi4gQuG6oW4gY8OzIHRo4buDIGjhu49pIHbhu4EgbWVudSwgZ2nhu50gbeG7nyBj4butYSwgxJHhu4thIGNo4buJLCBob+G6t2MgY8OhYyBk4buLY2ggduG7pSBj4bunYSBEUkVBTSBDT0ZGRUUga2jDtG5nPydcbiAgICB9LFxuICAgIGNvbnRhY3Q6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6ICdC4bqhbiBjw7MgdGjhu4MgbGnDqm4gaOG7hyB24bubaSBjaMO6bmcgdMO0aSBxdWE6XFxu8J+TniDEkGnhu4duIHRob+G6oWk6ICs4NCAyOCAxMjM0IDU2NzhcXG7wn5OnIEVtYWlsOiBpbmZvQGRyZWFtY29mZmVlLnZuXFxu8J+TjSDEkOG7i2EgY2jhu4k6IDEyMyDEkMaw4budbmcgQ8OgIFBow6osIFF14bqtbiAxLCBUUC5IQ00nXG4gICAgfVxuICB9LFxuXG4gIC8vIFRoaXMgd2lsbCBiZSB0cnVlIGZvciB0aGUgbWFpbiBzaG9wIGNvbmZpZ3VyYXRpb25cbiAgaXNBY3RpdmU6IHtcbiAgICB0eXBlOiBCb29sZWFuLFxuICAgIGRlZmF1bHQ6IHRydWVcbiAgfVxufSwge1xuICB0aW1lc3RhbXBzOiB0cnVlXG59KTtcblxuLy8gSW5kZXggZm9yIGJldHRlciBwZXJmb3JtYW5jZVxuc2hvcFNjaGVtYS5pbmRleCh7IGlzQWN0aXZlOiAxIH0pO1xuXG4vLyBTdGF0aWMgbWV0aG9kIHRvIGdldCB0aGUgYWN0aXZlIHNob3AgY29uZmlndXJhdGlvblxuc2hvcFNjaGVtYS5zdGF0aWNzLmdldEFjdGl2ZVNob3AgPSBhc3luYyBmdW5jdGlvbigpIHtcbiAgbGV0IHNob3AgPSBhd2FpdCB0aGlzLmZpbmRPbmUoeyBpc0FjdGl2ZTogdHJ1ZSB9KTtcbiAgXG4gIC8vIElmIG5vIHNob3AgZXhpc3RzLCBjcmVhdGUgZGVmYXVsdCBvbmVcbiAgaWYgKCFzaG9wKSB7XG4gICAgc2hvcCA9IG5ldyB0aGlzKHt9KTtcbiAgICBhd2FpdCBzaG9wLnNhdmUoKTtcbiAgfVxuICBcbiAgcmV0dXJuIHNob3A7XG59O1xuXG4vLyBJbnN0YW5jZSBtZXRob2QgdG8gY2hlY2sgaWYgY3VycmVudGx5IG9wZW5cbnNob3BTY2hlbWEubWV0aG9kcy5pc0N1cnJlbnRseU9wZW4gPSBmdW5jdGlvbigpIHtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgY29uc3QgY3VycmVudEhvdXIgPSBub3cuZ2V0SG91cnMoKTtcbiAgY29uc3QgY3VycmVudE1pbnV0ZSA9IG5vdy5nZXRNaW51dGVzKCk7XG4gIGNvbnN0IGN1cnJlbnRUaW1lID0gY3VycmVudEhvdXIgKiA2MCArIGN1cnJlbnRNaW51dGU7XG4gIFxuICBjb25zdCBpc1dlZWtlbmQgPSBub3cuZ2V0RGF5KCkgPT09IDAgfHwgbm93LmdldERheSgpID09PSA2O1xuICBjb25zdCBob3VycyA9IGlzV2Vla2VuZCA/IHRoaXMuaG91cnMud2Vla2VuZHMgOiB0aGlzLmhvdXJzLndlZWtkYXlzO1xuICBcbiAgY29uc3QgW29wZW5Ib3VyLCBvcGVuTWludXRlXSA9IGhvdXJzLm9wZW4uc3BsaXQoJzonKS5tYXAoTnVtYmVyKTtcbiAgY29uc3QgW2Nsb3NlSG91ciwgY2xvc2VNaW51dGVdID0gaG91cnMuY2xvc2Uuc3BsaXQoJzonKS5tYXAoTnVtYmVyKTtcbiAgXG4gIGNvbnN0IG9wZW5UaW1lID0gb3BlbkhvdXIgKiA2MCArIG9wZW5NaW51dGU7XG4gIGNvbnN0IGNsb3NlVGltZSA9IGNsb3NlSG91ciAqIDYwICsgY2xvc2VNaW51dGU7XG4gIFxuICByZXR1cm4gY3VycmVudFRpbWUgPj0gb3BlblRpbWUgJiYgY3VycmVudFRpbWUgPD0gY2xvc2VUaW1lO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBtb25nb29zZS5tb2RlbCgnU2hvcCcsIHNob3BTY2hlbWEpOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRXBDLE1BQU1DLFVBQVUsR0FBRyxJQUFJRixRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUNyQ0MsUUFBUSxFQUFFO0lBQ1JDLElBQUksRUFBRTtNQUNKQyxJQUFJLEVBQUVDLE1BQU07TUFDWkMsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLDJCQUEyQixDQUFDO01BQzdDQyxJQUFJLEVBQUUsSUFBSTtNQUNWQyxPQUFPLEVBQUU7SUFDWCxDQUFDO0lBQ0RKLElBQUksRUFBRTtNQUNKQSxJQUFJLEVBQUVDLE1BQU07TUFDWkcsT0FBTyxFQUFFO0lBQ1gsQ0FBQztJQUNEQyxXQUFXLEVBQUU7TUFDWEwsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYLENBQUM7SUFDREUsV0FBVyxFQUFFO01BQ1hOLElBQUksRUFBRUMsTUFBTTtNQUNaRyxPQUFPLEVBQUU7SUFDWCxDQUFDO0lBQ0RHLE9BQU8sRUFBRTtNQUNQUCxJQUFJLEVBQUVDLE1BQU07TUFDWkcsT0FBTyxFQUFFO0lBQ1g7RUFDRixDQUFDO0VBRURJLFFBQVEsRUFBRTtJQUNSQyxPQUFPLEVBQUU7TUFDUFQsSUFBSSxFQUFFQyxNQUFNO01BQ1pDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxxQkFBcUIsQ0FBQztNQUN2Q0UsT0FBTyxFQUFFO0lBQ1gsQ0FBQztJQUNETSxjQUFjLEVBQUU7TUFDZFYsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYLENBQUM7SUFDRE8sSUFBSSxFQUFFO01BQ0pYLElBQUksRUFBRUMsTUFBTTtNQUNaRyxPQUFPLEVBQUU7SUFDWCxDQUFDO0lBQ0RRLFFBQVEsRUFBRTtNQUNSWixJQUFJLEVBQUVDLE1BQU07TUFDWkcsT0FBTyxFQUFFO0lBQ1gsQ0FBQztJQUNEUyxPQUFPLEVBQUU7TUFDUGIsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYLENBQUM7SUFDRFUsV0FBVyxFQUFFO01BQ1hDLEdBQUcsRUFBRTtRQUNIZixJQUFJLEVBQUVnQixNQUFNO1FBQ1paLE9BQU8sRUFBRTtNQUNYLENBQUM7TUFDRGEsR0FBRyxFQUFFO1FBQ0hqQixJQUFJLEVBQUVnQixNQUFNO1FBQ1paLE9BQU8sRUFBRTtNQUNYO0lBQ0YsQ0FBQztJQUNEYyxTQUFTLEVBQUU7TUFDVGxCLElBQUksRUFBRUMsTUFBTTtNQUNaRyxPQUFPLEVBQUU7SUFDWDtFQUNGLENBQUM7RUFFRGUsT0FBTyxFQUFFO0lBQ1BDLEtBQUssRUFBRTtNQUNMcEIsSUFBSSxFQUFFQyxNQUFNO01BQ1pDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSwwQkFBMEIsQ0FBQztNQUM1Q0UsT0FBTyxFQUFFO0lBQ1gsQ0FBQztJQUNEaUIsT0FBTyxFQUFFO01BQ1ByQixJQUFJLEVBQUVDLE1BQU07TUFDWkcsT0FBTyxFQUFFO0lBQ1gsQ0FBQztJQUNEa0IsS0FBSyxFQUFFO01BQ0x0QixJQUFJLEVBQUVDLE1BQU07TUFDWkMsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLG1CQUFtQixDQUFDO01BQ3JDcUIsS0FBSyxFQUFFLENBQUMsK0NBQStDLEVBQUUsNEJBQTRCLENBQUM7TUFDdEZuQixPQUFPLEVBQUU7SUFDWCxDQUFDO0lBQ0RvQixPQUFPLEVBQUU7TUFDUHhCLElBQUksRUFBRUMsTUFBTTtNQUNaRyxPQUFPLEVBQUU7SUFDWCxDQUFDO0lBQ0RxQixXQUFXLEVBQUU7TUFDWEMsUUFBUSxFQUFFO1FBQ1IxQixJQUFJLEVBQUVDLE1BQU07UUFDWkcsT0FBTyxFQUFFO01BQ1gsQ0FBQztNQUNEdUIsU0FBUyxFQUFFO1FBQ1QzQixJQUFJLEVBQUVDLE1BQU07UUFDWkcsT0FBTyxFQUFFO01BQ1gsQ0FBQztNQUNEd0IsT0FBTyxFQUFFO1FBQ1A1QixJQUFJLEVBQUVDLE1BQU07UUFDWkcsT0FBTyxFQUFFO01BQ1g7SUFDRjtFQUNGLENBQUM7RUFFRHlCLEtBQUssRUFBRTtJQUNMQyxRQUFRLEVBQUU7TUFDUkMsSUFBSSxFQUFFO1FBQ0ovQixJQUFJLEVBQUVDLE1BQU07UUFDWkcsT0FBTyxFQUFFO01BQ1gsQ0FBQztNQUNENEIsS0FBSyxFQUFFO1FBQ0xoQyxJQUFJLEVBQUVDLE1BQU07UUFDWkcsT0FBTyxFQUFFO01BQ1gsQ0FBQztNQUNENkIsT0FBTyxFQUFFO1FBQ1BqQyxJQUFJLEVBQUVDLE1BQU07UUFDWkcsT0FBTyxFQUFFO01BQ1g7SUFDRixDQUFDO0lBQ0Q4QixRQUFRLEVBQUU7TUFDUkgsSUFBSSxFQUFFO1FBQ0ovQixJQUFJLEVBQUVDLE1BQU07UUFDWkcsT0FBTyxFQUFFO01BQ1gsQ0FBQztNQUNENEIsS0FBSyxFQUFFO1FBQ0xoQyxJQUFJLEVBQUVDLE1BQU07UUFDWkcsT0FBTyxFQUFFO01BQ1gsQ0FBQztNQUNENkIsT0FBTyxFQUFFO1FBQ1BqQyxJQUFJLEVBQUVDLE1BQU07UUFDWkcsT0FBTyxFQUFFO01BQ1g7SUFDRixDQUFDO0lBQ0QrQixRQUFRLEVBQUU7TUFDUm5DLElBQUksRUFBRUMsTUFBTTtNQUNaRyxPQUFPLEVBQUU7SUFDWCxDQUFDO0lBQ0RnQyxLQUFLLEVBQUU7TUFDTHBDLElBQUksRUFBRUMsTUFBTTtNQUNaRyxPQUFPLEVBQUU7SUFDWCxDQUFDO0lBQ0RpQyxPQUFPLEVBQUU7TUFDUHJDLElBQUksRUFBRUMsTUFBTTtNQUNaRyxPQUFPLEVBQUU7SUFDWDtFQUNGLENBQUM7RUFFRGtDLFFBQVEsRUFBRTtJQUNSQyxNQUFNLEVBQUU7TUFDTnZDLElBQUksRUFBRXdDLE9BQU87TUFDYnBDLE9BQU8sRUFBRTtJQUNYLENBQUM7SUFDRHFDLFFBQVEsRUFBRTtNQUNSekMsSUFBSSxFQUFFd0MsT0FBTztNQUNicEMsT0FBTyxFQUFFO0lBQ1gsQ0FBQztJQUNEc0MsUUFBUSxFQUFFO01BQ1IxQyxJQUFJLEVBQUV3QyxPQUFPO01BQ2JwQyxPQUFPLEVBQUU7SUFDWCxDQUFDO0lBQ0R1QyxRQUFRLEVBQUU7TUFDUjNDLElBQUksRUFBRXdDLE9BQU87TUFDYnBDLE9BQU8sRUFBRTtJQUNYLENBQUM7SUFDRHdDLE1BQU0sRUFBRTtNQUNOQyxTQUFTLEVBQUU7UUFDVDdDLElBQUksRUFBRXdDLE9BQU87UUFDYnBDLE9BQU8sRUFBRTtNQUNYLENBQUM7TUFDRDBDLE1BQU0sRUFBRTtRQUNOOUMsSUFBSSxFQUFFQyxNQUFNO1FBQ1pHLE9BQU8sRUFBRTtNQUNYLENBQUM7TUFDRDJDLEtBQUssRUFBRSxDQUFDO1FBQ04vQyxJQUFJLEVBQUVDLE1BQU07UUFDWkcsT0FBTyxFQUFFLENBQUMsZ0JBQWdCLEVBQUUsVUFBVSxFQUFFLGNBQWM7TUFDeEQsQ0FBQztJQUNILENBQUM7SUFDRDRDLFNBQVMsRUFBRTtNQUNUSCxTQUFTLEVBQUU7UUFDVDdDLElBQUksRUFBRXdDLE9BQU87UUFDYnBDLE9BQU8sRUFBRTtNQUNYLENBQUM7TUFDRGUsT0FBTyxFQUFFO1FBQ1BuQixJQUFJLEVBQUVDLE1BQU07UUFDWkcsT0FBTyxFQUFFO01BQ1gsQ0FBQztNQUNEQyxXQUFXLEVBQUU7UUFDWEwsSUFBSSxFQUFFQyxNQUFNO1FBQ1pHLE9BQU8sRUFBRTtNQUNYO0lBQ0Y7RUFDRixDQUFDO0VBRUQ2QyxTQUFTLEVBQUUsQ0FBQztJQUNWakQsSUFBSSxFQUFFQyxNQUFNO0lBQ1pHLE9BQU8sRUFBRSxDQUNQLFdBQVcsRUFDWCxrQkFBa0IsRUFDbEIsaUJBQWlCLEVBQ2pCLGVBQWUsRUFDZix3REFBd0QsRUFDeEQsY0FBYyxFQUNkLFlBQVksRUFDWixlQUFlO0VBRW5CLENBQUMsQ0FBQztFQUVGOEMsT0FBTyxFQUFFO0lBQ1BDLE9BQU8sRUFBRSxDQUFDO01BQ1JuRCxJQUFJLEVBQUVDLE1BQU07TUFDWkcsT0FBTyxFQUFFLENBQUMsTUFBTSxFQUFFLGFBQWEsRUFBRSxZQUFZLEVBQUUsZ0JBQWdCLEVBQUUsZUFBZTtJQUNsRixDQUFDLENBQUM7SUFDRmdELFFBQVEsRUFBRTtNQUNScEQsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYO0VBQ0YsQ0FBQztFQUVEaUQsUUFBUSxFQUFFO0lBQ1JDLElBQUksRUFBRTtNQUNKdEQsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYLENBQUM7SUFDRG1ELE9BQU8sRUFBRTtNQUNQdkQsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYLENBQUM7SUFDRG9ELElBQUksRUFBRTtNQUNKeEQsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYLENBQUM7SUFDRHFELE9BQU8sRUFBRTtNQUNQekQsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYLENBQUM7SUFDRHNELFlBQVksRUFBRTtNQUNaMUQsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYO0VBQ0YsQ0FBQztFQUVEdUQsaUJBQWlCLEVBQUU7SUFDakJDLFFBQVEsRUFBRTtNQUNSNUQsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYLENBQUM7SUFDRHlELFFBQVEsRUFBRTtNQUNSN0QsSUFBSSxFQUFFQyxNQUFNO01BQ1pHLE9BQU8sRUFBRTtJQUNYLENBQUM7SUFDRGUsT0FBTyxFQUFFO01BQ1BuQixJQUFJLEVBQUVDLE1BQU07TUFDWkcsT0FBTyxFQUFFO0lBQ1g7RUFDRixDQUFDO0VBRUQ7RUFDQTBELFFBQVEsRUFBRTtJQUNSOUQsSUFBSSxFQUFFd0MsT0FBTztJQUNicEMsT0FBTyxFQUFFO0VBQ1g7QUFDRixDQUFDLEVBQUU7RUFDRDJELFVBQVUsRUFBRTtBQUNkLENBQUMsQ0FBQzs7QUFFRjtBQUNBbkUsVUFBVSxDQUFDb0UsS0FBSyxDQUFDO0VBQUVGLFFBQVEsRUFBRTtBQUFFLENBQUMsQ0FBQzs7QUFFakM7QUFDQWxFLFVBQVUsQ0FBQ3FFLE9BQU8sQ0FBQ0MsYUFBYSxHQUFHLGtCQUFpQjtFQUNsRCxJQUFJQyxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUNDLE9BQU8sQ0FBQztJQUFFTixRQUFRLEVBQUU7RUFBSyxDQUFDLENBQUM7O0VBRWpEO0VBQ0EsSUFBSSxDQUFDSyxJQUFJLEVBQUU7SUFDVEEsSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25CLE1BQU1BLElBQUksQ0FBQ0UsSUFBSSxDQUFDLENBQUM7RUFDbkI7RUFFQSxPQUFPRixJQUFJO0FBQ2IsQ0FBQzs7QUFFRDtBQUNBdkUsVUFBVSxDQUFDdUQsT0FBTyxDQUFDbUIsZUFBZSxHQUFHLFlBQVc7RUFDOUMsTUFBTUMsR0FBRyxHQUFHLElBQUlDLElBQUksQ0FBQyxDQUFDO0VBQ3RCLE1BQU1DLFdBQVcsR0FBR0YsR0FBRyxDQUFDRyxRQUFRLENBQUMsQ0FBQztFQUNsQyxNQUFNQyxhQUFhLEdBQUdKLEdBQUcsQ0FBQ0ssVUFBVSxDQUFDLENBQUM7RUFDdEMsTUFBTUMsV0FBVyxHQUFHSixXQUFXLEdBQUcsRUFBRSxHQUFHRSxhQUFhO0VBRXBELE1BQU1HLFNBQVMsR0FBR1AsR0FBRyxDQUFDUSxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSVIsR0FBRyxDQUFDUSxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUM7RUFDMUQsTUFBTWxELEtBQUssR0FBR2lELFNBQVMsR0FBRyxJQUFJLENBQUNqRCxLQUFLLENBQUNLLFFBQVEsR0FBRyxJQUFJLENBQUNMLEtBQUssQ0FBQ0MsUUFBUTtFQUVuRSxNQUFNLENBQUNrRCxRQUFRLEVBQUVDLFVBQVUsQ0FBQyxHQUFHcEQsS0FBSyxDQUFDRSxJQUFJLENBQUNtRCxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUNDLEdBQUcsQ0FBQ25FLE1BQU0sQ0FBQztFQUNoRSxNQUFNLENBQUNvRSxTQUFTLEVBQUVDLFdBQVcsQ0FBQyxHQUFHeEQsS0FBSyxDQUFDRyxLQUFLLENBQUNrRCxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUNDLEdBQUcsQ0FBQ25FLE1BQU0sQ0FBQztFQUVuRSxNQUFNc0UsUUFBUSxHQUFHTixRQUFRLEdBQUcsRUFBRSxHQUFHQyxVQUFVO0VBQzNDLE1BQU1NLFNBQVMsR0FBR0gsU0FBUyxHQUFHLEVBQUUsR0FBR0MsV0FBVztFQUU5QyxPQUFPUixXQUFXLElBQUlTLFFBQVEsSUFBSVQsV0FBVyxJQUFJVSxTQUFTO0FBQzVELENBQUM7QUFFREMsTUFBTSxDQUFDQyxPQUFPLEdBQUcvRixRQUFRLENBQUNnRyxLQUFLLENBQUMsTUFBTSxFQUFFOUYsVUFBVSxDQUFDIiwiaWdub3JlTGlzdCI6W119","map":{"version":3,"names":["mongoose","require","shopSchema","Schema","business","name","type","String","required","trim","default","description","established","mission","location","address","englishAddress","city","district","country","coordinates","lat","Number","lng","landmarks","contact","phone","hotline","email","match","website","socialMedia","facebook","instagram","twitter","hours","weekdays","open","close","display","weekends","timezone","notes","kitchen","services","dineIn","Boolean","takeaway","delivery","catering","events","available","notice","types","wholesale","amenities","payment","methods","currency","policies","wifi","parking","pets","smoking","reservations","responseTemplates","greeting","fallback","isActive","timestamps","index","statics","getActiveShop","shop","findOne","save","isCurrentlyOpen","now","Date","currentHour","getHours","currentMinute","getMinutes","currentTime","isWeekend","getDay","openHour","openMinute","split","map","closeHour","closeMinute","openTime","closeTime","module","exports","model"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\models\\","sources":["Shop.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst shopSchema = new mongoose.Schema({\n  business: {\n    name: {\n      type: String,\n      required: [true, 'Business name is required'],\n      trim: true,\n      default: 'DREAM COFFEE'\n    },\n    type: {\n      type: String,\n      default: 'Premium Coffee Shop'\n    },\n    description: {\n      type: String,\n      default: 'A premium coffee shop in the heart of Ho Chi Minh City, offering exceptional coffee, pastries, and a welcoming atmosphere for work and relaxation.'\n    },\n    established: {\n      type: String,\n      default: '2020'\n    },\n    mission: {\n      type: String,\n      default: 'To provide the finest coffee experience while fostering community connections.'\n    }\n  },\n\n  location: {\n    address: {\n      type: String,\n      required: [true, 'Address is required'],\n      default: '123 Đường Cà Phê, Quận 1, Thành phố Hồ Chí Minh'\n    },\n    englishAddress: {\n      type: String,\n      default: '123 Coffee Street, District 1, Ho Chi Minh City'\n    },\n    city: {\n      type: String,\n      default: 'Ho Chi Minh City'\n    },\n    district: {\n      type: String,\n      default: 'District 1'\n    },\n    country: {\n      type: String,\n      default: 'Vietnam'\n    },\n    coordinates: {\n      lat: {\n        type: Number,\n        default: 10.7769\n      },\n      lng: {\n        type: Number,\n        default: 106.7009\n      }\n    },\n    landmarks: {\n      type: String,\n      default: 'Near Ben Thanh Market, walking distance from Nguyen Hue Walking Street'\n    }\n  },\n\n  contact: {\n    phone: {\n      type: String,\n      required: [true, 'Phone number is required'],\n      default: '+84 28 1234 5678'\n    },\n    hotline: {\n      type: String,\n      default: '+84 28 1234 5678'\n    },\n    email: {\n      type: String,\n      required: [true, 'Email is required'],\n      match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email'],\n      default: 'info@dreamcoffee.vn'\n    },\n    website: {\n      type: String,\n      default: 'https://dreamcoffee.vn'\n    },\n    socialMedia: {\n      facebook: {\n        type: String,\n        default: 'https://facebook.com/dreamcoffee'\n      },\n      instagram: {\n        type: String,\n        default: 'https://instagram.com/dreamcoffee'\n      },\n      twitter: {\n        type: String,\n        default: 'https://twitter.com/dreamcoffee'\n      }\n    }\n  },\n\n  hours: {\n    weekdays: {\n      open: {\n        type: String,\n        default: '06:00'\n      },\n      close: {\n        type: String,\n        default: '20:00'\n      },\n      display: {\n        type: String,\n        default: 'Thứ 2 - Thứ 6: 6:00 - 20:00 (GMT+7)'\n      }\n    },\n    weekends: {\n      open: {\n        type: String,\n        default: '07:00'\n      },\n      close: {\n        type: String,\n        default: '19:00'\n      },\n      display: {\n        type: String,\n        default: 'Thứ 7 - Chủ Nhật: 7:00 - 19:00 (GMT+7)'\n      }\n    },\n    timezone: {\n      type: String,\n      default: 'GMT+7 (ICT)'\n    },\n    notes: {\n      type: String,\n      default: 'Closed on major holidays'\n    },\n    kitchen: {\n      type: String,\n      default: 'Kitchen closes 30 minutes before closing time'\n    }\n  },\n\n  services: {\n    dineIn: {\n      type: Boolean,\n      default: true\n    },\n    takeaway: {\n      type: Boolean,\n      default: true\n    },\n    delivery: {\n      type: Boolean,\n      default: true\n    },\n    catering: {\n      type: Boolean,\n      default: true\n    },\n    events: {\n      available: {\n        type: Boolean,\n        default: true\n      },\n      notice: {\n        type: String,\n        default: 'Contact us at least 48 hours in advance for bookings'\n      },\n      types: [{\n        type: String,\n        default: ['Private events', 'Meetings', 'Celebrations']\n      }]\n    },\n    wholesale: {\n      available: {\n        type: Boolean,\n        default: true\n      },\n      contact: {\n        type: String,\n        default: 'wholesale@dreamcoffee.vn'\n      },\n      description: {\n        type: String,\n        default: 'Coffee beans and catering services for businesses'\n      }\n    }\n  },\n\n  amenities: [{\n    type: String,\n    default: [\n      'Free WiFi',\n      'Air Conditioning',\n      'Outdoor Seating',\n      'Power Outlets',\n      'Free Parking (20 spots, including 2 accessible spaces)',\n      'Pet Friendly',\n      'Study Area',\n      'Meeting Rooms'\n    ]\n  }],\n\n  payment: {\n    methods: [{\n      type: String,\n      default: ['Cash', 'Credit Card', 'Debit Card', 'Mobile Payment', 'Bank Transfer']\n    }],\n    currency: {\n      type: String,\n      default: 'VND (Vietnamese Dong)'\n    }\n  },\n\n  policies: {\n    wifi: {\n      type: String,\n      default: 'Free high-speed WiFi for all customers'\n    },\n    parking: {\n      type: String,\n      default: 'Free parking available - 20 spots including 2 accessible spaces'\n    },\n    pets: {\n      type: String,\n      default: 'Pet-friendly environment'\n    },\n    smoking: {\n      type: String,\n      default: 'Non-smoking establishment'\n    },\n    reservations: {\n      type: String,\n      default: 'Walk-ins welcome, reservations recommended for groups of 6+'\n    }\n  },\n\n  responseTemplates: {\n    greeting: {\n      type: String,\n      default: 'Xin chào! Tôi là trợ lý AI của DREAM COFFEE. Tôi có thể giúp bạn tìm hiểu về menu, giờ mở cửa, địa chỉ và các dịch vụ của chúng tôi. Bạn cần hỗ trợ gì?'\n    },\n    fallback: {\n      type: String,\n      default: 'Xin lỗi, tôi không hiểu câu hỏi của bạn. Bạn có thể hỏi về menu, giờ mở cửa, địa chỉ, hoặc các dịch vụ của DREAM COFFEE không?'\n    },\n    contact: {\n      type: String,\n      default: 'Bạn có thể liên hệ với chúng tôi qua:\\n📞 Điện thoại: +84 28 1234 5678\\n📧 Email: info@dreamcoffee.vn\\n📍 Địa chỉ: 123 Đường Cà Phê, Quận 1, TP.HCM'\n    }\n  },\n\n  // This will be true for the main shop configuration\n  isActive: {\n    type: Boolean,\n    default: true\n  }\n}, {\n  timestamps: true\n});\n\n// Index for better performance\nshopSchema.index({ isActive: 1 });\n\n// Static method to get the active shop configuration\nshopSchema.statics.getActiveShop = async function() {\n  let shop = await this.findOne({ isActive: true });\n  \n  // If no shop exists, create default one\n  if (!shop) {\n    shop = new this({});\n    await shop.save();\n  }\n  \n  return shop;\n};\n\n// Instance method to check if currently open\nshopSchema.methods.isCurrentlyOpen = function() {\n  const now = new Date();\n  const currentHour = now.getHours();\n  const currentMinute = now.getMinutes();\n  const currentTime = currentHour * 60 + currentMinute;\n  \n  const isWeekend = now.getDay() === 0 || now.getDay() === 6;\n  const hours = isWeekend ? this.hours.weekends : this.hours.weekdays;\n  \n  const [openHour, openMinute] = hours.open.split(':').map(Number);\n  const [closeHour, closeMinute] = hours.close.split(':').map(Number);\n  \n  const openTime = openHour * 60 + openMinute;\n  const closeTime = closeHour * 60 + closeMinute;\n  \n  return currentTime >= openTime && currentTime <= closeTime;\n};\n\nmodule.exports = mongoose.model('Shop', shopSchema);"],"mappings":"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","ignoreList":[]}},"mtime":1757007725785},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\routes\\\\contact.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst Contact = require('../models/Contact');\nconst {\n  protect,\n  authorize\n} = require('../middleware/auth');\n\n// @route   POST /api/contact\n// @desc    Submit contact form\n// @access  Public\nrouter.post('/', async (req, res) => {\n  try {\n    const {\n      name,\n      email,\n      subject,\n      message\n    } = req.body;\n\n    // Validate required fields\n    if (!name || !email || !subject || !message) {\n      return res.status(400).json({\n        success: false,\n        message: 'All fields are required'\n      });\n    }\n\n    // Create new contact message\n    const contact = new Contact({\n      name: name.trim(),\n      email: email.trim(),\n      subject: subject.trim(),\n      message: message.trim()\n    });\n    await contact.save();\n    res.status(201).json({\n      success: true,\n      message: 'Your message has been received',\n      data: {\n        ticketId: contact.ticketId,\n        expectedResponseTime: '24-48 hours'\n      }\n    });\n  } catch (error) {\n    console.error('Contact form submission error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error. Please try again later.'\n    });\n  }\n});\n\n// @route   GET /api/contact\n// @desc    Get all contact messages (Admin only)\n// @access  Private/Admin\nrouter.get('/', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const skip = (page - 1) * limit;\n\n    // Build query\n    let query = {};\n    if (status && ['new', 'read', 'replied', 'closed'].includes(status)) {\n      query.status = status;\n    }\n\n    // Get contacts with pagination\n    const contacts = await Contact.find(query).sort({\n      createdAt: -1\n    }).skip(skip).limit(limit);\n\n    // Get total count for pagination\n    const total = await Contact.countDocuments(query);\n    res.json({\n      success: true,\n      data: {\n        contacts,\n        pagination: {\n          current: page,\n          pages: Math.ceil(total / limit),\n          total,\n          limit\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Get contacts error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   GET /api/contact/:id\n// @desc    Get single contact message (Admin only)\n// @access  Private/Admin\nrouter.get('/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const contact = await Contact.findById(req.params.id);\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    // Mark as read if not already\n    if (!contact.isRead) {\n      contact.isRead = true;\n      contact.status = 'read';\n      await contact.save();\n    }\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Get contact error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   PUT /api/contact/:id/status\n// @desc    Update contact message status (Admin only)\n// @access  Private/Admin\nrouter.put('/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const {\n      status\n    } = req.body;\n    if (!['new', 'read', 'replied', 'closed'].includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid status'\n      });\n    }\n    const contact = await Contact.findById(req.params.id);\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n    contact.status = status;\n    if (status !== 'new') {\n      contact.isRead = true;\n    }\n    await contact.save();\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Update contact status error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   DELETE /api/contact/:id\n// @desc    Delete contact message (Admin only)\n// @access  Private/Admin\nrouter.delete('/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const contact = await Contact.findById(req.params.id);\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n    await Contact.findByIdAndDelete(req.params.id);\n    res.json({\n      success: true,\n      message: 'Contact message deleted successfully'\n    });\n  } catch (error) {\n    console.error('Delete contact error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIkNvbnRhY3QiLCJwcm90ZWN0IiwiYXV0aG9yaXplIiwicG9zdCIsInJlcSIsInJlcyIsIm5hbWUiLCJlbWFpbCIsInN1YmplY3QiLCJtZXNzYWdlIiwiYm9keSIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwiY29udGFjdCIsInRyaW0iLCJzYXZlIiwiZGF0YSIsInRpY2tldElkIiwiZXhwZWN0ZWRSZXNwb25zZVRpbWUiLCJlcnJvciIsImNvbnNvbGUiLCJnZXQiLCJwYWdlIiwicGFyc2VJbnQiLCJxdWVyeSIsImxpbWl0Iiwic2tpcCIsImluY2x1ZGVzIiwiY29udGFjdHMiLCJmaW5kIiwic29ydCIsImNyZWF0ZWRBdCIsInRvdGFsIiwiY291bnREb2N1bWVudHMiLCJwYWdpbmF0aW9uIiwiY3VycmVudCIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJmaW5kQnlJZCIsInBhcmFtcyIsImlkIiwiaXNSZWFkIiwicHV0IiwiZGVsZXRlIiwiZmluZEJ5SWRBbmREZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJEOlxcY29kZVxcV2ViQ2FmZmVcXGJhY2tlbmRcXHNyY1xccm91dGVzXFwiLCJzb3VyY2VzIjpbImNvbnRhY3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5jb25zdCBDb250YWN0ID0gcmVxdWlyZSgnLi4vbW9kZWxzL0NvbnRhY3QnKTtcbmNvbnN0IHsgcHJvdGVjdCwgYXV0aG9yaXplIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcblxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL2NvbnRhY3Rcbi8vIEBkZXNjICAgIFN1Ym1pdCBjb250YWN0IGZvcm1cbi8vIEBhY2Nlc3MgIFB1YmxpY1xucm91dGVyLnBvc3QoJy8nLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IG5hbWUsIGVtYWlsLCBzdWJqZWN0LCBtZXNzYWdlIH0gPSByZXEuYm9keTtcblxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgIGlmICghbmFtZSB8fCAhZW1haWwgfHwgIXN1YmplY3QgfHwgIW1lc3NhZ2UpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQWxsIGZpZWxkcyBhcmUgcmVxdWlyZWQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgbmV3IGNvbnRhY3QgbWVzc2FnZVxuICAgIGNvbnN0IGNvbnRhY3QgPSBuZXcgQ29udGFjdCh7XG4gICAgICBuYW1lOiBuYW1lLnRyaW0oKSxcbiAgICAgIGVtYWlsOiBlbWFpbC50cmltKCksXG4gICAgICBzdWJqZWN0OiBzdWJqZWN0LnRyaW0oKSxcbiAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UudHJpbSgpXG4gICAgfSk7XG5cbiAgICBhd2FpdCBjb250YWN0LnNhdmUoKTtcblxuICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnWW91ciBtZXNzYWdlIGhhcyBiZWVuIHJlY2VpdmVkJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdGlja2V0SWQ6IGNvbnRhY3QudGlja2V0SWQsXG4gICAgICAgIGV4cGVjdGVkUmVzcG9uc2VUaW1lOiAnMjQtNDggaG91cnMnXG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQ29udGFjdCBmb3JtIHN1Ym1pc3Npb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBAcm91dGUgICBHRVQgL2FwaS9jb250YWN0XG4vLyBAZGVzYyAgICBHZXQgYWxsIGNvbnRhY3QgbWVzc2FnZXMgKEFkbWluIG9ubHkpXG4vLyBAYWNjZXNzICBQcml2YXRlL0FkbWluXG5yb3V0ZXIuZ2V0KCcvJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQocmVxLnF1ZXJ5LnBhZ2UpIHx8IDE7XG4gICAgY29uc3QgbGltaXQgPSBwYXJzZUludChyZXEucXVlcnkubGltaXQpIHx8IDEwO1xuICAgIGNvbnN0IHN0YXR1cyA9IHJlcS5xdWVyeS5zdGF0dXM7XG4gICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcblxuICAgIC8vIEJ1aWxkIHF1ZXJ5XG4gICAgbGV0IHF1ZXJ5ID0ge307XG4gICAgaWYgKHN0YXR1cyAmJiBbJ25ldycsICdyZWFkJywgJ3JlcGxpZWQnLCAnY2xvc2VkJ10uaW5jbHVkZXMoc3RhdHVzKSkge1xuICAgICAgcXVlcnkuc3RhdHVzID0gc3RhdHVzO1xuICAgIH1cblxuICAgIC8vIEdldCBjb250YWN0cyB3aXRoIHBhZ2luYXRpb25cbiAgICBjb25zdCBjb250YWN0cyA9IGF3YWl0IENvbnRhY3QuZmluZChxdWVyeSlcbiAgICAgIC5zb3J0KHsgY3JlYXRlZEF0OiAtMSB9KVxuICAgICAgLnNraXAoc2tpcClcbiAgICAgIC5saW1pdChsaW1pdCk7XG5cbiAgICAvLyBHZXQgdG90YWwgY291bnQgZm9yIHBhZ2luYXRpb25cbiAgICBjb25zdCB0b3RhbCA9IGF3YWl0IENvbnRhY3QuY291bnREb2N1bWVudHMocXVlcnkpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgY29udGFjdHMsXG4gICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICBjdXJyZW50OiBwYWdlLFxuICAgICAgICAgIHBhZ2VzOiBNYXRoLmNlaWwodG90YWwgLyBsaW1pdCksXG4gICAgICAgICAgdG90YWwsXG4gICAgICAgICAgbGltaXRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0dldCBjb250YWN0cyBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgR0VUIC9hcGkvY29udGFjdC86aWRcbi8vIEBkZXNjICAgIEdldCBzaW5nbGUgY29udGFjdCBtZXNzYWdlIChBZG1pbiBvbmx5KVxuLy8gQGFjY2VzcyAgUHJpdmF0ZS9BZG1pblxucm91dGVyLmdldCgnLzppZCcsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29udGFjdCA9IGF3YWl0IENvbnRhY3QuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCk7XG5cbiAgICBpZiAoIWNvbnRhY3QpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQ29udGFjdCBtZXNzYWdlIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE1hcmsgYXMgcmVhZCBpZiBub3QgYWxyZWFkeVxuICAgIGlmICghY29udGFjdC5pc1JlYWQpIHtcbiAgICAgIGNvbnRhY3QuaXNSZWFkID0gdHJ1ZTtcbiAgICAgIGNvbnRhY3Quc3RhdHVzID0gJ3JlYWQnO1xuICAgICAgYXdhaXQgY29udGFjdC5zYXZlKCk7XG4gICAgfVxuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IGNvbnRhY3RcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdHZXQgY29udGFjdCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQHJvdXRlICAgUFVUIC9hcGkvY29udGFjdC86aWQvc3RhdHVzXG4vLyBAZGVzYyAgICBVcGRhdGUgY29udGFjdCBtZXNzYWdlIHN0YXR1cyAoQWRtaW4gb25seSlcbi8vIEBhY2Nlc3MgIFByaXZhdGUvQWRtaW5cbnJvdXRlci5wdXQoJy86aWQvc3RhdHVzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHN0YXR1cyB9ID0gcmVxLmJvZHk7XG5cbiAgICBpZiAoIVsnbmV3JywgJ3JlYWQnLCAncmVwbGllZCcsICdjbG9zZWQnXS5pbmNsdWRlcyhzdGF0dXMpKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgc3RhdHVzJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgY29udGFjdCA9IGF3YWl0IENvbnRhY3QuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCk7XG5cbiAgICBpZiAoIWNvbnRhY3QpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQ29udGFjdCBtZXNzYWdlIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnRhY3Quc3RhdHVzID0gc3RhdHVzO1xuICAgIGlmIChzdGF0dXMgIT09ICduZXcnKSB7XG4gICAgICBjb250YWN0LmlzUmVhZCA9IHRydWU7XG4gICAgfVxuICAgIGF3YWl0IGNvbnRhY3Quc2F2ZSgpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IGNvbnRhY3RcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdVcGRhdGUgY29udGFjdCBzdGF0dXMgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEByb3V0ZSAgIERFTEVURSAvYXBpL2NvbnRhY3QvOmlkXG4vLyBAZGVzYyAgICBEZWxldGUgY29udGFjdCBtZXNzYWdlIChBZG1pbiBvbmx5KVxuLy8gQGFjY2VzcyAgUHJpdmF0ZS9BZG1pblxucm91dGVyLmRlbGV0ZSgnLzppZCcsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY29udGFjdCA9IGF3YWl0IENvbnRhY3QuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCk7XG5cbiAgICBpZiAoIWNvbnRhY3QpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQ29udGFjdCBtZXNzYWdlIG5vdCBmb3VuZCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGF3YWl0IENvbnRhY3QuZmluZEJ5SWRBbmREZWxldGUocmVxLnBhcmFtcy5pZCk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ0NvbnRhY3QgbWVzc2FnZSBkZWxldGVkIHN1Y2Nlc3NmdWxseSdcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdEZWxldGUgY29udGFjdCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xuICAgIH0pO1xuICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUNHLE1BQU0sQ0FBQyxDQUFDO0FBQy9CLE1BQU1DLE9BQU8sR0FBR0gsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzVDLE1BQU07RUFBRUksT0FBTztFQUFFQztBQUFVLENBQUMsR0FBR0wsT0FBTyxDQUFDLG9CQUFvQixDQUFDOztBQUU1RDtBQUNBO0FBQ0E7QUFDQUMsTUFBTSxDQUFDSyxJQUFJLENBQUMsR0FBRyxFQUFFLE9BQU9DLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQ25DLElBQUk7SUFDRixNQUFNO01BQUVDLElBQUk7TUFBRUMsS0FBSztNQUFFQyxPQUFPO01BQUVDO0lBQVEsQ0FBQyxHQUFHTCxHQUFHLENBQUNNLElBQUk7O0lBRWxEO0lBQ0EsSUFBSSxDQUFDSixJQUFJLElBQUksQ0FBQ0MsS0FBSyxJQUFJLENBQUNDLE9BQU8sSUFBSSxDQUFDQyxPQUFPLEVBQUU7TUFDM0MsT0FBT0osR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztRQUMxQkMsT0FBTyxFQUFFLEtBQUs7UUFDZEosT0FBTyxFQUFFO01BQ1gsQ0FBQyxDQUFDO0lBQ0o7O0lBRUE7SUFDQSxNQUFNSyxPQUFPLEdBQUcsSUFBSWQsT0FBTyxDQUFDO01BQzFCTSxJQUFJLEVBQUVBLElBQUksQ0FBQ1MsSUFBSSxDQUFDLENB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","map":{"version":3,"names":["express","require","router","Router","Contact","protect","authorize","post","req","res","name","email","subject","message","body","status","json","success","contact","trim","save","data","ticketId","expectedResponseTime","error","console","get","page","parseInt","query","limit","skip","includes","contacts","find","sort","createdAt","total","countDocuments","pagination","current","pages","Math","ceil","findById","params","id","isRead","put","delete","findByIdAndDelete","module","exports"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\routes\\","sources":["contact.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst Contact = require('../models/Contact');\nconst { protect, authorize } = require('../middleware/auth');\n\n// @route   POST /api/contact\n// @desc    Submit contact form\n// @access  Public\nrouter.post('/', async (req, res) => {\n  try {\n    const { name, email, subject, message } = req.body;\n\n    // Validate required fields\n    if (!name || !email || !subject || !message) {\n      return res.status(400).json({\n        success: false,\n        message: 'All fields are required'\n      });\n    }\n\n    // Create new contact message\n    const contact = new Contact({\n      name: name.trim(),\n      email: email.trim(),\n      subject: subject.trim(),\n      message: message.trim()\n    });\n\n    await contact.save();\n\n    res.status(201).json({\n      success: true,\n      message: 'Your message has been received',\n      data: {\n        ticketId: contact.ticketId,\n        expectedResponseTime: '24-48 hours'\n      }\n    });\n  } catch (error) {\n    console.error('Contact form submission error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error. Please try again later.'\n    });\n  }\n});\n\n// @route   GET /api/contact\n// @desc    Get all contact messages (Admin only)\n// @access  Private/Admin\nrouter.get('/', protect, authorize('admin'), async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const status = req.query.status;\n    const skip = (page - 1) * limit;\n\n    // Build query\n    let query = {};\n    if (status && ['new', 'read', 'replied', 'closed'].includes(status)) {\n      query.status = status;\n    }\n\n    // Get contacts with pagination\n    const contacts = await Contact.find(query)\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(limit);\n\n    // Get total count for pagination\n    const total = await Contact.countDocuments(query);\n\n    res.json({\n      success: true,\n      data: {\n        contacts,\n        pagination: {\n          current: page,\n          pages: Math.ceil(total / limit),\n          total,\n          limit\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Get contacts error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   GET /api/contact/:id\n// @desc    Get single contact message (Admin only)\n// @access  Private/Admin\nrouter.get('/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const contact = await Contact.findById(req.params.id);\n\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    // Mark as read if not already\n    if (!contact.isRead) {\n      contact.isRead = true;\n      contact.status = 'read';\n      await contact.save();\n    }\n\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Get contact error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   PUT /api/contact/:id/status\n// @desc    Update contact message status (Admin only)\n// @access  Private/Admin\nrouter.put('/:id/status', protect, authorize('admin'), async (req, res) => {\n  try {\n    const { status } = req.body;\n\n    if (!['new', 'read', 'replied', 'closed'].includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid status'\n      });\n    }\n\n    const contact = await Contact.findById(req.params.id);\n\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    contact.status = status;\n    if (status !== 'new') {\n      contact.isRead = true;\n    }\n    await contact.save();\n\n    res.json({\n      success: true,\n      data: contact\n    });\n  } catch (error) {\n    console.error('Update contact status error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @route   DELETE /api/contact/:id\n// @desc    Delete contact message (Admin only)\n// @access  Private/Admin\nrouter.delete('/:id', protect, authorize('admin'), async (req, res) => {\n  try {\n    const contact = await Contact.findById(req.params.id);\n\n    if (!contact) {\n      return res.status(404).json({\n        success: false,\n        message: 'Contact message not found'\n      });\n    }\n\n    await Contact.findByIdAndDelete(req.params.id);\n\n    res.json({\n      success: true,\n      message: 'Contact message deleted successfully'\n    });\n  } catch (error) {\n    console.error('Delete contact error:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1757503867690},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"filename\":\"D:\\\\code\\\\WebCaffe\\\\backend\\\\src\\\\models\\\\Contact.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\code\\\\WebCaffe\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.28.4:development":{"value":{"code":"const mongoose = require('mongoose');\nconst contactSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: [true, 'Name is required'],\n    trim: true,\n    maxlength: [100, 'Name cannot exceed 100 characters']\n  },\n  email: {\n    type: String,\n    required: [true, 'Email is required'],\n    lowercase: true,\n    trim: true,\n    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email']\n  },\n  subject: {\n    type: String,\n    required: [true, 'Subject is required'],\n    trim: true,\n    maxlength: [200, 'Subject cannot exceed 200 characters']\n  },\n  message: {\n    type: String,\n    required: [true, 'Message is required'],\n    trim: true,\n    maxlength: [2000, 'Message cannot exceed 2000 characters']\n  },\n  ticketId: {\n    type: String,\n    unique: true,\n    required: false // Auto-generated in pre-save hook\n  },\n  status: {\n    type: String,\n    enum: ['new', 'read', 'replied', 'closed'],\n    default: 'new'\n  },\n  isRead: {\n    type: Boolean,\n    default: false\n  }\n}, {\n  timestamps: true // Adds createdAt and updatedAt automatically\n});\n\n// Generate ticket ID before saving\ncontactSchema.pre('save', function (next) {\n  if (!this.ticketId) {\n    this.ticketId = 'WC-' + Math.random().toString(36).substr(2, 6).toUpperCase();\n  }\n  next();\n});\n\n// Index for faster queries\ncontactSchema.index({\n  createdAt: -1\n});\ncontactSchema.index({\n  status: 1\n});\ncontactSchema.index({\n  ticketId: 1\n});\nmodule.exports = mongoose.model('Contact', contactSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJjb250YWN0U2NoZW1hIiwiU2NoZW1hIiwibmFtZSIsInR5cGUiLCJTdHJpbmciLCJyZXF1aXJlZCIsInRyaW0iLCJtYXhsZW5ndGgiLCJlbWFpbCIsImxvd2VyY2FzZSIsIm1hdGNoIiwic3ViamVjdCIsIm1lc3NhZ2UiLCJ0aWNrZXRJZCIsInVuaXF1ZSIsInN0YXR1cyIsImVudW0iLCJkZWZhdWx0IiwiaXNSZWFkIiwiQm9vbGVhbiIsInRpbWVzdGFtcHMiLCJwcmUiLCJuZXh0IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwidG9VcHBlckNhc2UiLCJpbmRleCIsImNyZWF0ZWRBdCIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2RlbCJdLCJzb3VyY2VSb290IjoiRDpcXGNvZGVcXFdlYkNhZmZlXFxiYWNrZW5kXFxzcmNcXG1vZGVsc1xcIiwic291cmNlcyI6WyJDb250YWN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcblxuY29uc3QgY29udGFjdFNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICBuYW1lOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ05hbWUgaXMgcmVxdWlyZWQnXSxcbiAgICB0cmltOiB0cnVlLFxuICAgIG1heGxlbmd0aDogWzEwMCwgJ05hbWUgY2Fubm90IGV4Y2VlZCAxMDAgY2hhcmFjdGVycyddXG4gIH0sXG4gIGVtYWlsOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ0VtYWlsIGlzIHJlcXVpcmVkJ10sXG4gICAgbG93ZXJjYXNlOiB0cnVlLFxuICAgIHRyaW06IHRydWUsXG4gICAgbWF0Y2g6IFsvXlxcdysoW1xcLi1dP1xcdyspKkBcXHcrKFtcXC4tXT9cXHcrKSooXFwuXFx3ezIsM30pKyQvLCAnUGxlYXNlIGVudGVyIGEgdmFsaWQgZW1haWwnXVxuICB9LFxuICBzdWJqZWN0OiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ1N1YmplY3QgaXMgcmVxdWlyZWQnXSxcbiAgICB0cmltOiB0cnVlLFxuICAgIG1heGxlbmd0aDogWzIwMCwgJ1N1YmplY3QgY2Fubm90IGV4Y2VlZCAyMDAgY2hhcmFjdGVycyddXG4gIH0sXG4gIG1lc3NhZ2U6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgcmVxdWlyZWQ6IFt0cnVlLCAnTWVzc2FnZSBpcyByZXF1aXJlZCddLFxuICAgIHRyaW06IHRydWUsXG4gICAgbWF4bGVuZ3RoOiBbMjAwMCwgJ01lc3NhZ2UgY2Fubm90IGV4Y2VlZCAyMDAwIGNoYXJhY3RlcnMnXVxuICB9LFxuICB0aWNrZXRJZDoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICB1bmlxdWU6IHRydWUsXG4gICAgcmVxdWlyZWQ6IGZhbHNlIC8vIEF1dG8tZ2VuZXJhdGVkIGluIHByZS1zYXZlIGhvb2tcbiAgfSxcbiAgc3RhdHVzOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIGVudW06IFsnbmV3JywgJ3JlYWQnLCAncmVwbGllZCcsICdjbG9zZWQnXSxcbiAgICBkZWZhdWx0OiAnbmV3J1xuICB9LFxuICBpc1JlYWQ6IHtcbiAgICB0eXBlOiBCb29sZWFuLFxuICAgIGRlZmF1bHQ6IGZhbHNlXG4gIH1cbn0sIHtcbiAgdGltZXN0YW1wczogdHJ1ZSAvLyBBZGRzIGNyZWF0ZWRBdCBhbmQgdXBkYXRlZEF0IGF1dG9tYXRpY2FsbHlcbn0pO1xuXG4vLyBHZW5lcmF0ZSB0aWNrZXQgSUQgYmVmb3JlIHNhdmluZ1xuY29udGFjdFNjaGVtYS5wcmUoJ3NhdmUnLCBmdW5jdGlvbihuZXh0KSB7XG4gIGlmICghdGhpcy50aWNrZXRJZCkge1xuICAgIHRoaXMudGlja2V0SWQgPSAnV0MtJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA2KS50b1VwcGVyQ2FzZSgpO1xuICB9XG4gIG5leHQoKTtcbn0pO1xuXG4vLyBJbmRleCBmb3IgZmFzdGVyIHF1ZXJpZXNcbmNvbnRhY3RTY2hlbWEuaW5kZXgoeyBjcmVhdGVkQXQ6IC0xIH0pO1xuY29udGFjdFNjaGVtYS5pbmRleCh7IHN0YXR1czogMSB9KTtcbmNvbnRhY3RTY2hlbWEuaW5kZXgoeyB0aWNrZXRJZDogMSB9KTtcblxubW9kdWxlLmV4cG9ydHMgPSBtb25nb29zZS5tb2RlbCgnQ29udGFjdCcsIGNvbnRhY3RTY2hlbWEpOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRXBDLE1BQU1DLGFBQWEsR0FBRyxJQUFJRixRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUN4Q0MsSUFBSSxFQUFFO0lBQ0pDLElBQUksRUFBRUMsTUFBTTtJQUNaQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsa0JBQWtCLENBQUM7SUFDcENDLElBQUksRUFBRSxJQUFJO0lBQ1ZDLFNBQVMsRUFBRSxDQUFDLEdBQUcsRUFBRSxtQ0FBbUM7RUFDdEQsQ0FBQztFQUNEQyxLQUFLLEVBQUU7SUFDTEwsSUFBSSxFQUFFQyxNQUFNO0lBQ1pDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxtQkFBbUIsQ0FBQztJQUNyQ0ksU0FBUyxFQUFFLElBQUk7SUFDZkgsSUFBSSxFQUFFLElBQUk7SUFDVkksS0FBSyxFQUFFLENBQUMsK0NBQStDLEVBQUUsNEJBQTRCO0VBQ3ZGLENBQUM7RUFDREMsT0FBTyxFQUFFO0lBQ1BSLElBQUksRUFBRUMsTUFBTTtJQUNaQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUscUJBQXFCLENBQUM7SUFDdkNDLElBQUksRUFBRSxJQUFJO0lBQ1ZDLFNBQVMsRUFBRSxDQUFDLEdBQUcsRUFBRSxzQ0FBc0M7RUFDekQsQ0FBQztFQUNESyxPQUFPLEVBQUU7SUFDUFQsSUFBSSxFQUFFQyxNQUFNO0lBQ1pDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxxQkFBcUIsQ0FBQztJQUN2Q0MsSUFBSSxFQUFFLElBQUk7SUFDVkMsU0FBUyxFQUFFLENBQUMsSUFBSSxFQUFFLHVDQUF1QztFQUMzRCxDQUFDO0VBQ0RNLFFBQVEsRUFBRTtJQUNSVixJQUFJLEVBQUVDLE1BQU07SUFDWlUsTUFBTSxFQUFFLElBQUk7SUFDWlQsUUFBUSxFQUFFLEtBQUssQ0FBQztFQUNsQixDQUFDO0VBQ0RVLE1BQU0sRUFBRTtJQUNOWixJQUFJLEVBQUVDLE1BQU07SUFDWlksSUFBSSxFQUFFLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsUUFBUSxDQUFDO0lBQzFDQyxPQUFPLEVBQUU7RUFDWCxDQUFDO0VBQ0RDLE1BQU0sRUFBRTtJQUNOZixJQUFJLEVBQUVnQixPQUFPO0lBQ2JGLE9BQU8sRUFBRTtFQUNYO0FBQ0YsQ0FBQyxFQUFFO0VBQ0RHLFVBQVUsRUFBRSxJQUFJLENBQUM7QUFDbkIsQ0FBQyxDQUFDOztBQUVGO0FBQ0FwQixhQUFhLENBQUNxQixHQUFHLENBQUMsTUFBTSxFQUFFLFVBQVNDLElBQUksRUFBRTtFQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDVCxRQUFRLEVBQUU7SUFDbEIsSUFBSSxDQUFDQSxRQUFRLEdBQUcsS0FBSyxHQUFHVSxJQUFJLENBQUNDLE1BQU0sQ0FBQyxDQUFDLENBQUNDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQ0MsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7RUFDL0U7RUFDQUwsSUFBSSxDQUFDLENBQUM7QUFDUixDQUFDLENBQUM7O0FBRUY7QUFDQXRCLGFBQWEsQ0FBQzRCLEtBQUssQ0FBQztFQUFFQyxTQUFTLEVBQUUsQ0FBQztBQUFFLENBQUMsQ0FBQztBQUN0QzdCLGFBQWEsQ0FBQzRCLEtBQUssQ0FBQztFQUFFYixNQUFNLEVBQUU7QUFBRSxDQUFDLENBQUM7QUFDbENmLGFBQWEsQ0FBQzRCLEtBQUssQ0FBQztFQUFFZixRQUFRLEVBQUU7QUFBRSxDQUFDLENBQUM7QUFFcENpQixNQUFNLENBQUNDLE9BQU8sR0FBR2pDLFFBQVEsQ0FBQ2tDLEtBQUssQ0FBQyxTQUFTLEVBQUVoQyxhQUFhLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=","map":{"version":3,"names":["mongoose","require","contactSchema","Schema","name","type","String","required","trim","maxlength","email","lowercase","match","subject","message","ticketId","unique","status","enum","default","isRead","Boolean","timestamps","pre","next","Math","random","toString","substr","toUpperCase","index","createdAt","module","exports","model"],"sourceRoot":"D:\\code\\WebCaffe\\backend\\src\\models\\","sources":["Contact.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst contactSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: [true, 'Name is required'],\n    trim: true,\n    maxlength: [100, 'Name cannot exceed 100 characters']\n  },\n  email: {\n    type: String,\n    required: [true, 'Email is required'],\n    lowercase: true,\n    trim: true,\n    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please enter a valid email']\n  },\n  subject: {\n    type: String,\n    required: [true, 'Subject is required'],\n    trim: true,\n    maxlength: [200, 'Subject cannot exceed 200 characters']\n  },\n  message: {\n    type: String,\n    required: [true, 'Message is required'],\n    trim: true,\n    maxlength: [2000, 'Message cannot exceed 2000 characters']\n  },\n  ticketId: {\n    type: String,\n    unique: true,\n    required: false // Auto-generated in pre-save hook\n  },\n  status: {\n    type: String,\n    enum: ['new', 'read', 'replied', 'closed'],\n    default: 'new'\n  },\n  isRead: {\n    type: Boolean,\n    default: false\n  }\n}, {\n  timestamps: true // Adds createdAt and updatedAt automatically\n});\n\n// Generate ticket ID before saving\ncontactSchema.pre('save', function(next) {\n  if (!this.ticketId) {\n    this.ticketId = 'WC-' + Math.random().toString(36).substr(2, 6).toUpperCase();\n  }\n  next();\n});\n\n// Index for faster queries\ncontactSchema.index({ createdAt: -1 });\ncontactSchema.index({ status: 1 });\ncontactSchema.index({ ticketId: 1 });\n\nmodule.exports = mongoose.model('Contact', contactSchema);"],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAMC,aAAa,GAAG,IAAIF,QAAQ,CAACG,MAAM,CAAC;EACxCC,IAAI,EAAE;IACJC,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,CAAC,IAAI,EAAE,kBAAkB,CAAC;IACpCC,IAAI,EAAE,IAAI;IACVC,SAAS,EAAE,CAAC,GAAG,EAAE,mCAAmC;EACtD,CAAC;EACDC,KAAK,EAAE;IACLL,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,CAAC,IAAI,EAAE,mBAAmB,CAAC;IACrCI,SAAS,EAAE,IAAI;IACfH,IAAI,EAAE,IAAI;IACVI,KAAK,EAAE,CAAC,+CAA+C,EAAE,4BAA4B;EACvF,CAAC;EACDC,OAAO,EAAE;IACPR,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,CAAC,IAAI,EAAE,qBAAqB,CAAC;IACvCC,IAAI,EAAE,IAAI;IACVC,SAAS,EAAE,CAAC,GAAG,EAAE,sCAAsC;EACzD,CAAC;EACDK,OAAO,EAAE;IACPT,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,CAAC,IAAI,EAAE,qBAAqB,CAAC;IACvCC,IAAI,EAAE,IAAI;IACVC,SAAS,EAAE,CAAC,IAAI,EAAE,uCAAuC;EAC3D,CAAC;EACDM,QAAQ,EAAE;IACRV,IAAI,EAAEC,MAAM;IACZU,MAAM,EAAE,IAAI;IACZT,QAAQ,EAAE,KAAK,CAAC;EAClB,CAAC;EACDU,MAAM,EAAE;IACNZ,IAAI,EAAEC,MAAM;IACZY,IAAI,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,QAAQ,CAAC;IAC1CC,OAAO,EAAE;EACX,CAAC;EACDC,MAAM,EAAE;IACNf,IAAI,EAAEgB,OAAO;IACbF,OAAO,EAAE;EACX;AACF,CAAC,EAAE;EACDG,UAAU,EAAE,IAAI,CAAC;AACnB,CAAC,CAAC;;AAEF;AACApB,aAAa,CAACqB,GAAG,CAAC,MAAM,EAAE,UAASC,IAAI,EAAE;EACvC,IAAI,CAAC,IAAI,CAACT,QAAQ,EAAE;IAClB,IAAI,CAACA,QAAQ,GAAG,KAAK,GAAGU,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;EAC/E;EACAL,IAAI,CAAC,CAAC;AACR,CAAC,CAAC;;AAEF;AACAtB,aAAa,CAAC4B,KAAK,CAAC;EAAEC,SAAS,EAAE,CAAC;AAAE,CAAC,CAAC;AACtC7B,aAAa,CAAC4B,KAAK,CAAC;EAAEb,MAAM,EAAE;AAAE,CAAC,CAAC;AAClCf,aAAa,CAAC4B,KAAK,CAAC;EAAEf,QAAQ,EAAE;AAAE,CAAC,CAAC;AAEpCiB,MAAM,CAACC,OAAO,GAAGjC,QAAQ,CAACkC,KAAK,CAAC,SAAS,EAAEhC,aAAa,CAAC","ignoreList":[]}},"mtime":1757504373425}}
>>>>>>> 6d4410d46a2eb43aa5901e5bf1a237da367043e4
